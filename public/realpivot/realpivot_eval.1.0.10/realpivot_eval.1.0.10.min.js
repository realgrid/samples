/*!
* RealPivot Evaluation v1.0.10.1330
* Copyright (C) 2013-2023 WooriTech Inc.
* All Rights Reserved.
*/
var RealPivotClass=function($){var _win=$||window,_doc=$&&$.document||document,_ver="1.0.10.1330",_getVersion=function(){return _ver},_vm__="goAAAANSUhEUgAAA",$_logging=!1,$_debug=!1,$_simpleMessage=!1,console=window.console,log=console&&"function"==typeof console.log?Function.prototype.bind.call(console.log,console):UNDEFINED,__epoch=(new Date).getTime();function _setLogging(e){$_logging=e}function _log(){log&&log.apply(console,arguments)}function _trace(){$_logging&&log&&log.apply(console,arguments)}var trace=_trace;function _getTimer(){return(new Date).getTime()-__epoch}function AssertError(e){this.message=$_simpleMessage?e:"[RealPivot Assert error] "+e}AssertError.prototype=new Error,AssertError.prototype.constructor=AssertError;var assert=function(e,t){if(!e)throw new AssertError(t)},$$_compareTextValue=(Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");function t(){return s.apply(this instanceof n?this:e,i.concat(Array.prototype.slice.call(arguments)))}var i=Array.prototype.slice.call(arguments,1),s=this,n=function(){};return n.prototype=this.prototype,t.prototype=new n,t}),String.prototype.trim||!function(){var e=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(e,"")}}(),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var i;if(null==this)throw new TypeError('"this" is null or not defined');var s=Object(this),n=s.length>>>0;if(0!=n){t=+t||0;if(!(n<=(t=Math.abs(t)===1/0?0:t)))for(i=Math.max(0<=t?t:n-Math.abs(t),0);i<n;){if(i in s&&s[i]===e)return i;i++}}return-1}),Array.prototype.filter||(Array.prototype.filter=function(e){"use strict";if(null==this)throw new TypeError;var t=Object(this),i=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var s,n=[],o=2<=arguments.length?arguments[1]:void 0,r=0;r<i;r++)r in t&&(s=t[r],e.call(o,s,r,t)&&n.push(s));return n}),!function(){var o=0;window.requestAnimationFrame||(window.requestAnimationFrame=function(e,t){var i=(new Date).getTime(),s=Math.max(0,16-(i-o)),n=window.setTimeout(function(){e(i+s)},s);return o=i+s,n})}(),function(e,t,i,s){if(e===t)return!0;e=String(e),t=String(t);return!e&&!t||!(!e||!t)&&(i||(e=e.toLowerCase(),t=t.toLowerCase()),s?0<=t.indexOf(e):e==t)}),$$_get_obj=function(e,t){for(var i=e,s=0,n=t.length-1;s<n;s++)var o=t[s],r=i[o],i=r=r===UNDEFINED?i[o]={}:r;return i},$$_expand_object=function(e){var t=[];for(i in e)0<=i.indexOf(".")&&t.push(i);if(0<t.length){var i,s={};for(i in e)s[i]=e[i];e=s;for(var n=t.length;n--;){var o=(i=t[n]).split(".");o[0]&&((s=$$_get_obj(e,o))[o[o.length-1]]=e[i])}}return e},deepCopy=function(e){if(null==e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e);for(var t=Array.isArray(e)?[]:{},i=Object.keys(e),s=0;s<i.length;s++){var n=i[s];e.hasOwnProperty(n)&&(t[n]=deepCopy(e[n]))}return t},makeArray=function(e,t){return null!=e?Array.isArray(e)?e:[e]:t?[]:void 0},arrayNameToObj=function(e,t){for(var i={},s=0,n=Math.min(e.length,t.length);s<n;s++)i[e[s]]=t[s];return i},objToArrayName=function(e,t){for(var i=[],s=0,n=e.length;s<n&&t.hasOwnProperty(e[s]);s++)i.push(t[e[s]]);return i},Dictionary=function(){this._values={},this._keys={}},MAX_INT=(Dictionary.prototype={constructor:Dictionary,containsKey:function(e){return e&&this._values.hasOwnProperty(e.$_hash)},isEmpty:function(){for(var e in this._values)return!1;return!0},set:function(e,t){if(!e||!e.$_hash)throw"Invalid key";this._values[e.$_hash]=t,this._keys[e.$_hash]=e},unset:function(e){return!(!e||!this._values.hasOwnProperty(e.$_hash))&&(delete this._values[e.$_hash],delete this._keys[e.$_hash],!0)},clear:function(){this._values={},this._keys={}},get:function(e){return e?this._values[e.$_hash]:void 0},keys:function(){var e,t=[];for(e in this._values)t.push(this._keys[e]);return t},values:function(){var e,t=[];for(e in this._values)t.push(this._values[e]);return t},each:function(e){for(var t in this._values)e.call(null,this._keys[t],this._values[t])},checkTrue:function(e){for(var t in this._values)if(e.call(null,this._keys[t],this._values[t]))return!0;return!1},checkFalse:function(e){for(var t in this._values)if(!e.call(null,this._keys[t],this._values[t]))return!0;return!1}},Math.pow(2,53)-1),MIN_INT=-MAX_INT;function _defined(e){return e!==UNDEFINED&&null!==e}function _isEmpty(e){}function _isEmptyObj(e){for(key in e)return!1;return!0}function _isNumber(e){return"number"==typeof e}function _isObj(e){return"object"==typeof e}function _isObject(e){return null!==e&&"object"==typeof e}function _isStr(e){return"string"==typeof e}function _isString(e){toString.call(e)}function _equalsText(e,t){e&&t&&(e.toLowerCase(),t.toLowerCase())}function _isWhiteSpace(e){e&&e.trim()}function _forceFloat(e){e=parseFloat(e),isNaN(e)}function _forceInt(e){return e=parseInt(e),isNaN(e)?0:e}function _isArray(e){return Array.isArray?Array.isArray(e):"[object Array]"===toString.call(e)}function _isFillArray(e){return _isArray(e)&&0<e.length}var isArray=_isArray;function _asArray(e){return(Array.isArray?Array.isArray(e):"[object Array]"===toString.call(e))?e:null}var asArray=_asArray;function _makeArray(e){_isArray(e)}function _equalsArray(e,t,i){if(_isArray(e)&&_isArray(t)){var s=e.length;if(t.length==s){for(var n=0;n<s;n++)if("object"==typeof e[n]&&"object"==typeof t[n]){if(i?!_equalsObjDeep(e[n],t[n]):!_equalsObj(e[n],t[n]))return}else if(e[n]!=t[n])return;return 1}}}function _equalsObjDeep(e,t){if(e==t)return 1;if(e&&t&&Object.keys(e).length==Object.keys(t).length){for(var i in e){if(!t.hasOwnProperty(i))return;var s=e[i],n=t[i];if(typeof s!=typeof n)return;if(_isArray(s)&&_isArray(n)){if(!_equalsArray(s,n,!0))return}else if(_isObj(s)&&_isObj(n)){if(!_equalsObjDeep(e[i],t[i]))return}else if(s instanceof Date&&n instanceof Date){if(s.getTime()!==n.getTime())return}else if(s!=n)return}return 1}}function _equalsObj(e,t){for(var i in e){if(!t||!t.hasOwnProperty(i))return!1;if(e[i]!==t[i])return!1}for(i in t){if(!e||!e.hasOwnProperty(i))return!1;if(t[i]!==e[i])return!1}return!0}function _equalsObjEx(e,t,i){for(attr in e)if(attr!=i){if(!t.hasOwnProperty(attr))return;if(e[attr]!==t[attr])return}for(attr in t)if(attr!=i){if(!e.hasOwnProperty(attr))return;if(t[attr]!==e[attr])return}return 1}function _indexOfObj(e,t,i){for(var s=0,n=e.length;s<n;s++)if(e[s][t]===i)return s;return-1}function _included(e){for(var t=arguments,i=t.length,s=1;s<i;s++)if(t[s]==e)return 1}function _getObj(e,t){if(e&&t)for(var i=t.split("."),s=e,n=0,o=i.length;s&&n<o;n++)s=s[i[n]]}function _toStr(e){"number"==typeof e?isNaN(e)||String(e):null!=e&&String(e)}function _toLowerCase(e){if(null!=e)return String(e).toLowerCase()}function _toUpperCase(e){if(null!=e)return String(e).toUpperCase()}function _strLen(e){if(null!=e)return String(e).length}function _pad(e,t,i){return t=Math.max(t||2,1),i=i||0,new Array(t-String(e).length+1).join(i)+e}var pad=_pad;function hex(e,t,i){t=Math.max(t||2,1),i=i||0;e=e.toString(16);return new Array(t-e.toString(16).length+1).join(i)+e}function toInt(e,t){return e!==UNDEFINED&&null!==e?parseInt(e,t||10):0}function toFloat(e){e!==UNDEFINED&&null!==e&&parseFloat(e)}var $$_week_days=window.RG_CONST&&window.RG_CONST.WEEKDAYS?window.RG_CONST.WEEKDAYS:["일","월","화","수","목","금","토"],$$_month_days=[[31,28,31,30,31,30,31,31,30,31,30,31],[31,29,31,30,31,30,31,31,30,31,30,31]];function _isDate(e){return e&&"[object Date]"===Object.prototype.toString.call(e)}function _isLeapYear(e){return e%4==0&&e%100!=0||e%400==0}function _incMonth(e,t){var i=e.getDate();e.setDate(1),e.setMonth(e.getMonth()+t),e.setDate(Math.min(i,$$_month_days[_isLeapYear(e.getYear())?1:0][e.getMonth()]))}function _minDate(e,t){null===e&&null===t&&(e.getTime(),t.getTime())}function _maxDate(e,t){null===e&&null===t&&(e.getTime(),t.getTime())}function _toArray(e){return _isArray(e)?e:defined(e)?[e]:null}var toArray=_toArray;function incArray(e,t){e.push(t)}function _getter(e){e.chartAt(0).toUpperCase(),e.substr(1)}function _setter(e){e.charAt(0).toUpperCase(),e.substr(1)}function _isWhitespace(e){return/\s/.test(e)}function _trim(e){return e?e.trim():null}var trim=_trim;function _stopEvent(e){e.preventDefault?(e.preventDefault(),e.stopPropagation()):e.returnValue=!1}function _capitalize(e){return e.charAt(0).toUpperCase()+e.substr(1)}function byteLength(e){var t;for(t=0;e.charCodeAt(t++););}function _createProperties(e,t,i){if(t)for(var s=t.split(","),n=0,o=t.length;n<o;n++)e[s[n]]=i}var _floor=Math.floor,_int=Math.floor,_round=Math.round,_ceil=Math.ceil,_min=Math.min,_max=Math.max,_abs=Math.abs;function _clone(e){var t,i=new e.constructor;for(t in e)i[t]=e[t];return i}function _extend(e){e=e||{};for(var t=1,i=arguments.length;t<i;t++){var s=arguments[t];if(s)for(var n in s)e[n]=s[n]}return e}function _deepExtend(e){e=e||{};for(var t=1,i=arguments.length;t<i;t++){var s=arguments[t];if(s)for(var n in s){var o=s[n];if(_isArray(o)){for(var r=[],l=0;l<o.length;l++)r.push(_deepExtend(o[l]));o=r}else _isObject(o)&&(o=_deepExtend({},o));e[n]=o}}return e}function decimalAdjust(e,t,i){return void 0===i||0==+i?Math[e](t):(t=+t,i=+i,isNaN(t)||"number"!=typeof i||i%1!=0?NaN:(t=t.toString().split("e"),+((t=(t=Math[e](+(t[0]+"e"+(t[1]?+t[1]-i:-i)))).toString().split("e"))[0]+"e"+(t[1]?+t[1]+i:i))))}var _round10=function(e,t){return decimalAdjust("round",e,t)},_floor10=function(e,t){return decimalAdjust("floor",e,t)},_ceil10=function(e,t){return decimalAdjust("ceil",e,t)},_trimNumber=function(e,t){return t=null==t?10:t,Math.round(e*Math.pow(10,t))/Math.pow(10,t)},_isMac=0<=navigator.platform.toUpperCase().indexOf("MAC"),_isOpera=!!window.opera||0<=navigator.userAgent.indexOf(" OPR/"),_isFirefox="undefined"!=typeof InstallTrigger,_isSafari=0<Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor"),_isChrome=!!window.chrome&&!_isOpera,_isIE=!!document.documentMode,_isEdge=0<=navigator.userAgent.toLowerCase().indexOf("edge/"),_ieVer=function(){for(var e=3,t=document.createElement("div"),i=t.getElementsByTagName("i");t.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i></i><![endif]--\x3e",i[0];);return 4<e?e:void 0}(),_ieOld=void 0!==_ieVer&&_ieVer<=9,_ieLeg=void 0!==_ieVer&&_ieVer<=8,_norgba=!1,_ieTen=-1!==navigator.appVersion.indexOf("MSIE 10"),_ieNine=-1!==navigator.appVersion.indexOf("MSIE 9"),_getBrowserSize=(!function(){var e,t=document.createElement("div"),i=!1;try{e=t.getBoundingClientRect()}catch(e){i=!0}i||isNaN(e.width)?Element.prototype.getBoundingClientRect2=function(){var e=Element.prototype.getBoundingClientRect.call(this);return{left:e.left,right:e.right,width:e.right-e.left,top:e.top,bottom:e.bottom,height:e.bottom-e.top}}:Element.prototype.getBoundingClientRect2=Element.prototype.getBoundingClientRect;try{t.style.background="rgba(0, 0, 0, 1)"}catch(e){_norgba=!0}}(),Object.defineProperty&&Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(Element.prototype,"textContent")&&!Object.getOwnPropertyDescriptor(Element.prototype,"textContent").get&&!function(){var t=Object.getOwnPropertyDescriptor(Element.prototype,"innerText");Object.defineProperty(Element.prototype,"textContent",{get:function(){return t.get.call(this)},set:function(e){return t.set.call(this,e)}})}(),function(){return{width:_win.innerWidth||_doc.documentElement.clientWidth||_doc.body.clientWidth,height:_win.innerHeight||_doc.documentElement.clientHeight||_doc.body.clientHeight}}),__performanceEnabled=performance&&performance.now,_performenceCountStart=function(){return(__performanceEnabled?performance:Date).now()},_performenceCountEnd=function(e){return __performanceEnabled?performance.now()-e:Date.now()-e},$$_defComparer=function(e,t,i){return t==i?0:i<t?1:-1},PivotHelper={sortLabels:function(e,t,i,s,n,o){var r,l,a,h,u,c;do{a=_floor(((r=n)+(l=o))/2);do{if(i){for(;r<=l&&(h=r,!((u=0==(u=s(t,e[a]._value,e[h]._value))?a-h:u)<=0));)r++;for(;r<=l&&(h=l,!(0<=(u=0==(u=s(t,e[a]._value,e[h]._value))?a-h:u)));)l--}else{for(;r<=l&&(h=r,!(0<=(u=0==(u=s(t,e[a]._value,e[h]._value))?h-a:u)));)r++;for(;r<=l&&(h=l,!((u=0==(u=s(t,e[a]._value,e[h]._value))?h-a:u)<=0));)l--}}while(r<=l&&(r!=l&&(c=e[r],e[r]=e[l],e[l]=c),r++,l--),r<=l)}while(n<l&&this.sortLabels(e,t,i,s,n,l),(n=r)<o)},sortValues:function(e,t,i,s,n,o){var r,l,a,h,u,c;do{a=_floor(((r=n)+(l=o))/2);do{if(i){for(;r<=l&&(h=r,!((u=0==(u=s(t,e[a]._value.value,e[h]._value.value))?a-h:u)<=0));)r++;for(;r<=l&&(h=l,!(0<=(u=0==(u=s(t,e[a]._value.value,e[h]._value.value))?a-h:u)));)l--}else{for(;r<=l&&(h=r,!(0<=(u=0==(u=s(t,e[a]._value.value,e[h]._value.value))?h-a:u)));)r++;for(;r<=l&&(h=l,!((u=0==(u=s(t,e[a]._value.value,e[h]._value.value))?h-a:u)<=0));)l--}}while(r<=l&&(r!=l&&(c=e[r],e[r]=e[l],e[l]=c),r++,l--),r<=l)}while(n<l&&this.sortValues(e,t,i,s,n,l),(n=r)<o)},asyncLoop:function(e,t,i,s,n,o,r){for(var l=e;l<=t&&!(e+i<=l);l++)n(l);l<t?(o(l),setTimeout(function(){PivotHelper.asyncLoop(l,t,i,s,n,o,r)}.bind(s))):r&&r()},splitEscape:function(e,t){if(e){var i=[],s=!1,n="";t=t||",";for(var o=0;o<e.length;o++){var r=e[o];r!=t||s?" "==r&&!s||(n+=r):(i.push(n),n=""),"("==r&&(s=!0),")"==r&&(s=!1)}return n&&i.push(n),i}return null},removeTags:function(e){return e&&e.replace(/<\/?[^>]+(>|$)/g,"")},unionArray:function(t,e){0<t.length?t.push.apply(e.filter(function(e){return-1==t.indexOf(e)})):t.push.apply(e)}},UNDEFINED;function _parseXml(t){var i=null;try{(i=new ActiveXObject("Microsoft.XMLDOM")).async=!1,i.loadXML(t)}catch(e){if(i)throw e;i=(new DOMParser).parseFromString(t,"text/xml")}return i}function _xmlToStr(t){if(t)try{return(new XMLSerializer).serializeToString(t)}catch(e){return t.xml}}function _getXmlList(e,t){var i=[];if(e){var s=e.childNodes;if(s)for(var n=0,o=s.length;n<o;n++){var r=s[n];r.tagName===t&&i.push(r)}}}function _getNodeValue(e){e.firstChild.nodeValue}function _getXmlAttr(e,t){e&&e.getAttribute(t)}function _setXmlAttr(e,t,i){e.setAttribute(t,i)}function _addChildWithAttr(e,t,i,s,n){e=e.createElement(i);s&&e.setAttribute(s,n),t.appendChild(e)}var $_csvreg=/,(?=(?:[^\"]*\"[^\"]*\")*(?![^\"]*\"))/,$_linereg=/\r|\n|\r\n/,PI=Math.PI,_2PI=2*Math.PI,MAX_INT=Math.pow(2,53)-1,MIN_INT=-MAX_INT,ZERO=0,INIT_INDEX=-1,MAX_DITINCT=100,STYLE_PIXEL="px",NUMBER_TAIL=Math.pow(10,10),CELL_MIN_WIDTH=3,CELL_MIN_HEIGHT=13,$$DATAROW$$="$$dataRow$$",Base64={SUFFIX:"=",CHARACTERS:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",decode:function(e){for(var t=Base64.CHARACTERS,i=Base64.SUFFIX,s=e.split(""),n=[],o=s.length;s[--o]==i;);for(var r=0;r<o;){var l=t.indexOf(s[r++])<<18;r<=o&&(l|=t.indexOf(s[r++])<<12),r<=o&&(l|=t.indexOf(s[r++])<<6),r<=o&&(l|=t.indexOf(s[r++])),n.push(l>>>16&255),n.push(l>>>8&255),n.push(255&l)}for(;0==n[n.length-1];)n.pop();return n}},Cryptor={POW2:Math.pow(2,2),POW3:Math.pow(2,3),POW4:Math.pow(2,4),POW8:Math.pow(2,8),POW16:Math.pow(2,16),POW24:Math.pow(2,24),kb:{p:[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],s0:[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],s1:[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],s2:[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],s3:[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462],k:[202,218,204,100]},union:function(e,t){var i=t.s3[255&e],s=t.s2[255&(e>>=8)],n=t.s1[255&(e>>=8)],t=t.s0[255&(e>>=8)],e=(t>>16)+(n>>16)+((65535&t)+(65535&n)>>16)<<16|(65535&t)+(65535&n)&65535;return((e=(e>>16^s>>16)<<16|65535&(65535&e^65535&s))>>16)+(i>>16)+((65535&e)+(65535&i)>>16)<<16|(65535&e)+(65535&i)&65535},xor:function(e,t){return(e>>16^t>>16)<<16|65535&(65535&e^65535&t)},_encryptBlock:function(e,t){var i=e.left,s=e.right,n=Cryptor.xor,o=Cryptor.union,i=n(i,t.p[0]),s=n(s,n(o(i,t),t.p[1]));i=n(i,n(o(s,t),t.p[2])),s=n(s,n(o(i,t),t.p[3])),i=n(i,n(o(s,t),t.p[4])),s=n(s,n(o(i,t),t.p[5])),i=n(i,n(o(s,t),t.p[6])),s=n(s,n(o(i,t),t.p[7])),i=n(i,n(o(s,t),t.p[8])),s=n(s,n(o(i,t),t.p[9])),i=n(i,n(o(s,t),t.p[10])),s=n(s,n(o(i,t),t.p[11])),i=n(i,n(o(s,t),t.p[12])),s=n(s,n(o(i,t),t.p[13])),i=n(i,n(o(s,t),t.p[14])),s=n(s,n(o(i,t),t.p[15])),i=n(i,n(o(s,t),t.p[16])),e.right=i,e.left=n(s,t.p[17])},_decryptBlock:function(e,t){var i=e.left,s=e.right,n=Cryptor.xor,o=Cryptor.union,i=n(i,t.p[17]),s=n(s,n(o(i,t),t.p[16]));i=n(i,n(o(s,t),t.p[15])),s=n(s,n(o(i,t),t.p[14])),i=n(i,n(o(s,t),t.p[13])),s=n(s,n(o(i,t),t.p[12])),i=n(i,n(o(s,t),t.p[11])),s=n(s,n(o(i,t),t.p[10])),i=n(i,n(o(s,t),t.p[9])),s=n(s,n(o(i,t),t.p[8])),i=n(i,n(o(s,t),t.p[7])),s=n(s,n(o(i,t),t.p[6])),i=n(i,n(o(s,t),t.p[5])),s=n(s,n(o(i,t),t.p[4])),i=n(i,n(o(s,t),t.p[3])),s=n(s,n(o(i,t),t.p[2])),i=n(i,n(o(s,t),t.p[1])),e.right=i,e.left=n(s,t.p[0])},_init:function(e){for(var t,s=e.split("").map(function(e){return 255&e.charCodeAt(0)}),e=Cryptor.kb,i=Cryptor._encryptBlock,n=0,o=0,r={left:0,right:0},l={p:e.p.slice(0).map(function(e){for(var t=s.length,i=0;i<4;i++)o=o*Cryptor.POW8|s[n++%t];return(e>>16^o>>16)<<16|65535&(65535&e^65535&o)}),s0:e.s0.slice(0),s1:e.s1.slice(0),s2:e.s2.slice(0),s3:e.s3.slice(0)},a=0,h=l.p.length;a<h;)i(r,l),l.p[a++]=r.left,l.p[a++]=r.right;for(a=0;a<4;a++)for(t=0,h=l["s"+a].length;t<h;)i(r,l),l["s"+a][t++]=r.left,l["s"+a][t++]=r.right;return l},decrypt:function(e,t){for(var i=Cryptor._decryptBlock,s=Cryptor._init(t),n=[],o=Base64.decode(e),r=o.length>>3,l=0,a={left:null,right:null},h=0;h<r;h++){a.left=o[l]*Cryptor.POW24|o[l+1]*Cryptor.POW16|o[l+2]*Cryptor.POW8|o[l+3],a.right=o[l+4]*Cryptor.POW24|o[l+5]*Cryptor.POW16|o[l+6]*Cryptor.POW8|o[l+7],i(a,s);var u=a.left,c=a.right;n.push(u>>24&255),n.push(u>>16&255),n.push(u>>8&255),n.push(255&u),n.push(c>>24&255),n.push(c>>16&255),n.push(c>>8&255),n.push(255&c),l+=8}return n[n.length-1]!=n[n.length-2]&&1!=n[n.length-1]||(t=n[n.length-1],n.splice(n.length-t,t)),n.map(function(e){return String.fromCharCode(e)}).join("")}},AppInfo={PRODUCT:"RealPivot",TYPE:"Evaluation",VERSION:"v1.0",toString:function(){return this.PRODUCT+" "+this.VERSION+" "+this.TYPE}};function $_equalServer(e,t){return e==t||0===e.indexOf("*")&&(e=e.substr(1,e.length-1),t.substr(t.indexOf(e),e.length)==e)}function $_checkIncludeDomain(e,t){for(var i,s=0,n=(i=e.split(",")).length;s<n;s++)if($_equalServer(i[s],t))return 1}function $_getLDKey(e){for(var t="",i=0,s=e.length;i<s;i++)t+=String.fromCharCode(e[i]>>1);return t}function $_decryptLic(e){for(var t={},i=Cryptor.decrypt(e,_gk+$_getLDKey([202,218,204,100]),{outputType:0,cipherMode:0}).split(";"),s=0,n=i.length;s<n;s++){var o=i[s].split("="),r=o[0],o=o[1];o&&0<o.length&&(t[r]=o)}return t}var __lck=function(){var e=location.hostname;try{t=realPivotLic}catch(e){return!1}if(!t)return!1;var t=$_decryptLic(t);if(t.name!=AppInfo.PRODUCT)return!1;if((t.vender||null)!=(AppInfo.VENDOR||null))return!1;var i=t.server.toLowerCase();if("Developer"!=AppInfo.TYPE&&!$_checkIncludeDomain(i,e.toLowerCase()))return!1;if("limited"!=(licType=t.lic.toLowerCase())&&t.lic!=AppInfo.TYPE)return!1;if("evaluation"==licType||"asp"==licType||"limited"==licType){i=t.expire.split("."),e=new Date(i[0],i[1],i[2],23,59,59,999);if(new Date>e)return!1}return!0},_IntegerProperty=function(e){this.defaultValue=e},IntProp_0=new _IntegerProperty(0),IntProp=function(e){return new _IntegerProperty(e)},_INHERITTING={},BaseClass=function(){},defineClass=(BaseClass.$_hash=0,function(e,t,i,s,n){if(null!==t&&"function"!=typeof t)throw"Base class is not a function";function o(){arguments[0]!==_INHERITTING&&(this.$inited=!1,this.init&&this.init.apply(this,arguments),this.$inited=!0)}var r,l,a,h,u,c,d=o.prototype=new(t||BaseClass)(_INHERITTING),_=null;if(d.constructor=o,d.$base=(t||BaseClass).prototype,d.$name=e,i){var f={},p=o.$inits={};for(_ in i)"function"==typeof(r=i[_])?(r.$name=_,(r.$owner=d)[_]=r):(r&&r.init&&(r=r.init),f[_]=r);for(_ in o.$attrs={},f)r=i[_],e=_capitalize(_),l="boolean"==typeof r?"is"+e:_,h="set"+e,c=_+"PropChanged",u=null,d.hasOwnProperty(a=_+"_")?(u=d[a],delete d[a]):r&&r.get?u=r.get:d.hasOwnProperty(l)||(u=function(e){return function(){return this["_"+e]}}(_)),u&&(u.$name=l,(u.$owner=d)[l]=u),u=null,r&&r.set?u=r.set:d.hasOwnProperty(h)||(u=(r instanceof _IntegerProperty?function(i,s){return function(e){var t;return e=parseInt(e),!isNaN(e)&&d[s]&&(t=d[s].call(this))!=e&&(this["_"+i]=e,this.$inited&&(this[c]?this[c].call(this,i,t,e):this.propertyChanged(i,t,e))),this}}:function(i,s){return function(e){var t;return d[s]&&(t=d[s].call(this))!=e&&(this["_"+i]=e,this.$inited&&(this[c]?this[c].call(this,i,t,e):this.propertyChanged(i,t,e))),this}})(_,l)),u&&(u.$name=h,(u.$owner=d)[h]=u),r&&(r instanceof _IntegerProperty?f[_]=r.defaultValue:"function"==typeof r.init?p[_]=r.init:r.hasOwnProperty("value")&&(f[_]=r.value)),o.$attrs[_]={field:"_"+_,value:f[_],get:d[l],set:d[h]}}if(s)for(_ in s)o[_]=s[_];return"function"==typeof n&&n.call(o,o),o});function _throwCallerError(){throw new Error("Not supported Function.caller")}function _throwInvalidMethod(e){throw new Error("Method is not exists: "+e)}BaseClass.prototype.constructor=BaseClass,BaseClass.prototype.init=function(e){e||(this.$_hash=String(++BaseClass.$_hash));for(var t=this.constructor;t;){var i=t.$inits,s=t.$attrs;if(s)for(var n in s){var o=i[n],n=s[n],o=o?o.call(this):n.value;this[n.field]=o}t=t.prototype.$base&&t.prototype.$base.constructor}},BaseClass.prototype.destroy=function(e){};var Base=BaseClass.prototype;function $$_getProxy(e){if(_isArray(e)){for(var t=[],i=0,s=e.length;i<s;i++)t.push($$_getProxy(e[i]));return t}return"function"==typeof e.proxy?e.proxy():e}BaseClass.prototype._super=function(){var e=this._super.caller;if(e){if(e=e.$owner.$base[e.$name])return e.apply(this,arguments)}else _throwCallerError()},BaseClass.prototype._inherit=function(e){this.constructor.prototype.$base[e].apply(this,Array.prototype.slice.call(arguments,1))},BaseClass.prototype.className=function(){return this.constructor.prototype.$name},BaseClass.prototype.baseClass=function(){return this.constructor.prototype.$base},BaseClass.prototype.baseClassName=function(){var e=this.constructor.prototype.$base;return e&&e.$name},BaseClass.prototype.clone=function(){var e,t,i=this.constructor,s=new i,n=i.$attrs;for(t in n)s[(e=n[t]).field]=this[e.field];return s},BaseClass.prototype.propertyChanged=function(e,t,i){},BaseClass.prototype.getAttr=function(e){for(var t=this.constructor;t;){var i=t.$attrs;if(i&&e in i)return i[e];t=t.prototype.$base&&t.prototype.$base.constructor}return null},BaseClass.prototype.getProperty=function(e){e=this.getAttr(e);return e?e.get?e.get.call(this):e:UNDEFINED},BaseClass.prototype.setProperty=function(e,t){e=this.getAttr(e);e&&e.set&&e.set.call(this,t)},BaseClass.prototype._initProps=function(e){if(e)for(var t in e){var i="_"+t;this.hasOwnProperty(i)&&(this[i]=e[t])}},BaseClass.prototype.assign=function(e){if(e instanceof BaseClass){if(e!==this)for(var t=e.constructor;t;){var i=t.$attrs;for(r in i){var s,n,o=this.getAttr(r);o&&o.set&&(n=i[r]).get&&(s=n.get.call(e),o.set.call(this,s))}t=t.prototype.$base&&t.prototype.$base.constructor}}else if(_isObject(e)){if(e!==this)for(var r in e)e[r]!==UNDEFINED&&(n=this.getAttr(r))&&n.set&&n.set.call(this,e[r])}else this.assignSimple(e)},BaseClass.prototype.assignSimple=function(e){},BaseClass.prototype.assignProps=function(e,t){if(e&&e!==this&&t)for(var i=0,s=t.length;i<s;i++){var n,o=t[i];!e.hasOwnProperty(o)||(n=this.getAttr(o))&&n.set&&n.set.call(this,e[o])}},BaseClass.prototype.proxy=function(e){e=!(0<arguments.length)||e;for(var t,i,s={},n=this.constructor;n;){for(var o in t=n.$attrs)!(i=t[o]).get||(i=i.get.call(this))&&i.noProxy||(i=i&&$$_getProxy(i),s[o]=i);n=n.prototype.$base&&n.prototype.$base.constructor}return e&&(s.$_hash=this.$_hash),s},BaseClass.prototype.as=function(e){return this instanceof e?this:null};var throwDebugError=function(e){if($_debug)throw e},_throwAbstractError=function(){var e=arguments.callee.caller;throw Errors.NOT_YET_IMPLEMENTED+": "+e.$owner.$name+"::"+e.$name},throwAbstractError=_throwAbstractError,_cast=function(e,t){return e instanceof t?e:null},EventAware=defineClass(null,null,{init:function(e){this._super(e),this._listeners=[]},destroy:function(){for(var e=this._listeners.length;e--;)this._listeners[e]=null;this._listeners=null,this._super()},addListener:function(e,t){return e&&this._listeners.indexOf(e)<0&&(null!=t&&INIT_INDEX<t?this._listeners.splice(t,0,e):this._listeners.push(e)),this},removeListener:function(e){return e&&(e=this._listeners.indexOf(e))>INIT_INDEX&&this._listeners.splice(e,1),this},fireEvent:function(e){var t,i,s,n=this._listeners.length,o=Array.prototype.slice.call(arguments,0);for(o[0]=this,t=0;t<n;t++)(s=(i=this._listeners[t])[e])&&s.apply(i,o)},fireConfirmEvent:function(e){var t,i,s=this._listeners.length,n=Array.prototype.slice.call(arguments,0);for(n[0]=this,t=0;t<s;t++)if(o=(i=this._listeners[t])[e]){var o=o.apply(i,n);if("boolean"==typeof o&&!o)return!1}return!0},fireMessageEvent:function(e){var t,i,s=this._listeners.length,n=Array.prototype.slice.call(arguments,0);for(n[0]=this,t=0;t<s;t++)if(o=(i=this._listeners[t])[e]){var o=o.apply(i,n);if("string"==typeof o&&o)return o}return null},fireObjectEvent:function(e){var t,i,s=this._listeners.length,n=Array.prototype.slice.call(arguments,0);for(n[0]=this,t=0;t<s;t++)if(o=(i=this._listeners[t])[e]){var o=o.apply(i,n);if(o)return o}return null}}),EventAware$=EventAware.prototype;function _enum(e){return Object.freeze?Object.freeze(e):e}var VisualElement=defineClass("VisualElement",EventAware,{init:function(){this._super(),this._parent=null,this._parentElement=null,this._container=null,this._childs=[],this._dirty=!1,this._mouseEnabled=!0,this._isContainer=!1,this._hovered=!1,this._mask=null,this._spaceWidth=0,this._spaceHeight=0,this._childFixed=!1,this._element=_doc.createElement("div"),this._css=this._element.style},destroy:function(){for(var e=this._childs.length;e--;)this._childs[e].destroy(),this._childs[e]=null;this._childs=null,this._mask&&this._mask.destroy(),this._mask=null,this._parent=null,this._element.parentNode&&this._element.parentNode.removeChild(this._element),this._element=null,this._super()},left:-1,top:-1,width:0,height:0,visible:!0,centerX:function(){return this._left+_int(this._width/2)},centerY:function(){return this._top+_int(this._height/2)},innerWidth:function(){return this._width-this._spaceWidth},innerHeight:function(){return this._height-this._spaceHeight},cssClass:function(){return this._element.className},setCssClass:function(e){e!=this._element.className&&(this._element.className=e)},setLeft:function(e){e!=this._left&&(this._left=e,this._css.left=e+STYLE_PIXEL)},setTop:function(e){e!=this._top&&(this._top=e,this._css.top=e+STYLE_PIXEL)},setWidth:function(e){(e=Math.max(0,e))!=this._width&&(this._width=e,this._css.width=e-this._spaceWidth+STYLE_PIXEL)},setHeight:function(e){(e=Math.max(0,e))!=this._height&&(this._height=e,this._css.height=e-this._spaceHeight+STYLE_PIXEL)},setSpace:function(e,t){this._spaceWidth=e,this._spaceHeight=t},setVisible:function(e){e!=this._visible&&((this._visible=e)?this._css.removeProperty("display"):this._css.display="none")},container:function(){return this._parent&&this._parent.container()},parent:function(){return this._parent},setParent:function(e){(this._parent=e)&&e._container&&(this._container=e._container)},childCount:function(){return this._childs?this._childs.length:0},isSingleton:function(){return 1==this._parent.childCount()},mouseX:function(){var e=this._container;if(e){for(var t=e._currentX,i=this;i&&i!==UNDEFINED;)t-=i._left,i=i._parent;return t}return NaN},mouseY:function(){var e=this._container;if(e){for(var t=e._currentY,i=this;i&&i!==UNDEFINED;)t-=i._top,i=i._parent;return t}return NaN},mask:function(){return this._mask},setMask:function(e){this._mask=e?e.clone():null},isLayer:function(){return!1},isClickable:function(){return!1},setMouseEnabled:function(e){this._mouseEnabled=e},canHover:function(){return!0},isHovered:function(){return this._hovered},setHovered:function(e){e!=this._hovered&&(this._hovered=e)},getChildren:function(){return this._childs&&this._childs.concat()},getChild:function(e){return this._childs?this._childs[e]:null},getChildIndex:function(e){return this._childs?this._childs.indexOf(e):-1},contains:function(e){return!!this._childs&&this._childs.indexOf(e)>INIT_INDEX},_calcOuterSpace:function(){var e=getComputedStyle(this._element,null);"border-box"!=e["box-sizing"]&&"border-box"!=e["-webkit-box-sizing"]&&"border-box"!=e["-moz-box-sizing"]&&(this._spaceWidth=_forceInt(e.getPropertyValue("border-left-width"))+_forceInt(e.getPropertyValue("border-right-width"))+_forceInt(e.getPropertyValue("padding-left"))+_forceInt(e.getPropertyValue("padding-right"))+_forceInt(e.getPropertyValue("margin-left"))+_forceInt(e.getPropertyValue("margin-right")),this._spaceHeight=_forceInt(e.getPropertyValue("border-top-width"))+_forceInt(e.getPropertyValue("border-bottom-width"))+_forceInt(e.getPropertyValue("padding-top"))+_forceInt(e.getPropertyValue("padding-bottom"))+_forceInt(e.getPropertyValue("margin-top"))+_forceInt(e.getPropertyValue("margin-bottom")))},setParentElement:function(e){this._parentElement=e},addChild:function(e,t){e instanceof VisualElement&&!this.contains(e)&&(this._childs||(this._childs=[]),t?t.appendChild(e._element):this._element&&this._element.appendChild(e._element),this._childs.push(e),e.setParentElement(t||this._element),e.setParent(this))},insertChildAt:function(e,t){t<this._childs.length?e instanceof VisualElement&&!this.contains(e)&&(this._childs||(this._childs=[]),this._element.insertBefore(e._element,this._childs[t]._element),this._childs.splice(t,0,e)):this.addChild(e)},moveChildTo:function(e,t){var i,s;-1<=t&&t<this._childs.length&&(t!=(i=this._childs.indexOf(e))&&(this._element.removeChild(e._element),-1==t?(this._element.appendChild(e._element),t=this._childs.length):(s=this._childs[t]._element,this._element.insertBefore(e._element,s)),this._childs.splice(t,0,this._childs.splice(i,1)[0])))},removeChild:function(e){if(e&&this._childs){e=this._childs.indexOf(e);if(INIT_INDEX<e)return this.removeChildAt(e)}return null},removeChildAt:function(e){var t;INIT_INDEX<e&&e<this.childCount()&&(t=this._childs[e],this._element&&t._element&&this._element.removeChild(t._element),t._parnet=null,this._childs.splice(e,1))},clear:function(){var e,t=this._childs,i=t?t.length:0;if(!this._childFixed&&0<i){for(e=0;e<i;e++)t[e].destroy();this._childs=[]}},right:function(){return this._left+this._width},bottom:function(){return this._top+this._height},position:function(){return{x:this._left,y:this._top}},bounds:function(){return new Rectangle(this._left,this._top,this._width,this._height)},clientRect:function(){return new Rectangle(0,0,this._width,this._height)},getBounds:function(e){return e?e.set(this._left,this._top,this._width,this._height):new Rectangle(this._left,this._top,this._width,this._height)},getClientRect:function(e){return e?e.set(0,0,this._width,this._height):new Rectangle(0,0,this._width,this._height)},containsInBounds:function(e,t){return e>=this._left&&e<this.right()&&t>=this._top&&t<this.bottom()},containsChildInBound:function(e){return 0<=e.right()&&0<=e.bottom()&&e.left()<=this.width()&&e.top()<=this.height()},containsInClient:function(e,t){return INIT_INDEX<e&&e<this._width&&INIT_INDEX<t&&t<this._height},translateBy:function(e,t){var i=e;for(t=t||new Rectangle(0,0,this._width,this._height);i&&i!==this;)t.x-=i._left,t.y-=i._top,i=i._parent;return t},topBy:function(e,t){for(var i=this._top+t,s=this._parent;s&&s!==e;)i+=s._top,s=s._parent;return i},boundsBy:function(e,t){var i=this._left,s=this._top,n=this._parent;for(t&&(i+=t.x,s+=t.y);n&&n!==e;)i+=n._left,s+=n._top,n=n._parent;return t?new Rectangle(i,s,t.width,t.height):new Rectangle(i,s,this._width,this._height)},boundsByContainer:function(e){for(var t=this._left,i=this._top,s=(e&&(t+=e.x,i+=e.y),this._parent);s&&s._left!==UNDEFINED;)t+=s._left,i+=s._top,s=s._parent;return e?new Rectangle(t,i,e.width,e.height):new Rectangle(t,i,this._width,this._height)},boundsByScreen:function(e){return e=this.boundsByContainer(e),e=this.container().toScreen(e)},move:function(e,t){this.setLeft(e),this.setTop(t)},offset:function(e,t){this.setLeft(this._left+e),this.setTop(this._top+t)},inflate:function(e,t){0!=e&&this.setWidth(this.width()+e),0!=t&&this.setHeight(this.height()+t)},shift:function(e,t){e&&(this.setLeft(this._left+e),this.setWidth(this._width-e)),t&&(this.setTop(this._top+t),this.setHeight(this._height-t))},resize:function(e,t){this.setWidth(e),this.setHeight(t)},setSize:function(e,t){this.setWidth(e),this.setHeight(t)},setPosition:function(e,t){this.setLeft(e),this.setTop(t)},setBounds:function(e,t,i,s,n,o){4<arguments.length&&(this._spaceWidth=n,this._spaceHeight=o),this.setLeft(e),this.setTop(t),this.setWidth(i),this.setHeight(s)},setBoundsI:function(e,t,i,s){this.setLeft(e>>0),this.setTop(t>>0),this.setWidth(i>>0),this.setHeight(s>>0)},setRect:function(e){this.setLeft(e.x),this.setTop(e.y),this.setWidth(e.width),this.setHeight(e.height)},setRectI:function(e){this.setLeft(_floor(e.x)),this.setTop(_floor(e.y)),this.setWidth(_floor(e.width)),this.setHeight(_floor(e.height))},layoutContent:function(e){this._doLayoutContent(e)},draw:function(){this._doDraw()},_doLayoutContent:function(e){},_doDraw:function(){this._doRender(this.clientRect())},_doRender:function(){},hitTest:function(e,t){return INIT_INDEX<e&&INIT_INDEX<t&&e<this._width&&t<this._height},clientToContainer:function(e,t){for(var i=this;i;)e+=i._left,t+=i._top,i=i._parent;return{x:e,y:t}},containerToClient:function(e,t){for(var i=this;i;)e-=i._left,t-=i._top,i=i._parent;return{x:e,y:t}},findChildAt:function(e,t,i){var s,n,o=this._childs,r=o?o.length:0;if(0<r)for(s=r-1;0<=s;s--)if((n=o[s]).isVisible()&&(i||n._mouseEnabled)){var l,a,h=n._left,u=n._top,h=("absolute"!=n._css.position&&(a=n._element.getBoundingClientRect(),l=this._element.getBoundingClientRect(),h=a.left-l.left,u=a.top-l.top,l=a.width,a=a.height),e-h),u=t-u;if(n.isLayer()||h<l&&u<a||n.hitTest(h,u)){if(h=n.findChildAt(h,u,i))return h;if(!n.isLayer()&&n._mouseEnabled&&!n._isContainer)return n}}return null}}),VisualElement$=VisualElement.prototype,OverflowContainer=defineClass("OverflowContainer",VisualElement,{init:function(){this._super(),this._isContainer=!0,this._css.position="absolute",this._css.overflow="hidden",this._css.pointerEvents="none",this._css.whiteSpace="nowrap"},destroy:function(){this._super()}}),PivotElement=defineClass("PivotElement",VisualElement,{init:function(e,t){this._super(),this._css.position="absolute",this._drawRect=new Rectangle,this._grid=e,this._options=e.tmpDisplayOptions(),this._cellSpaceWidth=this._options.cellSpaceWidth(),this._cellSpaceHeight=this._options.cellSpaceHeight(),this._defClassName=t,this.setCssClass(t)},destroy:function(){this._drawRect=null,this._grid=null,this._super()},grid:function(){return this._grid},_doDraw:function(){this.getClientRect(this._drawRect),this._doRender(this._drawRect)},_doLayoutContent:function(e){this._layoutCells(e)},_layoutCells:function(e){this._clearCells()},_doRender:function(e){},_clearCells:function(){for(var e=this._childs.length;e--;)this._childs[e].destroy(),delete this._childs[e],this._childs[e]=null;this._childs=[]},getStyleName:function(){return""}}),ClickableElement=defineClass("ClickableElement",PivotElement,{init:function(e,t){this._super(e,t),this._request=null,this._tracker=null},destroy:function(){this._request&&(this._request.destroy(),this._request=null),this._tracker&&(this._tracker.destroy(),this._tracker=null),this._super()},enabled:!0,clickable:!0,rightClickable:!1,draggable:!1,click:function(e,t){this._enabled&&this._clickable&&this._doClick(e,t)},rightClick:function(){this._enabled&&this._rightClickable&&this._doRightClick(x,y)},getRequest:function(){return null},getTracker:function(){return null},_doClick:function(e,t){},_doRightClick:function(e,t){}}),CellIndex=defineClass("CellIndex",null,{init:function(e,t,i,s){this._super(),this._grid=e,this._columns=t,this._rows=i,this._valueField=s},destroy:function(){this._grid=null,this._columns=null,this._rows=null,this._super()},valueField:null,grid:function(){return this._grid},columns:function(){return this._columns},rows:function(){return this._rows},setColumns:function(e){this._columns=e?_clone(e):null},setRows:function(e){this._rows=e?_clone(e):null},toProxy:function(){return{columns:this._columns,rows:this._rows,valueField:this._valueField}},clone:function(){var e=this._super();return e._columns=this._columns&&_clone(this._columns),e._rows=this._rows&&_clone(this._rows),e._grid=this._grid,e}},{ATTR_ISSUM:"__sum",ATTR_VFIELD:"$valueField",$_temp:null,temp:function(e,t,i,s){return CellIndex.$_temp._grid=e,CellIndex.$_temp._columns=t,CellIndex.$_temp._rows=i,CellIndex.$_temp._valueField=s,CellIndex.$_temp},areEquals:function(e,t){return e&&t&&e._grid===t._grid&&e._valueField==t._valueField&&_equalsObj(e._columns,t._columns)&&_equalsObj(e._rows,t._rows)}},function(e){e.$_temp=new e}),PivotOptions=defineClass("PivotOptions",null,{init:function(e){this.assign(e),this._super()},destroy:function(){this._super()}});function ExpressionSyntaxError(e,t){this.message=e,this.tokenPos=t}function ExpressionEvaluationError(e){this.message=e}ExpressionSyntaxError.prototype=new Error,ExpressionSyntaxError.prototype.constructor=ExpressionSyntaxError,ExpressionEvaluationError.prototype=new Error,ExpressionEvaluationError.prototype.constructor=ExpressionEvaluationError;var $$_createTokenArray=function(){for(var e=[],t=0;t<arguments.length;t++)e[arguments[t]]=!0;return e},TokenKind={Unknown:0,Add:1,Slash:2,Star:3,Minus:4,Plus:5,Identifier:10,And:11,In:12,Not:13,Div:14,Mod:15,Shl:16,Shr:17,Or:18,Xor:19,ToStr:20,ToNum:21,ToBool:23,Length:24,LengthBin:25,Is:26,IsNot:27,BraceClose:30,BraceOpen:31,Comma:32,CRLF:33,Null:34,Defined:35,Empty:36,NaN:37,Equal:40,Greater:41,GreaterEqual:42,Lower:43,LowerEqual:44,NotEqual:45,Like:46,NotLike:47,ILike:48,NotILike:49,Match:50,NotMatch:51,IMatch:52,NotIMatch:53,String:60,StringLiteral:61,Ascii:62,FloatLiteral:63,IntegerLiteral:64,Point:65,RoundOpen:66,RoundClose:67,DotDot:68,BracketOpen:69,BracketClose:70,Space:71,Symbol:80,ToDateStr:90,ToYear:91,ToMonth:92,ToDay:93,ToHour:94},ExpressionLexer=(TokenKind.IS_CHECK=$$_createTokenArray(TokenKind.Is,TokenKind.IsNot),TokenKind.IS_RELATIVE=$$_createTokenArray(TokenKind.Equal,TokenKind.NotEqual,TokenKind.Like,TokenKind.NotLike,TokenKind.ILike,TokenKind.NotILike,TokenKind.Match,TokenKind.NotMatch,TokenKind.IMatch,TokenKind.NotIMatch,TokenKind.Greater,TokenKind.GreaterEqual,TokenKind.Lower,TokenKind.LowerEqual),TokenKind.IS_ADDITIVE=$$_createTokenArray(TokenKind.Minus,TokenKind.Plus,TokenKind.Or,TokenKind.Xor),TokenKind.IS_MULTIPLICATIVE=$$_createTokenArray(TokenKind.And,TokenKind.Star,TokenKind.Slash,TokenKind.Div,TokenKind.Mod,TokenKind.Shl,TokenKind.Shr),function(){for(var i=[],e=[],t=[],s=[],n=[],o=0,r=0,l=0,a={},h=0;h<256;h++)i[h]=h=="_".charCodeAt()||h>="0".charCodeAt()&&h<="9".charCodeAt()||h>="a".charCodeAt()&&h<="z".charCodeAt()||h>="A".charCodeAt()&&h<="Z".charCodeAt(),e[h]=h>="0".charCodeAt()&&h<="9".charCodeAt()||h>="a".charCodeAt()&&h<="f".charCodeAt()||h>="A".charCodeAt()&&h<="F".charCodeAt(),t[h]=h>="0".charCodeAt()&&h<="9".charCodeAt()||h==".".charCodeAt()||h=="e".charCodeAt()||h=="E".charCodeAt(),s[h]=1<=h&&h<=9||11==h||14<=h&&h<=32,n[h]=0==h;o='"'.charCodeAt(),r="'".charCodeAt(),l="\\".charCodeAt(),(a={}).str=TokenKind.ToStr,a.num=TokenKind.ToNum,a.bool=TokenKind.ToBool,a.not=TokenKind.Not,a.len=TokenKind.Length,a.lenb=TokenKind.LengthBin,a.and=TokenKind.And,a.in=TokenKind.In,a.mod=TokenKind.Mod,a.or=TokenKind.Or,a.div=TokenKind.Div,a.shl=TokenKind.Shl,a.shr=TokenKind.Shr,a.xor=TokenKind.Xor,a.is=TokenKind.Is,a.like=TokenKind.Like,a.ilike=TokenKind.ILike,a.match=TokenKind.Match,a.imatch=TokenKind.IMatch,a.defined=TokenKind.Defined,a.null=TokenKind.Null,a.empty=TokenKind.Empty,a.nan=TokenKind.NaN,a.datestr=TokenKind.ToDateStr,a.year=TokenKind.ToYear,a.month=TokenKind.ToMonth,a.day=TokenKind.ToDay,a.hour=TokenKind.ToHour;var u,c=null,d=null,_=0,f=0,p=0,m=0,g=0,v=0,C=0,w=0;function y(){var e=d.charCodeAt(p);w=p,e<256?c[e]():N()}function b(){f=TokenKind.Symbol,p++}function E(){f=TokenKind.Comma,p++}function S(){f=TokenKind.CRLF,10==d.charCodeAt(p+1)?p+=2:p++,v++,C=p}function T(){f=TokenKind.CRLF,v++,C=++p}function x(){f=TokenKind.Equal,p++}function L(){"="==d.charAt(p+1)?(f=TokenKind.GreaterEqual,p+=2):(f=TokenKind.Greater,p++)}function D(){"="==d.charAt(p+1)?(f=TokenKind.LowerEqual,p+=2):">"==d.charAt(p+1)?(f=TokenKind.NotEqual,p+=2):(f=TokenKind.Lower,p++)}function P(){for(var e=p;e<_&&!i[d.charCodeAt(e)];)e++;for(var t=e;e<_&&i[d.charCodeAt(e)];)e++;return t<e?(g=e,d.substr(t,e-t).toLowerCase()):null}function N(){for(var e=p;p<_&&(i[d.charCodeAt(p)]||255<d.charCodeAt(p));)p++;var t=d.substr(e,p-e).toLowerCase();if(a.hasOwnProperty(t))switch(f=a[t]){case TokenKind.Not:if(t=P())switch(t){case"like":f=TokenKind.NotLike,p=g;break;case"ilike":f=TokenKind.NotILike,p=g;break;case"match":f=TokenKind.NotMatch,p=g;break;case"imatch":f=TokenKind.NotIMatch,p=g}break;case TokenKind.Is:"not"==(t=P())&&(f=TokenKind.IsNot,p=g)}else f=TokenKind.Identifier}function I(){for(f=TokenKind.IntegerLiteral,p++;p<_&&e[d.charCodeAt(p)];)p++}function R(){for(f=TokenKind.IntegerLiteral,p++;p<_&&t[d.charCodeAt(p)];){if("."==d.charAt(p)){if("."==d.charAt(p+1))break;f=TokenKind.FloatLiteral}p++}}function k(){f=TokenKind.Minus,p++}function V(){f=TokenKind.Plus,p++}function O(){"."==d.charAt(p+1)?(f=TokenKind.DotDot,p+=2):(f=TokenKind.Point,p++)}function F(){f=TokenKind.RoundOpen,p++}function A(){f=TokenKind.RoundClose,p++}function M(){f=TokenKind.Slash,p++}function H(){for(f=TokenKind.Space,p++;p<_&&s[d.charCodeAt(p)];)p++}function B(){f=TokenKind.BracketOpen,p++}function $(){f=TokenKind.BracketClose,p++}function W(){f=TokenKind.Star,p++}function G(){f=TokenKind.Mod,p++}function z(){f=TokenKind.StringLiteral;do{var e=d.charCodeAt(p);if(n[e])throw new ExpressionSyntaxError("Untermintated string",e)}while(e==l&&p++,++p<_&&d.charCodeAt(p)!=o);p++}function U(){f=TokenKind.StringLiteral;do{var e=d.charCodeAt(p);if(n[e])throw new ExpressionSyntaxError("Untermintated string",e)}while(e==l&&p++,++p<_&&d.charCodeAt(p)!=r);p++}for(this.tokenId=function(){return f},this.tokenLoc=function(){return{x:w-C,y:v}},this.tokenLen=function(){return p-w},this.token=function(){return d.substr(w,this.tokenLen())},this.isSpace=function(){return f==TokenKind.Space},this.init=function(e){_=(d=e).length,_origin=0,m=p=w=C=v=0,f=0},this.charAhread=function(){for(m=p;m<_&&0<d.charCodeAt(m)&&d.charCodeAt(m)<=32;)m++;return d.charCodeAt(this._runAhead)},this.nextId=function(e){for(;y(),p<_&&f!=e;);},this.nextNoSpace=function(){if(p<_)for(;y(),p<_&&this.isSpace(););},this.isFirstInLine=function(){if(0==w)return!0;var e,t=w;for(t--;0<t&&s[d.charCodeAt(t)];)t--;return 0==t||(10==(e=d.charCodeAt(t))||13==e)},c=[],u=1;u<=255;u++)c[u]=b;for(u=1;u<=32;u++)c[u]=H;for(c[10]=T,c[13]=S,c["$".charCodeAt()]=I,c[o]=z,c[r]=U,u=0;u<=9;u++)c["0".charCodeAt()+u]=R;for(u="A".charCodeAt();u<="Z".charCodeAt();u++)c[u]=N;for(u="a".charCodeAt();u<="z".charCodeAt();u++)c[u]=N;c["_".charCodeAt()]=N,c["(".charCodeAt()]=F,c[")".charCodeAt()]=A,c["*".charCodeAt()]=W,c["+".charCodeAt()]=V,c[",".charCodeAt()]=E,c["-".charCodeAt()]=k,c[".".charCodeAt()]=O,c["/".charCodeAt()]=M,c["%".charCodeAt()]=G,c["<".charCodeAt()]=D,c["=".charCodeAt()]=x,c[">".charCodeAt()]=L,c["[".charCodeAt()]=B,c["]".charCodeAt()]=$}),ExpressionNode=defineClass("ExpressionNode",null,{init:function(){this._super()},_asLiteral:function(){return null},evaluate:function(){throwAbstractError()},toString:function(){return String(this)}}),EmptyExpressionNode=defineClass("EmptyExpressionNode",ExpressionNode,{init:function(){this._super()},_asLiteral:function(){return null},evaluate:function(){},toString:function(){return""}},null,function(e){e.Default=new e}),ExpressionNodeImpl=defineClass("ExpressionNodeImpl",ExpressionNode,{init:function(){this._super(),this.leftExpr=null,this.rightExpr=null,this.operator=TokenKind.Unknown,this._literal=null},evaluate:function(e){if(this._literal)return this._literal.value();if(!this.rightExpr)return this.leftExpr.evaluate(e);var t=this.leftExpr.evaluate(e),i=this.rightExpr.evaluate(e);switch(this.operator){case TokenKind.Equal:return t==i;case TokenKind.NotEqual:return t!=i;case TokenKind.Greater:return i<t;case TokenKind.GreaterEqual:return i<=t;case TokenKind.Lower:return t<i;case TokenKind.LowerEqual:return t<=i;case TokenKind.Like:return this._calcLike(t,i,!1);case TokenKind.NotLike:return!this._calcLike(t,i,!1);case TokenKind.ILike:return this._calcLike(t,i,!0);case TokenKind.NotILike:return!this._calcLike(t,i,!0);case TokenKind.Match:return this._calcMatch(t,i,!1);case TokenKind.NotMatch:return!this._calcMatch(t,i,!1);case TokenKind.IMatch:return this._calcMatch(t,i,!0);case TokenKind.NotIMatch:return!this._calcMatch(t,i,!0);default:throw new ExpressionEvaluationError("Unknown operator: "+operator)}},toString:function(){var e="";if(this._literal)e=this._literal.toString();else if(this.rightExpr){var t,i=this.leftExpr.toString(),s=this.rightExpr.toString();switch(this.operator){case TokenKind.Equal:t="=";break;case TokenKind.NotEqual:t="<>";break;case TokenKind.Greater:t=">";break;case TokenKind.GreaterEqual:t=">=";break;case TokenKind.Lower:t="<";break;case TokenKind.LowerEqual:t="<=";break;case TokenKind.Like:t="like";break;case TokenKind.NotLike:t="not like";break;case TokenKind.ILike:t="ilike";break;case TokenKind.NotILike:t="not ilike";break;case TokenKind.Match:t="match";break;case TokenKind.NotMatch:t="not match";break;case TokenKind.IMatch:t="imatch";break;case TokenKind.NotIMatch:t="not imatch";break;default:t="<<ERROR>>"}e="("+i+" "+t+" "+s+")"}else e=this.leftExpr.toString();return e},isIdentifier:function(e){return this.leftExpr&&!this.rightExpr&&this.leftExpr.isIdentifier(e)},_prepareValue:function(){this.leftExpr._prepareValue(),null==this.rightExpr?this._literal=this.leftExpr._getLiteral():this.rightExpr._prepareValue()},_getLiteral:function(){return this._literal},_calcLike:function(e,t,i){var s,n,e=String(e),t=String(t);return!(!e||!t)&&(i&&(e=e.toLowerCase(),t=t.toLowerCase()),1<(i=t.length)?(s="%"==t.charAt(0),n="%"==t.charAt(i-1),s&&n?(t=t.substr(1,i-2),0<=e.indexOf(t,0)):s?(t=t.substr(1,i-1),i=e.length,e.lastIndexOf(t,i-1)==i-1):n?(t=t.substr(0,i-1),0==e.indexOf(t,0)):e==t):"%"!=t&&e==t)},_calcMatch:function(e,t,i){return new RegExp(t,"m"+(i?"i":"")).test(e)}}),CheckableNode=defineClass("DefinedNode",ExpressionNode,{init:function(){this._super()}}),DefinedNode=defineClass("DefinedNode",CheckableNode,{init:function(){this._super()},value:function(){return UNDEFINED},_asLiteral:function(){return this},evaluate:function(e){return UNDEFINED},toString:function(){return"defined"}}),EmptyNode=defineClass("EmptyNode",CheckableNode,{init:function(){this._super()},value:function(){return UNDEFINED},_asLiteral:function(){return this},evaluate:function(e){return UNDEFINED},toString:function(){return"empty"}}),NullNode=defineClass("NullNode",CheckableNode,{init:function(){this._super()},value:function(){return UNDEFINED},_asLiteral:function(){return this},evaluate:function(e){return null},toString:function(){return"null"}}),NanNode=defineClass("NanNode",CheckableNode,{init:function(){this._super()},value:function(){return NaN},_asLiteral:function(){return this},evaluate:function(e){return NaN},toString:function(){return"NaN"}}),CheckNode=defineClass("CheckNode",ExpressionNodeImpl,{init:function(e,t,i){this._super(),this.leftExpr=e,this.operator=t,this._isNot=t==TokenKind.IsNot,this._value=-1,i instanceof DefinedNode?this._value=CheckNode.DEFINED:i instanceof NullNode?this._value=CheckNode.NULL:i instanceof EmptyNode?this._value=CheckNode.EMPTY:i instanceof NanNode&&(this._value=CheckNode.NAN)},_prepareValue:function(){this.leftExpr._prepareValue(),this._literal=this.leftExpr._getLiteral()},_getLiteral:function(){return null},evaluate:function(e){var t,i=this._literal?this._literal.value():this.leftExpr.evaluate(e);switch(this._value){case CheckNode.DEFINED:t=i!==UNDEFINED;break;case CheckNode.NULL:t=i===UNDEFINED||null===i;break;case CheckNode.EMPTY:t=i===UNDEFINED||null===i||0==String(i).length;break;case CheckNode.NAN:t=null===i||isNaN(i);break;default:return UNDEFINED}return this._isNot?!t:t},toString:function(){var e="<<ERROR>>";switch(this._value){case CheckNode.DEFINED:e="defined";break;case CheckNode.NULL:e="null";break;case CheckNode.EMPTY:e="empty";break;case CheckNode.NAN:e="NaN"}return"("+(this._isNot?"is not ":"is ")+e+")"}},{DEFINED:0,NULL:1,EMPTY:2,NAN:3}),FloatLiteralNode=defineClass("FloatLiteralNode",ExpressionNode,{init:function(e){this._super(),this._value=Number(e)},value:function(){return this._value},_asLiteral:function(){return this},evaluate:function(e){return this._value},toString:function(){return String(this._value)}}),IntegerLiteralNode=defineClass("IntegerLiteralNode",ExpressionNode,{init:function(e){this._super(),this._value=parseInt(e)},value:function(){return this._value},_asLiteral:function(){return this},evaluate:function(e){return this._value},toString:function(){return String(this._value)}}),StringLiteralNode=defineClass("StringLiteralNode",ExpressionNode,{init:function(e){this._super(),this._value=e.substr(1,e.length-2);for(var t="",i=0,s=!1;i<this._value.length;)"\\"!=this._value[i]||s?(s=!1,t+=this._value[i++]):(s=!0,i++);this._value=t},value:function(){return this._value},_asLiteral:function(){return this},evaluate:function(e){return this._value},toString:function(){return this._value}}),IdentifierNode=defineClass("IdentifierNode",ExpressionNode,{init:function(e){this._super(),this._literal=e,this._idKey=-651212},identifier:function(){return this._literal},evaluate:function(e){return-651212==this._idKey&&(this._idKey=e.isIdentifier(this._literal)),e.evaluateIdentifier(this._idKey)},toString:function(){return this._literal}}),IndexerNode=defineClass("IndexerNode",ExpressionNode,{init:function(e,t,i){this._super(),this._ident=e,this._indexer=t,this._capital=i,this._idKey=-1490313,this._intIndex=NaN,this._strIndex=null},_prepareValue:function(){var e=null,t=this._indexer._asLiteral();t||(e=this._indexer._prepareValue&&this._indexer)&&(e._prepareValue(),t=e._getLiteral()),t&&("string"==typeof(e=t.value())?this._strIndex=e:this._intIndex=parseInt(e),this._capital&&this._strIndex&&(this._strIndex=this._strIndex.toUpperCase()))},_getLiteral:function(){return null},evaluate:function(e){var t;return-1490313==this._idKey&&(this._idKey=e.isIdentifier(this._ident)),this._strIndex?e.evaluateIndexerS(this._idKey,this._strIndex,this._capital):isNaN(this._intIndex)?"string"==typeof(t=this._indexer.evaluate(e))?e.evaluateIndexerS(this._idKey,t,this._capital):e.evaluateIndexerI(this._idKey,t):e.evaluateIndexerI(this._idKey,this._intIndex)},toString:function(){return this._ident+"["+this._indexer.toString()+"]"}}),UnaryNode=defineClass("UnaryNode",ExpressionNode,{init:function(e){this._super(),this._factor=e,this._literal=null},_prepareValue:function(){this._literal=this._factor._asLiteral(),!this._literal&&this._factor._prepareValue&&(this._factor._prepareValue(),this._literal=this._factor._getLiteral())},_getLiteral:function(){return null}}),LenNode=defineClass("LenNode",UnaryNode,{init:function(e){this._super(e)},evaluate:function(e){e=this._literal?this._literal.value():this._factor.evaluate(e);return e?e.length:0},toString:function(){return"(len "+this._factor+")"}}),MinusNode=defineClass("MinusNode",UnaryNode,{init:function(e){this._super(e)},evaluate:function(e){return-(this._literal?this._literal.value():this._factor.evaluate(e))},toString:function(){return"-"+this._factor}}),PlusNode=defineClass("PlusNode",UnaryNode,{init:function(e){this._super(e)},evaluate:function(e){return this._literal?this._literal.value():this._factor.evaluate(e)},toString:function(){return"+"+this._factor}}),NotNode=defineClass("NotNode",UnaryNode,{init:function(e){this._super(e)},evaluate:function(e){return!(this._literal?this._literal.value():this._factor.evaluate(e))},toString:function(){return"(not "+this._factor+")"}}),ToBoolNode=defineClass("ToBoolNode",UnaryNode,{init:function(e){this._super(e)},evaluate:function(e){e=this._literal?this._literal.value():this._factor.evaluate(e);return Boolean(e)},toString:function(){return"(bool "+this._factor+")"}}),ToNumberNode=defineClass("ToNumberNode",UnaryNode,{init:function(e){this._super(e)},evaluate:function(e){e=this._literal?this._literal.value():this._factor.evaluate(e);return Number(e)},toString:function(){return"(num "+this._factor+")"}}),ToStringNode=defineClass("ToStringNode",UnaryNode,{init:function(e){this._super(e)},evaluate:function(e){e=this._literal?this._literal.value():this._factor.evaluate(e);return String(e)},toString:function(){return"(str "+this._factor+")"}}),ToDateStringNode=defineClass("ToDateStringNode",UnaryNode,{init:function(e){this._super(e)},evaluate:function(e){e=this._literal?this._literal.value():this._factor.evaluate(e);return e instanceof Date&&(e=_pad(e.getFullYear(),4)+_pad(e.getMonth()+1,2)+_pad(e.getDate(),2)+_pad(e.getHours(),2)+_pad(e.getMinutes(),2)+_pad(e.getSeconds(),2)+_pad(e.getMilliseconds(),3)),String(e)},toString:function(){return"(datestr "+this._factor+")"}}),ToYearNode=defineClass("ToYearNode",UnaryNode,{init:function(e){this._super(e)},evaluate:function(e){e=this._literal?this._literal.value():this._factor.evaluate(e);return e instanceof Date?e.getFullYear():null},toString:function(){return"(year "+this._factor+")"}}),ToMonthNode=defineClass("ToMonthNode",UnaryNode,{init:function(e){this._super(e)},evaluate:function(e){e=this._literal?this._literal.value():this._factor.evaluate(e);return e instanceof Date?e.getMonth()+1:null},toString:function(){return"(month "+this._factor+")"}}),ToDayNode=defineClass("ToDayNode",UnaryNode,{init:function(e){this._super(e)},evaluate:function(e){e=this._literal?this._literal.value():this._factor.evaluate(e);return e instanceof Date?e.getDate():null},toString:function(){return"(day "+this._factor+")"}}),ToHourNode=defineClass("ToHourNode",UnaryNode,{init:function(e){this._super(e)},evaluate:function(e){e=this._literal?this._literal.value():this._factor.evaluate(e);return e instanceof Date?e.getHours():null},toString:function(){return"(hour "+this._factor+")"}}),TermNode=defineClass("TermNode",ExpressionNode,{init:function(){this._super(),this._factors=[],this._operators=[],this._literal=null},addFactor:function(e){this._factors.push(e)},addOperator:function(e){this._operators.push(e)},isIdentifier:function(e){return 1==this._factors.length&&this._factors[0]instanceof IdentifierNode&&this._factors[0].identifier()==e},_prepareValue:function(){for(var e,t=0,i=this._factors.length;t<i;t++)(e=this._factors[t])._prepareValue&&e._prepareValue();0==this._operators.length&&(e=this._factors[0],this._literal=e._asLiteral(),!this._literal&&e._prepareValue&&(this._literal=e._getLiteral()))},_getLiteral:function(){return this._literal},evaluate:function(e){if(this._literal)return this._literal.value();for(var t,i=this._factors.length,s=this._factors[0].evaluate(e),n=1;n<i;n++)switch(t=this._factors[n].evaluate(e),this._operators[n-1]){case TokenKind.And:s=s&&t;break;case TokenKind.Star:s*=t;break;case TokenKind.Slash:s/=t;break;case TokenKind.Div:s=_int(_int(s)/_int(t));break;case TokenKind.Mod:s%=t;break;case TokenKind.Shl:s<<=t;break;case TokenKind.Shr:s>>=t}return s},toString:function(){var e="";if(this._literal)e=this._literal.toString();else if(1==this._factors.length)e=this._factors[0].toString();else{for(var t=this._factors.length,e="("+this._factors[0].toString(),i=1;i<t;i++){switch(this._operators[i-1]){case TokenKind.And:e+=" and ";break;case TokenKind.Star:e+=" * ";break;case TokenKind.Slash:case TokenKind.Div:e+=" / ";break;case TokenKind.Mod:e+=" mod ";break;case TokenKind.Shl:e+=" shl ";break;case TokenKind.Shr:e+=" shr "}e+=this._factors[i].toString()}e+=")"}return e}}),SimpleExpressioNode=defineClass("SimpleExpressioNode",ExpressionNode,{init:function(){this._super(),this._terms=[],this._operators=[],this._literal=null},addTerm:function(e){this._terms.push(e)},addOperator:function(e){this._operators.push(e)},isIdentifier:function(e){return 1==this._terms.length&&this._terms[0].isIdentifier(e)},_prepareValue:function(){for(var e=0,t=this._terms.length;e<t;e++)this._terms[e]._prepareValue();0==this._operators.length&&(this._literal=this._terms[0]._getLiteral())},_getLiteral:function(){return this._literal},evaluate:function(e){if(this._literal)return this._literal.value();for(var t,i=this._terms.length,s=this._terms[0].evaluate(e),n=1;n<i;n++)switch(t=this._terms[n].evaluate(e),this._operators[n-1]){case TokenKind.Minus:s-=t;break;case TokenKind.Plus:s+=t;break;case TokenKind.Or:s=s||t;break;case TokenKind.Xor:s^=t}return s},toString:function(){var e="";if(this._literal)e=this._literal.toString();else if(1==this._terms.length)e=this._terms[0].toString();else{for(var t=this._terms.length,e="("+this._terms[0].toString(),i=1;i<t;i++){switch(this._operators[i-1]){case TokenKind.Minus:e+=" - ";break;case TokenKind.Plus:e+=" + ";break;case TokenKind.Or:e+=" or ";break;case TokenKind.Xor:e+=" xor ";break;default:e+=" <<ERROR>> "}e+=this._terms[i].toString()}e+=")"}return e}}),ExpressionParser=function(){var n=null,o=new ExpressionLexer;function r(e){if(e!=o.tokenId())throw new ExpressionSyntaxError("Token is not a expected kind ["+e+"]: "+o.tokenId(),o.tokenLoc());l()}function l(){o.nextNoSpace()}function a(){var e,t,i=null,s=h();if(TokenKind.IS_CHECK[t=o.tokenId()]){if(l(),(e=h())._prepareValue(),!(e=_cast(e._getLiteral(),CheckableNode)))throw new ExpressionSyntaxError("is operator's operand must be defined, null or empty: "+o.tokenId());i=new CheckNode(s,t,e)}else(i=new ExpressionNodeImpl).leftExpr=s,TokenKind.IS_RELATIVE[o.tokenId()]&&(i.operator=o.tokenId(),l(),i.rightExpr=h());return i}function h(){var e=new SimpleExpressioNode;for(e.addTerm(t());TokenKind.IS_ADDITIVE[o.tokenId()];)e.addOperator(o.tokenId()),l(),e.addTerm(t());return e}function t(){var e=new TermNode;for(e.addFactor(u());TokenKind.IS_MULTIPLICATIVE[o.tokenId()];)e.addOperator(o.tokenId()),l(),e.addFactor(u());return e}function u(){var e,t=o.tokenId();switch(t){case TokenKind.StringLiteral:return e=o.token(),l(),new StringLiteralNode(e);case TokenKind.RoundOpen:return l(),e=a(),r(TokenKind.RoundClose),e;case TokenKind.Identifier:var i,s=o.token();return l(),o.tokenId()==TokenKind.BracketOpen?(l(),i=a(),r(TokenKind.BracketClose),new IndexerNode(s,i,0<=n.indexOf(s))):new IdentifierNode(s);case TokenKind.IntegerLiteral:return i=o.token(),l(),new IntegerLiteralNode(i);case TokenKind.FloatLiteral:return s=o.token(),l(),new FloatLiteralNode(s);case TokenKind.Minus:return l(),new MinusNode(u());case TokenKind.Plus:return l(),new PlusNode(u());case TokenKind.Not:return l(),new NotNode(u());case TokenKind.Defined:return l(),new DefinedNode;case TokenKind.Null:return l(),new NullNode;case TokenKind.Empty:return l(),new EmptyNode;case TokenKind.NaN:return l(),new NanNode;case TokenKind.ToBool:return l(),new ToBoolNode(u());case TokenKind.ToNum:return l(),new ToNumberNode(u());case TokenKind.ToStr:return l(),new ToStringNode(u());case TokenKind.Length:return l(),new LenNode(u());case TokenKind.LengthBin:return l(),new LenBinNode(u());case TokenKind.ToDateStr:return l(),new ToDateStringNode(u());case TokenKind.ToYear:return l(),new ToYearNode(u());case TokenKind.ToMonth:return l(),new ToMonthNode(u());case TokenKind.ToDay:return l(),new ToDayNode(u());case TokenKind.ToHour:return l(),new ToHourNode(u())}throw new ExpressionSyntaxError("Unkown token: "+t)}this.parse=function(e,t){if(!e)return null;n=t||[],o.init(e),l();t=a();return t&&t._prepareValue(),t},this.evaluate=function(e,t,i){return this.parse(e,i).evaluate(t)}},ExpressionRuntime=(ExpressionParser.Default=new ExpressionParser,defineClass("ExpressionRuntime",null,{init:function(){this._super()},isIdentifier:function(e){throw new Error("Token is not a valid Identifier: "+e)},evaluateIdentifier:function(e){throw new Error("Invalid identifier key: "+e)},evaluateIndexerI:function(e,t){throw new Error("Invalid identifier indexer: "+e)},evaluateIndexerS:function(e,t){throw new Error("Invalid identifier indexer: "+e)}})),FilterRuntime=defineClass("FilterRuntime",ExpressionRuntime,{init:function(){this._super(),this._value=null},setData:function(e){this._value=e},isIdentifier:function(e){return e=e.toLowerCase(),FilterRuntime.IDENTS.hasOwnProperty(e)?FilterRuntime.IDENTS[e]:this._super(e)},evaluateIdentifier:function(e){if(e===FilterRuntime.ID_VALUE)return this._value;throw new ExpressionEvaluationError("Invalid identifier key: "+e)}},{ID_VALUE:0},function(e){e.IDENTS={value:e.ID_VALUE}}),$$_XML_HEAD='<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r\n',_excelColCaption=function(e){for(var t="",i=e+1,s=1,n=26;0<=(i-=s);s=n,n*=26)t=String.fromCharCode(parseInt(i%n/s)+65)+t;return t},ExcelStrings=defineClass("ExcelStrings",null,{init:function(e){this._super(),this._workbook=e,this._nextId=0,this._count=0,this._stringMap={},this._strings=[]},count:function(){return this._count},uniqueCount:function(){return this._nextId},add:function(e){this._count++;var t=this._stringMap[e];return void 0===t&&(t=this._nextId++,this._stringMap[e]=t,this._strings[t]=e),t},getIndex:function(e){return this._stringMap[e]},createPart:function(){var e=_parseXml('<sst xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main"></sst>'),t=e.documentElement,i=/^\s|\s$/;t.setAttribute("count",this._count),t.setAttribute("uniqueCount",this._nextId);for(var s=0,n=this._strings.length;s<n;s++){var o=e.createElement("si"),r=(t.appendChild(o),e.createElement("t")),o=(o.appendChild(r),e.createTextNode(this._strings[s]));r.appendChild(o),i.test(this._strings[s])&&r.setAttribute("xml:space","preserve")}return $$_XML_HEAD+_xmlToStr(e)}}),ExcelFont=function(){this.id=void 0,this.name="Tahoma",this.size=10,this.color="ff000000",this.bold=!1,this.italic=!1,this.scheme=void 0},ExcelFill=(ExcelFont.prototype.getKey=function(){return this.name+"="+this.size+"="+this.color+"="+this.bold+"="+this.italic+"="+this.scheme},ExcelFont.prototype.serialize=function(e,t){_addChildWithAttr(e,t,"sz","val",this.size||10),_addChildWithAttr(e,t,"name","val",this.name||"Calibri"),_addChildWithAttr(e,t,"color","rgb",this.color||"ff000000"),_addChildWithAttr(e,t,"b","val",this.bold?"true":"false"),_addChildWithAttr(e,t,"i","val",this.italic?"true":"false")},function(){this.id=void 0,this.patternType="none",this.color=void 0,this.gradient=void 0,this.color2=void 0,this.degree="90",this.tint=0}),ExcelBorder=(ExcelFill.prototype.getKey=function(){return this.gradient+"="+this.color+"="+this.color2+"="+this.tint+"="+this.degree+"="+this.patternType},ExcelFill.prototype.serialize=function(e,t){var i,s,n;"linear"==this.gradient?(n=e.createElement("gradientFill"),t.appendChild(n),n.setAttribute("degree",this.degree),s=e.createElement("stop"),n.appendChild(s),s.setAttribute("position","0"),i=e.createElement("color"),s.appendChild(i),i.setAttribute("rgb",this.color),i.setAttribute("tint",this.tint),s=e.createElement("stop"),n.appendChild(s),s.setAttribute("position","1"),i=e.createElement("color"),s.appendChild(i),i.setAttribute("rgb",this.color2),i.setAttribute("tint",this.tint)):(n=e.createElement("patternFill"),t.appendChild(n),n.setAttribute("patternType",this.patternType),"none"!=this.patternType&&(i=e.createElement("fgColor"),n.appendChild(i),i.setAttribute("rgb",this.color),i.setAttribute("tint",this.tint)))},function(){this.id=void 0,this.left=void 0,this.right=void 0,this.top=void 0,this.bottom=void 0}),ExcelStyle=(ExcelBorder.prototype.getKey=function(){return this.left.css()+"="+this.right.css()+"="+this.top.css()+"="+this.bottom.css()},ExcelBorder.prototype.serialize=function(e,t){this.serializeBorder(e,t,"left"),this.serializeBorder(e,t,"right"),this.serializeBorder(e,t,"top"),this.serializeBorder(e,t,"bottom")},ExcelBorder.prototype.serializeBorder=function(e,t,i){var s=e.createElement(i);t.appendChild(s),(i=this[i])&&0<i._width&&(s.setAttribute("style","thin"),t=e.createElement("color"),s.appendChild(t),t.setAttribute("rgb",i._color.toColorHex()))},function(){this.id=void 0,this.horzAlign=ExcelStyle.ALIGN_NEAR,this.vertAlign=ExcelStyle.VALIGN_CENTER,this.wrapText=!1,this.formatId=0,this.font=null,this.fill=null,this.border=null,this.xfId=0}),ExcelStyles=(ExcelStyle.ALIGN_NEAR="left",ExcelStyle.ALIGN_CENTER="center",ExcelStyle.ALIGN_FAR="right",ExcelStyle.VALIGN_NEAR="top",ExcelStyle.VALIGN_CENTER="center",ExcelStyle.VALIGN_FAR="bottom",ExcelStyle.prototype.clone=function(){var e,t=new ExcelStyle;for(e in this)this.hasOwnProperty(e)&&(t[e]=this[e]);return t.id=void 0,t},ExcelStyle.prototype.serialize=function(e,t){this.border&&t.setAttribute("borderId",this.border?this.border.id:"0"),this.fill&&t.setAttribute("fillId",this.fill?this.fill.id:"0"),this.font&&t.setAttribute("fontId",this.font?this.font.id:"0"),t.setAttribute("numFmtId",this.formatId),t.setAttribute("xfId","0");e=e.createElement("alignment");t.appendChild(e),e.setAttribute("horizontal",this.horzAlign),e.setAttribute("vertical",this.vertAlign),this.wrapText&&e.setAttribute("wrapText","1")},defineClass("ExcelStyles",null,{init:function(e){this._super(),this._book=e,this._fonts=[],this._fills=[],this._borders=[],this._numFormats=[],this._xfs=[];e=new ExcelFill,this._fills.push(e,e),e=new ExcelBorder,this._borders.push(e),e=new ExcelFont,this._fonts.push(e),e=new ExcelStyle;this._xfs.push(e),this._fillMap={},this._fontMap={},this._borderMap={}},$_findFont:function(e){return this._fontMap[e.getKey()]},addFont:function(e){var t=this.$_findFont(e);return t||(e?(e.id=this._fonts.length,this._fontMap[e.getKey()]=e,this._fonts.push(e),e):void 0)},$_findFill:function(e){return this._fillMap[e.getKey()]},addFill:function(e){var t=this.$_findFill(e);return t||(e?(e.id=this._fills.length,this._fillMap[e.getKey()]=e,this._fills.push(e),e):void 0)},$_findBorder:function(e){return this._borderMap[e.getKey()]},addBorder:function(e){var t=this.$_findBorder(e);return t||(e?(e.id=this._borders.length,this._borderMap[e.getKey()]=e,this._borders.push(e),e):void 0)},addNumberFormat:function(e){var t=this._numFormats.indexOf(e);return t<0&&(this._numFormats.push(e),t=this._numFormats.length-1),ExcelStyles.$$_EXCEL_NUMFMT_START+t},add:function(e){return e?(this._xfs.push(e),e.id=this._xfs.length-1):0},createPart:function(){var e=_parseXml('<styleSheet xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main"></styleSheet>'),t=e.documentElement,i=(0<this._numFormats.length&&(i=e.createElement("numFmts"),t.appendChild(i),this.$_createNumberFormats(e,i)),e.createElement("fonts")),i=(t.appendChild(i),this.$_createFonts(e,i),e.createElement("fills")),i=(t.appendChild(i),this.$_createFills(e,i),e.createElement("borders")),i=(t.appendChild(i),this.$_createBorders(e,i),e.createElement("cellStyleXfs")),i=(t.appendChild(i),this.$_createDefXfs(e,i),e.createElement("cellXfs"));return t.appendChild(i),this.$_createXfs(e,i),$$_XML_HEAD+_xmlToStr(e)},$_createNumberFormats:function(e,t){for(var i=0,s=this._numFormats.length;i<s;i++){var n=e.createElement("numFmt");_setXmlAttr(n,"formatCode",this._numFormats[i]),_setXmlAttr(n,"numFmtId",ExcelStyles.$$_EXCEL_NUMFMT_START+i),t.appendChild(n)}},$_createFonts:function(e,t){var i;this._fonts.length<1&&(i=new ExcelFont,this._fonts.push(i));for(var s=0,n=this._fonts.length;s<n;s++){var o=e.createElement("font");this._fonts[s].serialize(e,o),t.appendChild(o)}t.setAttribute("count",this._fonts.length)},$_createFills:function(e,t){var i;this._fills.length<1&&(i=new ExcelFill,this._fills.push(i));for(var s=0,n=this._fills.length;s<n;s++){var o=e.createElement("fill");this._fills[s].serialize(e,o),t.appendChild(o)}t.setAttribute("count",this._fills.length)},$_createBorders:function(e,t){var i;this._borders.length<1&&(i=new ExcelBorder,this._borders.push(i));for(var s=0,n=this._borders.length;s<n;s++){var o=e.createElement("border");this._borders[s].serialize(e,o),t.appendChild(o)}t.setAttribute("count",this._borders.length)},$_createDefXfs:function(e,t){e=e.createElement("xf");t.appendChild(e),e.setAttribute("borderId",0),e.setAttribute("fillId",0),e.setAttribute("fontId",0),e.setAttribute("numFmtId",0),t.setAttribute("count",1)},$_createXfs:function(e,t){var i;this._xfs.length<1&&(i=new ExcelStyle,this._xfs.push(i));for(var s=0,n=this._xfs.length;s<n;s++){var o=this._xfs[s],r=e.createElement("xf");o.serialize(e,r),t.appendChild(r)}t.setAttribute("count",this._xfs.length)}},{$$_EXCEL_NUMFMT_START:200})),ExcelColumn=function(){this.index=void 0,this.width=10,this.style=null,this.serialize=function(e,t){t.setAttribute("min",this.index),t.setAttribute("max",this.index),t.setAttribute("width",this.width),this.style&&t.setAttribute("style",this.style.id)}},ExcelSheet=defineClass("ExcelSheet",null,{init:function(e){this._super(),this._book=e,this._columns=null,this._doc=null,this._viewRoot=null,this._dataRoot=null,this._mergeRoot=null,this._rows=[],this._mergeCount=0,this._outlineLevel=0,this.$_preparePart(),this._dateConverter=DatetimeConverter.Default},colCount:function(){return this._columns.length},rowCount:function(){return this._rows.length},setColumns:function(e){this._columns=e},addRow:function(e,t){var i=this._rows[e];return i||((i=this._doc.createElement("row")).setAttribute("r",e+1),t&&-1<t&&(i.setAttribute("ht",t),i.setAttribute("customHeight","1")),this._rows[e]=i),i},setRowLevel:function(e,t){0<=t&&((e=this._rows[e])&&(e.setAttribute("outlineLevel",t),this._outlineLevel=Math.max(t,this._outlineLevel)))},addBlank:function(e,t,i,s){var s=this.addRow(e,s),n=this._doc.createElement("c");n.setAttribute("r",_excelColCaption(t)+(e+1)),i&&n.setAttribute("s",i.id),s.appendChild(n)},addMerge:function(e,t,i,s){t=_excelColCaption(t)+(e+1)+":"+_excelColCaption(t+s-1)+(e+i),s=this._doc.createElement("mergeCell");s.setAttribute("ref",t),this._mergeRoot.appendChild(s),this._mergeCount++},$_addCell:function(e,t,i,s,n,o){var o=this.addRow(e,o),r=this._doc.createElement("c"),t=(r.setAttribute("r",_excelColCaption(t)+(e+1)),r.setAttribute("t",i),n&&r.setAttribute("s",n.id),o.appendChild(r),this._doc.createElement("v"));return t.appendChild(this._doc.createTextNode(s)),r.appendChild(t),r},addText:function(e,t,i,s,n){i=this._book.addString(null!=i?i:"");return this.$_addCell(e,t,"s",i,s,n)},addNumber:function(e,t,i,s,n){i=isNaN(i)?"":String(i);return this.$_addCell(e,t,"n",i,s,n)},addBool:function(e,t,i,s,n){return this.$_addCell(e,t,"b",i?1:0,s,n)},addDate:function(e,t,i,s,n){return i?(i=this.$_dateToStr(i),this.$_addCell(e,t,"d",i,s,n)):this.$_addCell(e,t,"s","",s,n)},createPart:function(){var e=this._doc,t=e.documentElement,i="A1:"+_excelColCaption(this._columns.length-1)+this._book._sheet._rows.length,s=e.getElementsByTagName("dimension");return s&&0<s.length&&s[0].setAttribute("ref",i),0<this._outlineLevel&&(s=e.createElement("sheetFormatPtr"),t.appendChild(s),s.setAttribute("outlineLevelRow",this._outlineLevel)),this._columns&&(i=e.createElement("cols"),t.appendChild(i),this.$_createCols(e,i)),this._rows&&this._rows.forEach(function(e,t,i){e&&this._dataRoot.appendChild(e)}.bind(this)),t.appendChild(this._dataRoot),0<this._mergeCount&&(t.appendChild(this._mergeRoot),this._mergeRoot.setAttribute("count",this._mergeCount)),$$_XML_HEAD+_xmlToStr(e)},$_preparePart:function(){var e=this._doc=_parseXml('<worksheet xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships"></worksheet>'),t=e.createElement("dimension"),t=(e.documentElement.appendChild(t),e.createElement("sheetViews")),i=(e.documentElement.appendChild(t),this._viewRoot=e.createElement("sheetView"));t.appendChild(i),i.setAttribute("workbookViewId","0"),i.setAttribute("tabSelected","1"),this._dataRoot=e.createElement("sheetData"),this._mergeRoot=e.createElement("mergeCells")},$_createCols:function(e,t){for(var i=this._columns,s=0,n=i.length;s<n;s++){var o=i[s],r=e.createElement("col");o.serialize(e,r),t.appendChild(r)}},$_dateToStr:function(e){return _pad(e.getFullYear(),4)+_pad(e.getMonth()+1,2)+_pad(e.getDate(),2)+"T"+_pad(e.getHours(),2)+_pad(e.getMinutes(),2)+_pad(e.getSeconds(),2)}}),ExcelWorkbook=defineClass("ExcelWorkbook",null,{init:function(){this._super(),this._parts={},this._sst=new ExcelStrings(this),this._styles=new ExcelStyles(this),this._sheet=new ExcelSheet(this),this.$_preapreTemplateParts()},destroy:function(){this._sst.destroy(),this._sst=null,this._styles.destroy(),this._styles=null,this._sheet.destroy(),this._sheet=null,this._super()},parts:function(){return this._parts},sheet:function(){return this._sheet},addString:function(e){return this._sst.add(e)},addNumberFormat:function(e){return this._styles.addNumberFormat(e)},addFill:function(e){return this._styles.addFill(e)},addBorder:function(e){return this._styles.addBorder(e)},addFont:function(e){return this._styles.addFont(e)},addStyle:function(e){return this._styles.add(e)},createParts:function(){var e=this._parts;return e["xl/sharedStrings.xml"]=this._sst.createPart(),e["xl/styles.xml"]=this._styles.createPart(),e["xl/worksheets/sheet1.xml"]=this._sheet.createPart(),e},$_preapreTemplateParts:function(){var e=this._parts;e["[Content_Types].xml"]=$$_XML_HEAD+'<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types"><Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml"/><Default Extension="xml" ContentType="application/xml"/><Override PartName="/docProps/app.xml" ContentType="application/vnd.openxmlformats-officedocument.extended-properties+xml"/><Override PartName="/docProps/core.xml" ContentType="application/vnd.openxmlformats-package.core-properties+xml"/><Override PartName="/xl/sharedStrings.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml"/><Override PartName="/xl/styles.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml"/><Override PartName="/xl/workbook.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml"/><Override PartName="/xl/worksheets/sheet1.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml"/></Types>',e["_rels/.rels"]=$$_XML_HEAD+'<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships"><Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="xl/workbook.xml"/><Relationship Id="rId2" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties" Target="docProps/app.xml"/><Relationship Id="rId3" Type="http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties" Target="docProps/core.xml"/></Relationships>',e["docProps/app.xml"]=$$_XML_HEAD+'<Properties xmlns="http://schemas.openxmlformats.org/officeDocument/2006/extended-properties"><Application>RealGridJS</Application><AppVersion>1.0</AppVersion></Properties>',e["docProps/core.xml"]=$$_XML_HEAD+'<coreProperties xmlns="http://schemas.openxmlformats.org/package/2006/metadata/core-properties" xmlns:cp="http://schemas.openxmlformats.org/package/2006/metadata/core-properties" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:dcterms="http://purl.org/dc/terms/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><dcterms:created xsi:type="dcterms:W3CDTF">2014-12-25T03:06:34Z</dcterms:created><dc:creator>Wooritech</dc:creator></coreProperties>',e["xl/workbook.xml"]=$$_XML_HEAD+'<workbook xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships"><workbookPr date1904="false"/><bookViews><workbookView activeTab="0"/></bookViews><sheets><sheet name="Sheet1" r:id="rId3" sheetId="1"/></sheets></workbook>',e["xl/_rels/workbook.xml.rels"]=$$_XML_HEAD+'<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships"><Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings" Target="sharedStrings.xml"/><Relationship Id="rId2" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles" Target="styles.xml"/><Relationship Id="rId3" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet" Target="worksheets/sheet1.xml"/></Relationships>'}}),$$_SCROLL_SIZE=17,Dom=defineClass("Dom",null,{init:function(e){this._super(),this._element=e},x:function(){return this._element.offsetLeft},y:function(){return this._element.offsetTop},size:function(){return Dom.getSize(this._element)},element:function(){return this._element},detach:function(){this._element.parentNode&&this._element.parentNode.removeChild(this._element)},clearChildren:function(){Dom.clearChildren(this._element)},addChild:function(e){Dom.addChild(this._element,e)},setStyles:function(e){Dom.setStyles(this._element,e)},getBounds:function(){return Dom.getBounds(this._element)},getOffset:function(){return Dom.getOffset(this._element)},move:function(e,t){Dom.move(this._element,e,t)},disableSelection:function(){Dom.disableSelection(this._element)},isAncestorOf:function(e){for(var t=e.parentElement;t;)if(t==this._element)return!0;return!1}},{createElement:function(e,t,i){var s=document.createElement(e);if(t&&Dom.setStyles(s,t),i)for(var n in i)s[n]=i[n];return s},setStyles:function(e,t){if(t){var i,s=e.style;for(i in t)s[i]=t[i]}},removeStyleProperty:function(e,t){e.style.removeProperty?e.style.removeProperty(t):e.style.removeAttribute(t)},addEventListener:function(e,t,i,s){_win.addEventListener?e.addEventListener(t,i,s):e.attachEvent(t,i,s)},removeEventListener:function(e,t,i,s){_win.removeEventListener?e.removeEventListener(t,i,s):e.detachEvent(t,i)},getSize:function(e){e=e.getBoundingClientRect();return{width:e.width,height:e.height}},setSize:function(e,t,i){e=e.style;e.width=t+"px",e.height=i+"px"},getBounds:function(e){var t=e.getBoundingClientRect();return t.cx=e.offsetLeft,t.cy=e.offsetTop,t},setBounds:function(e,t,i,s,n){e=e.style;e.left=t+"px",e.top=i+"px",e.width=s+"px",e.height=n+"px"},getScrolled:function(){var e=document.body,t=document.documentElement;return{sx:window.pageXOffset||t.scrollLeft||e.scrollLeft,sy:window.pageYOffset||t.scrollTop||e.scrollTop}},getOffset:function(e){var e=e.getBoundingClientRect(),t=document.body,i=document.documentElement,s=window.pageYOffset||i.scrollTop||t.scrollTop,n=window.pageXOffset||i.scrollLeft||t.scrollLeft,o=i.clientTop||t.clientTop||0,i=i.clientLeft||t.clientLeft||0,t=e.left+n-i,n=e.top+s-o;return{x:Math.round(t),y:Math.round(n)}},move:function(e,t,i){e.style.left=t+"px",e.style.top=i+"px"},disableSelection:function(e){e.style["-moz-user-select"]="-moz-none",e.style["-khtml-user-select"]="none",e.style["-webkit-user-select"]="none",e.style["-o-user-select"]="none",e.style["-ms-user-select"]="none",e.style["user-select"]="none"},createOptions:function(e,t,i){for(var s=0,n=t.length;s<n;s++){var o=document.createElement("option");o.value=t[s],o.text=(i||t)[s],e.appendChild(o)}},addChild:function(e,t){return!(!e||!t||t.parentNode===e)&&(e.appendChild(t),!0)},removeChild:function(e,t){return!(!e||!t||t.parentNode!==e)&&(e.removeChild(t),!0)},clearChildren:function(e){for(var t=e;t.lastChild;)t.removeChild(t.lastChild)},getChildIndex:function(e){if(e){var t=e.parentNode;if(t)for(var i=t.childNodes,s=0;s<i.length;s++)if(i[s]===e)return s}return-1},getRadioGroupValue:function(e){var t=document.getElementsByName(e);if(t)for(var i=t.length;i--;)if(t[i].checked)return t[i].value},htmlEncode:function(e){return document.createElement("a").appendChild(document.createTextNode(e)).parentNode.innerHTML},getClipRect:function(e){return"rect("+e.y+"px,"+(e.x+e.width)+"px,"+(e.y+e.height)+"px,"+e.x+"px)"},renderTextRect:function(e,t,i,s,n,o){Dom.renderTextBounds(e,t,i,s,n.x,n.y,n.width,n.height,o)},renderTextBounds:function(e,t,i,s,n,o,r,l,a,h){if(i&&s){var u=e.style,c=(e.textContent=s,u.font=t?t.font:DEF_FONT,u.color=i.css(),u.whiteSpace="nowrap",u.textDecoration=t.underline?"underline":"none",e.getBoundingClientRect2());switch(a){case TextAlign.CENTER:n+=(r-c.width)/2;break;case TextAlign.RIGHT:n=n+r-c.width}switch(u.left=n+"px",h){case TextLayout.TOP:break;case TextLayout.BOTTOM:o=o+l-c.height;break;default:TextLayout.MIDDLE;o+=(l-c.height)/2}u.top=o+"px"}},isAncestorOf:function(e,t){for(var i=t.parentElement;i;){if(i==e)return!0;i=i.parentElement}return!1},fireEvent:function(e,t){var i;document.createEventObject?(i=document.createEventObject(),e.fireEvent("on"+t,i)):((i=document.createEvent("HTMLEvents")).initEvent(t,!0,!0),e.dispatchEvent(i))}}),Color=function(e,t){if("string"==typeof e){var i=Color._parse(e,this,t,!1);if("object"==typeof i)return i}else e instanceof Color?(this._r=e._r,this._g=e._g,this._b=e._b,this._a=e._a):isNaN(e)?(this._r=this._g=this._b=0,this._a=t?NaN:1):(this._a=(e>>>24)/255,this._r=(16711680&e)>>16,this._g=(65280&e)>>8,this._b=255&e)},$_tempColor=(Color._ERROR=new Color(UNDEFINED,!0),Color._ERROR.error=!0,Color.createFrom=function(e,t){e=Color._parse(e,$_tempColor,t,!1);return e?"object"==typeof e?e:$_tempColor.clone():null},Color._parse=function(e,t,i,s){function n(e){return e?"%"==e[e.length-1]?toInt(e)/100*255:toInt(e):NaN}if(r=String(e)){var o,r,l=r.length;if("#"==(r=r.trim().toLowerCase()).charAt(0))if(r=r.substr(1),6<=--l&&l<=8)t._b=toInt(r.substr(l-2,2),16),t._g=toInt(r.substr(l-4,2),16),t._r=toInt(r.substr(l-6,2),16),t._a=6==l?i?NaN:1:toInt(r.substr(0,l-6),16)/255;else{if(3!=l){if(s)throw"Invalid color value text: "+e;return!1}t._r=toInt(r.charAt(0)+r.charAt(0),16),t._g=toInt(r.charAt(1)+r.charAt(1),16),t._b=toInt(r.charAt(2)+r.charAt(2),16),t._a=i?NaN:1}else if(0==r.indexOf("rgba(")&&")"==r.charAt(l-1))o=(r=r.substring(5,l-1)).split(","),t._r=n(o[0]),t._g=n(o[1]),t._b=n(o[2]),t._a=o[3];else{if(0!=r.indexOf("rgb(")||")"!=r.charAt(l-1)){if(i&&StrictColors.hasOwnProperty(r))return StrictColors[r];if(!i&&Colors.hasOwnProperty(r))return Colors[r];var a=ColorPaletteItem.createFrom(r,!1);if(a)return a;if(s)throw new Error("Invalid color text: "+e);return!1}o=(r=r.substring(4,l-1)).split(","),t._r=n(o[0]),t._g=n(o[1]),t._b=n(o[2]),t._a=i?NaN:1}return!0}return!1},Color.getColorStringArray=function(e){return e.trim().toLowerCase().split(/\s+|(rgba\(.*\))|(rgb\(.*\))|(pal\(.*\))/).filter(Boolean)},Color.getColorCsvArray=function(e){return e.trim().toLowerCase().split(/\s*,\s*|\s+|(rgba\(.*\))|(rgb\(.*\))|(pal\(.*\))/).filter(Boolean)},Color.prototype.clone=function(){return new Color(this)},Color.prototype.copy=function(e,t){return e?(this._r=e._r,this._g=e._g,this._b=e._b,this._a=isNaN(e._a)?Number(t):e._a):this._a=Number(t),this},Color.prototype.value=function(){return"rgba("+this._r+","+this._g+","+this._b+","+this._a+")"},Color.prototype.valueWithBrightness=function(e){var t=this._r,i=this._g,s=this._b,e=Number(e);return isNaN(e)||1==e||(t=_floor(Math.max(0,Math.min(255,t*e))),i=_floor(Math.max(0,Math.min(255,i*e))),s=_floor(Math.max(0,Math.min(255,s*e))),255==t&&this._r<255&&(t=_floor((255+this._r)/2)),255==i&&this._g<255&&(i=_floor((255+this._g)/2)),255==s&&this._b<255&&(s=_floor((255+this._b)/2))),"rgba("+t+","+i+","+s+","+this._a+")"},Color.prototype.argb=function(){return Math._floor(255*this._a)<<24|this._r<<16|this._g<<8|this._b},Color.prototype.rgb=function(){return this._r<<16|this._g<<8|this._b},Color.prototype.extractAlpha=function(){var e=this._a;return this._a=NaN,e},Color.prototype.toHex=function(){return""+hex(_floor(255*this._a))+hex(this._r)+hex(this._g)+hex(this._b)},Color.prototype.toColorHex=function(){return""+hex(this._r)+hex(this._g)+hex(this._b)},Color.prototype.toString=function(){return"#"+hex(_floor(255*this._a))+hex(this._r)+hex(this._g)+hex(this._b)},Color.prototype.toColorString=function(){return"#"+hex(this._r)+hex(this._g)+hex(this._b)},Color.areEqual=function(e,t){return e&&t&&e._r==t._r&&e._g==t._g&&e._b==t._b&&e._a==t._a},new Color),$_tempColors=[new Color,new Color],Colors={transparent:new Color("#00000000"),aqua:new Color("#00ffff"),black:new Color("#000000"),blue:new Color("#0000ff"),fuchsia:new Color("#ff00ff"),gray:new Color("#808080"),green:new Color("#008000"),lime:new Color("#00ff00"),maroon:new Color("#800000"),navy:new Color("#000080"),olive:new Color("#808000"),orange:new Color("#ffa500"),purple:new Color("#800080"),red:new Color("#ff0000"),silver:new Color("#c0c0c0"),teal:new Color("#008080"),white:new Color("#ffffff"),yellow:new Color("#ffff00"),dimGray:new Color("#696969"),ltGray:new Color("#d3d3d3")},StrictColors={transparent:new Color("#00000000"),aqua:new Color("#00ffff",!0),black:new Color("#000000",!0),blue:new Color("#0000ff",!0),fuchsia:new Color("#ff00ff",!0),gray:new Color("#808080",!0),green:new Color("#008000",!0),lime:new Color("#00ff00",!0),maroon:new Color("#800000",!0),navy:new Color("#000080",!0),olive:new Color("#808000",!0),orange:new Color("#ffa500",!0),purple:new Color("#800080",!0),red:new Color("#ff0000",!0),silver:new Color("#c0c0c0",!0),teal:new Color("#008080",!0),white:new Color("#ffffff",!0),yellow:new Color("#ffff00",!0),dimGray:new Color("#696969",!0),ltGray:new Color("#d3d3d3",!0)},ColorPaletteItem=function(e,t){this._palette=e,this._index=1<arguments.length?t:-1},ColorPalette=(ColorPaletteItem.createFrom=function(e,t){t=t?e.trim().toLowerCase():e;return 0==t.indexOf("pal(")&&")"==t.charAt(t.length-1)?1<=(t=t.substring(4,t.length-1)).indexOf(",")?1<(e=t.split(",")).length?new ColorPaletteItem(e[0],parseInt(e[1])):new ColorPaletteItem(e[0]):new ColorPaletteItem(t):null},ColorPaletteItem.prototype.clone=function(){return new ColorPaletteItem(this._palette,this._index)},ColorPaletteItem.prototype.getColor=function(){var e=this.getIndex();return 0<=e?this._palette.getColor(e):Colors.transparent},ColorPaletteItem.prototype.getIndex=function(){var e=this._palette;return e instanceof ColorPalette||(this._palette=e=ColorPalette.getPalette(this._palette)),e?((this._index<0||this._index>=e.getCount())&&(this._index=e.next()),this._index):-1},function(e){this._colors=[],this._next=0,this._parse(e)}),Pen=(ColorPalette.register=function(e,t){e&&(ColorPalette._palettes[e]=t)},ColorPalette.loadPalettes=function(e){if(e){var t=toArray(e);if(t)for(var i=0;i<t.length;i++){var s=t[i].name,n=t[i].colors;s&&n&&(n=new ColorPalette(n),ColorPalette.register(s,n))}}},ColorPalette.getPalette=function(e){return ColorPalette._palettes.hasOwnProperty(e)?ColorPalette._palettes[e]:ColorPalette._palettes.default},ColorPalette.prototype.getCount=function(){return this._colors.length},ColorPalette.prototype.getColors=function(){return this._colors.slice()},ColorPalette.prototype.next=function(){var e=this._next;return this._next=(this._next+1)%this._colors.length,e},ColorPalette.prototype.getColor=function(e){return this._colors[e]},ColorPalette.prototype._parse=function(e,t){if(this._colors=[],e)for(var i=e,s=0,n=(i=isArray(i)?i:String(e).split(",")).length;s<n;s++){var o=Color.createFrom(i[s],!0);this._colors.push(o)}this._colors.length<1&&this._colors.push(Color.createFrom("#00000000"))},ColorPalette._palettes={default:new ColorPalette("#eeeeee")},function(){var e=arguments;1==e.length?this._parse(e[0]):2==e.length&&(this._color=new Color(e[0]),this._width=parseInt(e[1]))}),TextAlign=(Pen.prototype._parse=function(e){e=PivotHelper.splitEscape(e," ");3==e.length&&"solid"==e[1]?(this._width=parseInt(e[0]),this._color=new Color(e[2])):2==e.length&&"solid"==e[1]?(this._width=1,this._color=Colors.black):(this._width=0,this._color=null)},Pen.prototype.width=function(){return this._width},Pen.prototype.color=function(){return this._color},Pen.prototype.css=_norgba?function(){return this._width+"px solid "+this._color.toColorString()}:function(){return this._width+"px solid "+this._color.value()},_enum({LEFT:"left",CENTER:"center",RIGHT:"right"})),TextLayout=_enum({TOP:"top",MIDDLE:"middle",BOTTOM:"bottom"}),TextWrap=_enum({NONE:"none",NORMAL:"normal"}),ChartItemShapes=_enum({CIRCLE:"circle",TRIANGLE:"triangle",SQUARE:"square",DIAMOND:"diamond"}),ContentVisibility=_enum({VISIBLE:"visible",HIDDEN:"hidden",COLLAPSED:"collapsed"}),LabelPosition=_enum({DEFAULT:"default",FAR:"far",MID:"mid",NEAR:"near"}),ContentOrientation=_enum({HORIZONTAL:"horizontal",VERTICAL:"vertical"}),HorizontalAlign=_enum({DEFAULT:"default",LEFT:"left",CENTER:"center",RIGHT:"right",FILL:"fill"}),VerticalAlign=_enum({DEFAULT:"default",TOP:"top",MIDDLE:"middle",BOTTOM:"bottom",FILL:"fill"}),OverflowPolicy=_enum({NONE:"none",JUSTIFY:"justify"}),Rectangle=function(e,t,i,s){null==e?this.x=this.y=this.width=this.height=0:(this.x=e,this.y=t,this.width=i,this.height=s)},Size=(Rectangle.prototype={constructor:Rectangle,clone:function(){return new Rectangle(this.x,this.y,this.width,this.height)},getInner:function(){return new Rectangle(0,0,this.width,this.height)},equals:function(e){return e===this||e&&this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height},toString:function(){return"{x: "+this.x+", y: "+this.y+", width: "+this.width+", height: "+this.height+"}"},left:function(){return this.x},setLeft:function(e){e-=this.x;this.x+=e,this.width-=e},leftBy:function(e){return this.x+=e,this.width-=e,this},right:function(){return this.x+this.width},setRight:function(e){e-=this.x+this.width;this.width+=e},rightBy:function(e){return this.width+=e,this},top:function(){return this.y},setTop:function(e){e-=this.y;return this.y+=e,this.height-=e,this},topBy:function(e){return this.y+=e,this.height-=e,this},bottom:function(){return this.y+this.height},setBottom:function(e){e-=this.y+this.height;return this.height+=e,this},bottomBy:function(e){return this.height+=e,this},shrink:function(e,t){return this.width-=e,this.height-=t,this},expand:function(e,t){return this.width+=e,this.height+=t,this},contains:function(e,t){return e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height},isEmpty:function(){return 0===this.width||0===this.height},setEmpty:function(){return this.width=this.height=0,this},set:function(e,t,i,s){return this.x=e,this.y=t,this.width=i,this.height=s,this},copy:function(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this},copyHorz:function(e){return this.x=e.x,this.width=e.width,this},copyVert:function(e){return this.y=e.y,this.height=e.height,this},inflate:function(e,t,i,s){return t=1<arguments.length?t:0,i=2<arguments.length?i:e,s=3<arguments.length?s:t,e&&this.setLeft(this.x-e),t&&this.setTop(this.y-t),i&&this.setRight(this.right()+i),s&&this.setBottom(this.bottom()+s),this},offset:function(e,t){return this.x+=e,this.y+=t,this},round:function(){var e=this.clone();return e.x>>>=0,e.y>>>=0,e.width>>>=0,e.height>>>=0,e},union:function(e){var t=this.clone();return t.setLeft(Math.min(this.x,e.x)),t.setRight(Math.max(this.right(),e.right())),t.setTop(Math.min(this.y,e.y)),t.setBottom(Math.max(this.bottom(),e.bottom())),t},normalize:function(){return this.width<0&&(this.x-=this.width,this.width*=-1),this.height<0&&(this.y-=this.height,this.height*=-1),this}},function(e,t){0==arguments.length?this.width=this.height=0:(this.width=e,this.height=t)}),Point=(Size.EMPTY=new Size,Size.empty=function(){return new Size},Size.create=function(e,t){return new Size(e,t)},Size.prototype={constructor:Size,clone:function(){return new Size(this.width,this.height)},equals:function(e){return e===this||e&&this.width===e.width&&this.height===e.height},toString:function(){return"{width: "+this.width+", height: "+this.height+"}"},isEmpty:function(){return 0===this.width||0===this.height},setEmpty:function(){return this.width=this.height=0,this},set:function(e,t){return this.width=e,this.height=t,this},round:function(){var e=this.clone();return e.width>>>=0,e.height>>>=0,e}},function(e,t){0==arguments.length?this.x=this.y=0:(this.x=e,this.y=t)}),SideRectangles=(Point.EMPTY=new Point,Point.empty=function(){return new Point},Point.create=function(e,t){return new Point(e,t)},Point.prototype={constructor:Size,clone:function(){return new Point(this.x,this.y)},equals:function(e){return e===this||e&&this.width===e.width&&this.height===e.height},toString:function(){return"{x: "+this.x+", y: "+this.y+"}"},isEmpty:function(){return 0===this.x||0===this.y},setEmpty:function(){return this.x=this.y=0,this},set:function(e,t){return this.x=e,this.y=t,this},round:function(){var e=this.clone();return e.x>>>=0,e.y>>>=0,e}},function(){this.left=new Rectangle,this.right=new Rectangle,this.top=new Rectangle,this.bottom=new Rectangle}),RelativeSize=(SideRectangles.prototype={constructor:SideRectangles,clear:function(){this.left.setEmpty(),this.right.setEmpty(),this.top.setEmpty(),this.bottom.setEmpty()},setLeft:function(e,t,i,s){this.left.set(e,t,i,s)},setRight:function(e,t,i,s){this.right.set(e,t,i,s)},setTop:function(e,t,i,s){this.top.set(e,t,i,s)},setBottom:function(e,t,i,s){this.bottom.set(e,t,i,s)}},function(e,t){this._size=e,this._fixed=t}),PercentSize=(RelativeSize.prototype={constructor:RelativeSize,clone:function(){return new RelativeSize(this._size,this._fixed)},getSize:function(e){return this._fixed?this._size:e*this._size}},RelativeSize.Empty=new RelativeSize(0,!1),RelativeSize.createFrom=function(e){var t,i=0,s=!1;return e&&0<(t=(e=String(e).trim()).length)&&(2<t&&e.lastIndexOf("px")==t-2&&(s=!0,e=e.substr(0,t-3)),e&&(i=parseFloat(e))),new RelativeSize(i,s)},RelativeSize.equals=function(e,t){return e instanceof RelativeSize&&t instanceof RelativeSize&&e._size===t.size&&e._precentage===t._precentage},function(e,t){this._size=e,this._fixed=t}),SizeF=(PercentSize.prototype={constructor:PercentSize,clone:function(){return new PercentSize(this._size,this._fixed)},getSize:function(e,t){return this._fixed?this._size:e*this._size/(t||100)}},PercentSize.Empty=new PercentSize(0,!0),PercentSize.createFrom=function(e){var t,i=0,s=!0;return e&&0<(t=(e=String(e).trim()).length)&&(1<t&&e.lastIndexOf("%")==t-1&&(s=!1,e=e.substr(0,t-1).trim()),e&&(i=parseFloat(e))),new PercentSize(i,s)},PercentSize.equals=function(e,t){return e instanceof PercentSize&&t instanceof PercentSize&&e._size===t.size&&e._precentage===t._precentage},function(e,t){this.width=e,this.height=t}),pointInBound=(SizeF.prototype={constructor:SizeF,clone:function(){return new SizeF(this.width,this.height)},set:function(e,t){this.width=parseFloat(e),this.height=parseFloat(t)}},SizeF.createFrom=function(e){var t=0,i=0;return e&&(0<(e=String(e).split(",")).length&&(t=i=parseFloat(e[0])),1<e.length&&(i=parseFloat(e[1]))),new SizeF(t,i)},function(e,t,i){return e>=i.left&&e<=i.right&&t>=i.top&&t<=i.bottom}),ProgressView=defineClass("ProgressView",null,{init:function(){this._super(),this._container=null,this._element=this.$_createElement(),this._min=0,this._max=0,this._pos=0},destroy:function(){this._element.parentNode&&this._container.removeChild(this._element),this._container=null,this._super()},modal:!1,message:"Load data...",position:function(){return this._pos},setProperties:function(e,t,i,s){this._min=e,this._max=Math.max(e,t),this._max==this._min&&(this._max=this._min+1),this._pos=Math.max(this._min,Math.min(this._max,i)),s&&this.$_refreshView()},show:function(e,t){this._container=e,this.setMessage(t),e.appendChild(this._element);t=e.getBoundingClientRect(),e=this._element.getBoundingClientRect();this._element.style.left=(t.width-e.width)/2+"px",this._element.style.top=(t.height-e.height)/3+"px"},close:function(){this._element.parentNode&&this._container.removeChild(this._element)},setMessage:function(e){e!=this._message&&(this._spanElement.innerHTML=Dom.htmlEncode(e),this._message=e)},$_createElement:function(){var e=_doc.createElement("div");return e.style.position="absolute",e.style.zIndex=3001,e.style.minWidth="250px",e.style.padding="8px 10px",e.className="realpivot-progress",this._barElement=this.$_createBar(),e.appendChild(this._barElement),this._msgElement=this.$_createMsg(),e.appendChild(this._msgElement),e},$_createBar:function(){var e=_doc.createElement("div"),t=(e.style.width="100%",e.style.height="13px",e.style.marginBottom="4px",e.className="realpivot-progress-bar",this._ledElement=_doc.createElement("div"));return t.style.height="100%",t.style.width="0px",t.className="realpivot-progress-led",e.appendChild(t),e},$_createMsg:function(){var e=_doc.createElement("div"),t=(e.style.width="100%",e.className="realpivot-progress-message",this._spanElement=_doc.createElement("span"));return t.className="realpivot-progress-message",e.appendChild(t),e},$_refreshView:function(){this._element;var e=this._barElement,t=this._ledElement,e=(this._spanElement.innerHTML=Dom.htmlEncode(this._message),e.getBoundingClientRect());t.style.width=Math.min(e.width-1,_int(e.width*(this._pos-this._min)/(this._max-this._min)))+"px"}}),ProgressManager=defineClass("ProgressManager",null,{init:function(e){this._super(),this._container=e,this._title=null,this._view=null,this._active=!1},active:!1,destroy:function(){this._view&&(this._view.destroy(),this._view=null),this._container=null,this._super()},show:function(e,t){this._view||(this._view=new ProgressView),this._title=e||"Load data...",this._view.show(this._container,e),this._active=!0},close:function(){this._view&&this._view.close(),this._active=!1},setProperties:function(e,t,i){message=this._title,e<t&&(message+=parseInt(100*(i-e)/(t-e))+"% ("+i+" / "+t+")"),this._view&&(this._view.setMessage(message),this._view.setProperties(e,t,i,!0))}}),TooltipView=defineClass("ToolTipView",EventAware,{init:function(e){this._super(),this._container=e,this._span=null,this._element=this._createElement()},destroy:function(){this._span&&this._element.removeChild(this._span),this._element.parentNode&&this._container.removeChild(this._element),this._container=null,this._super()},show:function(e,t,i,s,n){var e=e.message+"";e&&(this._span.innerHTML=e.replace(/\n/g,"<br>"),(e=this._element).style.position="absolute",e.style.left=t+"px",e.style.top=i+"px",e.style.visibility="hidden",n?this._container.insertBefore(e,n._element):this._container.appendChild(e),t=e.getBoundingClientRect(),n=this._container.getBoundingClientRect(),e.style.left=t.right>n.right?Math.max(n.right-t.width-n.left-2,0)+"px":e.style.left,e.style.top=t.bottom>n.bottom?(s instanceof LabelCellElement?Math.max(i-t.height-2,0):Math.max(i-t.height-s.height(),0))+"px":e.style.top,e.style.visibility="visible")},hide:function(){var e=this._element;e&&e.parentNode&&this._container.removeChild(e)},_createElement:function(){var e=_doc.createElement("div");return e.className="realpivot-tooltip",this._span=_doc.createElement("span"),this._span.className="realpivot-tooltip",e.appendChild(this._span),e}}),TooltipManager=defineClass("ToolTipManager",null,{init:function(e){this._super(),this._container=e,this._tipView=null,this._active=!1},destroy:function(){this._active&&this.close(),this._tipView&&(this._tipView.destroy(),this._tipView=null),this._container=null,this._super()},delayTime:100,showTimer:null,isVisible:function(){return this._active},show:function(e,t,i,s,n){this._active||(this.close(),e&&(this._tipView||(this._tipView=new TooltipView(this._container)),this._tipView.show(e,t,i,s,n),this._active=!0))},close:function(){this._showTimer&&clearTimeout(this._showTimer),this._active&&(this._tipView&&this._tipView.hide(),this._active=!1)}}),ContextMenuView=defineClass("ContextMenuView",EventAware,{init:function(e,t){this._super(),this._container=e,this._listners=[],this._items=t,this._createElement(t)},destroy:function(){this.hide(),this._items=null,this._removeItems(),this._element=null,this._container=null,this._super()},show:function(e,t,i){this.$_show(e,t,i)},$_show:function(e,t,i){var s=this._element,e=(s.style.position="absolute",s.style.left=e+"px",s.style.top=t+"px",s.style.visibility="hidden",this._container.appendChild(s),s.getBoundingClientRect()),n=this._container.getBoundingClientRect(),i=i?i.height:0;s.style.left=e.right>n.right?Math.max(n.right-e.width-n.left-2,0)+"px":s.style.left,s.style.top=e.bottom>n.bottom?Math.max(t-e.height-i,0)+"px":s.style.top,s.style.visibility="visible"},hide:function(){var e=this._element;e&&e.parentNode&&this._container.removeChild(e)},_createElement:function(e){this._element=_doc.createElement("div"),this._element.className="realpivot-menu",this._buildItems(e)},_removeItems:function(){for(var e=this._listners.length;e--;){var t=this._listners[e];Dom.removeEventListener(t,"click",this._menuItemClick,!1),delete this._listners[e]}for(this._listners=[];this._element.firstChild;)this._element.removeChild(this._element.firstChild)},_buildItems:function(e){this._removeItems();for(var t,i,s,n=this._element,o=0,r=e.length;o<r;o++)(t=_doc.createElement("div")).menuItem=e[o],"-"==e[o].text?(t.className="realpivot-menu-split",(i=_doc.createElement("hr")).className="realpivot-menu-split",t.appendChild(i)):(t.className="realpivot-menu-item",e[o].callback&&(Dom.addEventListener(t,"click",this._menuItemClick.bind(this),!1),this._listners.push(t)),(i=_doc.createElement("span")).className="realpivot-menu-item-pre",t.appendChild(i),(s=_doc.createElement("span")).className="realpivot-menu-item",s.innerHTML=e[o].text||"&nbsp;",t.appendChild(s)),n.appendChild(t)},_menuItemClick:function(e){e=(e.currentTarget||e.srcElement).menuItem.callback;this.hide(),e()}}),ContextMenuManager=defineClass("ContextMenuManager",null,{init:function(e,t){this._super(),this._container=e,this._menuView=null,this._items=t?t.slice():null,this._active=!1,this._itemChanged=!1},destroy:function(){this._active&&this.close(),this._menuView&&(this._menuView.destroy(),this._menuView=null),this._container=null,this._items=null,this._super()},isVisible:function(){return this._active},getView:function(){return this._menuView},show:function(e,t,i){this._active||(this.close(),this._menuView?this._itemChanged&&this._menuView._buildItems(this._items):this._menuView=new ContextMenuView(this._container,this._items),this._menuView.show(e,t,i),this._active=!0,this._itemChanged=!1)},close:function(){this._active&&(this._menuView&&this._menuView.hide(),_trace(this._menuView._element.parentNode),this._active=!1)},setItems:function(e){if(e){this._items=[],this._itemChanged=!0;for(var t=0,i=e.length;t<i;t++){var s={};s.text=e[t].text,s.callback=e[t].callback,this._items.push(s)}}else this._items=null}}),Keys=_enum({BACK:8,TAB:9,ENTER:13,ESC:27,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,F2:113,F3:114,D:68,I:73,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90}),Cursor=_enum({DEFAULT:"default",AUTO:"auto",POINTER:"pointer",WAIT:"wait",MOVE:"move",COL_RESIZE:"col-resize",ROW_RESIZE:"row-resize",CROSSHAIR:"crosshair",HORZ_RESIZE:"ew-resize",VERT_RESIZE:"ns-resize",NESW_RESIZE:"nesw-resize",NWSE_RESIZE:"nwse-resize",NO_DROP:"no-drop",NOT_ALLOWED:"not-allowed"}),_touchToOffset=function(e,t){if(t)if(e){if(e._canvas)return e=e._canvas.getBoundingClientRect(),t.x=t.pageX-(e.left+window.scrollX),t.y=t.pageY-(e.top+window.scrollY),t;alert("no canvas")}else alert("no container");else alert("no touch")},TouchManager=defineClass("TouchManager",null,{init:function(e){this._super(),this._container=e},touchStart:function(e){},touchMove:function(e){},touchEnd:function(e){},touchCancel:function(e){},_toOffset:function(e){return _touchToOffset(this._container,e)}}),VisualTool=defineClass("VisualTool",null,{init:function(e){this._super(),this._owner=e,this._dragTracker=null,this._clickX=0,this._clickY=0,this._currX=0,this._currY=0},dragTracker:null,owner:function(){return this._owner},setDragTracker:function(e){e!==this._dragTracker&&(this._dragTracker&&this._dragTracker.deactivate(),this._dragTracker=e,this._dragTracker&&this._dragTracker.activate())},isDragging:function(){return this._dragTracker&&this._dragTracker.isDragging()},inDraggablePt:function(e,t){return e>=t-VisualTool.DRAG_BORDER-1&&e<=t+VisualTool.DRAG_BORDER},clickX:function(){return this._clickX},clickY:function(){return this._clickY},currX:function(){return this._currX},currY:function(){return this._currY},isEditing:function(){return!1},touchManager:function(){return null},activate:function(){this._doActivate()},deactivate:function(){this._doDeactivate()},keyDown:function(e,t,i,s){return this._doKeyDown(e,t,i,s)},keyUp:function(e,t,i,s){return this._doKeyUp(e,t,i,s)},keyPress:function(e){return this._doKeyPress(e)},click:function(e){this._doClick(e.mouseX,e.mouseY,e)},dblclick:function(e){this._doDblClick(e.mouseX,e.mouseY)},mouseDown:function(e){var t=this._currX=this._clickX=e.mouseX,i=this._currY=this._clickY=e.mouseY,t=(this.isDragging()&&(this._stopDragTracker(t,i,!1),this.setDragTracker(null)),_isMac&&e.metaKey||!_isMac&&e.ctrlKey);this._doMouseDown(e.mouseX,e.mouseY,t,e.shiftKey,e.button,e)},mouseMove:function(e){var t=this._currX=e.mouseX,i=this._currY=e.mouseY,s=this.dragTracker();s?s.isDragging()?("$hasNotButtons"in VisualTool||(VisualTool.$hasNotButtons=_ieOld||_isSafari),VisualTool.$hasNotButtons||0<e.buttons?s.drag(t,i)||(e=s.getNextRequest(t,i))&&(this._stopDragTracker(t,i,!0),this.setDragTracker(this._getDragTracker(e)),this._startDragTracker(t,i)):this._stopDragTracker(t,i,!0)):_abs(t-this._clickX)>=VisualTool.DRAG_THRESHOLD||_abs(i-this._clickY)>=VisualTool.DRAG_THRESHOLD?this._startDragTracker(t,i):this._doMouseMove(t,i):this._doMouseMove(t,i)},mouseUp:function(e){var t=this._currX=e.mouseX,i=this._currY=e.mouseY;this.isDragging()?this._stopDragTracker(t,i,!1):this._doMouseUp(t,i,e)},mouseEnter:function(e){this._doMouseEnter(e.mouseX,e.mouseY)},mouseLeave:function(e){this._doMouseLeave(e.mouseX,e.mouseY)},mouseOver:function(e){this._doMouseOver(e.mouseX,e.mouseY)},mouseOutside:function(){this._doMouseOutside()},mouseWheel:function(e){var t,i;if(!this.owner()._maskView.isVisible())return t=e.wheelDeltaX||0,i=e.wheelDeltaY||e.wheelDelta,_abs(t)>_abs(i)?t=(i=0)<t?VisualTool.WHEEL_DOWN:VisualTool.WHEEL_UP:i=(t=0)<i?VisualTool.WHEEL_DOWN:VisualTool.WHEEL_UP,e.shiftKey?this._doMouseWheel(e.mouseX,e.mouseY,i,t):this._doMouseWheel(e.mouseX,e.mouseY,t,i)},touchStart:function(e){this.touchManager()?this.touchManager().touchStart(e):this._doTouchStart(e)},touchMove:function(e){this.touchManager()?this.touchManager().touchMove(e):this._doTouchMove(e)},touchEnd:function(e){this.touchManager()?this.touchManager().touchEnd(e):this._doTouchEnd(e)},touchCancel:function(e){this.touchManager()?this.touchManager().touchCancel(e):this._doTouchCancel(e)},findElementAt:function(e,t,i){return this._owner.findChildAt(e,t,i)},setFocus:function(){return this._doSetFocus()},_doActivate:function(){trace("tool: activated")},_doDeactivate:function(){trace("tool: deactivated")},_doKeyDown:function(e,t,i,s){return trace("tool: keyDown("+e+")"),!1},_doKeyUp:function(e,t,i,s){return trace("tool: keyUp("+e+")"),!1},_doKeyPress:function(e){trace("tool: keyPress("+e+")")},_doClick:function(e,t,i){trace("tool: click("+e+","+t+")")},_doDblClick:function(e,t){trace("tool: dblClick("+e+","+t+")")},_doMouseDown:function(e,t,i,s,n,o){trace("tool: mouseDown("+e+","+t+")")},_doMouseMove:function(e,t){trace("tool: mouseMove("+e+","+t+")")},_doMouseUp:function(e,t){trace("tool: mouseUp("+e+","+t+")")},_doMouseEnter:function(e,t){trace("tool: mouseEnter("+e+","+t+")")},_doMouseLeave:function(e,t){trace("tool: mouseLeave("+e+","+t+")")},_doMouseOver:function(e,t){trace("tool: mouseOver("+e+","+t+")")},_doMouseOutside:function(){},_doMouseWheel:function(e,t,i,s){return trace("tool: mouseWheel("+i+","+s+")"),!1},_doTouchStart:function(e){trace("tool: touchStart")},_doTouchMove:function(e){trace("tool: touchMove")},_doTouchEnd:function(e){trace("tool: touchEnd")},_doTouchCancel:function(e){trace("tool: touchCancel")},_startDragTracker:function(e,t){this._dragTracker&&(this._dragTracker.start(e,t)?this._doDragTrackerStarted(this._dragTracker):this._dragTracker=null)},_stopDragTracker:function(e,t,i){var s;this.isDragging()&&(s=this._dragTracker,i?s.cancel():s.drop(e,t),this.setDragTracker(null),this._doDragTrackerFinished(s,i),this._owner&&this._owner.invalidate&&this._owner.invalidate())},_doDragTrackerStarted:function(e){trace("dragTracker started: "+e.name())},_doDragTrackerFinished:function(e,t){trace("dragTracker stopped: "+e.name()+", "+(t?"canceled":"completed"))},_doSetFocus:function(){}},{DRAG_BORDER:2,DRAG_THRESHOLD:3,WHEEL_UP:-60,WHEEL_DOWN:60}),RGValueType=Object.freeze({TEXT:"text",NUMBER:"number",BOOLEAN:"boolean",DATETIME:"datetime",OBJECT:"object",CHAR:"char",UNUM:"unum",INT:"int",UINT:"uint",DATE:"date"}),getRGFieldType=function(e){return e?"function"==typeof e.dataType?e.dataType():e.dataType:null},$$$_DEC_SEP=".",$$$_GRP_SEP=",";function decimalPlaces(e){e=(""+e).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return e?Math.max(0,(e[1]?e[1].length:0)-(e[2]?+e[2]:0)):0}var DecimalFormatter=defineClass("DecimalFormatter",null,{init:function(e){this._super(),this._minDigits=0,this._maxDigits=0,this._minInts=0,this._maxInts=0,this._optDecimal=!1,this._groupPos=0,this._seperator=null,this._groupSep=null,this._reg=null,this._regDecimal=null,this._replacement="$&,",this._parse(e)},format:function(e){var t,i,e=Number(e);return isNaN(e)?"":(t=this._minDigits,this._optDecimal&&(i=decimalPlaces(e),t=Math.min(Math.max(i,this._minDigits),this._maxDigits)),i=(e=Number(e.toPrecision(15))).toFixed(t),this._seperator&&(i=i.replace($$$_DEC_SEP,this._seperator)),this._reg?t?i.replace(this._regDecimal,this._replacement):i.replace(this._reg,this._replacement):i)},_parse:function(e){if(e=e&&e.trim()){var t,i=$$$_DEC_SEP,s=$$$_GRP_SEP,n=(-1<e.indexOf(";")&&(e=(o=e.split(";"))[0],1<o.length&&o[1]&&(i=o[1]),2<o.length&&o[2]&&(s=o[2])),this._seperator=i==$$$_DEC_SEP?null:i,this._groupSep=s==$$$_GRP_SEP?null:s,e.length),o=e.indexOf($$$_DEC_SEP);if(this._optDecimal=0<e.indexOf("#",o),this._minDigits=0,(this._maxDigits=0)<=o){for(l=o+1;l<n&&"0"==e.charAt(l);l++)this._minDigits++,this._maxDigits++;for(;l<n&&"#"==e.charAt(l);l++)this._maxDigits++;e=e.substr(0,o)}if(e&&(n=e.length,e.charAt(n-1)==$$$_GRP_SEP&&(this._groupPos=3,e=e.substr(0,n-1))),e)for(var r=!0,l=(n=e.length)-1;0<=l;l--)if("0"==(t=e.charAt(l))&&r)this._minInts++,this._maxInts++;else if(0==this._groupPos&&t==$$$_GRP_SEP)this._groupPos=n-l-1;else{if("#"!=t)break;r=!1}0<this._groupPos&&(this._replacement="$&"+s,this._reg=new RegExp("\\d(?=(\\d{"+this._groupPos+"})+($|\\"+i+"))","g"),this._regDecimal=new RegExp("\\d(?=(\\d{"+this._groupPos+"})+\\"+i+")","g"))}}},{PerformTest:function(e,t){for(var i=new DecimalFormatter(e),e=_getTimer(),s=0;s<t;s++)i.format(1234567.1234);e=_getTimer()-e,trace("##### DecimalFormat PerformTest Result : "+e+" msces.")},Test:function(e,t){e=new DecimalFormatter(e).format(t);trace("##### DecimalFormat Test Result : "+e)}}),BooleanFormatter=defineClass("BooleanFormatter",null,{init:function(e){this._super(),this._format=e,this._nullText=null,this._trueText=null,this._falseText=null,this._parse()},format:null,setFormat:function(e){e!=this._format&&(this._format=e,this._parse())},formatValue:function(e){return e===UNDEFINED?this._nullText:e?this._trueText:this._falseText},_parse:function(){var e;this._falseText=this._trueText=null,this._format&&(e=this._format.split(/[;\:]/),this._falseText=e[0],0<e.length&&(this._trueText=e[1]),1<e.length&&(this._nullText=e[2]))}}),BooleanConverter=function(e){var t=e,r=null,l=!0,a=null,h=null,i=(this.format=function(){return t},this.setFormat=function(e){e!=t&&i(t=e)},this.toBool=function(e){if(r&&e){var t=l?String(e):String(e).toLowerCase();if(t in r)return r[t]}return Boolean(e)},this.toBoolEx=function(e){e=l?String(e):String(e).toLowerCase();return r&&e in r?r[e]:e?Boolean(e):void 0},this.toBoolStrict=function(e){if(r){e=l?String(e):String(e).toLowerCase();if(e in r)return r[e]}},this.toText=function(e){return e?a:h},function(e){if(e){var t,i,e=e.split(/[;\:]/),s=!0,n=e[0],o=n?n.split(","):null;for(1<e.length&&(i=(n=e[1])?n.split(","):null),2<e.length&&"0"==(n=trim(e[2]))&&(s=!1),r={},l=s,t=0;t<o.length;t++)n=o[t],r[s?n:n.toLowerCase()]=!1;for(t=0;t<i.length;t++)n=i[t],r[s?n:n.toLowerCase()]=!0;a=i&&0<i.length?i[0]:"true",h=o&&0<o.length?o[0]:"false"}else r={true:!0,false:!1},a="true",h="false"});i(t)},DATE_SEPARATORS=(BooleanConverter.Default=new BooleanConverter("false,f,0:true,t,1:0"),"./-: "),DateTimeParser=defineClass("DateTimeParser",null,{init:function(e){this._super(),this._baseYear=0,this._patterns=[],this.setFormat(e)},format:null,baseYear:2e3,amText:"AM",pmText:"PM",setFormat:function(e){if(e!=this._format){if(!e)throw"Invalid empty date format";this.$_parseFormat(e),this._format=e}},setBaseYear:function(e){e!=this._baseYear&&(this._baseYear=e)},setAmText:function(e){e!=this._amText&&(this._amText=e)},setPmText:function(e){e!=this._pmText&&(this._pmText=e)},parse:function(e){try{for(var t=0,i=1,s=1,n=0,o=0,r=0,l=0,a=0,h=0,u=this._patterns.length,c=0,d=e.length,_=0;_<u&&c<d;_++){var f=this._patterns[_],p=f.c,m=f.len;switch(p){case"y":t=_int(e.substr(c,m));break;case"M":i=_int(e.substr(c,m));break;case"d":s=_int(e.substr(c,m));break;case"a":if(this._amText&&e.indexOf(this._amText,c)==c)a=12,m=this._amText.length;else{if(!this._pmText||e.indexOf(this._pmText,c)!=c)return null;h=12,m=this._pmText.length}break;case"H":case"h":n=_int(e.substr(c,m));break;case"m":o=_int(e.substr(c,m));break;case"s":r=_int(e.substr(c,m));break;case"S":l=_int(e.substr(c,m));break;case".":case"/":case"-":case":":case" ":if(DATE_SEPARATORS.indexOf(e.charAt(c))<0)return null;break;default:return null}c+=m}}catch(e){return null}return t<100&&(t+=this._baseYear),0<a?12==n&&(n=0):0<h&&n<12&&(n+=12),new Date(t,i-1,s,n,o,r,l)},$_parseFormat:function(e){var t,i,s,n=e,o=n.length,r=0;for(this._patterns=[];r<o;)if(t=r,_isWhitespace(i=n.charAt(r))){for(r++;r<o&&_isWhitespace(n.charAt(r));)r++;this._patterns.push({c:" ",p:t,len:r-t})}else{switch(s=0,i){case"y":4!=(s=this.$_getPattern(n,r,i))&&2!=s&&this.$_throwInvalidFormat(n);break;case"M":case"d":case"H":case"h":case"m":case"s":2!=(s=this.$_getPattern(n,r,i))&&this.$_throwInvalidFormat(n);break;case"S":3!=(s=this.$_getPattern(n,r,i))&&this.$_throwInvalidFormat(n);break;case"a":case".":case"/":case"-":case":":1!=(s=this.$_getPattern(n,r,i))&&this.$_throwInvalidFormat(n);break;default:this.$_throwInvalidFormat(n)}0<s&&(this._patterns.push({c:i,p:r,len:s}),r+=s)}},$_throwInvalidFormat:function(e){throw"Invalid date format: "+e},$_throwInvalidValue:function(e){throw"Invalid date text: "+e},$_getPattern:function(e,t,i){for(var s=1;++t<e.length&&e.charAt(t)==i;)s++;return s}}),$$_DT_DATE_TOKENS=["yy","yyyy","M","MM","d","dd","a","H","HH","h","hh","m","mm","s","ss","S","SS","SSS"],$$_DT_DATE_SEPARATORS=[".","/","-",":"],U_0="0".charCodeAt(0),U_9="9".charCodeAt(0),U_Z="Z".charCodeAt(0),L_Z="z".charCodeAt(0),U_A="A".charCodeAt(0),L_A="a".charCodeAt(0),U_Y="Y".charCodeAt(0),L_Y="y".charCodeAt(0),U_M="M".charCodeAt(0),L_M="m".charCodeAt(0),U_D="D".charCodeAt(0),L_D="d".charCodeAt(0),U_H="H".charCodeAt(0),L_H="h".charCodeAt(0),U_S="S".charCodeAt(0),L_S="s".charCodeAt(0),DateTimeWriter=function(e){function t(e){h="AM",u="PM",e&&(e=e.split(";"),i=e[0]||DateTimeWriter.$_DefaultFormat,c=function(e){var t=[];if(e)for(var i,s,n=e.trim(),o=n.length,r=0;r<o;){if(i=n.charAt(r),0<=$$_DT_DATE_SEPARATORS.indexOf(i))t.push(i),r++;else{for(s=r++;r<o&&n.charAt(r)==i;)r++;if(i=n.substring(s,r),$$_DT_DATE_TOKENS.indexOf(i)<0&&(s=i.charCodeAt(0),U_A<=s&&s<=U_Z||L_A<=s&&s<=L_Z))throw new Error("Invalid datetime write format: "+e);t.push(i)}if(r<o&&_isWhitespace(i=n.charAt(r)))for(t.push(i);r<o&&_isWhitespace(n.charAt(r));)r++}return t}(i),d=0<=c.indexOf("a")||0<=c.indexOf("A"),1<e.length&&e[1]&&(0<(e=e[1].split(",")).length&&e[0]&&(h=e[0]),1<e.length&&e[1]&&(u=e[1])))}function a(e){return e<10?"0"+e:String(e)}var i=null,h=null,u=null,c=null,d=!1,s=null;this.format=function(){return i},this.formatString=function(){return s},this.setFormatString=function(e){(e=e||DateTimeWriter.$_DefaultFormat)!=s&&(c=[],t(e),s=e)},this.getText=function(e){if(!c)return"";for(var t,i=e,s=(i instanceof Date||(i=new Date(e)),""),n=0,o=c.length;n<o;n++){var r=c[n],l=r.length;switch(r.charCodeAt(0)){case L_Y:s+=2<l?i.getFullYear():a(i.getFullYear()%100);break;case U_M:s+=1<l?a(i.getMonth()+1):i.getMonth()+1;break;case L_D:s+=1<l?a(i.getDate()):i.getDate();break;case U_H:s+=1<l?a(i.getHours()):i.getHours();break;case L_H:d?(0==(t=i.getHours())?t=12:12<t&&(t-=12),s+=1<l?a(t):t):s+=1<l?a(i.getHours()):i.getHours();break;case L_M:s+=1<l?a(i.getMinutes()):i.getMinutes();break;case L_S:s+=1<l?a(i.getSeconds()):i.getSeconds();break;case L_A:case U_A:i.getHours()<12?s+=h:s+=u;break;case U_S:s+=i.getMilliseconds().toString().substr(0,l);break;default:s+=r}}return s},this.setFormatString(e||DateTimeWriter.$_DefaultFormat)},$$_DATE_TOKENS=(DateTimeWriter.$_DefaultFormat="yyyy/MM/dd",DateTimeWriter.Default=new DateTimeWriter(DateTimeWriter.$_DefaultFormat),["yy","yyyy","M","MM","d","dd","a","A","H","HH","h","hh","m","mm","s","ss"]),$$_DATE_SEPARATORS=[".","/","-",":"],$$_ZERO_CHAR="0".charCodeAt(0),$$_NINE_CHAR="9".charCodeAt(0),$$_WEEK_TIME=6048e5,$$_NOW=new Date,DatetimeConverter=function(e){function t(e){if(w="am",y="pm",b=2e3,e){var e=e.split(";"),t=C=e[0]||_defaultFormat;if(t=_trim(t)){var i=E(t),s=0<=i.indexOf("a");if(s&&0<=i.indexOf("H"))throw"Invalid datetime read format - 'H'와 'a'가 같이 존재할 수 없습니다: "+t;if(0<=i.indexOf("h")&&!s)throw"Invalid datetime read format - 'h'가 있으면 'a'가 반드시 있어야 합니다: "+t}1<e.length&&e[1]&&(b=_int(e[1])),2<e.length&&e[2]&&(i=e[2].split(","),w=i[0]||"am",1<i.length&&(y=i[1]||"pm")),3<e.length&&(!e[3]||e[3])}}var i=null,C=null,w=null,y=null,b=2e3,E=function(e){var t,i=[];if(t=_trim(e)){for(var s,n=t.length,o=0;o<n;){if(s=t.charAt(o),0<=$$_DATE_SEPARATORS.indexOf(s))i.push(s),o++;else{for(l=o++;o<n&&t.charAt(o)==s;)o++;if(s=t.substring(l,o),$$_DATE_TOKENS.indexOf(s)<0)throw new Error("Invalid datetime read format: "+e);i.push("A"==s?"a":s)}if(o<n&&_isWhitespace(s=t.charAt(o)))for(i.push(" ");o<n&&_isWhitespace(t.charAt(o));)o++}for(var r=[],n=i.length,l=0,o=0;o<n;o++)"a"==(s=i[o])||$$_DATE_TOKENS.indexOf(s)<0?(1<l&&r.push("E"),r.push(s),l=0):(1==l&&r.splice(r.length-2,0,"L"),r.push(s),l++);i=r}return i};this.formatString=function(){return i},this.setFormatString=function(e){e!=i&&t(i=e)},this.format=function(){return C},this.getDate=function(e){var t=null;if(e=_trim(e)){for(var i,s=E(C),n=function(e,t,i){var s,n=[],o=["am","pm","AM","PM","Am","Pm","aM","pM"];if(t&&o.push(t),i&&o.push(i),s=_trim(e))for(var r,l,a=s.length,h=0;h<a;){if(r=s.charAt(h),0<=DATE_SEPARATORS.indexOf(r))n.push(r),h++;else if(r.charCodeAt(0)>=$$_ZERO_CHAR&&r.charCodeAt(0)<=$$_NINE_CHAR){for(l=h++;h<a&&s.charCodeAt(h)>=$$_ZERO_CHAR&&s.charCodeAt(h)<=$$_NINE_CHAR;)h++;r=s.substring(l,h),n.push(r)}else{for(var u=-1,c=0;c<o.length;c++)if(s.indexOf(o[c],h)==h){u=c;break}if(u<0)throw"Invalid date value: "+s;n.push(o[c]),h+=o[c].length}if(h<a&&_isWhitespace(r=s.charAt(h)))for(n.push(" ");h<a&&_isWhitespace(s.charAt(h));)h++}return n}(e,w,y),o=(0<=s.indexOf("a")||s.indexOf("A"),s.length),r=n.length,l=0,a=1,h=1,u=0,c=0,d=0,_=0,f=0,p=0,m=0;p<o&&m<r;){var g=s[p],v=n[m];switch(g.charAt(0)){case"L":for(i=String(v),p++;p<o&&"E"!=(e=s[p]);){switch(v=i?_int(i.substr(0,e.length)):-1,i=i.substr(e.length),e.charAt(0)){case"Y":case"y":l=Math.max(0,v);break;case"M":a=0<=v?v:1;break;case"D":case"d":h=0<=v?v:1;break;case"H":case"h":u=Math.max(0,v);break;case"m":c=Math.max(0,v);break;case"s":d=Math.max(0,v)}p++}break;case"Y":case"y":l=_int(v);break;case"M":a=_int(v);break;case"D":case"d":h=_int(v);break;case"H":case"h":u=_int(v);break;case"m":c=_int(v);break;case"s":d=_int(v);break;case"a":(e=String(v))&&(e=e.toLowerCase(),w&&e==w.toLowerCase()||"am"==e?_=12:(y&&e==y.toLowerCase()||"pm"==e)&&(f=12))}p++,m++}if(l<100&&0<=l&&(l+=b),l<0||9999<l)return null;if(a<1||12<a)return null;if(h<1||31<h)return null;if(2==a){if(29<h)return null;if(29==h&&(l%4!=0||l%100==0)&&l%400!=0)return null}if(u<0||24<u)return null;if((0<_||0<f)&&12<u)return null;if(c<0||59<c)return null;if(d<0||59<d)return null;0<_?u%=12:0<f&&(u=u%12+12),t=new Date(l,a-1,h,u,c,d)}return t},this.getDateNull=function(e){try{return this.getDate(e)}catch(e){}return null},this.getText=function(e){for(var t,i=e,s=(i instanceof Date||(i=new Date(e)),E(C)),n=0<=s.indexOf("a")||0<=s.indexOf("A"),o="",r=0,l=s.length;r<l;r++){var a=s[r],h=a.length;switch(a.charAt(0)){case"L":break;case"Y":case"y":o+=2<h?i.getFullYear():pad(i.getFullYear()%100);break;case"M":o+=1<h?pad(i.getMonth()+1):i.getMonth()+1;break;case"D":case"d":o+=1<h?pad(i.getDate()):i.getDate();break;case"H":o+=1<h?pad(i.getHours()):i.getHours();break;case"h":n?(0==(t=i.getHours())?t=12:12<t&&(t-=12),o+=1<h?pad(t):t):o+=1<h?pad(i.getHours()):i.getHours();break;case"m":o+=1<h?pad(i.getMinutes()):i.getMinutes();break;case"s":o+=1<h?pad(i.getSeconds()):i.getSeconds();break;case"A":case"a":i.getHours()<12?o+=w:o+=y;break;default:o+=a}}return o},this._daysOfYear=function(e){for(var t,i=[31,28,31,30,31,30,31,31,30,31,30],s=0,n=0;n<e.getMonth();n++)s+=i[n];return 2<=e.getMonth()&&(((t=e.getFullYear())%400==0||t%4==0&&t%100!=0)&&s++),s+=e.getDate()},this._daysOfPriorYears=function(e){return e<=1900?0:365*(--e-1899)+(parseInt(e/4)-parseInt(e/100)+parseInt(e/400)-460)},this.toExcelDate=function(e){var t=(1e3*(60*(60*e.getHours()+e.getMinutes())+e.getSeconds())+e.getMilliseconds())/864e5,e=this._daysOfPriorYears(e.getFullYear())+this._daysOfYear(e)+t;return 60<=e&&e++,e},this.getDateValue=function(e,t,i){if(!_isDate(e))return null;switch(t){case DateValueType.YEAR:return e.getFullYear();case DateValueType.HALF:return 5<e.getMonth()?2:1;case DateValueType.QUARTER:return _floor(e.getMonth()/3)+1;case DateValueType.MONTH:return e.getMonth()+1;case DateValueType.WEEKOFYEAR:return(s=new Date(e.getFullYear(),0,1)).setDate(s.getDate()-s.getDay()),_floor((e-s)/$$_WEEK_TIME)+1;case DateValueType.WEEKOFMONTH:var s;return(s=new Date(e.getFullYear(),e.getMonth(),1)).setDate(s.getDate()-s.getDay()),_floor((e-s)/$$_WEEK_TIME)+1;case DateValueType.WEEKDAY:return e.getDay()+1;case DateValueType.DAY:return e.getDate();case DateValueType.HOUR:return e.getHours();case DateValueType.CUSTOM:return i.getText(e)}},this.setFormatString(e)},ISODateTimeParser=(DatetimeConverter.$_DefaultFormat="yyyy/MM/dd",DatetimeConverter.Default=new DatetimeConverter(DatetimeConverter.$_DefaultFormat),function(){}),$$_zoneOffset=60*$$_NOW.getTimezoneOffset()*1e3,DateTimeReader=(ISODateTimeParser.parse=function(t,i){var e=null;try{var s,n,o,r,l=t.indexOf("T"),a=t.substring(0,l),h=t.substring(l+1),u=a.split("-"),c=u.length,d=_int(u[0]),_=1<c?_int(u[1]):1,f=2<c?_int(u[2]):1,p=(-1!=h.indexOf("Z")?(s=1,o=n=0,h=h.replace("Z","")):-1!=h.indexOf("+")?(s=1,r=h.substring(h.indexOf("+")+1,h.length),n=Number(r.substring(0,r.indexOf(":"))),o=Number(r.substring(r.indexOf(":")+1,r.length)),h=h.substring(0,h.indexOf("+"))):-1!=h.indexOf("-")?(s=-1,r=h.substring(h.indexOf("-")+1,h.length),n=Number(r.substring(0,r.indexOf(":"))),o=Number(r.substring(r.indexOf(":")+1,r.length)),h=h.substring(0,h.indexOf("-"))):s=0,h.split(":")),m=0<(c=p?p.length:0)?_int(p[0]):0,g=1<c?_int(p[1]):0,v=2<c?String(p[2]).split("."):null,C=v&&0<v.length?_int(v[0]):0,w=v&&1<v.length?1e3*parseFloat("0."+v[1]):0,y=Date.UTC(d,_-1,f,m,g,C,w),e=new Date(y-(s?(36e5*n+6e4*o)*s:-$$_zoneOffset));if(i&&isNaN(e.getTime()))throw"Invalidate date text: "+t}catch(e){if(i)throw"Invalid date Text: "+t+("\nError: "+e.toString())}return e},function(e){var i=null,s=0,n=new DateTimeParser;this.format=function(){return i},this.setFormat=function(e){var t;e!=i&&(e=i=e)&&(t=e.toLowerCase(),0==(s=Math.max(0,DateTimeReader.FORMATS.indexOf(t)))&&n.setFormat(e))},this.amText=function(){return n.amText()},this.setAmText=function(e){n.setAmText(e)},this.pmText=function(){return n.pmText()},this.setPmText=function(e){n.setPmText(e)},this.baseYear=function(){return n.baseYear()},this.setBaseYear=function(e){n.setBaseYear(e)},this.toDate=function(e){if(null==e||""===e)return null;var t=e;if(!(t instanceof Date)){var i=String(e);if(i)switch(s){case 0:t=n.parse(i);break;case 1:t=ISODateTimeParser.parse(i);break;default:t=new Date(i)}}return!t||isNaN(t.getTime())?null:t},this.setFormat(e)}),ValueTokenParse=(DateTimeReader.FORMATS=["custom","iso","platform"],DateTimeReader.Default=new DateTimeReader("yyyy/MM/dd HH:mm:ss"),DateTimeReader.Default.setAmText("AM"),DateTimeReader.Default.setPmText("PM"),DateTimeReader.Default.setBaseYear(2e3),ExcelFormatConverter=defineClass("ExcelFormatConverter",null,{},{convertNumberFormat:function(e){return 0<e.indexOf(".#")?e.replace(".#",".0"):e},convertDateFormat:function(e){for(var t="",i=e.length,s=0;s<i;s++){var n=e.charAt(s);switch(n){case"y":case"d":case"m":case"s":case":":t+=n;break;case"M":t+="m";break;case"a":t+="AM/PM";break;case"H":t+="h",(i-1<=s||"H"!=e.charAt(s+1))&&(t+="h");break;case"h":0!=s&&"h"==e.charAt(s-1)||(t+="h");break;case"S":break;case".":case"/":case"-":case" ":(i-1<=s||"S"!=e.charAt(s+1))&&(t=t+"\\"+n);break;default:t=t+'"'+n+'"'}}return t}}),ExcelFormatConverter.Default=new ExcelFormatConverter,function(expr,v){return expr.replace(/(\$\{)(.+)(\})/,function(match,a,b,c){return"value"==b?v:0<=b.indexOf("value")?eval(b.replace("value",v)):match})}),WatchDisplayObserver=defineClass("",null,{init:function(e){this._container=e._container,this._pivotView=e,this._watchProc=this.$_watchProc.bind(this),this._resetProc=this.$_resetProc.bind(this)},destroy:function(){this._watchTimer&&clearInterval(this._watchTimer)},_watchTimer:null,_sizeInfo:null,_resetTimer:null,start:function(){this._watchTimer&&clearInterval(this._watchTimer),this._container&&(this.$_resetProc(),this._sizeInfo={width:this._container.clientWidth,height:this._container.clientHeight},this._watchTimer=setInterval(this._watchProc,100))},stop:function(){this._watchTimer&&clearInterval(this._watchTimer),this._watchTimer=null},$_watchProc:function(){var e=this._container.clientWidth,t=this._container.clientHeight,i=this._sizeInfo;(1<=Math.abs(e-i.width)||Math.abs(t-i.height))&&(this._sizeInfo={width:e,height:t},clearTimeout(this._resetTimer),setTimeout(this._resetProc,50))},$_resetProc:function(){this._pivotView.resetSize()}}),FieldType=_enum({COLUMN:"column",ROW:"row",VALUE:"value"}),LabelType=_enum({COLUMN:"column",ROW:"row",BOTH:"both"}),ValueType=_enum({SUM:"sum",COUNT:"count",MIN:"min",MAX:"max",AVERAGE:"avg",DISTINCT:"distinct"}),DateValueType=_enum({YEAR:"year",HALF:"half",QUARTER:"quarter",MONTH:"month",WEEKOFYEAR:"weekofyear",WEEKOFMONTH:"weekofmonth",WEEKDAY:"weekday",DAY:"day",HOUR:"hour",CUSTOM:"custom"}),FilterType=_enum({ALL:"all",EXPRESSION:"expression",ITEMS:"items"}),FilterOperation=_enum({AND:"and",OR:"or"}),SortMethod=_enum({LABEL:"label",VALUE:"value"}),SortDirection=_enum({NONE:"none",ASCENDING:"ascending",DESCENDING:"descending"}),DataOptions=defineClass("DataOptions",PivotOptions,{trimOutputNumber:!0,defaultExpression:ValueType.SUM}),PivotField=defineClass("PivotField",null,{init:function(e,t){this._super(),this._owner=e,this._dataSource=e.getDataSource(),this._orgField=null,this._sourceFieldIndex=INIT_INDEX,this._displayFieldIndex=INIT_INDEX,this._formatter=null,t&&this.assign(t)},destroy:function(){this._owner=null,this._dataSource=null,this._orgField=null,this._formatter&&(this._formatter.destroy(),this._formatter=null),this._super()},name:null,sourceField:null,fieldHeader:null,fieldType:null,labelType:LabelType.BOTH,dateType:null,dateFormat:null,labelEnable:!0,valueEnable:!0,filterEnable:!0,width:null,displayLabels:null,displayFormat:null,displayField:null,labelPrefix:null,labelSuffix:null,summaryHeader:null,summaryFormat:null,summaryPrefix:null,summarySuffix:null,mustValues:null,sortDir:null,sortCallback:null,expression:null,expressions:null,numberFormat:null,prefix:null,suffix:null,valueAlignment:null,exportFormat:null,emptyValue:null,setDateType:function(e){getRGFieldType(this._orgField)==RGValueType.DATETIME?this._dateType=e:this._dateType=null},setSourceField:function(e){this._sourceField!=e&&((this._sourceField=e)?(this._sourceFieldIndex=this._dataSource.getFieldIndex(e),this._orgField=this._dataSource.getField(this._sourceFieldIndex),assert(this._sourceFieldIndex>INIT_INDEX,"sourceField is not found in dataProvider.")):(this._sourceFieldIndex=INIT_INDEX,this._orgField=null))},setDisplayField:function(e){this._displayField!=e&&((this._displayField=e)?(this._displayFieldIndex=this._dataSource.getFieldIndex(e),assert(this._displayFieldIndex>INIT_INDEX,"displayField is not found in dataProvider.")):this._displayFieldIndex=INIT_INDEX)},setDisplayLabels:function(e){this._displayLabels=e?_clone(e):null},getDisplayLabels:function(){return this._displayLabels?_clone(this._displayLabels):null},setNumberFormat:function(e){e!=this._numberFormat&&(e?this._formatter?this._formatter._parse(e):this._formatter=new DecimalFormatter(e):this._formatter=this._formatter&&this._formatter.destroy(),this._numberFormat=e)},sortDir_:function(){return this._sortCallback?SortDirection.NONE:this._sortDir||SortDirection.ASCENDING},setSortDir:function(e){this._sortCallback||(this._sortDir=e)},setDateFormat:function(e){this._dateFormat!=e&&(e?this._dateFormatter?this._dateFormatter.setFormatString(e):this._dateFormatter=new DateTimeWriter(e):this._dateFormatter=null,this._dateFormat=e)},dateFormatter:function(){return this._dateFormatter},assign:function(e){assert(e.sourceField,"sourceField is not defined."),this._super(e),e.name||(this._name=e.sourceField),getRGFieldType(this._orgField)!=RGValueType.NUMBER||this._numberFormat||this.setNumberFormat("#0")},getOrgIndex:function(){return this._sourceFieldIndex},getFieldHeader:function(){return this._fieldHeader||this._name},getDataType:function(){return getRGFieldType(this._orgField)},getSummaryLabel:function(e,t){return this._summaryHeader||(t=this._summaryFormat?ValueTokenParse(this._summaryFormat,e).replace("${label}",t):e+"",this._summaryPrefix&&(t=this._summaryPrefix+t),this._summarySuffix&&(t+=this._summarySuffix),t)},getLabelText:function(e,t){return t&&this._displayFieldIndex>INIT_INDEX?t[this._displayFieldIndex]:this._displayLabels?this._displayLabels[e]:(t=this._displayFormat?ValueTokenParse(this._displayFormat,e):e+"",this._labelPrefix&&(t=this._labelPrefix+t),this._labelSuffix&&(t+=this._labelSuffix),t)},getDisplayText:function(e){var t;return _defined(e)&&(t=this._formatter?this._formatter.format(e):null!=e?String(e):"",this._prefix&&(t=this._prefix+t),this._suffix&&(t+=this._suffix)),t}}),PivotFieldManager=defineClass("PivotFieldManager",null,{init:function(e){this._super(),this._owner=e,this._fields=[],this._columns=[],this._rows=[],this._values=[],this._valueSort={}},destroy:function(){this.clear(),this._owner=null,this._super()},$_fillFieldList:function(e,t,i){if(t)for(var s,n,o=0,r=t.length;o<r;o++)(n=_isStr(t[o])?this.getFieldByName(t[o]):this.getFieldByName(t[o].name))&&(e==FieldType.VALUE&&(s=t[o].expression||n.expression()||this.getDefaultExpression(),n.setExpression(s)),n.setFieldType(e),s=n.sortDir(),n.setSortDir(t[o].direction||(s==SortDirection.NONE?SortDirection.ASCENDING:s)),i.push(n))},$_packFieldList:function(e,t,i){for(var s=[],n=0,o=t.length;n<o;n++){var r,l=t[n];i?((r=l.proxy()).direction=l.sortDir(),delete r.sortDir,s.push(l.proxy())):e==FieldType.VALUE?s.push({name:l.name(),expression:l.expression()}):s.push({name:l.name(),direction:l.sortDir()})}return s},clear:function(){this._columns=[],this._rows=[],this._values=[],this._colDirFlds=[],this._rowDirFlds=[],this._colCondFlds=[],this._rowCondFlds=[],this._valueField=null;for(var e=0,t=this._fields.length;e<t;e++)this._fields[e].destroy(),delete this._fields[e];this._fields=[]},fieldCount:function(){return this._fields.length},getField:function(e){return this._fields[e]},getFieldByName:function(e){for(var t=0,i=this._fields.length;t<i;t++)if(this._fields[t].name()==e)return this._fields[t];return null},columnCount:function(){return this._columns.length},getColumn:function(e){return this._columns[e]},getColumns:function(){return this._columns},getColumnNames:function(e){for(var t=[],i=0,s=this._columns.length;i<s;i++)t.push(e?this._columns[i].proxy():this._columns[i].name());return t},rowCount:function(){return this._rows.length},getRow:function(e){return this._rows[e]},getRows:function(){return this._rows},getRowNames:function(e){for(var t=[],i=0,s=this._rows.length;i<s;i++)t.push(e?this._rows[i].proxy():this._rows[i].name());return t},valueCount:function(){return this._values.length},getValueNames:function(e){for(var t=[],i=0,s=this._values.length;i<s;i++)t.push(e?this._values[i].proxy():this._values[i].name());return t},getValue:function(e){return this._values[e]},getValues:function(){return this._values},getFieldsText:function(e,t){for(var i="",s=0,n=e.length;s<n;s++){i&&(i+=", ");var o=e[s];i+=o.getFieldHeader(),t&&(i+="("+RealPivotMessages.valueTypeTexts[o.expression()]+")")}return i},setFieldMapping:function(e){var t,i;for(this.clear(),t=0,i=e.length;t<i;t++){var s=new PivotField(this._owner,e[t]);this._fields.push(s)}},setPivotFields:function(e){this._columns=[],this._rows=[],this._values=[],this.$_fillFieldList(FieldType.COLUMN,e.columns,this._columns),this.$_fillFieldList(FieldType.ROW,e.rows,this._rows),this.$_fillFieldList(FieldType.VALUE,e.values,this._values)},getPivotFields:function(e){return{columns:this.$_packFieldList(FieldType.COLUMN,this._columns,e),rows:this.$_packFieldList(FieldType.ROW,this._rows,e),values:this.$_packFieldList(FieldType.VALUE,this._values,e),sort:{column:deepCopy(this._valueSort.column)||null,row:deepCopy(this._valueSort.row)||null}}},clearSort:function(){for(var e=this._fields.length;e--;)this._fields[e].setSortDir(SortDirection.NONE);this._valueSort={}},clearValueSort:function(){this._valueSort={}},setValueSort:function(e,t,i,s){this._valueSort[e]||(this._valueSort[e]={});e=this._valueSort[e];e.fieldName=t,e.direction=i,e.conditions=_extend(s)},getValueSort:function(e){return this._valueSort[e]},getFieldSortDir:function(e,t){var i,s;return e==FieldType.VALUE?(i=this._valueSort[FieldType.COLUMN],s=this._valueSort[FieldType.ROW],i&&i.fieldName==t?i.direction:s&&s.fieldName==t?s.direction:SortDirection.NONE):this._valueSort[e]?SortDirection.NONE:this.getFieldByName(t).sortDir()},getDefaultExpression:function(){return this._owner._options.defaultExpression()}}),FilterItem=defineClass("FilterItem",null,{init:function(){this._super(),this._exprNode=null,this._field=null},destroy:function(){this._exprNode=null,this._field=null,this._super()},type:FilterType.ALL,field:null,values:null,getValues:function(){return this._values?this._values.slice(0):null},criteria:null,setCriteria:function(e){this._exprNode=e?ExpressionParser.Default.parse(e,null):null,this._criteria=e},parse:function(e){if(e.criteria)this._type=FilterType.EXPRESSION,this.setCriteria(e.criteria);else if("all"==e.values)this._type=FilterType.ALL;else if(this._values=[],this._type=FilterType.ITEMS,_isArray(e.values))for(var t=0,i=e.values.length;t<i;t++)this._values.push(e.values[t]);else this._values.push(e.values)},toObject:function(){var e={};switch(e.name=this._field.name(),this._type){case FilterType.ALL:e.values="all";break;case FilterType.EXPRESSION:e.criteria=this._criteria;break;case FilterType.ITEMS:e.values=this._values.slice(0)}return e},checkExpress:function(e,t){return!!this._exprNode&&(e.setData(t),this._exprNode.evaluate(e))},checkInclude:function(e){return!!(this._values&&0<this._values.length)&&-1<this._values.indexOf(e)}}),FilterManager=defineClass("FilterManager",null,{init:function(e){this._super(),this._owner=e,this._filters=[],this._fieldManager=e.fieldManager()},destroy:function(){this.$_clear(),this._super()},operation:null,$_clear:function(){for(var e=this._filters.length;e--;){this._filters[e].field();this._filters[e].destroy(),delete this._filters[e]}this._filters=[]},count:function(){return this._filters.length},getFilter:function(e){return this._filters[e]},reset:function(){this.$_clear()},parse:function(e){this._operation=e.operation||FilterOperation.AND,this.$_clear();for(var t=0,i=e.conditions.length;t<i;t++){var s=new FilterItem,n=this._fieldManager.getFieldByName(e.conditions[t].name);assert(null!=n,"[filter] Not found field. ("+e.conditions[t].name+")"),s.setField(n),s.parse(e.conditions[t]),this._filters.push(s)}},toObject:function(){if(0<this._filters.length){var e={};e.operation=this._operation,e.conditions=[];for(var t=0,i=this._filters.length;t<i;t++){var s=this._filters[t];e.conditions.push(s.toObject())}return e}return null},select:function(e,t){for(var i=this._filters.length,s=0==i||this._operation==FilterOperation.AND,n=0;n<i;n++){var o=this._filters[n],r=!0;switch(o._type){case FilterType.ALL:break;case FilterType.EXPRESSION:var l=this._owner._getPivotValue(t,o.field()),r=o.checkExpress(e,l);break;case FilterType.ITEMS:l=this._owner._getPivotValue(t,o.field());r=o.checkInclude(l)}s=this._operation==FilterOperation.AND?s&&r:s||r}return s}}),LabelData=function(e,t,i){this.name=e,this.value=t,this.label=i,this.keepChild=!1,this.childs={},this.refCount=void 0,this.refValue=void 0},ValueData=(LabelData.prototype.toProxy=function(){var e={childs:[]};if(e.value=this.value,e.label=this.label,this.hasOwnProperty("childs"))for(var t=0,i=this.childs.length;t<i;t++)e.childs.push(this.childs[t].toProxy());return e},function(){this.value=void 0,this.count=void 0,this.dataRows=[]}),VALUE_SEPERATOR=(ValueData.prototype.initCols=function(){this.cols={}},ValueData.prototype.initRows=function(){this.rows={}},":::"),PivotDataProvider=(ValueData.prototype.toProxy=function(e,t){if(this.count){var i,s,n={cols:{},rows:{}};for(s in n.value=e&&_isNumber(this.value)?_trimNumber(this.value,t):this.value,this.cols)(i=this.cols[s].toProxy(e,t))&&(n.cols[s]=i);for(s in this.rows)(i=this.rows[s].toProxy(e,t))&&(n.rows[s]=i);return n}},ValueData.prototype.$_childToDescendants=function(e,t,i,s){for(var n in s=s||1,i=i?i+VALUE_SEPERATOR:"",t){var o=t[n];o&&(e[i+n]=o.value,o.hasOwnProperty("childs")&&this.$_childToDescendants(e,o.childs,i+n,s+1))}},ValueData.prototype.toRowProxy=function(e,t){if(this.count){var i,s={childs:{},descendants:{},rows:{}};for(i in this.dataRows&&(s.dataRows=this.dataRows.slice()),s.value=e&&_isNumber(this.value)?_trimNumber(this.value,t):this.value,this.cols){var n=this.cols[i].toRowProxy(e,t);n&&(s.childs[i]=n)}if(this.$_childToDescendants(s.descendants,s.childs),this.rows&&Object.keys(this.rows))for(i in this.rows){var o=this.rows[i].toRowProxy(e,t);o&&(s.rows[i]=o)}return s}},ValueData.prototype.toColProxy=function(e,t){if(this.count){var i,s={childs:{},descendants:{}};for(i in this.dataRows&&(s.dataRows=this.dataRows.slice()),s.value=e&&_isNumber(this.value)?_trimNumber(this.value,t):this.value,this.rows){var n=this.rows[i].toColProxy(e,t);n&&(s.childs[i]=n)}return this.$_childToDescendants(s.descendants,s.childs),s}},ValueData.prototype.toCellProxy=function(e,t){if(this.count){var i,s={cols:{}};for(i in s.value=e&&_isNumber(this.value)?_trimNumber(this.value,t):this.value,this.dataRows&&(s.dataRows=this.dataRows.slice()),this.cols){var n=this.cols[i].toCellProxy(e,t);n&&(s.cols[i]=n)}return s}},$$_calcfuncs={},$$_calcfuncs[ValueType.SUM]=function(e,t){return _defined(e)?e+t:t},$$_calcfuncs[ValueType.COUNT]=function(e,t){return _defined(e)?e+t:t},$$_calcfuncs[ValueType.MIN]=function(e,t){return _defined(e)?_min(e,t):t},$$_calcfuncs[ValueType.MAX]=function(e,t){return _defined(e)?_max(e,t):t},$$_calcfuncs[ValueType.AVERAGE]=function(e,t,i){return _defined(e)?(e*i+t)/(i+1):t},$$_calcfuncs[ValueType.DISTINCT]=function(e,t){return _defined(t)?t:e},defineClass("PivotDataProvider",EventAware,{init:function(){this._super(),this._dataSource=null,this._fieldManager=new PivotFieldManager(this),this._columnLeafCount=0,this._rowLeafCount=0,this._baseValues=[],this._filteredValues=[],this._columnLabelRoot={},this._rowLabelRoot={},this._columnLabels=[],this._rowLabels=[],this._values={},this._filters=new FilterManager(this),this._filterRuntime=new FilterRuntime,this._options=new DataOptions},destroy:function(){this._options.destroy(),this._options=null,this._filterRuntime.destroy(),this._filterRuntime=null,this._filters.destroy(),this._filters=null,this._rowLabels=null,this._coumnLabels=null,this._values=null,this._summaries=null,this._baseValues=null,this._filteredValues=null,this._fieldManager.destroy(),this._fieldManager=null,this._dataSource&&this._dataSource.removeListener(this),this._dataSource=null,this._super()},getColumnLabels:function(){return this._columnLabels},getRowLabels:function(){return this._rowLabels},getValues:function(){return this._values},fieldManager:function(){return this._fieldManager},filterManager:function(){return this._filters},isEmpty:function(){return 0==this._fieldManager.valueCount()||0==this._fieldManager.columnCount()&&0==this._fieldManager.rowCount()},isDataEmpty:function(){return _isEmptyObj(this._values)||!this._baseValues||this._baseValues.length<=0},setDataSource:function(e){e?(assert(e&&e._dp&&e._dp.getDistinctValues&&e._dp._rowIds,"provider indices must be LocalDataProvider."),this._dataSource=e._dp,this._dataSource.addListener(this)):(this._dataSource.removeListener(this),this._dataSource=null)},getOptions:function(){return this._options.proxy(!1)},setOptions:function(e){this._options.assign(e)},getDataSource:function(){return this._dataSource},clearFieldMapping:function(){this._fieldManager.clear()},setFieldMapping:function(e){this._fieldManager.setFieldMapping(e)},getFieldMapping:function(){for(var e=[],t=this._fieldManager,i=0,s=t.fieldCount();i<s;i++)e.push(t.getField(i).proxy());return e},setPivotFields:function(e,t){this._fieldManager.setPivotFields(e),e.filter?this.filter(e.filter):this.resetFilter(),this.sort(e.sort),this.buildPivotData()},getPivotFields:function(e){var e=this._fieldManager.getPivotFields(e),t=this._filters;return 0<t.count()?e.filter=t.toObject():e.filter={operation:t._operation||FilterOperation.AND,conditions:[]},e},buildPivotData:function(e){_trace("#pivot build data"),e&&this.$_refreshData();e=_performenceCountStart();this.$_extractLabels(),this.$_initializeValues(),this.$_summarizeValues(),_trace(_performenceCountEnd(e)+"ms ellapsed."),this.fireConfirmEvent(PivotDataProvider.CONFIRM_SHOW_PROGRESSIVE)||this.fireEvent(PivotDataProvider.DATA_REFRESHED)},sort:function(e){var t,i,s=this._fieldManager;if(s.clearValueSort(),e){if(t=e.column)if(t.method==SortMethod.LABEL)for(var n=0,o=t.labels.length;n<o;n++)(i=s.getFieldByName(t.labels[n].name))&&i.setSortDir(t.labels[n].direction);else this._fieldManager.setValueSort(FieldType.COLUMN,t.fieldName,t.direction,t.conditions);if(t=e.row)if(t.method==SortMethod.LABEL)for(n=0,o=t.labels.length;n<o;n++)(i=s.getFieldByName(t.labels[n].name))&&i.setSortDir(t.labels[n].direction);else this._fieldManager.setValueSort(FieldType.ROW,t.fieldName,t.direction,t.conditions)}},resetFilter:function(){this._filters.reset(),this._filteredValues=_clone(this._baseValues)},filter:function(e){e&&this._filters.parse(e),this._filteredValues=[];for(var t=0,i=this._baseValues.length;t<i;t++)this._filters.select(this._filterRuntime,this._baseValues[t])&&this._filteredValues.push(this._baseValues[t])},getFilters:function(){return this._filters.toObject()},getDistinctValues:function(e,t,i,s,n){return this.$_getDistinctValues(e,t,i,s,n)},getBodyCount:function(){return this._columnLeafCount*this._fieldManager.valueCount()*this._rowLeafCount},getValueData:function(){var e,t,i={},s=this._options.isTrimOutputNumber();for(e in this._values)s&&(t=(t=this._fieldManager.getFieldByName(e))&&t._formatter instanceof DecimalFormatter?t._formatter._maxDigits:0),i[e]=this._values[e].toProxy(s,t);return i},getRowValueData:function(e,t){t=t||{};var i=this._fieldManager.getRowNames(),s=this._values[e];if(s){t=Array.isArray(t)?arrayNameToObj(i,t):t;for(var n=0;n<i.length;n++){var o=i[n];if(!t.hasOwnProperty(o)||!s)break;s=s.rows[t[o]]}e=this._fieldManager.getFieldByName(e),e=e&&e._formatter instanceof DecimalFormatter?e._formatter._maxDigits:0;return s&&s.toRowProxy(this._options.isTrimOutputNumber(),e)}},getColumnValueData:function(e,t){t=t||{};var i=this._fieldManager.getColumnNames(),s=this._values[e];if(s){t=Array.isArray(t)?arrayNameToObj(i,t):t;for(var n=0;n<i.length;n++){var o=i[n];if(!t.hasOwnProperty(o)||!s)break;s=s.cols[t[o]]}e=this._fieldManager.getFieldByName(e),e=e&&e._formatter instanceof DecimalFormatter?e._formatter._maxDigits:0;return s&&s.toColProxy(this._options.isTrimOutputNumber(),e)}},getCellValueData:function(e,t,l){var i=this._options.isTrimOutputNumber();function a(e){var t,i={};for(t in e){for(var s=e[t],n=s,o=0;o<u.length;o++){var r=u[o];if(!l.hasOwnProperty(r)||!n)break;n=n.cols[l[r]]}n&&n.count&&(i[t]=n?n.toCellProxy():{},s.rows&&i[t]&&(i[t].rows=a.call(this,s.rows)))}return i}var s=this._fieldManager.getFieldByName(e),s=s&&s._formatter instanceof DecimalFormatter?s._formatter._maxDigits:0,n=this._values[e];if(t=t||{},n){var o=this._fieldManager.getRowNames();t=Array.isArray(t)?arrayNameToObj(o,t):t;for(var r=0;r<o.length;r++){var h=o[r];if(!t.hasOwnProperty(h)||!n)break;n=n.rows[t[h]]}}e=n&&n.rows;if(n){var u=this._fieldManager.getColumnNames();l=l||{},l=Array.isArray(l)?arrayNameToObj(u,l):l;for(r=0;r<u.length;r++){h=u[r];if(!l.hasOwnProperty(h)||!n)break;n=n.cols[l[h]]}}if(n&&n.count)return i=n.toCellProxy(i,s),e&&(i.rows=a.call(this,e)),i},getColumnLabelData:function(){for(var e=[],t=0,i=this._columnLabels.length;t<i;t++)e.push(this._columnLabels[t].toProxy());return e},getRowLabelData:function(){for(var e=[],t=0,i=this._rowLabels.length;t<i;t++)e.push(this._rowLabels[t].toProxy());return e},onDataProviderRefresh:function(){this.$_refreshData(),this.buildPivotData()},_getPivotValue:function(e,t){e=e[t.getOrgIndex()];return e=null!=t.dateType()?DatetimeConverter.Default.getDateValue(e,t.dateType(),t.dateFormatter()):e},$_refreshData:function(){this._baseValues=this._dataSource.getRows(),this._baseValues.forEach(function(e,t){e[$$DATAROW$$]=t}),this._filteredValues=_clone(this._baseValues),0<this._filters.count()&&this.filter()},$_getDistinctValues:function(e,t,i,s,n){for(var o=[],r=s?this._filteredValues:this._baseValues,l=t.length,a=0,h=r.length;a<h;a++){var u,c=r[a];if(_indexOfObj(o,"value",u=this._getPivotValue(c,e))<0){for(var d,_=!0,f=0;f<l;f++)if(this._getPivotValue(c,t[f])!=i[f]){_=!1;break}_&&((d={}).name=e._name,d.value=u,e._displayFieldIndex>INIT_INDEX?d.label=c[e._displayFieldIndex]:e._displayFormat?d.label=ValueTokenParse(e._displayFormat,u):e._displayLabels&&(d.label=e._displayLabels[u]),o.push(d))}}return n&&o.sort(n==SortDirection.DESCENDING?this.$_compareDescByValue:this.$_compareByValue),o},$_compareByValue:function(e,t){e=null==e.value?0:e.value,t=null==t.value?0:t.value;return t<e?1:e<t?-1:0},$_compareDescByValue:function(e,t){e=null==e.value?0:e.value,t=null==t.value?0:t.value;return t<e?-1:e<t?1:0},$_compareByRefValue:function(e,t){e=null==e.refValue?0:e.refValue,t=null==t.refValue?0:t.refValue;return t<e?1:e<t?-1:0},$_compareDescByRefValue:function(e,t){e=null==e.refValue?0:e.refValue,t=null==t.refValue?0:t.refValue;return t<e?-1:e<t?1:0},$_getFieldLabels:function(e,t,i,s,n,o,r,l){for(var a,h,u,c,d=function(e,t,i){if(!(i>t.length-1)){var s,n,o=t[i],r=o.mustValues();if(_isArray(r))for(w=r.length;w--;)e[n=r[w]]||(s=o.getLabelText(n),e[n]=new LabelData(o.name(),n,s),i<t.length-1&&(e[n].keepChild=!0));for(n in e)d(e[n].childs,t,i+1)}},_=function(e,t,i,s){var n,o=0;for(n in t){var r=t[n],l=_clone(r);l.childs=[],_isEmptyObj(r.childs)?r.keepChild||(o++,delete l.childs):o+=_(l.childs,r.childs,i,s+1),e.push(l)}var a=m[s],h=g[s];return h?e.sort(h):a&&(i?e.sort(a==SortDirection.DESCENDING?this.$_compareDescByRefValue:this.$_compareByRefValue):e.sort(a==SortDirection.DESCENDING?this.$_compareDescByValue:this.$_compareByValue)),o}.bind(this),f=this._filteredValues,p={},m=[],g=[],v=f.length,C=i.length,w=0;w<v;w++)for(u=t,a=f[w],c=0;c<C;c++){var y=i[c];if(0==w&&(m.push(o||y.sortDir()),g.push(y.sortCallback())),h=this._getPivotValue(a,y),p=u.hasOwnProperty(h)?u[h]:(T=y.getLabelText(h,a),u[h]=new LabelData(y.name(),h,T)),n&&p){for(var b=!0,E=0,S=l.length;E<S;E++)if(l[E]!=this._getPivotValue(a,r[E])){b=!1;break}var T,x,y=this._getPivotValue(a,n);b&&_defined(y)&&(T=n.expression(),x=p.refCount||0,p.refValue=$$_calcfuncs[T](p.refValue,y,x),p.refCount=++x)}u=u[h].childs}return d(t,i,0),_(e,t,n,0)},$_extractLabels:function(){var e=this._fieldManager.getColumns(),t=this._fieldManager.getRows(),i=(this._columnLeafCount=0,this._rowLeafCount=0,this._fieldManager),s=i.getValueSort(FieldType.COLUMN),n=i.getValueSort(FieldType.ROW);if(this._columnLabels=[],this._columnLabelRoot={},0<e.length)if(s&&s.fieldName){for(var o=i.getFieldByName(s.fieldName),r=[],l=[],a=0,h=s.conditions.length;a<h;a++)r.push(i.getFieldByName(s.conditions[a].name)),l.push(s.conditions[a].value);this._columnLeafCount=this.$_getFieldLabels(this._columnLabels,this._columnLabelRoot,e,[],o,s.direction,r,l)}else this._columnLeafCount=this.$_getFieldLabels(this._columnLabels,this._columnLabelRoot,e,[]);if(this._rowLabels=[],this._rowLabelRoot={},0<t.length)if(n&&n.fieldName){for(o=i.getFieldByName(n.fieldName),r=[],l=[],a=0,h=n.conditions.length;a<h;a++)r.push(i.getFieldByName(n.conditions[a].name)),l.push(n.conditions[a].value);this._rowLeafCount=this.$_getFieldLabels(this._rowLabels,this._rowLabelRoot,t,[],o,n.direction,r,l)}else this._rowLeafCount=this.$_getFieldLabels(this._rowLabels,this._rowLabelRoot,t,[])},$_getValueLabels:function(e,t){for(var i=[],s=0,n=t.length;s<n;s++){var o,r=t[s];e.hasOwnProperty(r.getOrgIndex())&&((o={}).name=t[s].name(),o.value=this._getPivotValue(e,r),i.push(o))}return i},$_findValue:function(e,t,i,s){for(var n,o=0,r=e.length;o<r;o++)if(_equalsArray((n=e[o]).rows,t)&&_equalsArray(n.cols,i)&&n.valueField==s.name())return n;return null},$_initializeValues:function(){function a(e,t){for(var i=0,s=t.length;i<s;i++){var n=t[i],o=e[n.value]=new ValueData;n.hasOwnProperty("childs")&&(o.initCols(),a(o.cols,n.childs))}}for(var e=this._values={},t=this._fieldManager.getValueNames(),i=0;i<t.length;i++){var s=e[t[i]]=new ValueData;0<this._columnLabels.length&&(s.initCols(),a(s.cols,this._columnLabels)),0<this._rowLabels.length&&(s.initRows(),function e(t,i,s){for(var n=0,o=i.length;n<o;n++){var r=i[n],l=t[r.value]=new ValueData;l.initCols(),a(l.cols,s),r.hasOwnProperty("childs")&&(l.initRows(),e(l.rows,r.childs,s))}}(s.rows,this._rowLabels,this._columnLabels))}},$_summarizeValues:function(){var o,r,l=this._values;function h(e,t,i,s){e.value=i==ValueType.COUNT?_defined(e.value)?e.value+1:1:$$_calcfuncs[i](e.value,t,e.count),e.count=_defined(e.count)?e.count+1:1,e.dataRows.push(s)}function u(e,t,i,s,n,o,r){var l=t.shift();o.push(l),e=e[l.value]||(e[l.value]=new ValueData),_defined(i)&&h(e,i,s.expression(),r),0<t.length&&u(e.cols||(e.cols={}),t.concat(),i,s,n,o,r)}var a,c,d=this._filteredValues,_=this._fieldManager.getValues(),f=this._fieldManager.getValueNames(),p=this._fieldManager.getColumns(),m=this._fieldManager.getRows(),e=function(e){o=d[e];for(var t=this.$_getValueLabels(o,p),i=this.$_getValueLabels(o,m),s=0,n=f.length;s<n;s++)a=f[s],c=_[s],a=l[a],_defined(r=o[c.getOrgIndex()])&&h(a,r,c.expression(),o[$$DATAROW$$]),0<t.length&&u(a.cols,t.concat(),r,c,[],[],o[$$DATAROW$$]),0<i.length&&!function e(t,i,s,n,o,r,l){var a=i.shift(),a=(r.push(a),t=t[a.value]||(t[a.value]=new ValueData),_defined(n)&&h(t,n,o.expression(),l),t.cols||(t.cols={}));0<s.length&&u(a,s.concat(),n,o,r,[],l),0<i.length&&e(t.rows||(t.rows={}),i.concat(),s.concat(),n,o,r,l)}(a.rows,i.concat(),t.concat(),r,c,[],o[$$DATAROW$$])}.bind(this),t=function(e){this.fireEvent(PivotDataProvider.SET_PROGRESS_PROPERTY,e)}.bind(this),i=function(){this.fireEvent(PivotDataProvider.DATA_REFRESHED),this.fireEvent(PivotDataProvider.COMPLETE_PROGRESS)}.bind(this);if(this.fireConfirmEvent(PivotDataProvider.CONFIRM_SHOW_PROGRESSIVE))this.fireEvent(PivotDataProvider.SETUP_PROGRESS,d.length,RealPivotMessages.progressDataAnalysis),PivotHelper.asyncLoop(0,d.length-1,1e3,this,e,t,i);else for(var s=0,n=d.length;s<n;s++)e(s)}})),PivotModelItem=(PivotDataProvider.DATA_REFRESHED="onPivotDataRefreshed",PivotDataProvider.CONFIRM_SHOW_PROGRESSIVE="isShowProgressive",PivotDataProvider.SETUP_PROGRESS="onSetupProgress",PivotDataProvider.SET_PROGRESS_PROPERTY="onProgressProperty",PivotDataProvider.COMPLETE_PROGRESS="onCompleteProgress",defineClass("PivotModelItem",null,{init:function(e,t){this._super(),this._level=e,this._summaryItem=!!t},destroy:function(){this._super()},summaryItem:!1,level:0,prepareChildren:function(){this._childs||(this._childs={})}},{ITEM_SUMMARY:"$$sum"})),PivotCellGroup=defineClass("PivotCellGroup",null,{init:function(){this._super()},destroy:function(){if(this._childs){for(var e in this._childs)this._childs[e].destroy(),this._childs[e]=null;this._childs=null}for(var t in this)this[t]instanceof BaseClass&&(this[t].destroy(),this[t]=null);this._super()},prepareChildren:function(){this._childs||(this._childs={})}}),PivotCellItem=defineClass("PivotCellItem",PivotModelItem,{init:function(e,t,i,s,n){this._super(i,s),this._field=t,this._dataObj=e,this._rowLevel=n.level()},destroy:function(){for(var e in this._childs)this._childs[e].destroy(),this._childs[e]=null;this._field=null,this._dataObj=null,this._super()},rowLevel:0,field:null,width:0,height:0,getValue:function(){return this._dataObj.value},getCount:function(){return this._dataObj.count||0}}),PivotRowItem=defineClass("PivotColumnModel",PivotModelItem,{init:function(e,t,i,s,n){this._super(s,n),this._childs={},this._cells={},this._dataObjs={},this._dataObjs[i]=e},destroy:function(){for(var e in this._childs)this._childs[e].destroy(),this._childs[e]=null;for(e in this._childs=null,this._cells)this._cells[e].destroy(),this._cells[e]=null;this._cells=null,this._dataObjs=null,this._super()},appendCells:function(e,t,i,s){this._dataObjs[i]=e,this.$_buildCells(e,t,i,s)},getCell:function(e,t){for(var i,s=this._cells,n=0,o=e.length;n<o;n++)s=(i=s[e[n]])._childs;return(i=_isEmptyObj(s)?i:s[PivotModelItem.ITEM_SUMMARY])instanceof PivotCellItem?i:i[t]},$_buildCells:function(e,i,s,n){(n?function e(i,s,n,o,r,l,a){var h,u=new PivotCellItem(s,n,r,!0,a);for(h in i[PivotModelItem.ITEM_SUMMARY]=u,s.cols){var c=s.cols[h],u=new PivotCellItem(c,n,r+1,l,a);i[h]=u,t=performance.now(),c.cols&&(i[h].prepareChildren(),e(i[h]._childs,c,n,o,r+1,l,a))}}:function e(t,i,s,n,o,r,l){var a=new PivotCellItem(i,s,o,!0,l),h=PivotModelItem.ITEM_SUMMARY;for(h in t[h]||(t[h]=new PivotCellGroup),t[h][n]=a,i.cols){var u=i.cols[h],a=new PivotCellItem(u,s,o+1,r,l);t[h]||(t[h]=new PivotCellGroup),t[h][n]=a,_isEmptyObj(u.cols)||(t[h].prepareChildren(),e(t[h]._childs,u,s,n,o+1,r,l))}})(this._cells,e,i,s,0,this._summaryItem,this)}}),PivotModelManager=defineClass("PivotModelManager",EventAware,{init:function(e){this._super(),this._items={},this._columnLayouts=null,(this._dataSource=e).addListener(this)},destroy:function(){this._dataSource.removeListener(this),this._dataSource=null,this.$_clearItems(),this._items=null,this._super()},columnLayouts:null,getRow:function(e){for(var t,i=this._items,s=0,n=e.length;s<n;s++)i=(t=i[e[s]])._childs;return t=_isEmptyObj(i)?t:i[PivotModelItem.ITEM_SUMMARY]},onPivotDataRefreshed:function(){var e=_performenceCountStart();this.$_clearItems(),this.$_buildItems(this._dataSource),_trace("model build "+_performenceCountEnd(e))},$_clearItems:function(){for(var e in this._items)this._items[e].destroy(),this._items[e]=null},$_buildItems:function(e){for(var t=e.getValues(),i=e.fieldManager().getValues(),s=this._items={},n=0,o=i.length;n<o;n++){var r=i[n],l=r.name();!function e(t,i,s,n,o,r){for(var l in t[PivotModelItem.ITEM_SUMMARY]||(t[PivotModelItem.ITEM_SUMMARY]=new PivotRowItem(i,s,n,o,!0)),t[PivotModelItem.ITEM_SUMMARY].appendCells(i,s,n,r),i.rows){var a=i.rows[l],h=t[l];h||(h=new PivotRowItem(a,s,n,o+1),t[l]=h),_isEmptyObj(a.rows)?h.appendCells(a,s,n,r):e(h._childs,a,s,n,o+1,r)}}(s,t[l],r,l,0,1==o)}this.fireEvent(PivotModelManager.BUILED)}}),Request=(PivotModelManager.BUILED="onPivotModelManagerBuild",defineClass("Request",null,{init:function(){this._super()},cursor:function(){return Cursor.AUTO},source:function(){return null},isSelectable:function(){return!1},isDblClickable:function(){return!1}})),CellRequest=defineClass("CellRequest",Request,{init:function(e){this._super(),(this._cell=e)&&(this._grid=e.grid())},destroy:function(){this._super(),this._cell=null},grid:function(){return this._grid},cell:function(){return this._cell},cursor:function(){return null},source:function(){return this._cell},isSelectable:function(){return!0},isDblClickable:function(){return!1}}),ColumnResizeRequest=defineClass("ColumnResizeRequest",CellRequest,{init:function(e){this._super(e)},delta:0,cursor:function(){return Cursor.HORZ_RESIZE},isSelectable:function(){return!1}}),RowResizeRequest=defineClass("RowResizeRequest",CellRequest,{init:function(e){this._super(e)},cursor:function(){return Cursor.VERT_RESIZE},isSelectable:function(){return!1}}),ColumnLevelResizeRequest=defineClass("ColumnLevelResizeRequest",Request,{init:function(e,t){this._super(),this._grid=e,this._level=t},destroy:function(){this._super(),this._grid=null},delta:0,grid:function(){return this._grid},level:function(){return this._level},cursor:function(){return Cursor.VERT_RESIZE},isSelectable:function(){return!1}}),RowLevelResizeRequest=defineClass("RowLevelResizeRequest",Request,{init:function(e,t){this._super(),this._grid=e,this._level=t},destroy:function(){this._super(),this._grid=null},grid:function(){return this._grid},level:function(){return this._level},cursor:function(){return Cursor.HORZ_RESIZE},isSelectable:function(){return!1}}),HeaderResizeRequest=defineClass("HeaderResizeRequest",Request,{init:function(e){this._super(),this._grid=e,this._view=e.headerView()},destroy:function(){this._super(),this._grid=null},grid:function(){return this._grid},view:function(){return this._view},cursor:function(){return Cursor.VERT_RESIZE},isSelectable:function(){return!1}}),DataCellRequest=defineClass("DataCellRequest",Request,{init:function(e){this._super(),this._index=e},cursor:function(){return null},source:function(){return null},isSelectable:function(){return!0}}),DragTracker=defineClass("DragTracker",null,{init:function(e,t,i,s){this._super(),this._container=e,this._name=t,this._active=!1,this._completed=!1,this._dragging=!1,this._startX=i,this._startY=s,this._currentX=0,this._currentY=0},cancelabel:!1,container:function(){return this._container},name:function(){return this._name},isActive:function(){return this._active},isDragging:function(){return this._dragging},startWhenCreated:function(){return!1},isCompleted:function(){return this._completed},activate:function(){this._active||(this._doActivate(),this._active=!0)},deactivate:function(){this._active&&(this.cancel(),this._doDeactivate(),this._active=!1)},start:function(e,t,i){return this.cancel(),!(!this._active||!this._doStart(e,t,i))&&(this._currentX=this._startX=e,this._currentY=this._startY=t,this._dragging=!0,this._completed=!1,this._showFeedback(e,t),!0)},drag:function(e,t){return!(!this._dragging||(this._currentX=e,this._currentY=t,!this._doDrag(e,t)))&&(this._moveFeedback(e,t),!0)},cancel:function(){try{if(this._dragging)try{this._dragging=!1,this._doCanceled()}finally{this._doEnded()}}finally{this._hideFeedback()}},drop:function(e,t){try{if(this._dragging)try{this._currentX=e,this._currentY=t,this._dragging=!1,this._canAccept(e,t)?(this._doCompleted(e,t),this._completed=!0):this._doCanceled(e,t)}finally{this._doEnded()}}finally{this._hideFeedback()}},getNextRequest:function(e,t){return null},startX:function(){return this._startX},startY:function(){return this._startY},currentX:function(){return this._currentX},currentY:function(){return this._currentY},offsetX:function(){return this._currentX-this._startX},offsetY:function(){return this._currentY-this._startY},_showFeedback:function(e,t){},_moveFeedback:function(e,t){},_hideFeedback:function(){},_doActivate:function(){trace(this._name+" activated")},_doDeactivate:function(){trace(this._name+" deactivated")},_doStart:function(e,t){return!0},_doDrag:function(e,t){return!0},_doCanceled:function(){},_canAccept:function(e,t){return!0},_doCompleted:function(){},_doEnded:function(){},_findElementAt:function(e,t,i){return this._container.findElementAt(e,t,i)}}),GridDragTracker=defineClass("GridDragTracker",DragTracker,{init:function(e,t){this._destroying=!0,this._request=e,this._grid=e.grid(),this._super(this._grid.container(),t)},destroy:function(){this._grid=null,this._super()},request:function(){return this._request},grid:function(){return this._grid},isStartWhenCreated:function(){return!1},checkScrolling:function(){return this._grid.checkScrolling()},checkHScrolling:function(){return this._grid.checkHSCrolling()}}),ColumnResizeTracker=defineClass("ColumnResizeTracker",GridDragTracker,{init:function(e,t,i){var s=this._cell=e.cell();this._super(e,"columnResizeTracker"),this._startWidth=s.width(),this._offset=t-this._startWidth,this._changeOffset=0,this._descendantCount=_max(1,s.getDescendantCount(!0))},_doStart:function(e,t){return!0},_doDrag:function(e,t){var i,s=this._cell,e=(this._grid,e-this._offset);return e>=CELL_MIN_WIDTH*this._descendantCount&&(i=e-this._startWidth,s.changeSize(i,0),this._startWidth=e,this._changeOffset+=i),!0},_doEnded:function(){for(var e=this._cell,t=this._grid,i=(e.changeSizeComplete(),t.changeClientSize(this,e,this._changeOffset,0,LayoutMode.CELL_SIZE),e.getFamilyTree()),s=i.length;s--;)t.setColumnWidth(i[s],i[s].width())}}),RowResizeTracker=defineClass("RowResizeTracker",GridDragTracker,{init:function(e,t,i){var s=this._cell=e.cell();this._super(e,"rowResizeTracker"),this._startHeight=s.height(),this._offset=i-this._startHeight,this._changeOffset=0,this._descendantCount=_max(1,s.getDescendantCount(!0))},_doStart:function(e,t){return!0},_doDrag:function(e,t){var i,s=this._cell,t=(this._grid,t-this._offset);return t>=CELL_MIN_HEIGHT*this._descendantCount&&(i=t-this._startHeight,s.changeSize(0,i),this._changeOffset+=i,this._startHeight=t),!0},_doEnded:function(){for(var e=this._cell,t=this._grid,i=(e.changeSizeComplete(),t.changeClientSize(this,e,0,this._changeOffset,LayoutMode.CELL_SIZE),e.getFamilyTree()),s=i.length;s--;)t.setRowHeight(i[s],i[s].height())}}),ColumnLevelResizeTracker=defineClass("ColumnResizeTracker",GridDragTracker,{init:function(e,t,i){this._super(e,"columnLevelResizeTracker"),this._level=e.level(),this._startHeight=this._grid.columnLevelHeight(this._level),this._offset=i-this._startHeight,this._changeOffset=0},_doStart:function(e,t){return!0},_doDrag:function(e,t){var i,s=this._level,n=this._grid,t=t-this._offset;return CELL_MIN_HEIGHT<=t&&(i=t-this._startHeight,n.changeColumnLevelHeight(s,i),this._changeOffset+=i,this._startHeight=t),!0},_doEnded:function(){this._grid.changeClientSize(this,null,0,this._changeOffset,LayoutMode.CELL_SIZE)}}),RowLevelResizeTracker=defineClass("RowLevelResizeTracker",GridDragTracker,{init:function(e,t,i){this._super(e,"rowLevelResizeTracker"),this._level=e.level(),this._startWidth=this._grid.rowLevelWidth(this._level),this._offset=t-this._startWidth,this._changeOffset=0},_doStart:function(e,t){return!0},_doDrag:function(e,t){var i,s=this._level,n=this._grid,e=e-this._offset;return CELL_MIN_WIDTH<=e&&(i=e-this._startWidth,n.changeRowLevelWidth(s,i),this._changeOffset+=i,this._startWidth=e),!0},_doEnded:function(){this._grid.changeClientSize(this,null,this._changeOffset,0,LayoutMode.CELL_SIZE)}}),HeaderResizeTracker=defineClass("HeaderReiszeTracker",GridDragTracker,{init:function(e,t,i){this._super(e,"headerResizeTracker");e=this._view=e.view();this._startPos=e.rowSplitPos(),this._top=e.titleHeight(),this._offset=i-this._top-this._startPos},_doStart:function(e,t){return!0},_doDrag:function(e,t){t-=this._offset;return CELL_MIN_HEIGHT<=t&&t<=this._view.height()-CELL_MIN_HEIGHT&&(this._view.setRowSplitPos(t-this._top),this._startPos=t),!0},_doEnded:function(){}}),DefaultPivotUITool=defineClass("DefaultPivotUITool",VisualTool,{init:function(e){this._super(e),this._request=null,this._scrollTool=new GridScrollTool(e),this._hoveredCell=null,this._tooltipCell=null,this._tooltipIndex=null,this._focused=!1;e=this.$_createCopyElement(e._element);Dom.addEventListener(e,"focusin",this.$_focusinHandler.bind(this),!1),Dom.addEventListener(e,"blur",this.$_blurHandler.bind(this),!1),Dom.addEventListener(e,"focusout",this.$_focusoutHandler.bind(this),!1),Dom.addEventListener(e,"copy",this.$_copyHandler.bind(this),!1)},destroy:function(){var e=this._copyElement;Dom.removeEventListener(e,"focusin",this.$_focusinHandler.bind(this),!1),Dom.removeEventListener(e,"blur",this.$_blurHandler.bind(this),!1),Dom.removeEventListener(e,"focusout",this.$_focusoutHandler.bind(this),!1),Dom.removeEventListener(this._copyElement,"copy",this.$_copyHandler.bind(this),!1),this._owner._element.removeChild(this._copyContainer),this._scrollTool.destroy(),this._scrollTool=null,this._copyElement=null,this._copyContainer=null,this._super()},$_createCopyElement:function(e){var t=this._copyContainer=document.createElement("div");return t.spellcheck=!1,t.setAttribute("aria-hidden","true"),t.style.outline="none",t.style.position="absolute",t.style.border="none",t.style.width="0px",t.style.height="0px",t.style["z-index"]=10,t.style["box-sizing"]="border-box",t.style.overflow="hidden",t.style.padding="0px",t.style.margin="0px",(t=this._copyElement=_doc.createElement("input")).setAttribute("aria-hidden","true"),t.autocomplete="off",t.style.position="absolute",t.style.margin="0px",t.style.padding="0px",t.style.wordWrap="normal",t.style.left="0px",t.style.top="0px",t.style.width="100%",t.style.height="100%",this._copyContainer.appendChild(t),e.appendChild(this._copyContainer),t},isFocused:function(){return this._focused},setFocus:function(e){_trace("setfocus",e),this._focused=e,this._copyElement.focus()},changeClipboardData:function(e){var t=this._owner.getClipboardValue();this._copyElement.value=t,this._copyElement.select()},$_setFocusedCell:function(t,i){var s=this._owner,e=s.tmpSummaryOptions(),n=e.isTotalFixed(),o=s.bodyView(),r=s.leftPos(),l=s.topPos(),a=s.bodyWidth(),h=s.bodyHeight(),u=r,c=l,d=n&&e.isColumnVisible()?s.columnView().rootElement().summaryCell().width():0,_=n&&e.isRowVisible()?s.rowView().rootElement().summaryCell().height():0,f=(n&&(e.columnPosition()==SummaryPosition.FIRST&&(u+=d),a-=d,e.rowPosition()==SummaryPosition.FIRST&&(c+=_),h-=_),!1);n&&(i.isTotalSummary()||e.rowPosition()!=SummaryPosition.LAST)||(i.bottom()-1>c+h?(l=i.bottom()-h,f=!0):i.top()<c&&(l=i.top()-_,f=!0)),n&&(t.isTotalSummary()||e.columnPosition()!=SummaryPosition.LAST)||(t.right()-1>u+a?(r=t.right()-a,f=!0):t.left()<u&&(r=t.left()-d,f=!0)),f?s.scrollTo(r,l,function(){setTimeout(function(){s._updateScroll();var e=o.getBodyCell(t,i);o.setFocusCell(e)},20)}):(h=o.getBodyCell(t,i),o.setFocusCell(h))},_doKeyDown:function(e,t,i,s){var n=this._owner,o=this._focused&&n.displayOptions().isShowFocus();if(trace("tool: keyDown("+e+")"),27==e)n.tooltipManager().isVisible()&&this.$_hideTooltip();else{if(n._maskView&&n._maskView.isVisible())return;var r=n.bodyView(),l=r.focusColumn(),a=r.focusRow();if(o&&t&&s&&_included(e,Keys.RIGHT,Keys.LEFT,Keys.DOWN,Keys.UP)){for(var h=l,u=l.valueField();!(h instanceof GroupCellElement);)h=h.group();var c,d=a.group(),_=!1;switch(e){case Keys.LEFT:for(;!h.expanded()||1==h._lowers.length;)h=h.group();h instanceof GroupCellElement&&!h.isRoot()&&(h.collapse(),_=l!=(c=(c=h.summaryCell()).isValueLabel()?c:c.findValueLower(u)),l=c);break;case Keys.RIGHT:h instanceof GroupCellElement&&!h.expanded()&&h.expand();break;case Keys.UP:for(;!d.expanded()||1==d._lowers.length;)d=d.group();d instanceof GroupCellElement&&!d.isRoot()&&d.expanded()&&(d.collapse(),_=a!=d.summaryCell(),a=d.summaryCell());break;case Keys.DOWN:d instanceof GroupCellElement&&!d.expanded()&&d.expand()}return _&&this.$_setFocusedCell(l,a),!1}if(o&&_included(e,Keys.HOME,Keys.END,Keys.RIGHT,Keys.LEFT,Keys.DOWN,Keys.UP,Keys.PAGEDOWN,Keys.PAGEUP)){var f=n.columnView(),p=n.rowView(),m=r.visibleRowCount()-1,g=r.visibleColCount()-1;switch(e){case Keys.LEFT:l=f.prevCell(l);break;case Keys.RIGHT:l=f.nextCell(l);break;case Keys.UP:a=p.prevCell(a);break;case Keys.DOWN:a=p.nextCell(a);break;case Keys.PAGEUP:t?l=f.beforeCell(l,g):a=p.beforeCell(a,m);break;case Keys.PAGEDOWN:t?l=f.afterCell(l,g):a=p.afterCell(a,m);break;case Keys.HOME:t?a=p.firstCell():l=f.firstCell();break;case Keys.END:t?a=p.lastCell():l=f.lastCell()}return l&&a?this.$_setFocusedCell(l,a):_trace("not found focus label"),!1}}return!0},_doKeyUp:function(e,t,i,s){return trace("tool: keyUp("+e+")"),!1},_doKeyPress:function(e){trace("tool: keyPress("+e+")")},_doClick:function(e,t,i){trace("tool: click("+e+","+t+")");e=this.findElementAt(e,t,!0);this._owner._fireClick(e,i)},_doDblClick:function(e,t){trace("tool: dblClick("+e+","+t+")");e=this.findElementAt(e,t,!0);this._owner._fireDblClick(e)},_doMouseDown:function(e,t,i,s,n,o){if(this.setFocus(!0),this._scrollTool.stop(),this._request){var r=this._getDragTracker(this._request,e,t);this.setDragTracker(r)}else if(!this._owner.contextMenuManager().isVisible()){r=this.findElementAt(e,t);if(r){if(this._scrollTool.start(r,e,t))return;e=r.containerToClient(e,t);r instanceof ClickableElement&&r.click(e.x,e.y),r instanceof BodyCellElement&&this.$_setFocusedCell(r.columnLabel(),r.rowLabel())}}o.preventDefault()},_doMouseMove:function(e,t){var i,s=this._owner;this._scrollTool.isScrolling()?this._scrollTool.move(e,t):(s.setCursor(Cursor.DEFAULT),(i=this.findElementAt(e,t,!0))!=this._hoveredCell&&(this.$_hideTooltip(),this._hoveredCell=i),this.isDragging()||s.isPopuped()||(this._request&&(this._request.destroy(),this._request=null),(e=this._request=this._getRequest(i,e,t))&&e.cursor()?s.setCursor(e.cursor()):this._changeTooltip(i)))},_doMouseUp:function(e,t){this._scrollTool.isScrolling()&&this._scrollTool.stop(e,t)},_doMouseEnter:function(e,t){trace("tool: mouseEnter("+e+","+t+")")},_doMouseLeave:function(e,t){trace("tool: mouseLeave("+e+","+t+")")},_doMouseOver:function(e,t){trace("tool: mouseOver("+e+","+t+")")},_doMouseOutside:function(){},_doMouseWheel:function(e,t,i,s){trace("tool: mouseWheel("+i+","+s+")");i=this._owner._scrollContainer.wheelScroll(i,s);return i&&(this.$_hideTooltip(),s=this.findElementAt(e,t,!0),this._changeTooltip(s)),i},_doTouchStart:function(e){trace("tool: touchStart")},_doTouchMove:function(e){trace("tool: touchMove")},_doTouchEnd:function(e){trace("tool: touchEnd")},_doTouchCancel:function(e){trace("tool: touchCancel")},_changeTooltip:function(e){var t=this._owner,i=t.tooltipManager(),s=t.displayOptions().tooltipDelay();e instanceof BodyCellElement&&t.displayOptions().isShowTooltip()?0<s?(i._showTimer&&clearTimeout(i._showTimer),i._showTimer=setTimeout(function(){this._showTooltip(e)}.bind(this),s)):this._showTooltip(e):e instanceof LabelCellElement&&t.displayOptions().isShowLabelTooltip()?0<s?(i._showTimer&&clearTimeout(i._showTimer),i._showTimer=setTimeout(function(){this._showLabelTooltip(e)}.bind(this),s)):this._showLabelTooltip(e):i.isVisible()&&i.close()},_getRequest:function(e,t,i,s,n){return e instanceof ScrollThumb?new ScrollThumbRequest(e):e instanceof PivotCellElement&&((e=this.$_getHeaderResizeRequest(t,i))||(e=this.$_getColumnResizeRequest(t,i))||(e=this.$_getRowResizeRequest(t,i)))?e:null},_getDragTracker:function(e,t,i){return e instanceof ScrollThumbRequest?new ScrollThumbTracker(e,t,i):e instanceof ColumnResizeRequest?new ColumnResizeTracker(e,t,i):e instanceof RowResizeRequest?new RowResizeTracker(e,t,i):e instanceof ColumnLevelResizeRequest?new ColumnLevelResizeTracker(e,t,i):e instanceof RowLevelResizeRequest?new RowLevelResizeTracker(e,t,i):e instanceof HeaderResizeRequest?new HeaderResizeTracker(e,t,i):void 0},$_getColumnResizeRequest:function(e,t){var i=this._owner,s=i.columnView(),n=s.boundsByContainer();if(n.inflate(0,0,VisualTool.DRAG_BORDER,VisualTool.DRAG_BORDER),0<=e&&e<=n.left()&&this.inDraggablePt(t,n.bottom()))return new ColumnLevelResizeRequest(i,s.depth()-1);if(n.contains(e,t))for(var o=e-n.left(),r=t-n.top(),l=s.getChildren(),a=0,h=l.length;a<h;a++){var u=l[a];if(u.isVisible()&&0<u.right()+s.left()){if(r>=u.top()&&r<=u.bottom()&&this.inDraggablePt(o,u.right()))return new ColumnResizeRequest(u);if(o>=u.left()&&o<=u.right()&&this.inDraggablePt(r,u.bottom()))return new ColumnLevelResizeRequest(i,u.level()+u.mergeCount())}}return null},$_getRowResizeRequest:function(e,t){var i=this._owner,s=i.headerView(),n=i.tmpHeaderOptions().formType()==HeaderFormType.GRID,o=i.rowView();if(0<=t&&t<=s.height()){if(this.inDraggablePt(e,i._centralPt.x-1))return new RowLevelResizeRequest(i,o.depth()-1);if(n)for(var r=i.headerView().getGridRowHeaderCells(),l=r.length;l--;){var a=r[l];if(this.inDraggablePt(e,a.right()))return new RowLevelResizeRequest(i,l)}}s=o.boundsByContainer();if(s.inflate(0,0,VisualTool.DRAG_BORDER,VisualTool.DRAG_BORDER),s.contains(e,t))for(var h=e-s.left(),u=t-s.top(),c=o.getChildren(),l=0,d=c.length;l<d;l++){var _=c[l];if(_.isVisible()&&0<_.bottom()+o.top()){if(h>=_.left()&&h<=_.right()&&this.inDraggablePt(u,_.bottom()))return new RowResizeRequest(_);if(u>=_.top()&&u<=_.bottom()&&this.inDraggablePt(h,_.right()))return new RowLevelResizeRequest(i,_.level()+_.mergeCount())}}return null},$_getHeaderResizeRequest:function(e,t){var i=this._owner,s=i.headerView(),n=s.rowSplitPos();if(-1!=n&&this.inDraggablePt(t,s.titleHeight()+n)&&e>=s.left()&&e<=i._centralPt.x)return new HeaderResizeRequest(i)},_showTooltip:function(e){var t,i,s;e&&(t=(i=this._owner).tooltipManager(),s=e.getCellIndex(),t.isVisible()&&this._tooltipCell==e&&CellIndex.areEquals(s,this._tooltipIndex)||(t=e.getTooltip())&&(i=i._fireShowTooltip(s,t))&&(s={},"object"==typeof i?(s.message=i.message,i.styles&&(s.styles=i.styles)):"string"==typeof i&&(s.message=i),this.$_showTooltip(e,s)))},_showLabelTooltip:function(e){var t,i,s;e&&(t=(i=this._owner).tooltipManager(),s=e.getCellIndex(),t.isVisible()&&this._tooltipCell==e&&CellIndex.areEquals(s,this._tooltipIndex)||(t=e.getTooltip())&&(i=i._fireShowLabelTooltip(s,t))&&(s={},"object"==typeof i?(s.message=i.message,i.styles&&(s.styles=i.styles)):"string"==typeof i&&(s.message=i),this.$_showTooltip(e,s)))},$_showTooltip:function(e,t){var i=this._owner,s=i.tooltipManager(),i=i.contextMenuManager(),n=e.getCellIndex(),o=(this.$_hideTooltip(),e.boundsBy()),r=o.x,o=o.y+e.height();e instanceof LabelCellElement&&(r=this._currX,o=this._currY),_trace("showtooltip x="+r+", y="+o),i.isVisible()?s.show(t,r,o,e,i.getView()):s.show(t,r,o,e),this._tooltipCell=e,this._tooltipIndex=n.clone()},$_hideTooltip:function(){this._owner.tooltipManager().close(),this._tooltipCell=null,this._tooltipIndex=this._tooltipIndex&&this._tooltipIndex.destroy()},$_copyHandler:function(e){var t=e.target.value;return null!=t&&(_win.clipboardData?_win.clipboardData.setData("Text",t):e.clipboardData.setData("text/plain",t)),e.preventDefault()},$_focusinHandler:function(e){_trace("copyElement focus"),this._focused=!0},$_blurHandler:function(e){_trace("copyElement blur"),this._focused=!1},$_focusoutHandler:function(e){_trace("copyElement focusout"),this._focused=!1}}),SummaryPosition=_enum({FIRST:"first",LAST:"last"}),FieldRole=_enum({NONE:"none",COLUMN:"column",ROW:"row",VALUE:"value",FILTER:"filter"}),SetupDragAction=_enum({NONE:"none",ADD:"add",REMOVE:"remove",MOVE:"move",ORDER:"order",DENIED:"denied"}),SetupDragDenied=_enum({NONE:"none",DISABLED:"disabled",DUPLICATED:"duplicated"}),LayoutMode=_enum({INIT:"init",SCROLL:"scroll",RESIZE:"resize",CELL:"cell",CELL_SIZE:"cellSize"}),HeaderFormType=_enum({NORMAL:"normal",GRID:"grid"}),ValueAlignment=_enum({NEAR:"near",CENTER:"center",FAR:"far"}),DisplayOptions=defineClass("DisplayOptions",PivotOptions,{init:function(e){this._super(),this._pivot=e},columnHeight:25,rowHeight:25,columnWidth:70,rowLabelWidth:90,rowGroupWidth:70,cellSpaceWidth:0,cellSpaceHeight:0,labelTextWidth:-1,showTooltip:!1,showLabelTooltip:!1,tooltipDelay:100,blankFillValue:null,showProgress:!1,virtualRendering:!0,showFocus:!1,showFocusGuide:!1,keepLabelSpace:!1,notReadyMessage:RealPivotMessages.notReadyText,emptyMessage:RealPivotMessages.emptyDataText,columnSizeCallback:null,rowSizeCallback:null,watchDisplayChange:!1,styleCallback:null,setWatchDisplayChange:function(e){this._watchDisplayChange=e,this._pivot&&this._pivot.watchDisplay(e)},setLabelTextWidth:function(e){e=parseInt(e),this._labelTextWidth=isNaN(e)?-1:e}}),GroupOptions=defineClass("GroupOptions",PivotOptions,{columnExpand:-1,rowExpand:-1,expanderVisible:!0}),SummaryOptions=defineClass("SummaryOptions",PivotOptions,{columnVisible:!0,rowVisible:!0,columnGroupVisible:!0,rowGroupVisible:!0,columnPosition:SummaryPosition.FIRST,rowPosition:SummaryPosition.FIRST,columnTotalText:RealPivotMessages.columnTotalText,rowTotalText:RealPivotMessages.rowTotalText,totalFixed:!1}),HeaderOptions=defineClass("HeaderOptions",PivotOptions,{formType:HeaderFormType.NORMAL,titleVisible:!0,titleHeight:20,rowHeadVisible:!0,columnHeadVisible:!0,valueHeadVisible:!0,menuButtonVisible:!0,setupButtonVisible:!0,headerSortable:!0}),CopyOptions=defineClass("CopyOptions",PivotOptions,{copyDisplayText:!1}),SetupOptions=defineClass("SetupOptions",PivotOptions,{init:function(e){this._super(),this.setupView=e},destroy:function(){return this._super()},expressions:null,filterOperation:FilterOperation.AND}),EmptyElement=defineClass("PivotEmptyElement",PivotElement,{init:function(e){this._super(e,"realpivot-empty"),this._mouseEnabled=!1,this._messageDiv=null},destroy:function(){this._messageDiv&&this._element.removeChild(this._messageDiv),this._messageDiv=null,this._super()},_layoutCells:function(){var e=this.grid().tmpDisplayOptions().emptyMessage();this._messageDiv||(this._messageDiv=_doc.createElement("span"),this._messageDiv.className=this.cssClass(),this._element.appendChild(this._messageDiv)),this._messageDiv.textContent=e},_doRender:function(e){}}),NotReadyElement=defineClass("PivotEmptyElement",PivotElement,{init:function(e){this._super(e,"realpivot-noready"),this._mouseEnabled=!1,this._messageDiv=null,this._productSpan=null},destroy:function(){this._setupImg&&(Dom.removeEventListener(this._setupImg,"click",this._setupButtonClicked.bind(this),!1),this._messageDiv.removeChild(this._setupImg)),this._messageDiv&&this._element.removeChild(this._messageDiv),this._productSpan&&this._element.removeChild(this._productSpan),this._messageDiv=null,this._productSpan=null,this._super()},_layoutCells:function(){var e=this.grid(),t=e.tmpDisplayOptions().notReadyMessage(),i=AppInfo.toString();this._messageDiv||(this._messageDiv=_doc.createElement("span"),this._messageDiv.className=this.cssClass(),this._element.appendChild(this._messageDiv)),this._messageDiv.textContent=t,0<e.dataSource().fieldManager().fieldCount()&&(this._setupImg=_doc.createElement("div"),this._setupImg.className="realpivot-title-setup",Dom.addEventListener(this._setupImg,"click",this._setupButtonClicked.bind(this),!1),this._setupImg.style.position="absolute",this._setupImg.style.left=_int(this._width/2)+"px",this._setupImg.style.top=_int(this._height/2)+20+"px",this._element.appendChild(this._setupImg)),this._productSpan||(this._productSpan=_doc.createElement("span"),this._productSpan.className=this.cssClass()+"-product",this._productSpan.style.position="absolute",this._productSpan.style.right="5px",this._productSpan.style.bottom="5px",this._element.appendChild(this._productSpan)),this._productSpan.textContent=i},_setupButtonClicked:function(e){this._grid.setupView().show()},_doRender:function(e){}}),HeaderElement=defineClass("HeaderElement",PivotElement,{init:function(e){this._super(e,"realpivot-header"),this._isContainer=!0,this._childFixed=!0,this._titleCell=null,this._colHeaderCell=null,this._rowHeaderCell=null,this._valHeaderCell=null,this._gridRowHeaderCells=[],this._rowSize=0,this._rowSplitPos=-1,this._layouted=!1,this._titleHeight=0,this._rowHeaderHeight=0,this._valHeaderHeight=0},destroy:function(){this._rowFields=null,this._super()},formType:HeaderFormType.normal,columnFields:null,rowFields:null,valueFields:null,setWidth:function(e){var t=!1;this._width!=e&&(t=!0),this._super(e),t&&this._colHeaderCell&&this._colHeaderCell.isVisible()&&(e=this.clientRect(),this._colHeaderCell.setWidth(e.width-this._grid._centralPt.x))},rowSize:function(){return this._rowSize},rowSplitPos:function(){return this._rowSplitPos},setRowSplitPos:function(e){e!=this._rowSplitPos&&(this._layouted&&(this._valHeaderCell.setHeight(e),this._rowHeaderCell.offset(0,e-this._rowSplitPos),this._rowHeaderCell.setHeight(this._rowSize-e)),this._rowSplitPos=e)},titleHeight:function(){return this._titleHeight},getTitleCell:function(){return this._titleCell},getColHeaderCell:function(){return this._colHeaderCell},getRowHeaderCell:function(){return this._rowHeaderCell},getValHeaderCell:function(){return this._valHeaderCell},getGridRowHeaderCell:function(e){return this._gridRowHeaderCells?this._gridRowHeaderCells[e]:null},getGridRowHeaderCells:function(){return this._gridRowHeaderCells},changeWidth:function(e,t){if(this._formType==HeaderFormType.GRID)for(var i=this._gridRowHeaderCells.length;i--;)i==e?this._gridRowHeaderCells[i].inflate(t,0):e<i&&this._gridRowHeaderCells[i].offset(t,0);else{var s=this._grid.tmpHeaderOptions(),n=s.isValueHeadVisible(),o=s.isRowHeadVisible(),r=s.isTitleVisible(),s=s.isColumnHeadVisible();(r||s)&&(this._titleCell.inflate(t,0),this._colHeaderCell.offset(t,0),this._colHeaderCell.inflate(-t,0)),n&&this._valHeaderCell.inflate(t,0),o&&this._rowHeaderCell.inflate(t,0)}},changeHeight:function(e){if(this._formType==HeaderFormType.GRID)for(var t=this._gridRowHeaderCells.length;t--;)this._gridRowHeaderCells[t].inflate(0,e);else{var i=this._grid.tmpHeaderOptions(),s=i.isValueHeadVisible(),i=i.isRowHeadVisible(),n=this._rowSplitPos,o=n/this._rowSize,r=(this._rowSize+=e,this._height+=e,this._rowSize);s&&i&&(n+=_round(e*o)),this._rowSplitPos=n,s&&(this._valHeaderHeight=i?n:this._rowSize,this._valHeaderCell.setHeight(this._valHeaderHeight),r-=this._valHeaderHeight),i&&(this._rowHeaderHeight=r,s&&this._rowHeaderCell.setTop(this._valHeaderCell.bottom()),this._rowHeaderCell.setHeight(this._rowHeaderHeight))}this.inflate(0,e)},$_clearHeaders:function(){this._titleCell&&(this.removeChild(this._titleCell),this._titleCell.destroy(),this._titleCell=null),this._colHeaderCell&&(this.removeChild(this._colHeaderCell),this._colHeaderCell.destroy(),this._colHeaderCell=null),this._rowHeaderCell&&(this.removeChild(this._rowHeaderCell),this._rowHeaderCell.destroy(),this._rowHeaderCell=null),this._valHeaderCell&&(this.removeChild(this._valHeaderCell),this._valHeaderCell.destroy(),this._valHeaderCell=null);for(var e=this._gridRowHeaderCells.length;e--;)this.removeChild(this._gridRowHeaderCells[e]),this._gridRowHeaderCells[e].destroy(),this._gridRowHeaderCells[e]=null;this._gridRowHeaderCells=[]},_layoutCells:function(){var e=this.clientRect(),t=this._grid,i=t.tmpHeaderOptions(),s=i.titleHeight(),n=i.isTitleVisible(),o=i.isColumnHeadVisible(),r=i.isValueHeadVisible(),l=i.isRowHeadVisible(),a=t._centralPt;if((this._formType=i.formType())==HeaderFormType.GRID)for(var h=t.rowLevelWidths(),u=(this.$_clearHeaders(),0),c=0,d=this._rowFields.length;c<d;c++){var _=this._rowFields[c],f=new SingleFieldHeaderCellElement(this._grid),p=(this._gridRowHeaderCells.push(f),f.setField(_),this.addChild(f),h[c]);f.setBoundsI(u,e.top,p,e.height),f.setText(_.getFieldHeader()),f.draw(),u+=p}else{this.$_clearHeaders(),this._titleCell||(this._titleCell=new TitleCellElement(this._grid),this.addChild(this._titleCell)),this._colHeaderCell||(this._colHeaderCell=new FieldHeaderCellElement(this._grid,FieldType.COLUMN),this.addChild(this._colHeaderCell)),this._rowHeaderCell||(this._rowHeaderCell=new FieldHeaderCellElement(this._grid,FieldType.ROW),this.addChild(this._rowHeaderCell)),this._valHeaderCell||(this._valHeaderCell=new FieldHeaderCellElement(this._grid,FieldType.VALUE),this.addChild(this._valHeaderCell));var t=e.clone(),m=0;n||o?(t.width=a.x,t.height=s,this._titleHeight=s,this._titleCell.setVisible(!0),this._titleCell.setSpace(this._cellSpaceWidth,this._cellSpaceHeight),this._titleCell.setRectI(t),this._titleCell.setContentsVisible(n),this._titleCell.setMenuVisible(i.isMenuButtonVisible()),this._titleCell.setSetupVisible(i.isSetupButtonVisible()),this._titleCell.layoutContent(),t.leftBy(a.x),t.width=e.width-a.x,this._colHeaderCell.setFields(this._columnFields),this._colHeaderCell.setVisible(!0),this._colHeaderCell.setSpace(this._cellSpaceWidth,this._cellSpaceHeight),this._colHeaderCell.setRectI(t),this._colHeaderCell.setContentsVisible(o),this._colHeaderCell.layoutContent(),m+=s):(this._titleHeight=0,this._titleCell.setVisible(!1),this._colHeaderCell.setVisible(!1)),e.setTop(m),e.width=a.x,this._rowSplitPos=l&&r?0<this._rowSplitPos?_round(this._rowSplitPos/this._rowSize*e.height):_floor(e.height/2):-1,this._rowSize=e.height,this._valHeaderCell.setVisible(r),r?(this._valHeaderCell.setFields(this._valueFields),n=this._rowSplitPos,(t=e.clone()).height=n,this._valHeaderCell.setSpace(this._cellSpaceWidth,this._cellSpaceHeight),this._valHeaderCell.setRectI(t),this._valHeaderCell.layoutContent(),e.setTop(e.y+n)):this._valHeaderCell.setVisible(!1),l||!r?(this._rowHeaderCell.setFields(this._rowFields),this._rowHeaderCell.setVisible(!0),this._rowHeaderCell.setSpace(this._cellSpaceWidth,this._cellSpaceHeight),this._rowHeaderCell.setRectI(e),this._rowHeaderHeight=e.height,this._rowHeaderCell.setContentsVisible(l),this._rowHeaderCell.layoutContent()):this._rowHeaderCell.setVisible(!1)}this._layouted=!0},_doRender:function(e){}}),LabelElement=defineClass("LabelElement",PivotElement,{init:function(e,t){this._super(e,t),this._isContainer=!0,this._sumOptions=e.tmpSummaryOptions(),this._rootElement=this._createRootCell()},destroy:function(){this._labels=null,this._rootElement.destroy(),this._rootElement=null,this._super()},labels:null,depth:0,cellIndexes:null,sumIndexes:null,rootElement:function(){return this._rootElement},getLeafCells:function(){return this._rootElement.getLeafDescendants().filter(function(e){return e.isVisible()})},getBoundLeafCells:function(){return null},$_addIndexCell:function(e,t,i){this._cellIndexes[t]=e,(this._totCellIndexes[i]=e).setIndex(i)},$_addSumCell:function(e,t,i){var s=this._sumIndexes.length;this._sumIndexes[0==s?t:s]=e,(this._totCellIndexes[i]=e).setIndex(i)},_layoutCells:function(){this._super(),this._cellIndexes=[],this._sumIndexes=[],this._totCellIndexes=[],this._layoutChildren({expand:!0,childs:this._labels},0,0,0,0,this._rootElement)},_layoutChildren:function(e,t,i,s,n){},_doRender:function(e){},_createRootCell:function(){},findCellWithTree:function(e){return this._rootElement.findLowerWithTree(e,0)},prevCell:function(e){for(var t=e.index();t--;)if((e=this._totCellIndexes[t])&&e.isVisible())return e;return null},nextCell:function(e){for(var t=e.index()+1,i=this._totCellIndexes.length;t<i;t++)if((e=this._totCellIndexes[t])&&e.isVisible())return e;return null},firstCell:function(){for(var e=0,t=this._totCellIndexes.length;e<t;e++)if((cell=this._totCellIndexes[e])&&cell.isVisible())return cell},lastCell:function(){for(var e=this._totCellIndexes.length;e--;)if((cell=this._totCellIndexes[e])&&cell.isVisible())return cell},beforeCell:function(e,t){for(var i,s=t,n=e.index()-1;0<=n;n--)if((e=this._totCellIndexes[n])&&e.isVisible()){if(i=e,1==s)return e;s--}return i},afterCell:function(e,t){for(var i=t,s=e.index()+1,n=this._totCellIndexes.length;s<n;s++)if((e=this._totCellIndexes[s])&&e.isVisible()){var o=e;if(0==i)return e;i--}return o},scroll:function(e,t){var i;this._totalFixed&&(i=this._rootElement.summaryCell())&&i.isVisible()&&i.offsetMembers(e,t),this.offset(-e,-t)}}),ColumnLabelElement=defineClass("ColumnLabelElement",LabelElement,{init:function(e){this._super(e,"realpivot-col")},destroy:function(){this._values=null,this._super()},values:[],getCellAt:function(e){for(var t=this._rootElement.getLeafDescendants(),i=t.length;i--;){var s=t[i];if(s.isVisible()&&s.left()<=e&&s.right()>e)return s}return null},getBoundLeafCells:function(t,i,s){var e=this._rootElement.getLeafDescendants().filter(function(e){return e instanceof PivotCellElement&&e.isVisible()&&(s&&e instanceof LabelSummaryCellElement&&0==e.level()||e.right()>=t&&e.left()<=i)});return s&&e.sort(function(e,t){e=e.isTotalSummary(),t=t.isTotalSummary();return e&&!t?1:!e&&t?-1:0}),e},changeHeight:function(e,t){this.setHeight(this._height+t);for(var i=this._childs.length;i--;){var s=this._childs[i];s._level==e||s._level<e&&s instanceof LabelSummaryCellElement&&s._level+s._mergeCount>=e?s.inflate(0,t):s._level>e&&s.offset(0,t)}},findCellWithTree:function(e,t){e=this._super(e);return e=e&&!e.isValueLabel()?e.findValueLower(t):e},_createRootCell:function(){var e=new ColumnRootCellElement(this._grid);return e.setVisible(!1),e},_layoutChildren:function(e,t,i,s,n,o){for(var r,l,a,h,u,c,d,_,f=cnt=0,p=this._grid,m=p._dataSource.fieldManager(),g=m.getColumn(t),v=this._values.length,C=p.columnPoints(),w=this._cellSpaceWidth,y=this._cellSpaceHeight,b=1<v?this._depth-2:this._depth-1,E=0==t?this._sumVisible:this._groupSumVisible,S=E||0<t,T=E||!e.expand,F=p.tmpDisplayOptions().columnWidth(),x=[],L=0,D=this._sumPosition,P=D==SummaryPosition.FIRST,N=this._sumVisible&&this._totalFixed&&this._sumPosition==SummaryPosition.LAST,A=1==v?this._values[0]:null,I=n,R=0;R<v;R++)h=this._values[R].width()||F,x.push(h),L+=h;if(E&&P&&(c=n,I+=C[(d=s)+v]-C[d],s+=v,i+=v),e.expand)for(R=0,l=e.childs.length;R<l;R++){var k=e.childs[R];if(k.hasOwnProperty("childs")?V=new ColumnGroupCellElement(p,t,g,o,-1,k):(h=C[s+(cnt=v)]-C[s],V=new LabelCellElement(p,FieldType.COLUMN,t,g,A,o,-1,k.value,k.label),v<2&&this.$_addIndexCell(V,s++,i++)),this.addChild(V),u=p.getColumnLevelSumHeight(0,t-1),a=p.columnLevelHeight(t),V instanceof ColumnGroupCellElement&&(h=C[s+(cnt=this._layoutChildren(k,t+1,i,s,I,V))]-C[s],s+=cnt,i=this._totCellIndexes.length),V.setBounds(I,u,h,a,w,y),0===h&&V.setVisible(!1),V.draw(),V.layoutContent(),_=V,f+=cnt,1<v&&!(V instanceof ColumnGroupCellElement))for(r=0;r<v;r++){var M=(O=this._values[r]).getFieldHeader(),V=new LabelCellElement(p,FieldType.COLUMN,this._depth-1,null,O,_,-1,null,M);this.addChild(V),h=C[s+1]-C[s],u=p.getColumnLevelSumHeight(0,this._depth-2),a=p.columnLevelHeight(this._depth-1),this.$_addIndexCell(V,s++,i++),V.setBounds(I,u,h,a,w,y),0===h&&V.setVisible(!1),V.draw(),I+=h}else I+=h}else e.hasOwnProperty("childs")&&0<e.childs.length&&o.setPartial();if(S){void 0===c&&(c=I,d=s,i+=v);g=m.getColumn(t-1),P=0<t?e.value:null,S=0==t?this._totalText:g.getSummaryLabel(e.value,e.label);if(V=new LabelSummaryCellElement(p,FieldType.COLUMN,t,b-t,D,g,A,o,P,S),this.addChild(V),u=p.getColumnLevelSumHeight(0,t-1),a=p.getColumnLevelSumHeight(t,b),T?(h=C[d+v]-C[d],V.setBounds(c,u,h,a,w,y)):V.setBounds(c=n,u,L,a,w,y),1==v&&(E?this.$_addIndexCell(V,d,d++):0<t&&this.$_addSumCell(V,C.length,i++),V.setValueField(this._values[0])),o.setSummaryVisible(E),V.setGroup(o,this._sumPosition==SummaryPosition.FIRST?0:void 0),N&&0==t&&V.setFixedSplit(!0),V.draw(),_=V,T?f+=v:V.setVisible(!1),1<v)for(r=0;r<v;r++){var O=this._values[r],M=this._values[r].getFieldHeader();V=new LabelSummaryCellElement(p,FieldType.COLUMN,this._depth-1,0,D,null,O,_,-1,M,!0),this.addChild(V),u=p.getColumnLevelSumHeight(0,b),a=p.columnLevelHeight(this._depth-1),h=T?C[d+1]-C[d]:x[r],V.setBounds(c,u,h,a,w,y),E?this.$_addIndexCell(V,d,d++):0<t&&(this.$_addSumCell(V,C.length,i++),d++),N&&0==t&&0==r&&V.setFixedSplit(!0),V.draw(),T||V.setVisible(!1),c+=h}}return f},_layoutCells:function(){var e,t;this._cellWidth=this._options.columnWidth(),this._sumVisible=this._sumOptions.isColumnVisible(),this._groupSumVisible=this._sumOptions.isColumnGroupVisible(),this._sumPosition=this._sumOptions.columnPosition(),this._totalText=this._sumOptions.columnTotalText(),this._cellHeight=this._options.columnHeight(),this._totalFixed=this._sumOptions.isTotalFixed(),this._super(),this._sumVisible&&this._totalFixed&&this._sumPosition==SummaryPosition.LAST&&(e=this._parent.width(),this._grid.columnWidth()>e&&(t=this._rootElement.summaryCell()).offsetMembers(e-t.width()-t.left(),0))},_doRender:function(e){}}),RowLabelElement=defineClass("RowLabelElement",LabelElement,{init:function(e){this._super(e,"realpivot-row")},getCellAt:function(e){for(var t=this._rootElement.getLeafDescendants(),i=t.length;i--;){var s=t[i];if(s.isVisible()&&s.top()<=e&&s.bottom()>e)return s}return null},getBoundLeafCells:function(t,i,s){var e=this._rootElement.getLeafDescendants().filter(function(e){return e instanceof PivotCellElement&&e.isVisible()&&(s&&e instanceof LabelSummaryCellElement&&e.isTotalSummary()||e.bottom()>=t&&e.top()<=i)});return s&&e.sort(function(e,t){e=e instanceof LabelSummaryCellElement&&e.isTotalSummary(),t=t instanceof LabelSummaryCellElement&&t.isTotalSummary();return e&&!t?1:!e&&t?-1:0}),e},changeWidth:function(e,t){this.setWidth(this._width+t);for(var i=this._childs.length;i--;){var s=this._childs[i];s._level==e||s._level<e&&s instanceof LabelSummaryCellElement&&s._level+s._mergeCount>=e?s.inflate(t,0):s._level>e&&s.offset(t,0)}},_createRootCell:function(){var e=new RowRootCellElement(this._grid);return e.setVisible(!1),e},_layoutChildren:function(e,t,i,s,n,o){var r,l,a,h,u,c,d,_,f=cnt=0,p=this._grid,m=p._dataSource.fieldManager(),g=m.getRow(t),v=p.rowPoints(),C=p.rowLevelWidths(),w=this._cellSpaceWidth,y=this._cellSpaceHeight,b=0==t?this._sumVisible:this._groupSumVisible,E=b||0<t,S=b||!e.expand,T=p.tmpDisplayOptions().rowHeight(),x=this._sumPosition,L=x==SummaryPosition.FIRST,D=this._sumVisible&&this._totalFixed&&this._sumPosition==SummaryPosition.LAST,P=n;if(b&&L&&(c=n,P+=v[(d=s)+1]-v[d],s++,i++),e.expand)for(r=0,l=e.childs.length;r<l;r++){var N=e.childs[r];N.hasOwnProperty("childs")?_=new RowGroupCellElement(p,t,g,o,-1,N):(h=v[s+(cnt=1)]-v[s],a=this._cellWidth,_=new LabelCellElement(p,FieldType.ROW,t,g,null,o,-1,N.value,N.label),this.$_addIndexCell(_,s++,i++)),this.addChild(_),u=p.getRowLevelSumWidth(0,t-1),a=p.rowLevelWidth(t),_ instanceof RowGroupCellElement&&(h=v[s+(cnt=this._layoutChildren(N,t+1,i,s,P,_))]-v[s],a=C[t],s+=cnt,i=this._totCellIndexes.length),_.setBounds(u,P,a,h,w,y),_.draw(),_.layoutContent(),f+=cnt,P+=h}else e.hasOwnProperty("childs")&&0<e.childs.length&&o.setPartial();return E&&(void 0===c&&(c=P,d=s,i++),g=m.getRow(t-1),L=0<t?e.value:null,E=0==t?this._totalText:g.getSummaryLabel(e.value,e.label),_=new LabelSummaryCellElement(p,FieldType.ROW,t,this._depth-t-1,x,g,null,o,L,E),this.addChild(_),u=p.getRowLevelSumWidth(0,t-1),a=p.getRowLevelSumWidth(t,this._depth-1),b?(h=v[d+1]-v[d],_.setBounds(u,c,a,h,w,y)):_.setBounds(u,n,a,T,w,y),b?this.$_addIndexCell(_,d,d):0<t&&this.$_addSumCell(_,v.length,i++),o.setSummaryVisible(b),D&&0==t&&_.setFixedSplit(!0),_.draw(),S?f++:_.setVisible(!1)),f},_layoutCells:function(){var e,t;this._groupWidth=this._options.rowGroupWidth(),this._cellWidth=this._options.rowLabelWidth(),this._sumVisible=this._sumOptions.isRowVisible(),this._groupSumVisible=this._sumOptions.isRowGroupVisible(),this._sumPosition=this._sumOptions.rowPosition(),this._totalText=this._sumOptions.rowTotalText(),this._cellHeight=this._options.rowHeight(),this._totalFixed=this._sumOptions.isTotalFixed(),this._super(),this._sumVisible&&this._totalFixed&&this._sumPosition==SummaryPosition.LAST&&(e=this._parent.height(),this._grid.columnHeight()>e&&(t=this._rootElement.summaryCell()).offsetMembers(0,e-t.height()-t.top(),0))},_doRender:function(e){}}),BodyElement=defineClass("BodyElement",PivotElement,{init:function(e){this._super(e,"realpivot-body"),this._isContainer=!0,this._cells=[],this._queCells=[],this._queSumCells=[],this._cellCount=0,this._visibleHorzStart=0,this._visibleHorzEnd=-1,this._visibleVertStart=0,this._visibleVertEnd=-1,this._sumOptions=e.tmpSummaryOptions()},destroy:function(){this._columnView=null,this._rowView=null,this._valueFields=null,this._values=null,this._super()},columnView:null,rowView:null,valueFields:null,values:null,summaries:null,focusColumn:function(){return this._focusColLabel},focusRow:function(){return this._focusRowLabel},backupFocusLabel:function(){this._backupColpath=this._focusColLabel?this._focusColLabel.treePath():null,this._backupRowpath=this._focusRowLabel?this._focusRowLabel.treePath():null,this._backupValueField=this._focusColLabel?this._focusColLabel.valueField():null},restoreFocusLabel:function(){this._backupColpath&&(this._focusColLabel=this._columnView.findCellWithTree(this._backupColpath,this._backupValueField)),this._backupRowpath&&(this._focusRowLabel=this._rowView.findCellWithTree(this._backupRowpath))},setFocusWithLabel:function(e,t){e=this.getBodyCell(e,t);this.setFocusCell(e)},setFocusCell:function(e){var t,i;e&&(t=(this._focusCell=e).columnLabel(),i=e.rowLabel(),t!=this._focusColLabel||i!=this._focusRowLabel?(this._grid.focusView().moveToCell(e,this._grid.leftPos(),this._grid.topPos()),this._focusColLabel=t,this._focusRowLabel=i):e.isVisible()&&this._grid.focusView().redraw(e),this._grid.activeTool().changeClipboardData())},redrawFocus:function(){var e=this._grid.focusView();this._parent.containsChildInBound(e.bounds())&&(this._focusCell.columnLabel()==this._focusColLabel&&this._focusCell.rowLabel()==this._focusRowLabel?this._grid.focusView().redraw(this._focusCell):this.setFocusWithLabel(this._focusColLabel,this._focusRowLabel))},getFocusCell:function(){return this._focusColLabel&&this._focusRowLabel&&this.getBodyCell(this._focusColLabel,this._focusRowLabel)},visibleColCount:function(){return this._visibleColCount},visibleRowCount:function(){return this._visibleRowCount},borrowCellView:function(){return this._queCells.pop()},borrowSumCellView:function(e,t){var i=this._queSumCells.pop();return i&&i.setLevel(e,t),i},returnAllCellView:function(){for(var e=this._childs.length;e--;){var t=this._childs[e];t instanceof SummaryCellElement?-1==this._queSumCells.indexOf(t)&&this._queSumCells.push(t):-1==this._queCells.indexOf(t)&&this._queCells.push(t),t.setVisible(!1)}},returnCellViews:function(e){for(var t=e.length;t--;){var i=e[t];(i instanceof SummaryCellElement?this._queSumCells:this._queCells).push(i),i.setVisible(!1)}},updateCells:function(e,t,i,s){this._options.isVirtualRendering()?this._layoutCells(s,e,t,i):s&&s()},getBodyCell:function(e,t){var t=t.treePath(),i=e.treePath(),e=e.valueField(),t=this._grid.modelManager().getRow(t).getCell(i,e.name());return this._findCellWithModel(t)},_clearCells:function(){this._queCells=[],this._queSumCells=[],this._super()},_getBoundCells:function(t,i,s,n){return this._childs.filter(function(e){return e._visible&&e.right()>=t&&e._left<=s&&e.bottom()>=i&&e._top<=n})},_findCellWithModel:function(t){var e=this._childs.filter(function(e){return e._model==t});return 0<e.length?e[0]:null},_layoutCells:function(e,c,t,i){var s=this._grid,d=s.modelManager(),_=s.dataSource().fieldManager().getValues(),f=(s.columnPoints(),s.rowPoints(),s.leftPos()),p=s.topPos(),n=this._parent.innerWidth(),o=this._parent.innerHeight(),m=this._cellSpaceWidth,g=this._cellSpaceHeight,s=s.tmpSummaryOptions(),v=(w=s.isTotalFixed())&&s.isColumnVisible()&&s.columnPosition()==SummaryPosition.LAST,C=w&&s.isRowVisible()&&s.rowPosition()==SummaryPosition.LAST,s=((c=c||LayoutMode.INIT)==LayoutMode.SCROLL&&(f+=t,p+=i),f+n),t=p+o,w=(this.returnAllCellView(),this._sumOptions.isTotalFixed()),y=this._columnView.getBoundLeafCells(f,s,w),b=this._rowView.getBoundLeafCells(p,t,w),E=(this._visibleColCount=y.length,this._visibleRowCount=b.length,this._options.isVirtualRendering()||(y=this._columnView.getLeafCells(),b=this._rowView.getLeafCells()),this._options.blankFillValue()),l=this._options.isShowProgress()&&c==LayoutMode.INIT,S=y.length,i=b.length,n=S*i,o=l?_max(1e3,_int(n/3)):n,r=(l&&this._grid.showProgress(n,RealPivotMessages.progressMessage),_performenceCountStart());PivotHelper.asyncLoop(0,n-1,o,this,function(e){var t=_int(e/S),e=e%S,i=b[t],s=y[e],n=(i.index(),s.index(),i.treePath()),o=s.treePath(),r=s.valueField(),n=d.getRow(n),o=n.getCell(o,r.name()),l=!1,n=n.level(),a=o.level(),h=o.isSummaryItem()?this.borrowSumCellView(n,a):this.borrowCellView(),u=(h||(l=!0,(h=o.isSummaryItem()?new SummaryCellElement(this._grid,n,a):new ValueCellElement(this._grid)).setEmptyValue(E)),r&&r.fieldType()===FieldType.VALUE&&(u=null!=(u=r.emptyValue())?u:E,h.setEmptyValue(u)),h.setRowLabel(i),h.setColumnLabel(s),h.setModel(o),h instanceof SummaryCellElement&&(0==a||0==n)),o=(l?w&&!u?this.insertChildAt(h,0):this.addChild(h):w&&(u?this.moveChildTo(h,-1):this.moveChildTo(h,0)),s.left()-f),l=i.top()-p,u=s.width(),s=i.height();h instanceof SummaryCellElement&&(i=_.indexOf(r),h.setFixedSplit(0==a&&v&&0==i,0==n&&C)),h.setBounds(o,l,u,s,m,g),h.setVisible(0!==u),h.draw(),c==LayoutMode.INIT&&0==t&&0==e&&this.setFocusCell(h)}.bind(this),function(e){l&&this._grid.setCurrentProgress(e)}.bind(this),function(){_trace("rendering time = "+_performenceCountEnd(r)),_trace("body children cell = "+this._childs.length),setTimeout(function(){if(l&&this._grid.closeProgress(),c!=LayoutMode.INIT&&this._focusCell){var e,t=this._focusColLabel,i=this._focusRowLabel,s=this._grid.focusView();if(!t||!t.isVisible()){if(t)for(var n,o=0,r=(n=t.getAncestors()||[]).length;o<r;o++)if((e=n[o]).isVisible()){t=e.getLeafDescendants().reduce(function(e,t){return e||(t&&t.isVisible()?t:null)},null);break}t=(t=t&&t.isVisible()?t:this._columnView.getCellAt(s.centerX()+f))||y[y.length-1]}if(!i||!i.isVisible()){if(i){for(o=0,r=(n=i.getAncestors()||[]).length;o<r;o++)if((e=n[o]).isVisible()){i=e;break}}else i=this._rowView.getCellAt(s.centerY()+p);i=i||b[b.length-1]}this.setFocusWithLabel(t,i)}}.bind(this)),e&&e()}.bind(this))},_doRender:function(e){}}),PivotCellElement=defineClass("PivotCellElement",PivotElement,{init:function(e,t){this._super(e,"realpivot-cell "+t),this._cellIndex=new CellIndex(e)},destroy:function(){this._cellIndex.destroy(),this._cellIndex=null,this._visible=!1,this._super()},value:null,text:null,span:null,setText:function(e){this._text!=e&&(_defined(e)?this._text=e+"":this._text="")},_doRender:function(e){this.$_prepareSpan(this._text)},getCellIndex:function(){return this._cellIndex},getTooltip:function(){return null},$_prepareSpan:function(e){this._span||(this._span=document.createElement("span")),this._span.className=this.cssClass(),this._span.innerHTML=this.$_getCellText(),this._element.appendChild(this._span)},$_getCellText:function(){return this._text||""}}),HeaderCellElement=defineClass("HeaderCellElement",PivotCellElement,{init:function(e,t){this._super(e,t)},destroy:function(){this._super()},contentsVisible:!0}),TitleCellElement=defineClass("TitleCellElement",HeaderCellElement,{init:function(e){this._super(e,"realpivot-title"),this._menuImg=_doc.createElement("div"),this._menuImg.className="realpivot-title-menu",this._menuImg.style.display="none",Dom.addEventListener(this._menuImg,"click",this._menuButtonClicked.bind(this),!1),this._element.appendChild(this._menuImg),this._setupImg=_doc.createElement("div"),this._setupImg.className="realpivot-title-setup",this._setupImg.style.display="none",Dom.addEventListener(this._setupImg,"click",this._setupButtonClicked.bind(this),!1),this._element.appendChild(this._setupImg)},destroy:function(){Dom.removeEventListener(this._menuImg,"click",this._menuButtonClicked.bind(this),!1),Dom.removeEventListener(this._setupImg,"click",this._setupButtonClicked.bind(this),!1),this._element.removeChild(this._menuImg),this._element.removeChild(this._setupImg),this._super()},menuVisible:!0,setupVisible:!0,_menuButtonClicked:function(e){this._grid.showGlobalContextMenu(this.left()+5,this.bottom()+1)},_setupButtonClicked:function(e){this._grid.setupView().show()},_doLayoutContent:function(){this._contentsVisible&&this._menuVisible?this._menuImg.style.display="inline-block":this._menuImg.style.display="none",this._contentsVisible&&this._setupVisible?this._setupImg.style.display="inline-block":this._setupImg.style.display="none"},_doRender:function(e){}}),SingleFieldHeaderCellElement=defineClass("SingleFieldHeaderCellElement",HeaderCellElement,{init:function(e){this._super(e,"realpivot-header-label")},destroy:function(){this._field=null,this._super()},field:null,_clearElements:function(){this._field=null}}),FieldHeaderCellElement=defineClass("FieldHeaderCellElement",HeaderCellElement,{init:function(e,t){var i=this.getCls(t);this._super(e,i),this._type=t,this._headers=[]},destroy:function(){this._fields=null,this._clearElements(),this._super()},getCls:function(e){return e==FieldType.VALUE?"realpivot-value-header":e==FieldType.ROW?"realpivot-row-header":"realpivot-col-header"},type:null,fields:null,getField:function(e){for(var t=this.getCls(this._type),i=null,s=e;s;){if(s instanceof HTMLDivElement&&0<=s.className.indexOf(t)){i=s;break}s=s.parentElement}if(!i)return null;for(var n=-1,o=0;o<this._headers.length;o++)if(this._headers[o]===i){n=o;break}return n<0||n>=this._fields.length?null:this._fields[n]},_clearElements:function(){for(var e=this._headers.length;e--;){for(var t=this._headers[e],i=t.childElementCount;i--;)t.removeChild(t.children[i]);this._element.removeChild(this._headers[e]),delete this._headers[e]}this._headers=[]},_doLayoutContent:function(){this._clearElements();for(var e,t=this._grid.dataSource().fieldManager(),i=this.grid().displayOptions().labelTextWidth(),s=this.cssClass()+"-text",n="realpivot-header-sort",o=0,r=this._fields.length;o<r;o++){(e=_doc.createElement("div")).className=s,(a=_doc.createElement("span")).className=s,e.appendChild(a);var l=this._fields[o].getFieldHeader(),l=(this._type==FieldType.VALUE&&(l=RealPivotMessages.valueTypeTexts[this._fields[o].expression()]+": "+l),a.textContent=l,0<i&&(e.style.width=i-3+"px",a.style.width=i-3-10+"px"),this._fields[o]),a=t.getFieldSortDir(l.fieldType(),l.name());a!=SortDirection.NONE&&((l=_doc.createElement("div")).className=n+" "+n+(a==SortDirection.ASCENDING?"-asc":"-desc"),e.appendChild(l)),this._element.appendChild(e),this._headers.push(e)}}}),LabelCellElement=defineClass("LabelCellElement",PivotCellElement,{init:function(e,t,i,s,n,o,r,l,a){var h,u,c=_defined(n)&&!_defined(s);this instanceof LabelSummaryCellElement?(u=t==FieldType.ROW?"realpivot-row-sum":"realpivot-col-sum",h=c?o.level():i,u+=(t==FieldType.ROW?" realpivot-row-sum-":" realpivot-col-sum-")+(0==h?"tot":i+1)):(u=t==FieldType.ROW?"realpivot-row-label":"realpivot-col-label",u+=(t==FieldType.ROW?" realpivot-row-d":" realpivot-col-d")+(i+1),this instanceof ColumnGroupCellElement?u+=" realpivot-col-group":this instanceof RowGroupCellElement&&(u+=" realpivot-row-group")),t==FieldType.VALUE&&(u+=" realpivot-value-label"),this._super(e,u),this._baseCssClass=this.cssClass(),this._type=t,this._level=i,this._lowers=[],this._bodies=[],this._widthOffset=0,this._heightOffset=0,this._treePath=[],this._keepSpace=e.tmpDisplayOptions().isKeepLabelSpace(),this.setLabelField(s),this.setValueField(n),this.setValueLabel(c),this.setValue(l),this.setText(a||l),this.setGroup(o,r)},destroy:function(){var e;for(this.releaseGroup(),e=this._lowers.length;e--;)delete this._lowers[e];for(this._lowers=[],e=this._bodies.length;e--;)delete this._bodies[e];this._bodies=[],this._labelField=null,this._valueField=null,this._super()},type:null,level:INIT_INDEX,mergeCount:0,index:INIT_INDEX,valueLabel:!1,labelField:null,valueField:null,group:null,setValue:function(e){this._value=e},treePath:function(){return this._treePath},findLowerWithTree:function(e,t){if(t>e.length-1)return this._summaryCell;for(var i=this._lowers.length;i--;){var s=this._lowers[i];if(e[t]==s._value)return s instanceof GroupCellElement&&s.expanded()?s.findLowerWithTree(e,t+1):s instanceof GroupCellElement?s._summaryCell:s}},findValueLower:function(e){for(var t=this._lowers.length;t--;)if(this._lowers[t]._valueField==e)return this._lowers[t]},isRoot:function(){return!1},isTotalSummary:function(){return!1},setGroup:function(e,t){e!=this._group&&(this.releaseGroup(),-1<t?e.$_insertLower(this,t):e.$_addLower(this),this._group=e,this.$_resetIndex(),this.$_resetTree())},releaseGroup:function(){this._group&&this._group.$_removeLower(this),this._group=null},addBody:function(e){this._bodies.push(e)},removeBody:function(e){e=this._bodies.indexOf(e);-1<e&&this._bodies.splice(e,1)},hasLower:function(){return 0<this._lowers.length},getLower:function(t){return this._lowers.filter(function(e){return e._index==t})},getLowers:function(){return this._lowers},getDescendantCount:function(e){for(var t=0,i=this._lowers.length;i--;){var s=this._lowers[i];!(0<s._lowers.length)||e&&s instanceof GroupCellElement&&!s._expanded?t++:t+=s.getDescendantCount(e)}return t},getDescendants:function(e){for(var t=this._lowers.slice(),i=0,s=t.length;i<s;i++){var n=t[i];!(0<n._lowers.length)||e&&n instanceof GroupCellElement&&!n._expanded||t.push.apply(t,n.getDescendants(e))}return t},getLeafDescendants:function(e){var t=[];if(0<this._lowers.length)for(var i=0,s=this._lowers.length;i<s;i++)t.push.apply(t,this._lowers[i].getLeafDescendants(e));else e&&!this.isVisible()||t.push(this);return t},getLeafWidths:function(e){e=this.getLeafDescendants(e);return e&&0<e.length?e.reduce(function(e,t){return e+t.width()},0):this.width()},getLeafHeights:function(e){e=this.getLeafDescendants(e);return e&&0<e.length?e.reduce(function(e,t){return e+t.height()},0):this.height()},getAncestors:function(){for(var e=this.group(),t=[];e&&!e.isRoot();)t.push(e),e=e.group();return t},getFamilyTree:function(){var e=[];return e.push.apply(e,this.getAncestors()),e.push(this),e.push.apply(e,this.getDescendants()),e},setFixedSplit:function(e){var t=this._baseCssClass;e&&(t+=this._type==FieldType.ROW?" realpivot-row-split":" realpivot-col-split"),this.setCssClass(t)},$_toggleMembers:function(e){e=e&&0<this.width(),this.setVisible(e);for(var t=this._bodies.length;t--;){var i=this._bodies[t];(!e||i.columnLabel().isVisible()&&i.rowLabel().isVisible())&&i.setVisible(e)}if(this instanceof GroupCellElement&&e&&!this._expanded)this._summaryCell.$_toggleMembers(e);else for(t=this._lowers.length;t--;){var s=this._lowers[t];e&&s instanceof LabelSummaryCellElement&&0==this._summaryVisible||s.$_toggleMembers(e)}},offsetMembers:function(e,t){if(this.isVisible()){var i;if(this.offset(e,t),this._type==FieldType.ROW){if(0!=t)for(i=this._bodies.length;i--;)this._bodies[i].offset(0,t)}else if(0!=e)for(i=this._bodies.length;i--;)this._bodies[i].offset(e,0);for(i=this._lowers.length;i--;)this._lowers[i].isVisible()&&this._lowers[i].offsetMembers(e,t)}},$_inflateGroup:function(e,t,i){for(var s=this._lowers.length;s--;){var n=this._lowers[s];!n.isVisible()||n.isTotalSummary()&&this._grid._summaryOptions.isTotalFixed()||!(0!=t&&n._left>e._left||0!=i&&n._top>e._top)||n.offsetMembers(t,i)}this.inflate(t,i),this._group&&this._group.$_inflateGroup(this,t,i)},$_inflateWidthLowers:function(e){var t=this.getLeafDescendants(!0),i=this.grid(),s=i.displayOptions().isVirtualRendering()?i.leftPos():0,n=[];if(0<t.length&&0<this._lowers.length){for(var o=[t[0].left()],r=t.length,l=0,a=0;a<r;a++)l+=0<t[a].width()?1:0,o.push(o[a]+t[a].width());for(var h=e/l,u=0,a=1;a<o.length;a++)u+=0<o[a]-o[a-1]?h:0,o[a]+=u;for(a=0;a<r;a++){var c=t[a];c.setLeft(o[a]),c.setWidth(o[a+1]-o[a]);for(var d=c._bodies.length;d--;)c._bodies[d].setLeft(o[a]-s),c._bodies[d].setWidth(o[a+1]-o[a]);for(var _=c.group();_&&_.level()>this.level();)n.indexOf(_)<0&&n.push(_),_=_.group()}n.forEach(function(e){e.setLeft(e.getLeafDescendants(!0)[0].left()),e.setWidth(e.getLeafWidths(!0))})}this.inflate(e,0);for(a=this._bodies.length;a--;)this._bodies[a].inflate(e,0);return e},$_inflateHeightLowers:function(e){var t=this.getLeafDescendants(!0),i=this.grid(),s=i.displayOptions().isVirtualRendering()?i.topPos():0,n=[];if(1<t.length&&0<this._lowers.length){for(var o=[t[0].top()],r=t.length,l=0;l<r;l++)o.push(o[l]+t[l].height());for(var a=e/r,h=0,l=1;l<o.length;l++)o[l]=o[l]+(h+=a);for(l=0;l<r;l++){var u=t[l];u.setTop(o[l]),u.setHeight(o[l+1]-o[l]);for(var c=u._bodies.length;c--;)u._bodies[c].setTop(o[l]-s),u._bodies[c].setHeight(o[l+1]-o[l]);for(var d=u.group();d&&d.level()>this.level();)n.indexOf(d)<0&&n.push(d),d=d.group()}n.forEach(function(e){e.setTop(e.getLeafDescendants(!0)[0].top()),e.setHeight(e.getLeafHeights(!0))})}this.inflate(0,e);for(l=this._bodies.length;l--;)this._bodies[l].inflate(0,e);return e},$_trimLowerSize:function(){var e=this.getVisibleLowers(!0,!1),t=e.length;if(0<t)for(var i=this._type==FieldType.COLUMN,s=0,n=i?this.left():this.top(),o=i?this.width():this.height(),r=0,l=0;l<t;l++){var a,h=e[l];h!==this&&(r=(a=i?h.width():h.height())-(a=l==t-1?o-s:_round(a+r)),i?(h.setLeft(n+s),h.setWidth(a)):(h.setTop(n+s),h.setHeight(a)),h.$_trimLowerSize(),s+=a)}},changeSize:function(e,t){if(0!==e)this.$_inflateWidthLowers(e);else{if(0===t)return;this.$_inflateHeightLowers(t)}this._group&&this._group.$_inflateGroup(this,e,t),this._grid.bodyView().redrawFocus()},changeSizeComplete:function(){this.$_trimLowerSize()},setTop:function(e){this._super(e)},$_insertLower:function(e,t){this._lowers.splice(t,0,e)},$_addLower:function(e){this._lowers.push(e)},$_removeLower:function(e){e=this._lowers.indexOf(e);-1<e&&this._lowers.splice(e,1)},_doLayoutContent:function(){},getVisibleLowers:function(e,t){for(var i=[],s=this._lowers.length,n=0;n<s;n++){var o=this._lowers[n];!e&&o instanceof LabelSummaryCellElement||!o.isVisible()||i.push(this._lowers[n])}return t&&0<s&&i.sort(function(e,t){e=e.index(),t=t.index();return e<t?-1:t<e?1:0}),i},$_resetTree:function(){var e=this._group?this._group._treePath.slice(0):[];this instanceof LabelSummaryCellElement||this._valueLabel&&!_defined(this._value)||e.push(this._value),this._treePath=e},$_resetIndex:function(){var e=(e=this._group.isRoot()?e:this._type==FieldType.ROW?this._group._cellIndex.rows():this._group._cellIndex.columns())?_clone(e):{};this._valueLabel&&!_defined(this._value)?e.valueField=this._valueField.name():this instanceof LabelSummaryCellElement?e[CellIndex.ATTR_ISSUM]=!0:e[this._labelField.name()]=this._value,this._type==FieldType.ROW?this._cellIndex.setRows(e):this._cellIndex.setColumns(e)},getTooltip:function(){for(var e="",t=this;t&&!t.isRoot();)e=t._text+(e=""!=e?" - "+e:e),t=t._group;return e},$_getCellText:function(){return this._text&&this._keepSpace?this._text.replace(/(\s)/g,"&nbsp;"):this._super()}}),GroupCellElement=defineClass("GroupCellElement",LabelCellElement,{init:function(e,t,i,s,n,o,r){this._super(e,t,i,s,null,n,o,r?r.value:null,r?r.label:null),e.groupOptions().isExpanderVisible()&&(this._expander=new GroupExpander(e,this,!0),this.addChild(this._expander),this._expander.addListener(this)),this._dataObj=r,this._expanded=!0,this._sumDeltaX=0,this._sumDeltaY=0,this._deflateW=0,this._deflateH=0,this._orgWidth=0,this._orgHeight=0,this._partial=!1},destroy:function(){this._expander&&this._expander.removeListener(this),this._super()},expander:null,summaryCell:null,summaryVisible:!0,expanded:function(){return this._expanded},setExpanded:function(e){e!=this._expanded&&(this._expanded=e,this._dataObj&&(this._dataObj.expand=e))},expand:function(){var e,t;this._partial?(this._dataObj.expand=!0,this._grid.expandPartialGroup(this)):this._expanded||(t=(e=this instanceof ColumnGroupCellElement)?this._orgWidth-this._width:this._orgHeight-this._height,this._summaryVisible&&this._summaryCell._labelPosition==SummaryPosition.FIRST?(this._summaryChangeSize=(e?this._summaryCell.width():this._summaryCell.height())-this._orgSumSize,t+=this._summaryChangeSize):this._summaryChangeSize=0,this.setExpanded(!0),this._doExpand(this),this._summaryVisible||this._summaryCell.$_toggleMembers(!1),this._expander.setExpanded(!0),e?(this._group&&this._group.$_inflateGroup(this,t,0),this._grid.changeClientSize(null,this,t,0)):(this._group&&this._group.$_inflateGroup(this,0,t),this._grid.changeClientSize(null,this,0,t)))},collapse:function(){this._expanded&&(this._prepareCollapse(),this.inflate(this._deflateW,this._deflateH),this._doCollapse(this),this.setExpanded(!1),this._summaryVisible||(this._summaryCell.$_toggleMembers(!0),this instanceof ColumnGroupCellElement?this._summaryCell.offsetMembers(this._left-this._summaryCell._left,0):this._summaryCell.offsetMembers(0,this._top-this._summaryCell._top)),this._expander.setExpanded(!1),this._group&&this._group.$_inflateGroup(this,this._deflateW,this._deflateH),this._grid.changeClientSize(null,this,this._deflateW,this._deflateH))},setPartial:function(){this._partial=!0,this._expanded=!1,this._expander&&this._expander.setExpanded(!1)},_prepareCollapse:function(){this._orgWidth=this._width,this._orgHeight=this._height,this._orgSumSize=this._type==FieldType.ROW?this._summaryCell._height:this._summaryCell._width},_doExpand:function(e){},_doCollapse:function(e){for(var t=this._lowers.length;t--;){var i=this._lowers[t];this==e&&i instanceof LabelSummaryCellElement&&this._summaryVisible?i.offsetMembers(this._sumDeltaX,this._sumDeltaY):i.$_toggleMembers(!1)}},$_getExpenderRect:function(){return new Rectangle(2,2,GroupExpander.SIZE,GroupExpander.SIZE)},_doLayoutContent:function(){var e=this.$_getExpenderRect();this._expander&&this._expander.setSize(e.width,e.height)},onGroupExpanderExpand:function(){this.expand()},onGroupExpanderCollapse:function(){this.collapse()}}),ColumnGroupCellElement=defineClass("ColumnGroupCellElement",GroupCellElement,{init:function(e,t,i,s,n,o){this._super(e,FieldType.COLUMN,t,i,s,n,o)},_doRender:function(e){this._super(e)},_prepareCollapse:function(){this._super(),this._sumDeltaX=this._left-this._summaryCell._left,this._deflateW=this._summaryCell._width-this._width;for(var e=MAX_INT,t=this._lowers.length;t--;)this._lowers[t]instanceof LabelSummaryCellElement||(e=_min(e,this._lowers[t]._left));this._collapseX=this._left},_doExpand:function(e){for(var t=this._left-this._collapseX+this._summaryChangeSize,i=0,s=this._lowers.length;i<s;i++){var n=this._lowers[i];n instanceof LabelSummaryCellElement?this==e?n.offsetMembers(-this._sumDeltaX,0):(n.$_toggleMembers(!0),n.offsetMembers(n._labelPosition==SummaryPosition.FIRST?this._sumDeltaX:t,0)):(n.$_toggleMembers(!0),n.offsetMembers(t,0))}this.setWidth(this._orgWidth+this._summaryChangeSize)}}),RowGroupCellElement=defineClass("RowGroupCellElement",GroupCellElement,{init:function(e,t,i,s,n,o){this._super(e,FieldType.ROW,t,i,s,n,o)},_doRender:function(e){this._super(e)},_prepareCollapse:function(){this._super(),this._sumDeltaY=this._top-this._summaryCell._top,this._deflateH=this._summaryCell._height-this._height;for(var e=MAX_INT,t=this._lowers.length;t--;)this._lowers[t]instanceof LabelSummaryCellElement||(e=_min(e,this._lowers[t]._top));this._collapseY=this._top},_doExpand:function(e){for(var t=this._top-this._collapseY+this._summaryChangeSize,i=0,s=this._lowers.length;i<s;i++){var n=this._lowers[i];n instanceof LabelSummaryCellElement?this==e?n.offsetMembers(0,-this._sumDeltaY):(n.$_toggleMembers(!0),n.offsetMembers(0,n._labelPosition==SummaryPosition.FIRST?this._sumDeltaY:t)):(n.$_toggleMembers(!0),n.offsetMembers(0,t))}this.setHeight(this._orgHeight+this._summaryChangeSize)}}),ColumnRootCellElement=defineClass("ColumnRootCellElement",ColumnGroupCellElement,{init:function(e){this._super(e,-1),this.setLeft(0)},isRoot:function(){return!0}}),RowRootCellElement=defineClass("RowRootCellElement",RowGroupCellElement,{init:function(e){this._super(e,-1),this.setTop(0)},isRoot:function(){return!0}}),LabelSummaryCellElement=defineClass("LabelSummaryCellElement",LabelCellElement,{init:function(e,t,i,s,n,o,r,l,a,h){var u=l instanceof GroupCellElement&&n==SummaryPosition.FIRST?0:void 0;this._super(e,t,i,o,r,l,u,a,h),this._mergeCount=s||0,this._labelPosition=n,l instanceof LabelSummaryCellElement||l.setSummaryCell(this)},labelPosition:SummaryPosition.FIRST,_doLayoutContent:function(){},_doRender:function(e){this._super(e)},isTotalSummary:function(){return this._valueLabel?0==this._group._level:0==this._level}}),BodyCellElement=defineClass("BodyCellElement",PivotCellElement,{init:function(e,t){this._super(e,t)},destroy:function(){this._columnLabel&&this._columnLabel.removeBody(this),this._columnLabel=null,this._rowLabel&&this._rowLabel.removeBody(this),this._rowLabel=null,this._valueField=null,this._model=null,this._super()},columnLabel:null,rowLabel:null,model:null,emptyValue:null,setWidth:function(e){this._super(e),this._model&&this._model.setWidth(this._width)},setHeight:function(e){this._super(e),this._model&&this._model.setHeight(this._height)},setColumnLabel:function(e){e!=this._columnLabel&&(this._columnLabel&&this._columnLabel.removeBody(this),e&&e.addBody(this),this._columnLabel=e,this._cellIndex.setColumns(e.getCellIndex().columns()))},setRowLabel:function(e){e!=this._rowLabel&&(this._rowLabel&&this._rowLabel.removeBody(this),e&&e.addBody(this),this._rowLabel=e,this._cellIndex.setRows(e.getCellIndex().rows()))},setModel:function(e){e!=this._model&&(this._model=e,this.setValueField(e.field()),this.setValue(e.getValue()),this.setText(this._emptyValue))},setValueField:function(e){e!=this._valueField&&(this._valueField=e,this._cellIndex.setValueField(e.name()))},setValue:function(e){this._value=e},setText:function(e){this._model;var t=this._model._dataObj;t.count||null==e?(t=(_isObject(t.value)?t.value:t).value,this._text=this._valueField.getDisplayText(t)||""):this._text=String(e)},_doLayoutContent:function(){},_doRender:function(e){this._super(e);var e=BodyCellElement.getStyleName(this._grid,this._cellIndex,this._value),t=this._defClassName;this._element.className=e?t+" "+e:t,this._valueField&&((e=this._valueField.valueAlignment())?this._span.className=this.cssClass()+" "+e:this._valueField.expression()==ValueType.DISTINCT?this._span.className=this.cssClass()+" center":this._span.className=this.cssClass())},getTooltip:function(){for(var e="",t=this._columnLabel;t&&!t.isRoot();)t.isValueLabel()&&0!=t.level()||(""!=e&&(e=" - "+e),e=t.text()+e),t=t.group();for(var i=RealPivotMessages.columnText+" : "+e,e="",t=this._rowLabel;t&&!t.isRoot();)""!=e&&(e=" - "+e),e=t.text()+e,t=t.group();var s=RealPivotMessages.rowText+" : "+e;return this._valueField.getFieldHeader()+"<br/>"+(RealPivotMessages.valueText+" : "+this._text)+"<br/>"+i+"<br/>"+s+("<br/>"+RealPivotMessages.countText+" : "+this._model.getCount())},isTotalSummary:function(){return!1}},{getStyleName:function(e,t,i){var s=e.displayOptions().styleCallback();return s&&t&&t._columns&&s.call(e,e,t.toProxy(),i)}}),ValueCellElement=defineClass("ValueCellElement",BodyCellElement,{init:function(e){this._super(e,"realpivot-body-value")},_doLayoutContent:function(){},_doRender:function(e){this._super(e)}}),SummaryCellElement=defineClass("SummaryCellElement",BodyCellElement,{init:function(e,t,i){this._super(e,"realpivot-body-sum"),this._baseClass=this.cssClass(),this.setLevel(t,i)},colLevel:0,rowLevel:0,_doLayoutContent:function(){},_doRender:function(e){this._super(e)},setLevel:function(e,t){var i="realpivot-body-sum-tot",s=(this._colLevel=t,this._rowLevel=e,(this._baseClass+"").split(" ")),n=s.indexOf(i);0==t||0==e?n<0&&s.push(i):0<=n&&s.splice(n,1),this.setCssClass(this._defClassName=s.join(" "))},isTotalSummary:function(){return 0==this._colLevel||0==this._rowLevel},setFixedSplit:function(e,t){var i="realpivot-body-left-split",s="realpivot-body-top-split",n=(this._defClassName+"").split(" "),o=n.indexOf(i),r=n.indexOf(s);e?o<0&&n.push(i):0<=o&&n.splice(o,1),t?r<0&&n.push(s):0<=r&&n.splice(r,1),this.setCssClass(this._defClassName=n.join(" "))}}),HandleElement=defineClass("HandleElement",ClickableElement,{init:function(e,t,i){this._super(e,i),this._css.removeProperty("position"),this._cellView=t},cellView:function(){return this._cellView}}),GroupExpander=defineClass("GroupExpander",HandleElement,{init:function(e,t,i){this._expanded=!(2<arguments.length)||i,this._super(e,t,this.$_getCssClass())},destroy:function(){this._super()},expanded:!0,setExpanded:function(e){this._expanded!=e&&(this._expanded=e,this.setCssClass(this.$_getCssClass()))},$_getCssClass:function(){return this._expanded?"realpivot-expander-expand":"realpivot-expander-collapse"},_doClick:function(e){this._expanded?this.fireEvent(GroupExpander.COLLAPSE):this.fireEvent(GroupExpander.EXPAND)}},{SIZE:15}),LayerElement=(GroupExpander.EXPAND="onGroupExpanderExpand",GroupExpander.COLLAPSE="onGroupExpanderCollapse",defineClass("LayerElement",VisualElement,{init:function(e){this._super(),this._grid=e,this._element.style.pointerEvents="none",this._css.position="absolute",this._layers=[]},destroy:function(){for(var e=0,t=this._layers.length;e<t;e++)this._element.removeChild(this._layers[0]);this._layers=[],this._grid=null,this._super()},isLayer:function(){return!0}})),_wmv_=function(){var i=new Image,e=(i.src="data:image/png;base64,"+_wm_,i.style.position="absolute",i.style.pointerEvents="none",i.style.zIndex=0,new LayerElement);return e.setVisible(!1),e._element.appendChild(i),e.resize=function(e,t){this.setVisible(!0),this.setSize(e,t),i.style.left=(this.width()-i.width)/2+STYLE_PIXEL,i.style.top=(this.height()-i.height)/2+STYLE_PIXEL},e},MaskElement=defineClass("MaskElement",LayerElement,{init:function(){this._super(),this._element.className="realpivot-mask",this.setVisible(!1),this._element.style.removeProperty("pointer-events"),this._element.addEventListener("mousedown",this._mouseDown),this._updateCnt=0},show:function(){this.setVisible(!0),this._updateCnt++},hide:function(e){this._updateCnt--,0!==this._updateCnt&&!e||(this._updateCnt=0,this.setVisible(!1))},_mouseDown:function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}}),FocusCellElement=defineClass("FocusCellElement",LayerElement,{init:function(e){this._super(e),this._element.className="realpivot-focus"},draw:function(e,t,i,s){this.setBounds(e,t,i,s)}}),FocusGuideElement=defineClass("FocusCellElement",LayerElement,{init:function(e){this._super(e),this._element.className="realpivot-focus-guide"},draw:function(e,t,i,s){this.setBounds(e,t,i,s)}}),FocusElement=defineClass("FocusElement",LayerElement,{init:function(e,t){this._super(e),this._cell=new FocusCellElement(e),this.addChild(this._cell),this._leftGuide=new FocusGuideElement(e),this.addChild(this._leftGuide),this._rightGuide=new FocusGuideElement(e),this.addChild(this._rightGuide),this._topGuide=new FocusGuideElement(e),this.addChild(this._topGuide),this._bottomGuide=new FocusGuideElement(e),this.addChild(this._bottomGuide),this._originalX=0,this._originalY=0,this._offsetX=0,this._offsetY=0},guideVisible:!1,moveToCell:function(e,t,i){var s=e.isTotalSummary();this._totalColCell=s&&0==e.colLevel(),this._totalRowCell=s&&0==e.rowLevel(),e&&(this._originalX=e.left(),this._originalY=e.top(),2<arguments.length?(this._offsetX=t,this._offsetY=i):(this._offsetX=0,this._offsetY=0),this.$_draw(this._originalX,this._originalY,e.width(),e.height())),this.fireEvent(FocusElement.MOVED,e)},resetSize:function(){var e=this._parent.width(),t=this._parent.height();this.setBounds(0,0,e,t)},redraw:function(e){this.$_draw(e.left(),e.top(),e.width(),e.height())},scrollTo:function(e,t){_defined(e)&&this._cell.setLeft(this._originalX+this._offsetX-e),_defined(t)&&this._cell.setTop(this._originalY+this._offsetY-t),this._guideVisible&&this.$_drawGuide(this._bound)},$_drawGuide:function(e){var t=this._cell.getBounds(),i=t.bottom()>e.y&&t.y<e.bottom(),s=t.right()>e.x&&t.x<e.right(),n=t.x>e.x&&i,i=t.right()<e.right()&&i,o=t.y>e.y&&s,s=t.bottom()<e.bottom()&&s,r=this._cell.isVisible();this._leftGuide.setVisible(n),this._rightGuide.setVisible(i),this._topGuide.setVisible(o),this._bottomGuide.setVisible(s),n&&(i||r?this._leftGuide.draw(e.x,t.y,t.x-e.x,t.height):this._leftGuide.draw(e.x,t.y,e.width,t.height)),i&&(n||r?this._rightGuide.draw(t.right(),t.y,e.right()-t.right(),t.height):this._rightGuide.draw(e.x,t.y,e.width,t.height)),o&&(s||r?this._topGuide.draw(t.x,e.y,t.width,t.y-e.y):this._topGuide.draw(t.x,e.y,t.width,e.height)),s&&(o||r?this._bottomGuide.draw(t.x,t.bottom(),t.width,e.bottom()-t.bottom()):this._bottomGuide.draw(t.x,e.y,t.width,e.height))},$_draw:function(e,t,i,s){_trace("##focus draw");var n=this._grid,o=n.tmpSummaryOptions(),r=!0,l=this._bound=this.getClientRect(),a=n.columnWidth(),h=n.rowHeight();a<l.width&&(l.width=a),h<l.height&&(l.height=h),o.isTotalFixed()&&(a=n.columnView().rootElement().summaryCell(),h=n.rowView().rootElement().summaryCell(),a&&!this._totalColCell&&(n=a.left(),a=a.width(),o.columnPosition()==SummaryPosition.FIRST?e<a&&(l.leftBy(a),a<e+i?(i-=a-e,e=a):r=!1):n<e+i&&(l.rightBy(-a),e<n?i-=e+i-n:r=!1)),h&&!this._totalRowCell&&(a=h.top(),n=h.height(),o.rowPosition()==SummaryPosition.FIRST?t<n&&(l.topBy(n),n<t+s?(s-=n-t,t=n):r=!1):o.rowPosition()==SummaryPosition.LAST&&a<t+s&&(l.bottomBy(n),t<a?s-=t+s-a:r=!1))),this._cell.setVisible(r),this._cell.draw(e--,t--,i--,s--),this._guideVisible&&this.$_drawGuide(l)}}),ScrollEventType=(FocusElement.MOVED="onFocusElementMoved",{LINE_UP:"lineUp",LINE_DOWN:"lineDown",LINE_LEFT:"lineLeft",LINE_RIGHT:"lineRight",PAGE_UP:"pageUp",PAGE_DOWN:"pageDown",PAGE_LEFT:"pageLeft",PAGE_RIGHT:"pageRight",WHEEL_X:"wheelX",WHEEL_Y:"wheelY",THUMB_TRACK:"thumbTrack",THUMB_END:"thumbEnd"}),ScrollContainer=defineClass("ScrollContainer",VisualElement,{init:function(e){this._super(),this._owner=e,this._isContainer=!0,this._css.position="absolute",this._css.pointerEvents="none",this._hscrollBar=new ScrollBar(e,this,!1),this.addChild(this._hscrollBar),this._vscrollBar=new ScrollBar(e,this,!0),this.addChild(this._vscrollBar),this._hscrollBar.addListener(this),this._vscrollBar.addListener(this),this._corner=new ScrollBarCorner(e),this.addChild(this._corner),this._scrollWidth=0,this._scrollHeight=0},destroy:function(){this._super(),this._hscrollBar=null,this._vscrollBar=null,this._corner=null},hscrollBar:null,vscrollBar:null,hscrollable:!1,vscrollable:!1,scrollBarSize:15,scrollUnitSize:25,setLeftPos:function(e){e=_max(0,_min(e,this._maxWidth-this._scrollWidth)),this._owner.scrollTo(e,void 0)},setTopPos:function(e){e=_max(0,_min(e,this._maxHeight-this._scrollHeight)),this._owner.scrollTo(void 0,e)},wheelScroll:function(e,t){var i=!1,s=this._scrollUnitSize;return e=_ceil(e/s)*s,t=_ceil(t/s)*s,this._hscrollable&&(i=this._hscrollBar._doScroll(ScrollEventType.WHEEL_X,-e,0)),i=this._vscrollable?i||this._vscrollBar._doScroll(ScrollEventType.WHEEL_Y,-t,0):i},clientWidth:function(){return this._width-(this._vscrollable?this._scrollBarSize:0)},clientHeight:function(){return this._height-(this._hscrollable?this._scrollBarSize:0)},updateScroll:function(e,t,i,s,n){var o,r,l=t+s,a=i+n,h=this._owner.topPos(),u=this._owner.leftPos(),e=e.clone();this.setRect(e),this._measure(l,a),e.width=e.width-(this._vscrollable?this._scrollBarSize:0),e.height=e.height-(this._hscrollable?this._scrollBarSize:0),this._maxWidth=t,this._maxHeight=i,this.layoutContent(),u>l-e.width&&this.setLeftPos(_max(l-e.width,0)),h>a-e.height&&this.setTopPos(_max(a-e.height,0)),this._hscrollable&&(o=t,this._scrollWidth=e.width-s,r=Math.min(this._scrollWidth,t-u),this._hscrollBar.setProperties(0,o,r),this._hscrollBar.setPosition(u)),this._vscrollable&&(o=i,this._scrollHeight=e.height-n,r=Math.min(this._scrollHeight,i-h),this._vscrollBar.setProperties(0,o,r),this._vscrollBar.setPosition(h))},_measure:function(e,t){this._hscrollable=e>this._width,this._vscrollable=t>this._height;var i=this._scrollBarSize;this._hscrollable&&(this._vscrollable=t>this._height-i),this._vscrollable&&(this._hscrollable=e>this._width-i)},_doLayoutContent:function(){var e,t=this._width,i=this._height,s=this._scrollBarSize,n=this._vscrollable?s:0,o=this._hscrollable?s:0;this._hscrollBar.setVisible(this._hscrollable),this._hscrollable&&(e=this._hscrollBar.width(),this._hscrollBar.setBounds(0,i-s,t-n,s),t-n!=e&&this._hscrollBar.layoutContent()),this._vscrollBar.setVisible(this._vscrollable),this._vscrollable&&(e=this._vscrollBar.height(),this._vscrollBar.setBounds(t-s,0,s,i-o),i-o!=e&&this._vscrollBar.layoutContent()),this._corner.setVisible(this._hscrollable&&this._vscrollable),this._corner.isVisible()&&this._corner.setBounds(t-s,i-s,s,s)},onScrollBarScrolled:function(e,t,i,s){var n=this._owner.topPos(),o=this._owner.leftPos(),r=e.getScrollUnit(t);if(e.isVertical())switch(t){case ScrollEventType.LINE_DOWN:case ScrollEventType.LINE_UP:case ScrollEventType.PAGE_DOWN:case ScrollEventType.PAGE_UP:this.setTopPos(n+i*r);break;case ScrollEventType.WHEEL_Y:this.setTopPos(n+i);break;default:this.setTopPos(s)}else switch(t){case ScrollEventType.LINE_RIGHT:case ScrollEventType.LINE_LEFT:case ScrollEventType.PAGE_RIGHT:case ScrollEventType.PAGE_LEFT:this.setLeftPos(o+i*r);break;case ScrollEventType.WHEEL_X:this.setLeftPos(o+i);break;default:this.setLeftPos(s)}}}),ScrollBar=defineClass("ScrollBar",ClickableElement,{init:function(e,t,i){this._super(e,"realpivot-sbar"),this._vertical=i,this._container=t,this._nearButton=new ScrollButton(e,this,!1),this.addChild(this._nearButton),this._farButton=new ScrollButton(e,this,!0),this.addChild(this._farButton),this._thumb=new ScrollThumb(e,this),this.addChild(this._thumb),this._buttonSize=20,this._min=0,this._max=0,this._pos=0,this._page=0,this._maxPosition=0},destroy:function(){this._super(),this._nearButton=null,this._farButton=null,this._thumb=null},lineScrollCount:1,pageScrollCount:10,minThumbSize:20,mouseX:0,mouseY:0,isVertical:function(){return this._vertical},maxPosition:function(){return this._maxPosition},getScrollUnit:function(e){var t=this._container.scrollUnitSize();switch(e){case ScrollEventType.LINE_DOWN:case ScrollEventType.LINE_UP:case ScrollEventType.LINE_RIGHT:case ScrollEventType.LINE_LEFT:return this._lineScrollCount*t;case ScrollEventType.PAGE_DOWN:case ScrollEventType.PAGE_UP:case ScrollEventType.PAGE_RIGHT:case ScrollEventType.PAGE_LEFT:return this._pageScrollCount*t;default:return 1}},setProperties:function(e,t,i){e=Math.max(0,e),t=Math.max(e,t),e==this._min&&t==this._max&&i==this._page||(this._min=e,this._max=t,this._page=i,this._pos=Math.min(this._max,Math.max(this._min,this._pos)),this._maxPosition=Math.max(0,this._max-this._page),this._doLayoutContent())},setPosition:function(e){return(e=Math.min(this._maxPosition,Math.max(this._min,e)))!=this._pos&&(this._pos=e,this._doLayoutContent(),!0)},ptInTrack:function(e,t,i){t=this.containerToClient(e,t);if(this._vertical){if(t.y>=this._nearButton.height()&&t.x<this._farButton.top())return!i&&t.y<this._thumb.top()||i&&t.y>=this._thumb.bottom()}else if(e>=this._nearButton.width()&&e<this._farButton.left())return!i&&t.x<this._thumb.left()||i&&t.x>=this._thumb.right();return!1},_doLayoutContent:function(){var e=this._vertical,t=this._buttonSize,i=(e?this._height:this._width)-2*t,s=Math.min(i,Math.max(this._minThumbSize,_int(i*this._page/(this._max-this._min+1)))),n=t+Math.min(i-s,Math.max(0,_int((i-s)*this._pos/(this._maxPosition-this._min))));e?(this._nearButton.setBounds(0,0,this._width,t),this._farButton.setBounds(0,this._height-t,this._width,t),s<=i&&this._thumb.setBounds(1,n,this._width-2,s)):(this._nearButton.setBounds(0,0,t,this._height),this._farButton.setBounds(this._width-t,0,t,this._height),s<=i&&this._thumb.setBounds(n,1,s,this._height-2))},_doScroll:function(e,t,i){var s=!1;return 0!=t?s=this.setPosition(this._pos+t*this.getScrollUnit(e)):i&&(s=this.setPosition(i)),s&&this.fireEvent(ScrollBar.SCROLLED,e,t,i),s},_mouseOut:function(){this._nearButton.setPressed(!1),this._farButton.setPressed(!1),this._thumb.setPressed(!1)},_doClick:function(e,t){this._vertical?t<this._thumb.top()?this._doScroll(ScrollEventType.PAGE_UP,-1,0):this._doScroll(ScrollEventType.PAGE_DOWN,1,0):e<this._thumb.left()?this._doScroll(ScrollEventType.PAGE_LEFT,-1,0):this._doScroll(ScrollEventType.PAGE_RIGHT,1,0)}}),ScrollButton=(ScrollBar.SCROLL_LINE_SIZE=25,ScrollBar.SCROLLED="onScrollBarScrolled",defineClass("ScrollButton",ClickableElement,{init:function(e,t,i){var s=this.$_getClassName(t.isVertical(),i);this._super(e,s),this._scrollBar=t,this._far=i},destroy:function(){this._scrollBar=null,this._super()},far:!1,enabled:!0,pressed:!1,setPressed:function(e){e!=this._pressed&&(this.setCssClass(this.$_getClassName(this.isVertical(),this._far,e)),this._pressed=e)},isVertical:function(){return this._scrollBar.isVertical()},scrollBar:function(){return this._scrollBar},_doClick:function(e,t){this.isVertical()?this._far?this._scrollBar._doScroll(ScrollEventType.LINE_DOWN,1,0):this._scrollBar._doScroll(ScrollEventType.LINE_UP,-1,0):this._far?this._scrollBar._doScroll(ScrollEventType.LINE_RIGHT,1,0):this._scrollBar._doScroll(ScrollEventType.LINE_LEFT,-1,0)},$_getClassName:function(e,t,i){e=e?"realpivot-sbar-v":"realpivot-sbar-h";return(i?"realpivot-sbar-button-pressed":"realpivot-sbar-button")+" "+(e+=t?"fbutton":"nbutton")}})),ScrollThumb=defineClass("ScrollThumb",ClickableElement,{init:function(e,t){this._scrollBar=t,this._request=null,this._super(e,this.$_getClassName())},pressed:!1,setPressed:function(e){e!=this._pressed&&(this.setCssClass(this.$_getClassName(e)),this._pressed=e)},destroy:function(){this._scrollBar=null,this._request=null,this._super()},scrollBar:function(){return this._scrollBar},isVertical:function(){return this._scrollBar._vertical},getRequest:function(){return this._request||(this._request=new ScrollThumbRequest(this)),this._request},getTracker:function(e,t){return new ScrollThumbTracker},$_getClassName:function(e){return e?"realpivot-sbar-thumb-pressed":"realpivot-sbar-thumb"}}),ScrollBarCorner=defineClass("ScrollBarCorner",PivotElement,{init:function(e){this._super(e,"realpivot-sbar-corner")}}),ScrollThumbRequest=defineClass("ScrollThumbRequest",Request,{init:function(e){this._super(),this._thumb=e,this._scrollBar=e.scrollBar(),this._grid=this._scrollBar.grid()},thumb:function(){return this._thumb},scrollBar:function(){return this._scrollBar},grid:function(){return this._grid},cursor:function(){return Cursor.POINTER},isSelectable:function(){return!1}}),ScrollThumbTracker=defineClass("ScrollThumbTracker",GridDragTracker,{init:function(e,t,i){this._super(e,"scrollThumbTracker"),this._request=e,this._thumb=e.thumb(),this._scrollBar=e.scrollBar(),this._vertical=this._scrollBar.isVertical();e=this._scrollBar.containerToClient(t,i);this._scrollBar.isVertical()?this._offset=e.y-this._thumb.top():this._offset=e.x-this._thumb.left(),this._prev=Date.now()},destroy:function(){this._request=null,this._thumb=null,this._scrollBar=null,this._super()},isStartWhenCreated:function(){return!0},_doStart:function(e,t){return this._thumb.setPressed(!0),!0},_doDrag:function(e,t){return this.$_doScroll(e,t,ScrollEventType.THUMB_TRACK)},_doCompleted:function(e,t){return this.$_doScroll(e,t,ScrollEventType.THUMB_END)},_doCanceled:function(e,t){},_doEnded:function(){this._thumb.setPressed(!1)},$_doScroll:function(e,t,i){if(!(Date.now()-this._prev<60)){this._prev=Date.now();var s,n=this._scrollBar._maxPosition-this._scrollBar._min+1,o=this._scrollBar._buttonSize,e=this._scrollBar.containerToClient(e,t);if(this._scrollBar.isVertical()){if((s=this._scrollBar.height()-2*o-this._thumb.height())<=0)return;e.y-=this._offset,e.y=(e.y-o)*n/s,this._scrollBar._doScroll(i,0,_int(e.y))}else{if((s=this._scrollBar.width()-2*o-this._thumb.width())<=0)return;e.x-=this._offset,e.x=(e.x-o)*n/s,this._scrollBar._doScroll(i,0,_int(e.x))}return!0}}}),ScrollButtonTimer=defineClass("ScrollButtonTimer",EventAware,{init:function(e){this._super(),this._button=e,this._scrollBar=e.scrollBar(),this._active=!1,this._timer=UNDEFINED,this._ready=!1},start:function(){this._button.setPressed(!0),this._active=!0,this.$_fireEvent(),setTimeout(function(){this._ready&&(this._ready=!1,this._timer=setInterval(function(){this._active&&this.$_fireEvent()}.bind(this),50))}.bind(this),200),this._ready=!0},move:function(e,t){e=this._button.containerToClient(e,t);this._active=this._button.containsInClient(e.x,e.y)},stop:function(e,t){this._ready=!1,this._timer&&clearInterval(this._timer),this._button.setPressed(!1)},$_fireEvent:function(){var e=null,t=1;this._scrollBar.isVertical()?this._button.isFar()?e=ScrollEventType.LINE_DOWN:(e=ScrollEventType.LINE_UP,t=-1):this._button.isFar()?e=ScrollEventType.LINE_RIGHT:(e=ScrollEventType.LINE_LEFT,t=-1),this._scrollBar._doScroll(e,t,0)}}),ScrollTrackTimer=defineClass("ScrollTrackTimer",EventAware,{init:function(e,t){this._super(e),this._scrollBar=e,this._isFar=t,this._active=!1,this._timer=UNDEFINED,this._ready=!1},start:function(){this._active=!0,this.$_fireEvent(),setTimeout(function(){this._ready&&(this._ready=!1,this._timer=setInterval(function(){this._active&&this.$_fireEvent()}.bind(this),50))}.bind(this),200),this._ready=!0},move:function(e,t){e=this._scrollBar.containerToClient(e,t);this._active=this._scrollBar.ptInTrack(e.x,e.y,this._isFar)},stop:function(e,t){this._ready=!1,this._timer&&clearInterval(this._timer)},$_fireEvent:function(){var e,t=null,i=0,s=this._scrollBar._thumb;this._scrollBar.isVertical()?(e=this._scrollBar.mouseY(),this._isFar&&e>s.bottom()?(t=ScrollEventType.PAGE_DOWN,i=1):e<s.top()&&(t=ScrollEventType.PAGE_UP,i=-1)):(e=this._scrollBar.mouseX(),this._isFar&&e>s.right()?(i=1,t=ScrollEventType.PAGE_RIGHT):e<s.left()&&(t=ScrollEventType.PAGE_LEFT,i=-1)),0!=i&&this._scrollBar._doScroll(t,i,0)}}),GridScrollTool=defineClass("GridScrollTool",null,{init:function(e){this._super(e,"gridScrollTool"),this._scrollTimer=null},isScrolling:function(){return null!=this._scrollTimer},stop:function(e,t){this._scrollTimer&&(this._scrollTimer.stop(e,t),this._scrollTimer=null)},start:function(e,t,i){return this._curruntScrollBar=null,e instanceof ScrollButton?(e.isEnabled()&&(this._scrollTimer=new ScrollButtonTimer(e),this._scrollTimer.start()),!0):!!(e instanceof ScrollBar&&((this._curruntScrollBar=e).ptInTrack(t,i,!0)?this._scrollTimer=new ScrollTrackTimer(e,!0):e.ptInTrack(t,i,!1)&&(this._scrollTimer=new ScrollTrackTimer(e,!1)),this._scrollTimer))&&(e.setMouseX(t),e.setMouseY(i),this._scrollTimer.start(),!0)},move:function(e,t){this._curruntScrollBar&&(this._curruntScrollBar.setMouseX(e),this._curruntScrollBar.setMouseY(t)),this._scrollTimer.move(e,t)}}),PivotView=defineClass("PivotView",VisualElement,{init:function(e){this._super(),this._container=e,this._setupView=null,this._container.appendChild(this._element),this.setParentElement(this._container),this._element.className="realpivot",this._css.position="relative",this._eventHandlers={},this._eventNodes=[],this._activeTool=this._createDefaultTool(),this._displayOptions=new DisplayOptions(this),this._groupOptions=new GroupOptions,this._summaryOptions=new SummaryOptions,this._headerOptions=new HeaderOptions,this._copyOptions=new CopyOptions,this._tmpDisplayOptions=new DisplayOptions,this._tmpSummaryOptions=new SummaryOptions,this._tmpHeaderOptions=new HeaderOptions,this._noreadyView=new NotReadyElement(this),this.addChild(this._noreadyView),this._emptyView=new EmptyElement(this),this.addChild(this._emptyView),this._bodyContainer=new OverflowContainer,this.addChild(this._bodyContainer),this._rowContainer=new OverflowContainer,this.addChild(this._rowContainer),this._colContainer=new OverflowContainer,this.addChild(this._colContainer),this._bodyView=new BodyElement(this),this._bodyContainer.addChild(this._bodyView),this._rowView=new RowLabelElement(this),this._rowContainer.addChild(this._rowView),this._columnView=new ColumnLabelElement(this),this._colContainer.addChild(this._columnView),this._headerView=new HeaderElement(this),this.addChild(this._headerView),this._layerView=new LayerElement(this),this.addChild(this._layerView),this._scrollContainer=new ScrollContainer(this),this.addChild(this._scrollContainer),this._focusView=new FocusElement(this),this._bodyContainer.addChild(this._focusView),this._focusView.addListener(this),this._maskView=new MaskElement,this.addChild(this._maskView),this._exporter=null,this._tooltipManager=new TooltipManager(this._element),this._progressManager=new ProgressManager(this._element),this._contextMenuManager=new ContextMenuManager(this._element),this._defContextItems=[{text:"About RealPivot",callback:this.$_aboutMenuHandler}],this._globalContextItems=this._defContextItems.slice(),this._contextItems=[],this._bodyWidth=0,this._bodyHeight=0,this._watchObserver=new WatchDisplayObserver(this),this.addLayerElement(_wmv_()),this._registerListners(),this._layouted=!1,this._fillLayouted=!1,this._progressSorting=!1,this._offsetX=0,this._offsetY=0;for(var t=this._element;t.offsetLeft&&(this._offsetX+=t.offsetLeft),t.offsetTop&&(this._offsetY+=t.offsetTop),t=t.offsetParent;);this._columnWidths=[],this._rowHeights=[],this._columnPoints=[],this._rowPoints=[],this._columnLevelHeights=[],this._rowLevelWidths=[],this._titleHeight=0,this._columnHeight=0,this._colsWidth=0,this._rowsHeight=0,this._centralPt=new Point,this.resetSize()},destroy:function(){this._removeListenerAll(),this._bodyContainer.removeChild(this._focusView),this._focusView.removeListener(this),this._focusView.destroy(),this._focusView=null,this._tooltipManager.destroy(),this._tooltipManager=null,this._progressManager.destroy(),this._progressManager=null,this._contextMenuManager.destroy(),this._contextMenuManager=null,this._focusView=null,this._displayOptions.destroy(),this._displayOptions=null,this._groupOptions.destroy(),this._groupOptions=null,this._summaryOptions.destroy(),this._summaryOptions=null,this._headerOptions.destroy(),this._headerOptions=null,this._copyOptions.destroy(),this._copyOptions=null,this._tmpDisplayOptions.destroy(),this._tmpDisplayOptions=null,this._tmpSummaryOptions.destroy(),this._tmpSummaryOptions=null,this._tmpHeaderOptions.destroy(),this._tmpHeaderOptions=null,this._centralPt=null,this._container=null,this._dataSource=null,this._setupView=null,this._modelManager&&(this._modelManager.removeListener(this),this._modelManager.destroy(),this._modelManager=null),this._activeTool&&(this._activeTool.destroy(),this._activeTool=null),this._exporter&&(this._exporter.destroy(),this._exporter=null),this._watchObserver=this._watchObserver&&this._watchObserver.destroy(),this._super()},displayOptions:null,headerOptions:null,summaryOptions:null,groupOptions:null,tmpDisplayOptions:null,tmpHeaderOptions:null,tmpSummaryOptions:null,dataSource:null,leftPos:0,topPos:0,watchObserver:null,bodyWidth:function(){return this._bodyWidth},bodyHeight:function(){return this._bodyHeight},setDataSource:function(e){assert(e instanceof PivotDataProvider,"dataSource must be PivotDataProvider"),(this._dataSource=e)&&(this._modelManager?this._modelManager.setDataSource(e):this._modelManager=new PivotModelManager(e),this._modelManager.addListener(this))},modelManager:function(){return this._modelManager},setupView:function(){return this._setupView},setSetupView:function(e){this._setupView=e},headerView:function(){return this._headerView},columnView:function(){return this._columnView},rowView:function(){return this._rowView},bodyView:function(){return this._bodyView},focusView:function(){return this._focusView},columnPoints:function(){return this._columnPoints},rowPoints:function(){return this._rowPoints},titleHeight:function(){return this._titleHeight},columnWidth:function(){return this._colsWidth},columnHeight:function(){return this._columnHeight},rowWidth:function(){return this._rowWidth},rowHeight:function(){return this._rowsHeight},columnLevelHeight:function(e){return this._columnLevelHeights[e]},rowLevelWidth:function(e){return this._rowLevelWidths[e]},columnLevelHeights:function(){return this._columnLevelHeights},rowLevelWidths:function(){return this._rowLevelWidths},tooltipManager:function(){return this._tooltipManager},contextMenuManager:function(){return this._contextMenuManager},activeTool:function(){return this._activeTool},getColumnDepth:function(){return this._columnLevelHeights.length},getRowDepth:function(){return this._rowLevelWidths.length},getLeafColumnCount:function(){return this._columnPoints.length-1},getLeafRowCount:function(){return this._rowPoints.length-1},getVisibleColumnCount:function(){return this._columnView.getLeafCells().length},getVisibleRowCount:function(){return this._rowView.getLeafCells().length},getColumnLevelSumHeight:function(e,t){e=_max(e,0),t=_min(t,this._columnLevelHeights.length-1);for(var i=0,s=e;s<=t;s++)i+=this._columnLevelHeights[s];return i},getRowLevelSumWidth:function(e,t){t=null==t?1/0:t,e=_max(e=null==e?0:e,0),t=_min(t,this._rowLevelWidths.length-1);for(var i=0,s=e;s<=t;s++)i+=this._rowLevelWidths[s];return i},valueLabelVisible:function(){return 1<this._dataSource.fieldManager().valueCount()},setColumnWidth:function(e,t){var i=_clone(e.getCellIndex().columns());delete i.valueField,(vfield=e.valueField())&&(i[CellIndex.ATTR_VFIELD]=vfield.name());for(var s=this._columnWidths.length;s--;){var n=this._columnWidths[s];if(_equalsObjEx(n,i,"width"))return void(n.width=t)}i.width=t,this._columnWidths.push(i)},setRowHeight:function(e,t){for(var i=_clone(e.getCellIndex().rows()),s=this._rowHeights.length;s--;){var n=this._rowHeights[s];if(_equalsObjEx(n,i,"height"))return void(n.height=t)}i.height=t,this._rowHeights.push(i)},changeColumnLevelHeight:function(e,t){_trace("changeColumnLevelHeight "+e+t),this._headerView.changeHeight(t),this._columnView.changeHeight(e,t),this._rowContainer.shift(0,t),this._bodyContainer.shift(0,t),this._focusView.resetSize(),this._centralPt.y+=t,this._updateScroll();t=this._columnLevelHeights[e]+t;this._columnLevelHeights[e]=t},changeRowLevelWidth:function(e,t){_trace("changeRowLevelHeight "+e+t),this._headerView.changeWidth(e,t),this._rowView.changeWidth(e,t),this._colContainer.shift(t,0),this._bodyContainer.shift(t,0),this._focusView.resetSize(),this._centralPt.x+=t,this._updateScroll();t=this._rowLevelWidths[e]+t;this._rowLevelWidths[e]=t},_registerListners:function(){var e=this._element;this._addListener(_win,"focus",this._focusHandlerFireFox.bind(this),!0),this._addListener(_win,"focusin",this._focusinHandler.bind(this),!0),this._addListener(e,"keydown",this._keyDownHandler.bind(this),!1),this._addListener(e,"keyup",this._keyUpHandler.bind(this),!1),this._addListener(e,"keypress",this._keyPressHandler.bind(this),!1),this._addListener(e,"click",this._clickHandler.bind(this),!1),this._addListener(e,"dblclick",this._dblclickHandler.bind(this),!1),this._addListener(e,"mousedown",this._globalMouseDownHandler.bind(this),!1),this._addListener(e,"mousedown",this._mouseDownHandler.bind(this),!1),this._addListener(_win,"mousemove",this._mouseMoveHandler.bind(this),!1),this._addListener(_win,"mouseup",this._mouseUpHandler.bind(this),!1),this._addListener(e,"mouseenter",this._mouseEnterHandler.bind(this),!1),this._addListener(e,"mouseleave",this._mouseLeaveHandler.bind(this),!1),this._addListener(e,"mouseover",this._mouseOverHandler.bind(this),!1),this._addListener(e,"touchstart",this._touchStartHandler.bind(this),!1),this._addListener(e,"touchmove",this._touchMoveHandler.bind(this),!1),this._addListener(e,"touchend",this._touchEndHandler.bind(this),!1),this._addListener(e,"touchcancel",this._touchCancelHandler.bind(this),!1),this._addListener(e,"touchleave",this._touchLeaveHandler.bind(this),!1),e.ondragstart=function(){return!1},_isFirefox?this._addListener(e,"DOMMouseScroll",this._mouseScrollHandler.bind(this),!1):this._addListener(e,"mousewheel",this._mouseWheelHandler.bind(this),!1)},_addListener:function(e,t,i,s){e in this._eventHandlers||(this._eventHandlers[e]={}),t in this._eventHandlers[e]||(this._eventHandlers[e][t]=[]),this._eventHandlers[e][t].push([i,s]),Dom.addEventListener(e,t,i,s),this._eventNodes.indexOf(e)<0&&this._eventNodes.push(e)},_removeListenerAll:function(){for(var e=this._eventNodes,t=0,i=e.length;t<i;t++){var s=e[t];if(s in this._eventHandlers){var n,o=this._eventHandlers[s];for(n in o){for(var r=o[n],l=r.length;l--;){var a=r[l];Dom.removeEventListener(s,n,a[0],a[1]),delete r[l]}delete o[n]}delete this._eventHandlers[s]}delete e[t]}},_createDefaultTool:function(){return new DefaultPivotUITool(this)},$_initLabelPoints:function(e,t,i,s,n,o,r,l,a,h){s&&o&&l(t,i,!0,r,h,a);for(var u=0,c=e.length;u<c;u++){var d=e[u],_=t.concat(d.name),f=i.concat(d.value);d.hasOwnProperty("childs")&&d.expand?this.$_initLabelPoints(d.childs,_,f,n,n,o,r,l,a,h):l(_,f,!1,r,h,a)}s&&!o&&l(t,i,!0,r,h,a)},$_addColumnPoints:function(e,t,i,s,n,o){for(var r=this._columnPoints.length,l=this._columnPoints[r-1],a=0;a<o.length;a++){var h,u=this.$_findColumnWidth(e.concat(CellIndex.ATTR_VFIELD),t.concat(o[a]),i);_defined(u)||(u=s[a],n&&null!==(h=n(e,t,i,o[a],u))&&!isNaN(h)&&(u=h<=0?0:this._groupOptions.isExpanderVisible()?Math.max(CELL_MIN_WIDTH+15,h):Math.max(CELL_MIN_WIDTH,h))),this._columnPoints.push(l+u),l+=u}},$_addRowPoints:function(e,t,i,s,n){var o=this._rowPoints.length,o=this._rowPoints[o-1],r=this.$_findRowHeight(e,t,i);_defined(r)||(r=s,n&&null!==(s=n(e,t,i,r))&&!isNaN(s)&&(r=Math.max(CELL_MIN_HEIGHT,s))),this._rowPoints.push(o+r)},$_findColumnWidth:function(e,t,i){for(var s={},n=e.length;n--;)s[e[n]]=t[n];for(i&&(s[CellIndex.ATTR_ISSUM]=!0),n=this._columnWidths.length;n--;){var o=this._columnWidths[n];if(_equalsObjEx(s,o,"width"))return o.width}return null},$_findRowHeight:function(e,t,i){for(var s={},n=e.length;n--;)s[e[n]]=t[n];i&&(s[CellIndex.ATTR_ISSUM]=!0);for(n=this._rowHeights.length;n--;){var o=this._rowHeights[n];if(_equalsObjEx(s,o,"height"))return o.height}return null},$_calcLabelPoints:function(){var e=this._dataSource,t=this._displayOptions,i=t.columnWidth(),s=t.columnHeight(),n=t.rowHeight(),o=t.rowLabelWidth(),r=t.rowGroupWidth(),l=this._summaryOptions,a=l.columnPosition()==SummaryPosition.FIRST,h=l.rowPosition()==SummaryPosition.FIRST,u=l.isColumnVisible(),c=l.isColumnGroupVisible(),d=l.isRowVisible(),l=l.isRowGroupVisible(),_=e.fieldManager(),e=_.getValueNames(),f=e.length,p=_.columnCount(),m=_.rowCount(),g=this._columnDepth=_max(p+(1<f?1:0),u?1:0),v=this._rowDepth=_max(m,d?1:0),p=t.labelTextWidth(),C=(this._columnPoints=[0],this._rowPoints=[0],[]);for(T=0;T<f;T++){var w=_.getValue(T);C.push(w.width()||i)}var y=t.columnSizeCallback();for(this.$_initLabelPoints(this._columnLabels,[],[],u,c,a,C,this.$_addColumnPoints.bind(this),e,y),y=t.rowSizeCallback(),this.$_initLabelPoints(this._rowLabels,[],[],d,l,h,n,this.$_addRowPoints.bind(this),void 0,y),this._columnHeight=0,this._columnLevelHeights.length=g,T=0;T<g;T++)this._columnLevelHeights[T]=s,this._columnHeight+=this._columnLevelHeights[T];for(var b=this._headerView.rowFields(),E=_.getRows(),u=this._headerView.valueFields(),c=_.getValues(),S=!b||!E||b.length!==E.length,T=0;!S&&T<b.length;T++)S=b[T].$_hash!==E[T].$_hash;var a=!u||!c||u.length!==c.length,x=this._rowLevelWidths;if(S)for(this._rowWidth=0,x.length=v,T=0;T<v;T++)x[T]=T==v-1?o:r,T<m&&(w=_.getRow(T)).width()&&(x[T]=w.width()),this._rowWidth+=x[T];if(0<p&&(this._labelTextWidth!==p||S||a)){var L=_max(v,f)*p;if(this._rowWidth<L){for(var D=0,T=0;T<v-1;T++)D+=x[T]=_round(x[T]*(L/this._rowWidth));x[v-1]=L-D,this._rowWidth=L}this._labelTextWidth=p}},_updateScroll:function(e){e||(e=this.clientRect()).inflate(0,0,-this._spaceWidth,-this._spaceHeight),this._scrollContainer.updateScroll(e,this._colsWidth,this._rowsHeight,this._centralPt.x,this._centralPt.y)},$_getCurrentValue:function(e){var t=this._bodyView.getFocusCell();return e?t.text():t.value()},$_prepareLabels:function(e,t){function n(e,t,i){for(var s=e.length;s--;)e[s].hasOwnProperty("childs")&&(e[s].expand=t<i,t+1<i&&n(e[s].childs,t+1,i))}this._columnLabels=_clone(e),this._rowLabels=_clone(t);e=this._groupOptions.columnExpand(),n(this._columnLabels,0,-1==e?MAX_INT:e),t=this._groupOptions.rowExpand();n(this._rowLabels,0,-1==t?MAX_INT:t)},_doLayoutContent:function(i){function e(){this._bodyView.layoutContent(function(){setTimeout(function(){this._bodyContainer.addChild(this._bodyView),this._colContainer.addChild(this._columnView),this._rowContainer.addChild(this._rowView),this._displayOptions.isShowFocus()&&this._bodyContainer.addChild(this._focusView),i&&i()}.bind(this))}.bind(this));var e=this._scrollContainer.clientWidth(),t=this._scrollContainer.clientHeight();this._bodyWidth=e-this._centralPt.x,this._bodyHeight=t-this._centralPt.y,this._colContainer.resize(e-this._centralPt.x,t),this._rowContainer.resize(e,t-this._centralPt.y),this._headerView.setWidth(e),this._fillLayouted=!0,this._layouting=!1}var t,s,n=this._dataSource,o=n.fieldManager(),r=this._tmpHeaderOptions,l=this._tmpDisplayOptions,a=l.isShowProgress()&&!this._progressSorting,h=this.clientRect(),u=this._layerView,c=(this._layouting=!0,this._fillLayouted&&(this._scrollContainer.setLeftPos(0),this._scrollContainer.setTopPos(0)),a&&(this._colContainer.removeChild(this._columnView),this._rowContainer.removeChild(this._rowView),this._bodyContainer.removeChild(this._bodyView)),this._bodyContainer.removeChild(this._focusView),this._columnView._clearCells(),this._rowView._clearCells(),this._bodyView._clearCells(),u.setRect(h),h.clone()),d=(c.inflate(0,0,-this._spaceWidth,-this._spaceHeight),n.isEmpty()),_=n.isDataEmpty();d||_?(this._noreadyView.setVisible(d),this._emptyView.setVisible(!d),this._headerView.setVisible(!1),this._scrollContainer.setVisible(!1),c.inflate(-1,-1),d?(this._noreadyView.setRectI(c),this._noreadyView.layoutContent()):(this._emptyView.setRectI(c),this._emptyView.layoutContent())):(this._noreadyView.setVisible(!1),this._emptyView.setVisible(!1),this._scrollContainer.setVisible(!0),this._headerView.setVisible(!0),this._progressSorting||this.$_prepareLabels(n.getColumnLabels(),n.getRowLabels()),this.$_calcLabelPoints(),0<(d=2*(_=this._titleHeight=r.formType()==HeaderFormType.NORMAL&&(r.isTitleVisible()||r.isColumnHeadVisible())?r.titleHeight():0)-this._columnHeight)&&(this._columnHeight+=d,this._columnLevelHeights[this._columnLevelHeights.length-1]+=d),this._centralPt.set(this._rowWidth,_+this._columnHeight),r=this._colsWidth=this._columnPoints[this._columnPoints.length-1],d=this._rowsHeight=this._rowPoints[this._rowPoints.length-1],this._updateScroll(c),this._scrollContainer.isHscrollable()&&(c.height-=this._scrollContainer.scrollBarSize()),this._scrollContainer.isVscrollable()&&(c.width-=this._scrollContainer.scrollBarSize()),t=c.width-this._centralPt.x,s=c.height-this._centralPt.y,this._rowContainer.setBounds(0,this._centralPt.y,c.width,s),this._colContainer.setBounds(this._centralPt.x,_,t,c.height),this._columnView.setBounds(0,0,r,this._centralPt.y-_),this._columnView.setLabels(this._columnLabels),this._columnView.setDepth(this._columnDepth),this._columnView.setValues(o.getValues()),this._rowView.setBounds(0,0,this._centralPt.x,d),this._rowView.setLabels(this._rowLabels),this._rowView.setDepth(this._rowDepth),(_=c.clone()).height=this._centralPt.y,this._headerView.setColumnFields(o.getColumns()),this._headerView.setRowFields(o.getRows()),this._headerView.setValueFields(o.getValues()),this._headerView.setRectI(_),this._headerView.layoutContent(),this._bodyContainer.setBounds(this._centralPt.x,this._centralPt.y,t,s),this._focusView.setGuideVisible(l.isShowFocusGuide()),this._focusView.resetSize(),c=new Rectangle(0,0,r,d),this._bodyView.setRectI(c),this._bodyView.setColumnView(this._columnView),this._bodyView.setRowView(this._rowView),this._bodyView.setValueFields(o.getValues()),this._bodyView.setValues(n._values),this._bodyView.setSummaries(n._summaries),this._columnView.layoutContent(),this._rowView.layoutContent(),a?setTimeout(function(){e.call(this)}.bind(this),100):e.call(this)),this._layouted=!0,this._progressSorting=!1,setTimeout(function(){u.getChild(0).resize(h.width,h.height)})},_doRender:function(e){},onPivotModelManagerBuild:function(){this._layouted&&this.layoutContent()},onFocusElementMoved:function(e,t){this._fireCurrentChanged(t)},isShowProgressive:function(e){return this.tmpDisplayOptions()&&this.tmpDisplayOptions().isShowProgress()},onSetupProgress:function(e,t,i){this.showMask(),this._tooltipManager.close(),this.showProgress(t,i)},onProgressProperty:function(e,t){this.setCurrentProgress(t)},onCompleteProgress:function(){this.closeProgress(),this.hideMask(!0)},draw:function(e){this._tmpDisplayOptions.assign(this._displayOptions),this._tmpSummaryOptions.assign(this._summaryOptions),this._tmpHeaderOptions.assign(this._headerOptions),this._scrollContainer.setScrollUnitSize(this._tmpDisplayOptions.rowHeight()),this.layoutContent(e)},getOptions:function(){return{display:this.getDisplayOptions(),summary:this.getSummaryOptions(),header:this.getHeaderOptions(),copy:this.getCopyOptions(),group:this.getGroupOptions()}},setOptions:function(e){e.display&&this.setDisplayOptions(e.display),e.summary&&this.setSummaryOptions(e.summary),e.header&&this.setHeaderOptions(e.header),e.copy&&this.setCopyOptions(e.copy),e.group&&this.setGroupOptions(e.group)},getDisplayOptions:function(){return this._displayOptions.proxy(!1)},setDisplayOptions:function(e){this._displayOptions.assign(e)},getSummaryOptions:function(){return this._summaryOptions.proxy(!1)},setSummaryOptions:function(e){this._summaryOptions.assign(e)},getHeaderOptions:function(){return this._headerOptions.proxy(!1)},setHeaderOptions:function(e){this._headerOptions.assign(e)},getCopyOptions:function(){return this._copyOptions.proxy(!1)},setCopyOptions:function(e){this._copyOptions.assign(e)},getGroupOptions:function(){return this._groupOptions.proxy(!1)},setGroupOptions:function(e){this._groupOptions.assign(e)},changeClientSize:function(e,t,i,s,n){n=4<arguments.length?n:LayoutMode.CELL;e instanceof RowLevelResizeTracker?this._rowWidth=this.getRowLevelSumWidth():this._colsWidth+=i,this._rowsHeight+=s,this._scrollContainer.clientWidth();var o=this._scrollContainer.clientHeight(),r=(this._updateScroll(),this._scrollContainer.clientWidth()),l=this._scrollContainer.clientHeight(),a=r-this._centralPt.x,h=l-this._centralPt.y,r=(this._colContainer.resize(a,l),this._rowContainer.resize(r,h),this._bodyContainer.resize(a,h),this._focusView.resetSize(),l-o),h=this._rowView.height()+s+r;this._bodyWidth=a,this._bodyHeight+=r,this._columnView.setWidth(this._colsWidth),this._rowView.setHeight(h),this._bodyView.setBounds(0,0,this._colsWidth,h),this._bodyView.updateCells(n,t)},watchDisplay:function(e){e?this._watchObserver.start():this._watchObserver.stop()},setCursor:function(e){this._css.cursor=e},resetSize:function(){var e,t,i=this._container.getBoundingClientRect(),s=(this._calcOuterSpace(),this.setBounds(0,0,i.width-this._spaceWidth,i.height-this._spaceHeight),this._container.getBoundingClientRect());i.width==s.width&&i.height==s.height||(s.width-=this._spaceWidth,s.height-=this._spaceHeight,this.setBounds(0,0,(i=s).width-this._spaceWidth,i.height-this._spaceHeight)),this._fillLayouted&&(this._updateScroll(),(s=this.clientRect()).inflate(0,0,-this._spaceWidth,-this._spaceHeight),this._scrollContainer.isHscrollable()&&(s.height-=this._scrollContainer.scrollBarSize()),this._scrollContainer.isVscrollable()&&(s.width-=this._scrollContainer.scrollBarSize()),(i=this._layerView.getChild(0))&&i.resize(s.width,s.height),i=this._scrollContainer.clientWidth(),s=this._scrollContainer.clientHeight(),e=i-this._centralPt.x,t=s-this._centralPt.y,this._bodyWidth=e,this._bodyHeight=t,this._headerView.setWidth(i),this._colContainer.resize(e,s),this._rowContainer.resize(i,t),this._bodyContainer.resize(e,t),this._focusView.resetSize(),this._bodyView.updateCells(LayoutMode.RESIZE,e,t))},scrollTo:function(e,t,i){var s,n=this._tmpDisplayOptions.isVirtualRendering(),o=(this._displayOptions.isShowFocus(),null!=t&&this._topPos!=t);null!=e&&this._leftPos!=e&&(s=e-this._leftPos,this._columnView.scroll(s,0),this._layouting||(n?this._bodyView.updateCells(LayoutMode.SCROLL,s,0,function(){o||i&&i()}):(this._bodyView.offset(-s,0),i&&i())),this._leftPos=e),o&&(s=t-this._topPos,this._rowView.scroll(0,s),this._layouting||(n?this._bodyView.updateCells(LayoutMode.SCROLL,0,s,i):(this._bodyView.offset(0,-s),i&&i())),this._topPos=t),this._focusView.scrollTo(e,t)},sort:function(e){var t,i,s=this._dataSource.fieldManager(),n=e.column,o=e.row,e=!1;if(s.clearValueSort(),n&&n.method===SortMethod.LABEL){for(var r=0;r<n.labels.length;r++)(t=s.getFieldByName(n.labels[r].name))&&t.setSortDir(n.labels[r].direction);for(var l=s._columns,a=[],h=[],r=0;r<l.length;r++)a[r]=l[r].sortDir(),h[r]=l[r].sortCallback();e=!0,this.$_doSortByValue(this._columnLabels,a,h,0)}if(o&&o.method===SortMethod.LABEL){for(r=0;r<o.labels.length;r++)(t=s.getFieldByName(o.labels[r].name))&&t.setSortDir(o.labels[r].direction);l=s._rows,a=[],h=[];for(r=0;r<l.length;r++)a[r]=l[r].sortDir(),h[r]=l[r].sortCallback();e=!0,this.$_doSortByValue(this._rowLabels,a,h,0)}o&&o.method===SortMethod.VALUE&&((i=i||{}).row=o),n&&n.method===SortMethod.VALUE&&((i=i||{}).column=n),i&&this.$_sortByRef(i,!1),(e||i)&&(this._progressSorting=!0,this.layoutContent())},$_prepareLevelCells:function(e){for(var t={},i=this._dataSource.fieldManager().getValues(),s=i.length,n=this._rowLevelWidths.length+1,o=1<s?this._columnLevelHeights.length:this._columnLevelHeights.length+1,r=0;r<s;r++)for(var l=i[r],a=t[l.name()]=[],h=0;h<n;h++)for(var u=a[h]=[],c=0;c<o;c++){var d=h==n-1&&c==o-1?new ValueCellElement(this):new SummaryCellElement(this,h,c);d.setValueField(l),d.draw(),e.appendChild(d._element),u[c]=d}return t},$_disposeLevelCells:function(e,t){for(var i in t){for(var s=t[i],n=s.length;n--;){for(var o=s[n],r=o.length;r--;){var l=o[r];l.destroy(),l[r]=null}o=s[n]=null}t[i]=null}},export:function(e){var t=_doc.createElement("div"),i=(t.className="realpivot-body",this.$_prepareLevelCells(t)),s=(this._element.appendChild(t),this._exporter||(this._exporter=new GridExcelExporter),e.done);e.done=function(){this.$_disposeLevelCells(t,i),s&&s()}.bind(this),this._exporter.export(this,e,i),this._element.removeChild(t)},expandPartialGroup:function(e){var t=e.type()==FieldType.COLUMN?this._columnView:this._rowView;this.$_calcLabelPoints(),this._colsWidth=this._columnPoints[this._columnPoints.length-1],this._rowsHeight=this._rowPoints[this._rowPoints.length-1],this._bodyView.backupFocusLabel(),t.layoutContent(),this._bodyView.restoreFocusLabel(),this._columnView.setWidth(this._colsWidth),this._rowView.setHeight(this._rowsHeight),this._updateScroll(),this._bodyView.inflate(this._colsWidth,this._rowsHeight),this._bodyView.updateCells(LayoutMode.CELL,e)},$_expandToLevel:function(e,t,i){for(var s=t<i,n=e.length;n--;)(e[n].expand=s)&&e[n].hasOwnProperty("childs")&&this.$_expandToLevel(e[n].childs,t+1,i)},$_expandTree:function(e,t,i){for(var s=t[i]||null,n=e.length;n--;)if(e[n].value==s&&(e[n].expand=!0,t.length-1>i&&e[n].hasOwnProperty("childs"))){this.$_expandTree(e[n].childs,t,i+1);break}},$_collapseTree:function(e,t,i){for(var s=t[i]||null,n=e.length;n--;)if(e[n].value==s)if(i==t.length-1)e[n].expand=!1;else if(t.length-1>i&&e[n].hasOwnProperty("childs")){this.$_collapseTree(e[n].childs,t,i+1);break}},expandColumnLevel:function(e){this._columnLabels&&0<this._columnLabels.length&&(this.$_expandToLevel(this._columnLabels,0,-1==e?MAX_INT:e),this.expandPartialGroup(this._columnView.rootElement()))},expandRowLevel:function(e){this._rowLabels&&0<this._rowLabels.length&&(this.$_expandToLevel(this._rowLabels,0,-1==e?MAX_INT:e),this.expandPartialGroup(this._rowView.rootElement()))},expandColumn:function(e,t){this._columnLabels&&0<this._columnLabels.length&&(t?this.$_expandTree(this._columnLabels,e,0):this.$_collapseTree(this._columnLabels,e,0),this.expandPartialGroup(this._columnView.rootElement()))},expandRow:function(e,t){this._rowLabels&&0<this._rowLabels.length&&(t?this.$_expandTree(this._rowLabels,e,0):this.$_collapseTree(this._rowLabels,e,0),this.expandPartialGroup(this._rowView.rootElement()))},$_labelExpanded:function(e,t,i){if(t.hasOwnProperty(i))for(var s=0;s<e.length;s++){var n=e[s];if(n.value==t[i])return n.expand&&t.hasOwnProperty(i+1)&&n.hasOwnProperty("childs")?this.$_labelExpanded(n.childs,t,i+1):n.expand}},columnExpanded:function(e){var t=makeArray(this._columnLabels,!0),i=this._dataSource.fieldManager().getColumnNames();return e=_isArray(e)?e:_isObject(e)?objToArrayName(i,e):null!=e?makeArray(e):e,this.$_labelExpanded(t,makeArray(e,!0),0)},rowExpanded:function(e){var t=makeArray(this._rowLabels,!0),i=this._dataSource.fieldManager().getRowNames();return e=_isArray(e)?e:_isObject(e)?objToArrayName(i,e):null!=e?makeArray(e):e,this.$_labelExpanded(t,makeArray(e,!0),0)},showMask:function(){this._maskView.show()},hideMask:function(){this._maskView.hide()},showProgress:function(e,t){this._progressManager.show(t,!1),this._progressMin=0,this._progressCurr=0,this._progressMax=e,this._progressManager.setProperties(this._progressMin,e,this._progressCurr)},completeProgress:function(){this._progressManager.setProperties(this._progressMin,this._progressMax,this._progressMax)},setCurrentProgress:function(e){this._progressCurr=e,this._progressManager.setProperties(this._progressMin,this._progressMax,this._progressCurr)},closeProgress:function(){this._progressManager.close()},addLayerElement:function(e){return!(!e||this._layerView.contains(e))&&(this._layerView.addChild(e),!0)},removeLayerElement:function(e){return!!this._layerView.contains(e)&&(this._layerView.removeChild(e),!0)},toOffset:function(e){var t=this._element.getBoundingClientRect();return e.mouseX=e.clientX-t.left,e.mouseY=e.clientY-t.top,e},toScreen:function(e){return e.x+=this._offsetX,e.y+=this._offsetY,e},toScreenPt:function(e){e.x+=this._offsetX,e.y+=this._offsetY},isPopuped:function(){return this._setupView&&this._setupView.isActive()||this._contextMenuManager&&this._contextMenuManager.isVisible()||this._setupView&&this._setupView._valueConfigView&&this._setupView._valueConfigView.isActive()||this._progressManager&&this._progressManager.isActive()},focus:function(){this._element.focus()},getGlobalContextMenu:function(){return this._globalContextItems.slice()},setGlobalContextMenu:function(e){e&&_isFillArray(e)?this._globalContextItems=this._defContextItems.concat({text:"-"}).concat(e.slice()):this._globalContextItems=this._defContextItems.slice()},showGlobalContextMenu:function(e,t){this._contextMenuManager.isVisible()&&this._contextMenuManager.close(),this._contextMenuManager.setItems(this._globalContextItems),this._contextMenuManager.show(e,t)},$_contextMenuHandler:function(e){e.target||e.srcElement;var t=this._element.getBoundingClientRect(),i=e.clientX-t.left,t=e.clientY-t.top,s=this.findChildAt(i,t);this._contextItems&&(e.preventDefault(),this._contextMenuManager.isVisible()&&this._contextMenuManager.close(),this._contextMenuManager.setItems(this._contextItems),this._contextMenuManager.show(i,t,s))},$_aboutMenuHandler:function(){alert("RealPivot version "+RealPivotClass.getVersion())},$_doSortByValue:function(e,t,i,s){var n=this._dataSource;if(0<e.length)for(var o=0;o<e.length;o++){var r=e[o];r&&r.childs&&0<r.childs.length&&this.$_doSortByValue(r.childs,t,i,s+1)}var l=t[s],a=i[s];a?e.sort(a):e.sort(l==SortDirection.DESCENDING?n.$_compareDescByValue:n.$_compareByValue)},$_sortByValue:function(e,t){var i=e.type(),s=this.dataSource().fieldManager(),n=e.getField(t.target),o=i===FieldType.ROW?s._rows:s._columns,e=i===FieldType.ROW?this._rowLabels:this._columnLabels,t=n._sortDir===SortDirection.ASCENDING?SortDirection.DESCENDING:SortDirection.ASCENDING,r={name:n.name(),direction:n.sortDir()},l={name:n.name(),direction:t};if(this.fireConfirmEvent(PivotView.SORTING,i,r,l)){var a=[],h=[];s.clearValueSort(),n.setSortDir(t);for(var u=0;u<o.length;u++)a[u]=o[u].sortDir(),h[u]=n.sortCallback();this._progressSorting=!0,this.$_doSortByValue(e,a,h,0),this.layoutContent()}},_doSort:function(e,t){var i=e.type(),s=e.getField(t.target);s&&(i===FieldType.ROW||i===FieldType.COLUMN?this.$_sortByValue(e,t):(i=this._setupView._valueConfigView,e=this._dataSource._fieldManager,t=new ValueSetupModel(this,s,e),i.showByPivot(this,t,this.$_applyValueSetup)))},$_doSortByColumnRef:function(e,t,i){var s=this._dataSource;if(0<e.length)for(var n=0;n<e.length;n++){var o=e[n],r=t[o.value];o.refCount=r&&r.count,o.refValue=r&&r.value,o&&o.childs&&0<o.childs.length&&this.$_doSortByColumnRef(o.childs,r.cols,i)}e.sort(i==SortDirection.DESCENDING?s.$_compareDescByRefValue:s.$_compareByRefValue)},$_doSortByRowRef:function(e,t,i,s){var n=this._dataSource;if(0<e.length)for(var o=0;o<e.length;o++){for(var r=e[o],l=t[r.value],a=l,h=0;h<i.length;h++)a=a&&a.cols[i[h]];r.refCount=a?a.count:void 0,r.refValue=a?a.value:void 0,r&&r.childs&&0<r.childs.length&&this.$_doSortByRowRef(r.childs,l.rows,i,s)}e.sort(s==SortDirection.DESCENDING?n.$_compareDescByRefValue:n.$_compareByRefValue)},$_sortByRef:function(e,t){e.column,e.row;var i,s=this._dataSource;if(i=e.column){if(n=i.direction,o=i.conditions,r=i.fieldName,l=s._values[r],o&&0<o.length)for(let e=0;e<o.length;e++)l=l&&l.rows[o[e].value];this.$_doSortByColumnRef(this._columnLabels,l&&l.cols,n)}if(e=e.row){var n=e.direction,o=e.conditions,r=e.fieldName,l=s._values[r],a=[];if(o&&0<o.length)for(let e=0;e<o.length;e++)a.push(o[e].value);this.$_doSortByRowRef(this._rowLabels,l&&l.rows,a,n)}(i||e)&&(this._progressSorting=!0,(r=s.fieldManager()).clearValueSort(),i&&r.setValueSort(FieldType.COLUMN,i.fieldName,i.direction,i.conditions),e&&r.setValueSort(FieldType.ROW,e.fieldName,e.direction,e.conditions)),t&&this.layoutContent()},$_applyValueSetup:function(e,t){var i,s;t&&(t={},i={},s=e.dataField(),e.isColumnSort()?(t.fieldName=s.name(),t.direction=e.columnSortDir(),t.conditions=e.columnSortConditions()):t=null,e.isRowSort()?((i={}).fieldName=s.name(),i.direction=e.rowSortDir(),i.conditions=e.rowSortConditions()):i=null,s.setNumberFormat(e.numberFormat()||null),s.setValueAlignment(e.valueAlignment()||null),this.$_sortByRef({column:t,row:i},!0)),e.destroy()},getContextMenu:function(){return this._contextItems.slice()},setContextMenu:function(e){e?(Dom.addEventListener(this._element,"contextmenu",this.$_contextMenuHandler.bind(this),!1),this._contextItems=e.slice()):(this._contextItems=null,Dom.removeEventListener(this._element,"contextmenu",this.$_contextMenuHandler.bind(this),!1))},getClipboardValue:function(){var e=this._copyOptions.isCopyDisplayText();return this.$_getCurrentValue(e)},getCurrent:function(){var e=this._bodyView,t=e&&e._focusRowLabel,e=e&&e._focusColLabel,i={};return t&&e?(i.columns=e._cellIndex._columns,i.rows=t._cellIndex._rows,i.valueField=e._valueField.name(),i.rowPath=this._bodyView._focusRowLabel.treePath(),i.colPath=this._bodyView._focusColLabel.treePath(),i):null},_fireClick:function(e,t){var i;e instanceof LabelCellElement||e instanceof BodyCellElement?(i=(i=e.getCellIndex())?i.toProxy():null,this.fireEvent(PivotView.CLICK,e instanceof LabelCellElement?e.type():"body",i)):e instanceof FieldHeaderCellElement&&this._headerOptions.isHeaderSortable()&&this._doSort(e,t)},_fireDblClick:function(e){var t;(e instanceof LabelCellElement||e instanceof BodyCellElement)&&(t=(t=e.getCellIndex())?t.toProxy():null,this.fireEvent(PivotView.DBL_CLICK,e instanceof LabelCellElement?e.type():"body",t))},_fireShowTooltip:function(e,t){return e=e?e.toProxy():null,this.fireObjectEvent(PivotView.SHOW_TOOLTIP,e,t)},_fireShowLabelTooltip:function(e,t){return e=e?e.toProxy():null,this.fireObjectEvent(PivotView.SHOW_LABEL_TOOLTIP,e,t)},_fireCurrentChanged:function(e){e?(e=(e=e.getCellIndex())?e.toProxy():null,this.fireEvent(PivotView.CURRENT_CHANGED,e)):this.fireEvent(PivotView.CURRENT_CHANGED,null)},_fireSetupChanging:function(e,t){return this.fireConfirmEvent(PivotView.SETUP_CHANGING,e,t)},_keyDownHandler:function(e){this._activeTool&&(_isMac&&e.metaKey||(_isMac||e.ctrlKey),this._activeTool.keyDown(e.keyCode,e.ctrlKey,e.shiftKey,e.altKey)||e.preventDefault())},_keyUpHandler:function(e){this._activeTool&&(_isMac&&e.metaKey||(_isMac||e.ctrlKey),this._activeTool.keyUp(e.keyCode,e.ctrlKey,e.shiftKey,e.altKey))},_keyPressHandler:function(e){this._activeTool&&this._activeTool.keyPress(e.keyCode)},_clickHandler:function(e){this._activeTool&&this._activeTool.click(this.toOffset(e))},_dblclickHandler:function(e){this._activeTool&&this._activeTool.dblclick(this.toOffset(e))},_globalMouseDownHandler:function(e){if(this._contextMenuManager.isVisible()){for(var t=e.target;t&&!t.menuItem;)t=t.parentNode;t||this._contextMenuManager.close()}},_mouseDownHandler:function(e){this._activeTool&&this._activeTool.mouseDown(this.toOffset(e))},_mouseMoveHandler:function(e){this._activeTool&&this._activeTool.mouseMove(this.toOffset(e))},_mouseUpHandler:function(e){this._activeTool&&this._activeTool.mouseUp(this.toOffset(e))},_mouseEnterHandler:function(e){this._activeTool&&this._activeTool.mouseEnter(this.toOffset(e))},_mouseLeaveHandler:function(e){this._activeTool&&this._activeTool.mouseLeave(this.toOffset(e))},_mouseOverHandler:function(e){this._activeTool&&this._activeTool.mouseLeave(this.toOffset(e))},_mouseWheelHandler:function(e){this._activeTool&&this._activeTool.mouseWheel(this.toOffset(e))&&_stopEvent(e)},_mouseScrollHandler:function(e){this._activeTool&&(e.wheelDelta=3*-e.detail,this._activeTool.mouseWheel(this.toOffset(e))&&_stopEvent(e))},_touchStartHandler:function(e){this._activeTool&&this._activeTool.touchStart(e)},_touchMoveHandler:function(e){this._activeTool&&this._activeTool.touchMove(e)},_touchEndHandler:function(e){this._activeTool&&this._activeTool.touchEnd(e)},_touchCancelHandler:function(e){this._activeTool&&this._activeTool.touchCancel(e)},_touchLeaveHandler:function(e){this._activeTool&&this._activeTool.touchEnd(e)},_focusinHandler:function(e){e.target===this._element&&this._activeTool&&this._activeTool.setFocus(!0)},_focusHandlerFireFox:function(e){e.target===this._element&&this._activeTool&&this._activeTool.setFocus(!0)},_focusoutHandler:function(e){e.target===this._element&&this._activeTool&&this._activeTool.setFocus(!1)},_blurHandler:function(e){e.target===this._element&&this._activeTool&&this._activeTool.setFocus(!1)},onSetupChanging:function(e,t,i){return this.fireConfirmEvent(PivotView.SETUP_CHANGING,t,i)}}),PivotSetupField=(PivotView.CLICK="onPivotViewClick",PivotView.DBL_CLICK="onPivotViewDblClick",PivotView.SHOW_TOOLTIP="onPivotViewTooltip",PivotView.SHOW_LABEL_TOOLTIP="onPivotViewLabelTooltip",PivotView.CURRENT_CHANGED="onPivotViewCurrentChanged",PivotView.SETUP_CHANGING="onPivotViewSetupChanging",PivotView.SORTING="onPivotViewSorting",defineClass("PivotSectionField",VisualElement,{init:function(e,t,i){this._super(),this._owner=e,this._section=t,this._dataField=i,this._name=i.name(),this.setCssClass("realpivot-setup-field"),this._removerVisible=!1,this._createElements()},destroy:function(){this._removeImg=null,this._dataField=null,this._super()},name:null,dataField:null,section:null,_createElements:function(){var e=this._dataField.getFieldHeader(),t=_doc.createElement("span");t.className="realpivot-setup-field",t.innerText=e,this._element.appendChild(t),this._section.type()!=FieldRole.NONE&&((e=this._removeImg=_doc.createElement("div")).className="realpivot-setup-field-remove",this._element.appendChild(e),Dom.addEventListener(e,"click",this.$_removerClick.bind(this),!1))},$_removerClick:function(e){this.fireEvent(PivotSetupField.REMOVE_CLICK,this)}})),PivotSetupLabelField=(PivotSetupField.REMOVE_CLICK="onPivotSetupFieldRemoveClick",defineClass("PivotSectionLabelField",PivotSetupField,{init:function(e,t,i){this._super(e,t,i),Dom.addEventListener(this._element,"click",this.$_click.bind(this),!1)},destroy:function(){Dom.removeEventListener(this._element,"click",this.$_click.bind(this),!1),this._super()},sortDir:SortDirection.ASCENDING,_createElements:function(){this._super(),this._sortImg=_doc.createElement("div"),this._setSortDir(this._dataField.sortDir()),this._element.appendChild(this._sortImg)},_setSortDir:function(e){this._sortImg&&(e=e==SortDirection.NONE?SortDirection.NONE:e==SortDirection.DESCENDING?SortDirection.DESCENDING:SortDirection.ASCENDING,this._sortDir=e,this._sortImg.className="realpivot-setup-field-sort-"+(e==SortDirection.ASCENDING?"asc":e==SortDirection.DESCENDING?"desc":"none"))},$_click:function(e){var t;this._dataField&&!this._dataField.sortCallback()&&(t=(t=this._sortDir)==SortDirection.ASCENDING?SortDirection.DESCENDING:t==SortDirection.ASCENDING,this._setSortDir(t))}})),PivotSetupValueField=defineClass("PivotSetupValueField",PivotSetupField,{init:function(e,t,i){this._super(e,t,i);e=this._owner.dataProvider().fieldManager(),t=i._owner._options.defaultExpression();this.setExpression(i.expression()||t),this._numberFormat=i.numberFormat(),this._valueAlignment=i.valueAlignment(),this.$_assignFrom(e)},destroy:function(){Dom.removeEventListener(this._expressionSelect,"change",this.$_expressionChange.bind(this),!1),this._super()},expression:null,setExpression:function(e){this._expression!=e&&(this._expressionSelect&&(this._expressionSelect.value=e),this._expression=e)},columnSort:!1,rowSort:!1,columnSortDir:SortDirection.NONE,rowSortDir:SortDirection.NONE,columnSortConditions:null,rowSortConditions:null,numberFormat:null,valueAlignment:null,_createElements:function(){this._super();var e,t=this._configButton=_doc.createElement("input"),i=(t.type="button",t.className="realpivot-setup btn-default btn-small realpivot-setup-field-value",t.value=RealPivotMessages.setupPanel.valueConfigText,Dom.addEventListener(t,"click",this.$_configButtonClick.bind(this),!1),this._element.appendChild(t),this._expressionSelect=_doc.createElement("select")),t=(i.className="realpivot-setup realpivot-setup-field-value",this._owner.options()),s=this._dataField&&this._dataField.expressions()||t.expressions(),n=[];for(e in ValueType)n.push(ValueType[e].toLowerCase());for(var s=(s=s&&(s=Array.isArray(s)?s:"string"==typeof s?[s]:n).filter(function(e){return e&&e.toLowerCase()}).filter(function(e){return 0<=n.indexOf(e)}))||n,o=0;o<s.length;o++){var r=_doc.createElement("option");r.value=s[o],r.text=RealPivotMessages.valueTypeTexts[s[o]],i.appendChild(r)}Dom.addEventListener(i,"change",this.$_expressionChange.bind(this),!1),i.value=this._expression||s[0],this._element.appendChild(i)},$_assignFrom:function(e){var t=this._dataField.name(),i=e.getValueSort(FieldType.COLUMN);i&&i.fieldName==t?(this._columnSort=!0,this._columnSortDir=i.direction,this._columnSortConditions=_extend(i.conditions)):this._columnSort=!1,(i=e.getValueSort(FieldType.ROW))&&i.fieldName==t?(this._rowSort=!0,this._rowSortDir=i.direction,this._rowSortConditions=_extend(i.conditions)):this._rowSort=!1},$_expressionChange:function(e){this._expression=e.currentTarget.value},$_configButtonClick:function(e){this._owner._showValueConfigView(this),e.preventDefault()}}),PivotSetupFilterField=defineClass("PivotSectionLabelField",PivotSetupField,{init:function(e,t,i,s){this._super(e,t,i),(this._filterItem=s)&&(this._type=s.type(),this._values=s.values(),this._criteria=s.criteria())},destroy:function(){this._filterItem=null,Dom.removeEventListener(this._filterButton,"click",this.$_filterImgClick.bind(this),!1),this._super()},filterItem:null,type:FilterType.ALL,values:null,criteria:null,_createElements:function(){this._super();var e=this._filterButton=_doc.createElement("div");e.className="realpivot-setup-field-filter",Dom.addEventListener(e,"click",this.$_filterImgClick.bind(this),!1),this._element.appendChild(e)},$_filterImgClick:function(e){this._owner._showFilterView(this)}}),PivotSetupSection=defineClass("PivotSetupSection",VisualElement,{init:function(e,t,i,s){this._super(),this._owner=e,this._type=t,this._countGet=i,this._itemGet=s,this.setCssClass(t==FieldRole.NONE?"realpivot-setup-section-merged":"realpivot-setup-section"),this._showCaret=!1,this._caretIndex=-1,this.$_createDragCaret()},destroy:function(){this._itemGet=null,this._super()},type:FieldRole.NONE,isLabelSection:function(){return this._type==FieldRole.COLUMN||this._type==FieldRole.ROW},buildItems:function(){this.$_clearItems();for(var e=this._countGet(),t=0;t<e;t++){var i=this._itemGet(t),i=this.$_createField(i);this.addChild(i)}},removeField:function(e){this.removeChild(e),e.destroy()},insertFieldAtCaret:function(e){e=this.$_createField(e);-1==this._caretIndex?this.addChild(e):this.insertChildAt(e,this._caretIndex)},moveFieldToCaret:function(e){var t=this._childs.indexOf(e);t!=this._caretIndex&&t+1!=this._caretIndex&&this.moveChildTo(e,this._caretIndex)},showDragCaret:function(e){e=this.$_getDragPosition(e);-1==e?this._element.appendChild(this._dragCaret):this._element.insertBefore(this._dragCaret,this._childs[e]._element),this._showCaret=!0,this._caretIndex=e},hideDragCaret:function(){this._showCaret&&(this._element.removeChild(this._dragCaret),this._showCaret=!1,this._caretIndex=-1)},checkDragAction:function(e,t){var i,s,n,o,r,l=SetupDragAction.NONE,a=SetupDragDenied.NONE;return e.type()!=FieldRole.NONE&&this._type==FieldRole.NONE?l=SetupDragAction.REMOVE:e.type()==FieldRole.NONE&&this._type!=FieldRole.NONE?(s=(t=t.dataField()).isLabelEnable(),n=t.isValueEnable(),o=t.isFilterEnable(),r=t.labelType(),s&&this.isLabelSection()||n&&this._type==FieldRole.VALUE||o&&this._type==FieldRole.FILTER?(i=this._existField(t))?(l=SetupDragAction.DENIED,a=SetupDragDenied.DUPLICATED):!s||!this.isLabelSection()||r===LabelType.BOTH||r===LabelType.COLUMN&&this._type===FieldRole.COLUMN||r===LabelType.ROW&&this._type===FieldRole.ROW?l=SetupDragAction.ADD:(l=SetupDragAction.DENIED,a=SetupDragDenied.DISABLED):(l=SetupDragAction.DENIED,a=SetupDragDenied.DISABLED)):this==e&&this._type!=FieldRole.NONE?l=SetupDragAction.ORDER:this.isLabelSection()&&e.isLabelSection()&&(l=SetupDragAction.MOVE),{action:l,denyType:a,denySource:i}},$_clearItems:function(){for(var e=this._childs.length;e--;)this._childs[e].destroy(),this._childs[e]=null;this._childs=[]},$_createField:function(e){var t;switch(this._type){case FieldRole.COLUMN:case FieldRole.ROW:t=new PivotSetupLabelField(this._owner,this,e);break;case FieldRole.VALUE:t=new PivotSetupValueField(this._owner,this,e);break;case FieldRole.FILTER:t=e instanceof FilterItem?new PivotSetupFilterField(this._owner,this,e.field(),e):new PivotSetupFilterField(this._owner,this,e,null);break;default:t=new PivotSetupField(this._owner,this,e)}return t.addListener(this),t},_existField:function(e){for(var t=this._childs.length;t--;)if(this._childs[t].dataField()==e)return this._childs[t];return!1},$_getDragPosition:function(e){for(var t=0,i=0,s=this._childs.length;i<s;i++){var n=this._childs[i]._element;if(t+_int(n.offsetHeight/2)>e)return i;t+=n.offsetHeight}return-1},$_createDragCaret:function(){var e=this._dragCaret=_doc.createElement("div"),t=(e.className="realpivot-setup-field-dragcaret",_doc.createElement("div")),t=(t.className="realpivot-setup-field-dragcaret-rarrow",e.appendChild(t),_doc.createElement("div"));t.className="realpivot-setup-field-dragcaret-larrow",e.appendChild(t)},onPivotSetupFieldRemoveClick:function(e){this.fireEvent(PivotSetupSection.FIELD_REMOVE,e),this.removeField(e)}}),PivotSetupFilterSection=(PivotSetupSection.FIELD_REMOVE="onPivotSetupSectionFieldRemove",defineClass("PivotSetupFilterSection",PivotSetupSection,{init:function(e,t,i,s,n){this._super(e,t,s,n),this._operationGet=i},destroy:function(){this._super()},filterOp:FilterOperation.AND,buildItems:function(){this._super(),this._filterOp=this._operationGet()}})),PivotSetupView=defineClass("PivotSetupView",VisualElement,{init:function(e,t){this._super(),this._container=e,this._pivotView=t,this._dataProvider=this._pivotView.dataSource(),this._columnSection=null,this._rowSection=null,this._valueSection=null,this._filterSection=null,this._fieldSection=null,this._applyButton=null,this._cancelButton=null,this._sections={},this.setCssClass("realpivot-setup"),this._css.position="absolute",this.$_createElements(),this._maskView=new MaskElement,this.addChild(this._maskView),this._filterView=new PivotFilterSetupView(this,this._dataProvider),this._valueConfigView=new PivotValueSetupView(this,this._dataProvider),this._active=!1,this._dragging=!1,this._dragAction=SetupDragAction.NONE,this._dragField=null,this._draggingSection=null,this._draggingElement=null,this._dragMouseX=0,this._dragMouseY=0,this._viewDragging=!1,this._options=new SetupOptions(this),Dom.addEventListener(_doc,"mousedown",this.$_dragMouseDown.bind(this),!1),Dom.addEventListener(_doc,"mousemove",this.$_dragMouseMove.bind(this),!1),Dom.addEventListener(_doc,"mouseup",this.$_dragMouseUp.bind(this),!1)},destroy:function(){this._active&&this.close(),Dom.removeEventListener(_doc,"mousedown",this.$_dragMouseDown.bind(this),!1),Dom.removeEventListener(_doc,"mousemove",this.$_dragMouseMove.bind(this),!1),Dom.removeEventListener(_doc,"mouseup",this.$_dragMouseUp.bind(this),!1),Dom.removeEventListener(this._applyButton,"click",this.$_applyButtonClick.bind(this),!1),Dom.removeEventListener(this._cancelButton,"click",this.$_cancelButtonClick.bind(this),!1),this._filterView.destroy(),this._filterView=null,this._valueConfigView.destroy(),this._valueConfigView=null,this._options=this._options.destroy(),this._super()},dragField:null,options:null,dataProvider:function(){return this._dataProvider},isActive:function(){return this._active},show:function(e,t){var i,s=this._element;for(i in this._filterOpSelect.value=this._dataProvider.filterManager().operation()||this._options.filterOperation()||FilterOperation.AND,this._sections)this._sections[i].buildItems();this._pivotView.showMask(),this._container.appendChild(s),_defined(e)||_defined(t)||(e=_max(0,_int((this._pivotView.width()-s.offsetWidth)/2)),t=_max(0,_int((this._pivotView.height()-s.offsetHeight)/2)),"fixed"!=(s=this._container.style.position)&&"absolute"!=s&&(e+=this._container.offsetLeft,t+=this._container.offsetTop)),this.setLeft(e),this.setTop(t),this._dragging=!1,this._dragAction=SetupDragAction.NONE,this._dragField=null,this._draggingSection=null,this._draggingElement=null,this._dragMouseX=0,this._dragMouseY=0,this._active=!0},close:function(){this._draggingElement&&(this._element.removeChild(this._draggingElement),this._draggingElement=null,_trace("### dragElement free"));var e=this._element;e&&e.parentNode&&(this._container.removeChild(e),this._pivotView.hideMask(),this._active=!1)},setOptions:function(e){this._options.assign(e)},getOptions:function(){return this._options.proxy(!1)},_clearSectionDragging:function(){},_showFilterView:function(e){this._filterView.show(e)},_showValueConfigView:function(e){this._valueConfigView.show(this,e)},showMask:function(){this._maskView.show()},hideMask:function(){this._maskView.hide()},$_findField:function(e){var t,i,s=e.parentNode;for(i in this._sections)if(this._sections[i]._element==s){t=this._sections[i];break}if(t)for(var n=0,o=t._childs.length;n<o;n++)if(t._childs[n]._element==e)return t._childs[n];return null},$_createDragElement:function(e){var t=_doc.createElement("div"),i=(t.style.position="absolute",e.cloneNode(!0)),e=e.getBoundingClientRect(),s=this._element.getBoundingClientRect(),n=e.left-s.left,s=e.top-s.top,e=(i.style.opacity=.7,i.style.width=e.width+"px",i.style.height=e.height+"px",t.appendChild(i),_doc.createElement("span"));return e.className="realpivot-setup-message",e.id="message",t.appendChild(e),t.style.left=n+"px",t.style.top=s+"px",t},$_createElements:function(e){var t=this._dataProvider,i=t.fieldManager(),t=t.filterManager(),s=this._element,n=_doc.createElement("div"),n=(n.className="realpivot-setup-head",n.innerText=RealPivotMessages.setupPanel.headerText,n.style.cursor="move",s.appendChild(n),_doc.createElement("div")),o=(n.className="realpivot-setup-table",_doc.createElement("div")),r=(o.className="realpivot-setup-row",_doc.createElement("div")),l=(r.className="realpivot-setup-cell realpivot-setup-cell-all",_doc.createElement("div")),a=(l.className="realpivot-setup-section-title",_doc.createElement("div")),a=(a.className="realpivot-setup-section-title-field",l.appendChild(a),_doc.createElement("span")),a=(a.className="realpivot-setup-section-title",a.innerText=RealPivotMessages.setupPanel.fieldSectionText,l.appendChild(a),r.appendChild(l),this._fieldSection=new PivotSetupSection(this,FieldRole.NONE,i.fieldCount.bind(i),i.getField.bind(i)),this._sections.field=this._fieldSection,this.addChild(this._fieldSection,r),o.appendChild(r),_doc.createElement("div")),l=(a.className="realpivot-setup-cell realpivot-setup-cell-normal",_doc.createElement("div")),r=(l.className="realpivot-setup-section-title",_doc.createElement("div")),r=(r.className="realpivot-setup-section-title-column",l.appendChild(r),_doc.createElement("span")),r=(r.className="realpivot-setup-section-title",r.innerText=RealPivotMessages.setupPanel.columnSectionText,l.appendChild(r),a.appendChild(l),this._columnSection=new PivotSetupSection(this,FieldRole.COLUMN,i.columnCount.bind(i),i.getColumn.bind(i)),this._sections.column=this._columnSection,this.addChild(this._columnSection,a),_doc.createElement("div")),l=(r.className="realpivot-setup-section-title",_doc.createElement("div")),l=(l.className="realpivot-setup-section-title-value",r.appendChild(l),_doc.createElement("span")),l=(l.className="realpivot-setup-section-title",l.innerText=RealPivotMessages.setupPanel.valueSectionText,r.appendChild(l),a.appendChild(r),this._valueSection=new PivotSetupSection(this,FieldRole.VALUE,i.valueCount.bind(i),i.getValue.bind(i)),this._sections.value=this._valueSection,this.addChild(this._valueSection,a),o.appendChild(a),_doc.createElement("div")),r=(l.className="realpivot-setup-cell realpivot-setup-cell-normal",_doc.createElement("div")),a=(r.className="realpivot-setup-section-title",_doc.createElement("div")),a=(a.className="realpivot-setup-section-title-row",r.appendChild(a),_doc.createElement("span")),a=(a.className="realpivot-setup-section-title",a.innerText=RealPivotMessages.setupPanel.rowSectionText,r.appendChild(a),l.appendChild(r),this._rowSection=new PivotSetupSection(this,FieldRole.ROW,i.rowCount.bind(i),i.getRow.bind(i)),this._sections.row=this._rowSection,this.addChild(this._rowSection,l),_doc.createElement("div")),r=(a.className="realpivot-setup-section-title",_doc.createElement("div")),i=(r.className="realpivot-setup-section-title-filter",a.appendChild(r),_doc.createElement("span")),r=(i.className="realpivot-setup-section-title",i.innerText=RealPivotMessages.setupPanel.filterSectionText,a.appendChild(i),this._filterOpSelect=_doc.createElement("select")),i=(r.className="realpivot-setup realpivot-setup-field-filter",_doc.createElement("option")),i=(i.value="and",i.innerText="AND",r.appendChild(i),(i=_doc.createElement("option")).value="or",i.innerText="OR",r.appendChild(i),a.appendChild(r),l.appendChild(a),this._filterSection=new PivotSetupFilterSection(this,FieldRole.FILTER,t.operation.bind(t),t.count.bind(t),t.getFilter.bind(t)),this._sections.filter=this._filterSection,this.addChild(this._filterSection,l),o.appendChild(l),n.appendChild(o),s.appendChild(n),_doc.createElement("div")),r=(i.className="realpivot-setup-foot",this._applyButton=_doc.createElement("input")),a=(r.type="button",r.className="btn-primary realpivot-setup",r.value=RealPivotMessages.setupPanel.applyButtonText,Dom.addEventListener(r,"click",this.$_applyButtonClick.bind(this),!1),i.appendChild(r),this._cancelButton=_doc.createElement("input"));a.type="button",a.className="btn-default realpivot-setup",a.value=RealPivotMessages.setupPanel.cancelButtonText,Dom.addEventListener(a,"click",this.$_cancelButtonClick.bind(this),!1),i.appendChild(a),s.appendChild(i)},$_applySetup:function(){for(var e=[],t=[],i=[],s=[],n=null,o=null,r=0,l=this._columnSection.childCount();r<l;r++)a=this._columnSection.getChild(r),e.push({name:a.name(),direction:a.sortDir()});for(r=0,l=this._rowSection.childCount();r<l;r++)a=this._rowSection.getChild(r),t.push({name:a.name(),direction:a.sortDir()});for(r=0,l=this._valueSection.childCount();r<l;r++){var a,h=(a=this._valueSection.getChild(r)).dataField();h.setNumberFormat(a.numberFormat()),h.setValueAlignment(a.valueAlignment()),i.push({name:a.name(),expression:a.expression()}),a.isColumnSort()&&!n&&((n={}).fieldName=a.name(),n.direction=a.columnSortDir(),n.conditions=a.columnSortConditions()),a.isRowSort()&&!o&&((o={}).fieldName=a.name(),o.direction=a.rowSortDir(),o.conditions=a.rowSortConditions())}for(r=0,l=this._filterSection.childCount();r<l;r++){var u=(a=this._filterSection.getChild(r)).type(),c={name:a.name()};u==FilterType.EXPRESSION?c.criteria=a.criteria():u==FilterType.ITEMS?c.values=a.values():c.values=FilterType.ALL,s.push(c)}var d=this.dataProvider().getPivotFields(!1),_={columns:e,rows:t,values:i,sort:{column:n,row:o},filter:{operation:this._filterOpSelect.value,conditions:s}};this.fireConfirmEvent(PivotSetupView.SETUP_CHANGING,d,_)&&this._dataProvider.setPivotFields(_,!0)},$_dragMouseDown:function(e){var t,i;this._active&&(_trace("### dragMouseDown",e.target),t=(e=e||window.event).target,i=this._draggingElement,"realpivot-setup-field"!=t.className||t==i||Dom.isAncestorOf(i,t)?"realpivot-setup-head"==t.className&&(_trace("view drag start"),this._dragMouseX=e.clientX,this._dragMouseY=e.clientY,this._viewDragging=!0):(this._dragging=!0,t instanceof HTMLSpanElement&&(t=t.parentNode),this._dragField=this.$_findField(t),_trace("### dragField set "+(this._dragField?"":"[ NULL ]")),this._dragField&&(this._dragMouseX=e.clientX,this._dragMouseY=e.clientY,setTimeout(function(){!this._dragging||this._draggingElement||(this._draggingElement=this.$_createDragElement(t),_trace("### dragElement create"),this._element.appendChild(this._draggingElement))}.bind(this),200)),_ieOld&&e.preventDefault()))},$_dragMouseMove:function(e){if(this._active){e=e||window.event;var t=this._draggingElement;if(this._dragging&&t){_trace("### dragMouseMove");var i=t.querySelector(".realpivot-setup-field"),s=t.querySelector("#message"),n=e.clientX,o=e.clientY,r=(this._dragAction=SetupDragAction.NONE,this._draggingSection&&(this._draggingSection.hideDragCaret(),this._draggingSection=null),this._oldDuplicateField&&this._oldDuplicateField._css.setProperty("border",""),this._element.getBoundingClientRect());if(pointInBound(n,o,r)){var l,a,h,u,c,d=n-this._dragMouseX,_=o-this._dragMouseY;for(a in this._dragMouseX=n,this._dragMouseY=o,t.style.top=t.offsetTop+_+"px",t.style.left=t.offsetLeft+d+"px",this._sections){var f=this._sections[a],r=f._element.getBoundingClientRect();if(pointInBound(n,o,r)){l=f;break}}l&&this._dragField&&(t=(_=(this._draggingSection=l).checkDragAction(this._dragField.section(),this._dragField)).action,d=_.denyType,_=_.denySource,h=l.type(),c=this._dragField.dataField().labelType(),l.isLabelSection()&&(u=h==FieldRole.COLUMN?this._rowSection:this._columnSection,t==SetupDragAction.ADD?(_=u._existField(this._dragField.dataField()))&&(t=SetupDragAction.DENIED,d=SetupDragDenied.DUPLICATED):t==SetupDragAction.MOVE&&c!==LabelType.BOTH&&(c===LabelType.COLUMN&&h!==FieldRole.COLUMN||c===LabelType.ROW&&h!==FieldRole.ROW)&&(t=SetupDragAction.DENIED,d=SetupDragDenied.DISABLED)),(this._dragAction=t)==SetupDragAction.NONE||t==SetupDragAction.DENIED?(i.style.setProperty("cursor","no-drop"),u=RealPivotMessages.setupPanel.fieldAddUnableText||"",c=RealPivotMessages.setupPanel.fieldDuplicateText||"",s.innerText=t==SetupDragAction.NONE?"":d==SetupDragDenied.DUPLICATED?c:u,_&&_._css.setProperty("border",t==SetupDragAction.DENIED?"1px solid red":"")):(t!=SetupDragAction.REMOVE&&f.showDragCaret(o-r.top+f._element.scrollTop),i.style.setProperty("cursor",t==SetupDragAction.ADD?"copy":"move"),s.innerText="",_&&_._css.setProperty("border","")),this._oldDuplicateField=_)}this._draggingSection||(i.style.removeProperty("cursor"),s.innerText="")}this._viewDragging&&(_log("view drag move"),this.setPosition(this._left+e.clientX-this._dragMouseX,this._top+e.clientY-this._dragMouseY),this._dragMouseX=e.clientX,this._dragMouseY=e.clientY)}},$_dragMouseUp:function(e){if(this._active){e=e||window.event,_trace("### dragMouseUp"),this._draggingElement&&(this._element.removeChild(this._draggingElement),this._draggingElement=null,_trace("### dragElement free")),this._oldDuplicateField&&this._oldDuplicateField._css.setProperty("border","");var t=this._draggingSection;if(this._dragging&&t){var i=this._dragField;switch(this._dragAction){case SetupDragAction.ADD:t.insertFieldAtCaret(i.dataField());break;case SetupDragAction.REMOVE:i.section().removeField(i);break;case SetupDragAction.ORDER:t.moveFieldToCaret(i,this._caretIndex);break;case SetupDragAction.MOVE:t.insertFieldAtCaret(i.dataField()),i.section().removeField(i)}}this._draggingSection&&(_trace("    draggingSection hide"),this._draggingSection.hideDragCaret(),this._draggingSection=null),this._dragging=!1,this._dragField=null,this._viewDragging=!1}},$_applyButtonClick:function(e){try{this.$_applySetup()}finally{this.close(),e.preventDefault()}},$_cancelButtonClick:function(e){this.close(),e.preventDefault()}}),PivotFilterSetupView=(PivotSetupView.SETUP_CHANGING="onSetupChanging",defineClass("PivotFilterSetupView",VisualElement,{init:function(e,t){this._super(),this.setCssClass("realpivot-filter-setup"),this._owner=e,this._dataProvider=t,this._allCheck=null,this._exprCheck=null,this._itemCheckes=[],this.$_createElements()},destroy:function(){Dom.removeEventListener(this._allCheck,"click",this.$_allCheckClick.bind(this),!1),Dom.removeEventListener(this._exprCheck,"click",this.$_exprCheckClick.bind(this),!1),Dom.removeEventListener(this._exprText,"input",this.$_exprTextInput.bind(this),!1),Dom.removeEventListener(this._applyButton,"click",this.$_applyButtonClick.bind(this),!1),Dom.removeEventListener(this._cancelButton,"click",this.$_cancelButtonClick.bind(this),!1),this.$_clearItems(),this._super()},type:FilterType.ALL,values:null,criteria:null,$_createElements:function(){var e=RealPivotMessages.setupPanel.filter,t=this._headDiv=_doc.createElement("div"),t=(t.className="realpivot-filter-setup-head",t.innerText=e.headerText,this._element.appendChild(t),_doc.createElement("div")),i=(t.className="realpivot-filter-setup-body",_doc.createElement("div")),s=(i.className="realpivot-filter-setup-box",(o=_doc.createElement("div")).className="realpivot-filter-setup-item",(n=this._allCheck=_doc.createElement("input")).type="checkbox",n.value="all",Dom.addEventListener(n,"click",this.$_allCheckClick.bind(this),!1),n.className="realpivot-filter-setup-checkbox",o.appendChild(n),(s=_doc.createElement("span")).className="realpivot-filter-setup-item",s.innerText=e.allText,o.appendChild(s),i.appendChild(o),t.appendChild(i),_doc.createElement("div")),n=(s.className="realpivot-filter-setup-box",o=_doc.createElement("div"),(n=this._exprCheck=_doc.createElement("input")).type="checkbox",n.value="expr",Dom.addEventListener(n,"click",this.$_exprCheckClick.bind(this),!1),n.className="realpivot-filter-setup-checkbox",o.appendChild(n),(i=this._exprText=_doc.createElement("input")).type="text",i.placeholder=e.expressionPlaceholder||"ex) value > 0",i.className="realpivot-filter-setup-textbox",Dom.addEventListener(i,"input",this.$_exprTextInput.bind(this),!1),o.appendChild(i),o.className="realpivot-filter-setup-item",s.appendChild(o),t.appendChild(s),this._itemList=_doc.createElement("div")),i=(n.className="realpivot-filter-setup-list-box",t.appendChild(n),this._element.appendChild(t),_doc.createElement("div")),o=(i.className="realpivot-filter-setup-foot",this._applyButton=_doc.createElement("input")),s=(o.type="button",o.className="btn-primary realpivot-setup",o.value=e.applyButtonText,Dom.addEventListener(o,"click",this.$_applyButtonClick.bind(this),!1),i.appendChild(o),this._cancelButton=_doc.createElement("input"));s.type="button",s.className="btn-default realpivot-setup",s.value=e.cancelButtonText,Dom.addEventListener(s,"click",this.$_cancelButtonClick.bind(this),!1),i.appendChild(s),this._element.appendChild(i)},$_clearItems:function(){for(var e=this._itemCheckes.length;e--;)Dom.removeEventListener(this._itemCheckes[e],"click",this.$_listCheckClick.bind(this),!1);this._itemCheckes=[];for(var t=this._itemList;t.firstChild;)t.removeChild(t.firstChild)},$_clearItemCheck:function(){for(var e=this._itemCheckes.length;e--;)this._itemCheckes[e].checked=!1},$_buildItems:function(e,t){var i,s,n=this._itemList,o=e.values(),r=this._dataProvider.getDistinctValues(e.dataField(),[],[],!1,SortDirection.ASCENDING),l=r.length;if(0<l)for(var a=0;a<l;a++)(i=_doc.createElement("div")).className="realpivot-filter-setup-item",(s=_doc.createElement("input")).type="checkbox",s.value=r[a].value,s.checked=t&&-1<o.indexOf(r[a].value),Dom.addEventListener(s,"click",this.$_listCheckClick.bind(this),!1),s.className="realpivot-filter-setup-checkbox",i.appendChild(s),this._itemCheckes.push(s),(s=_doc.createElement("span")).className="realpivot-filter-setup-item",s.innerText=r[a].label||r[a].value,i.appendChild(s),n.appendChild(i)},$_assignValue:function(e){this._headDiv.innerText=RealPivotMessages.setupPanel.filter.headerText+" ("+e.dataField().getFieldHeader()+")";var t=e.type();this._allCheck.checked=!1,this._exprCheck.checked=!1,this._exprText.value="",t==FilterType.ALL?this._allCheck.checked=!0:t==FilterType.EXPRESSION&&(this._exprCheck.checked=!0,this._exprText.value=e.criteria()),this.$_buildItems(e,t==FilterType.ITEMS)},show:function(e){this._owner.showMask(),this._field=e,this.$_clearItems(),this.$_assignValue(e),this._owner._element.appendChild(this._element)},close:function(){this._owner._element.removeChild(this._element),this._owner.hideMask()},$_applyFilter:function(){var e=this._field,t=e.dataField().getDataType();if(this._allCheck.checked)e.setType(FilterType.ALL);else if(this._exprCheck.checked)e.setType(FilterType.EXPRESSION),e.setCriteria(this._exprText.value);else{for(var i=[],s=0,n=this._itemCheckes.length;s<n;s++){var o=this._itemCheckes[s];o.checked&&i.push("number"==t||"datetime"==t?parseFloat(o.value):o.value)}0<i.length?(e.setType(FilterType.ITEMS),e.setValues(i)):e.setType(FilterType.ALL)}},$_allCheckClick:function(e){this._exprCheck.checked=!1,this.$_clearItemCheck()},$_exprCheckClick:function(e){this._allCheck.checked=!1,this.$_clearItemCheck()},$_exprTextInput:function(e){e=e.target.value;this._allCheck.checked=!e,this._exprCheck.checked=e,this.$_clearItemCheck()},$_listCheckClick:function(e){this._allCheck.checked=!1,this._exprCheck.checked=!1},$_applyButtonClick:function(e){try{this.$_applyFilter()}finally{this.close(),e.preventDefault()}},$_cancelButtonClick:function(e){this.close(),e.preventDefault()}})),PivotValueSetupView=defineClass("PivotSortSetupView",VisualElement,{init:function(e,t){this._super(),this.setCssClass("realpivot-value-setup"),this._owner=e,this._dataProvider=t,this._fieldManager=t.fieldManager(),this._selectes=[],this.$_createElements(),this._active=!1},destroy:function(){Dom.removeEventListener(this._colSelect,"change",this.$_colSelectChange.bind(this),!1),Dom.removeEventListener(this._rowSelect,"change",this.$_rowSelectChange.bind(this),!1),Dom.removeEventListener(this._applyButton,"click",this.$_applyButtonClick.bind(this),!1),Dom.removeEventListener(this._cancelButton,"click",this.$_cancelButtonClick.bind(this),!1),this.$_removeItems(),this._dataProvider=null,this._fieldManager=null,this._owner=null,this._super()},active:!1,$_createElements:function(){for(var e,t,i,s=RealPivotMessages.setupPanel.value,n=this._headDiv=_doc.createElement("div"),n=(n.className="realpivot-value-setup-head",n.innerText=s.headerText,this._element.appendChild(n),_doc.createElement("div")),o=(n.className="realpivot-value-setup-body",(i=_doc.createElement("div")).className="realpivot-value-setup-group",(u=_doc.createElement("span")).className="realpivot-setup realpivot-value-setup-group",u.innerText=s.columnGroupText,i.appendChild(u),this._colSelect=e=_doc.createElement("select"),e.className="realpivot-setup",Dom.createOptions(e,[!1,!0],[s.selectNoConfigText,s.selectConfigText]),Dom.addEventListener(e,"change",this.$_colSelectChange.bind(this),!1),i.appendChild(e),this._colList=h=_doc.createElement("div"),h.className="realpivot-value-setup-group-body",h.style.display="none",i.appendChild(h),n.appendChild(i),(i=_doc.createElement("div")).className="realpivot-value-setup-group",(u=_doc.createElement("span")).className="realpivot-setup realpivot-value-setup-group",u.innerText=s.rowGroupText,i.appendChild(u),this._rowSelect=e=_doc.createElement("select"),e.className="realpivot-setup",Dom.createOptions(e,[!1,!0],[s.selectNoConfigText,s.selectConfigText]),e.value=!1,Dom.addEventListener(e,"change",this.$_rowSelectChange.bind(this),!1),i.appendChild(e),this._rowList=h=_doc.createElement("div"),h.className="realpivot-value-setup-group-body",h.style.display="none",i.appendChild(h),n.appendChild(i),(i=_doc.createElement("div")).className="realpivot-value-setup-group",(u=_doc.createElement("span")).className="realpivot-setup realpivot-value-setup-group",u.innerText=s.formatGroupText,i.appendChild(u),(e=this._formatSelect=_doc.createElement("select")).className="realpivot-setup",RealPivotMessages.numberFormatList),r=0,l=o.length;r<l;r++)(t=_doc.createElement("option")).value=o[r].value,t.text=o[r].labelText,e.appendChild(t);i.appendChild(e),n.appendChild(i),(i=_doc.createElement("div")).className="realpivot-value-setup-group",(u=_doc.createElement("span")).className="realpivot-setup realpivot-value-setup-group",u.innerText=s.alignmentGroupText,i.appendChild(u),(e=this._alignmentSelect=_doc.createElement("select")).className="realpivot-setup";for(var a=RealPivotMessages.alignmentList,r=0,l=a.length;r<l;r++)(t=_doc.createElement("option")).value=a[r].value,t.text=a[r].labelText,e.appendChild(t);i.appendChild(e),n.appendChild(i),this._element.appendChild(n);var h=_doc.createElement("div"),s=(h.className="realpivot-value-setup-foot",this._applyButton=_doc.createElement("input")),u=(s.type="button",s.className="btn-primary realpivot-setup",s.value=RealPivotMessages.setupPanel.applyButtonText,Dom.addEventListener(s,"click",this.$_applyButtonClick.bind(this),!1),h.appendChild(s),this._cancelButton=_doc.createElement("input"));u.type="button",u.className="btn-default realpivot-setup",u.value=RealPivotMessages.setupPanel.cancelButtonText,Dom.addEventListener(u,"click",this.$_cancelButtonClick.bind(this),!1),h.appendChild(u),this._element.appendChild(h)},$_setLeftTop:function(e,t){var i,s,n,o=this._element.style;e?(o.removeProperty("left"),o.removeProperty("top")):(e=t.clientHeight,s=t.clientWidth,i=this._element.clientHeight,n=this._element.clientWidth,s=_max(_int((s-n)/2),0),n=_max(_int((e-i)/2),0),"fixed"!=(e=t.style.position)&&"absolute"!=e&&(s+=t.offsetLeft,n+=t.offsetTop),o.top=n+"px",o.left=s+"px")},show:function(e,t){(this._owner=e).showMask(),this._field=t,this._callback=void 0,this.$_assignValue(t),e._element.appendChild(this._element),this.$_setLeftTop(!0)},showByPivot:function(e,t,i){this._owner=e,this._field=t,e.showMask(),this._callback=i,this.$_assignValueByPivot(t),this._active=!0,e._element.parentElement.appendChild(this._element),this.$_setLeftTop(!1,e._element.parentElement)},close:function(){this._active=!1,this._callback=null,this._element.parentElement&&this._element.parentElement.removeChild(this._element),this._owner.hideMask()},$_initSelectOptions:function(e){for(var t,i=e.options.length;1<--i;)e.remove(i);0==e.options.length&&(t=RealPivotMessages.setupPanel.value,Dom.createOptions(e,e.$$parent?["",PivotValueSetupView.SUM_OPTION_VALUE]:[PivotValueSetupView.SUM_OPTION_VALUE],e.$$parent?[t.emptyUpperOptionText,t.summaryOptionText]:[t.summaryOptionText]))},$_buildSelectOptions:function(e,t,i,s){for(var n,o=this._dataProvider.getDistinctValues(t,i,s,!1,SortDirection.ASCENDING),r=0,l=o.length;r<l;r++)(n=_doc.createElement("option")).value=o[r].value,n.text=o[r].label||o[r].value,e.appendChild(n)},$_removeItems:function(){for(var e=this._selectes.length;e--;)Dom.removeEventListener(this._selectes[e],"change",this.$_valueSelectChange.bind(this),!1),this._selectes[e]=null;this._selectes=[],Dom.clearChildren(this._colList),Dom.clearChildren(this._rowList)},$_buildItems:function(e,t,i){var s,n,o,r,l,a=[],h=RealPivotMessages.setupPanel.value,u=(i=i||[],(s=_doc.createElement("div")).className="realpivot-value-setup-item",(n=_doc.createElement("span")).className="realpivot-value-setup-item",n.innerText=h.sortDirectionText,s.appendChild(n),(o=_doc.createElement("select")).className="realpivot-setup realpivot-value-setup-item",Dom.createOptions(o,[SortDirection.ASCENDING,SortDirection.DESCENDING],[h.sortAscendingText,h.sortDescendingText]),this._selectes.push(o),e==this._colList);u?this._colSortSelect=o:this._rowSortSelect=o,s.appendChild(o),e.appendChild(s),u?this._colFirstSelect=null:this._rowFirstSelect=null;for(var c=0,d=t.length;c<d;c++)(s=_doc.createElement("div")).className="realpivot-value-setup-item",l=t[c]instanceof PivotSetupLabelField?t[c].dataField():t[c],(n=_doc.createElement("span")).className="realpivot-value-setup-item",n.innerText=l.getFieldHeader(),s.appendChild(n),(o=_doc.createElement("select")).className="realpivot-setup realpivot-value-setup-item",o.$$field=l,o.$$parent=r,Dom.addEventListener(o,"change",this.$_valueSelectChange.bind(this),!1),this._selectes.push(o),this.$_initSelectOptions(o),this.$_buildSelectOptions(o,l,a,i),i[c]?o.value=i[c]:0===c&&(o.value=PivotValueSetupView.SUM_OPTION_VALUE),0==c&&(u?this._colFirstSelect=o:this._rowFirstSelect=o),r=o,s.appendChild(o),e.appendChild(s),a.push(l)},$_assignValue:function(e){var t=e.dataField(),i=this._owner._columnSection._childs,s=this._owner._rowSection._childs,n=[];if(this._headDiv.innerText=RealPivotMessages.setupPanel.value.headerText+" ("+t.getFieldHeader()+")",this.$_removeItems(),e.isColumnSort()){this._colSelect.value="true";for(var o=0,r=(l=e.columnSortConditions()).length;o<r;o++)n.push(l[o].value);this.$_buildItems(this._colList,s,n),this._colSortSelect.value=e.columnSortDir()}else this._colSelect.value="false",this.$_buildItems(this._colList,s,n);if(Dom.fireEvent(this._colSelect,"change"),n=[],e.isRowSort()){this._rowSelect.value="true";for(var l,o=0,r=(l=e.rowSortConditions()).length;o<r;o++)n.push(l[o].value);this.$_buildItems(this._rowList,i,n),this._rowSortSelect.value=e.rowSortDir()}else this._rowSelect.value="false",this.$_buildItems(this._rowList,i,n);Dom.fireEvent(this._rowSelect,"change");t=e.numberFormat(),t&&(this._formatSelect.value=t,this._formatSelect.value||(Dom.createOptions(this._formatSelect,[t],[RealPivotMessages.userDefinedFormatText+" "+t]),this._formatSelect.value=t)),s=e.valueAlignment();this._alignmentSelect.value=s},$_assignValueByPivot:function(e){var t=e.dataField(),i=e.getColumns(),s=e.getRows(),n=[];if(this._headDiv.innerText=RealPivotMessages.setupPanel.value.headerText+" ("+t.getFieldHeader()+")",this.$_removeItems(),e.isColumnSort()){this._colSelect.value="true";for(var o=0,r=(l=e.columnSortConditions()).length;o<r;o++)n.push(l[o].value);this.$_buildItems(this._colList,s,n),this._colSortSelect.value=e.columnSortDir()}else this._colSelect.value="false",this.$_buildItems(this._colList,s,n);if(Dom.fireEvent(this._colSelect,"change"),n=[],e.isRowSort()){this._rowSelect.value="true";for(var l,o=0,r=(l=e.rowSortConditions()).length;o<r;o++)n.push(l[o].value);this.$_buildItems(this._rowList,i,n),this._rowSortSelect.value=e.rowSortDir()}else this._rowSelect.value="false",this.$_buildItems(this._rowList,i,n);Dom.fireEvent(this._rowSelect,"change");t=e.numberFormat(),t&&(this._formatSelect.value=t,this._formatSelect.value||(Dom.createOptions(this._formatSelect,[t],[RealPivotMessages.userDefinedFormatText+" "+t]),this._formatSelect.value=t)),s=e.valueAlignment();this._alignmentSelect.value=s},$_makeCondition:function(e){for(var t=this._selectes.indexOf(e),i=[],s=t,n=this._selectes.length;s<n&&(""!=(e=this._selectes[s]).value&&e.value!=PivotValueSetupView.SUM_OPTION_VALUE&&(s==t||e.$$parent==this._selectes[s-1]));s++){var o={};o.name=e.$$field.name(),o.value=e.value,i.push(o)}return i},$_applyValueConfig:function(){var e=this._field,t="true"==this._colSelect.value&&this._colSortSelect;e.setColumnSort(t),t&&(e.setColumnSortDir(this._colSortSelect.value),i=this.$_makeCondition(this._colFirstSelect),e.setColumnSortConditions(i)),t="true"==this._rowSelect.value&&this._rowFirstSelect,e.setRowSort(t),t&&(e.setRowSortDir(this._rowSortSelect.value),i=this.$_makeCondition(this._rowFirstSelect),e.setRowSortConditions(i));var t=(t=this._formatSelect.value)||null,i=(e.setNumberFormat(t),this._alignmentSelect.value);e.setValueAlignment(i),this._callback&&this._callback.call(this._owner,this._field,!0)},$_colSelectChange:function(e){var t="true"==this._colSelect.value;this._colList.style.display=t?"":"none",this._colSort=t},$_rowSelectChange:function(e){var t="true"==this._rowSelect.value;this._rowList.style.display=t?"":"none",this._rowSort=t},$_valueSelectChange:function(e){var t,i=e.currentTarget,e=this._selectes.indexOf(i);if(t=e<this._selectes.length-1&&this._selectes[e+1].$$parent==i?this._selectes[e+1]:t){e=i.value&&i.value!=PivotValueSetupView.SUM_OPTION_VALUE?PivotValueSetupView.SUM_OPTION_VALUE:"";if(t.value!=e&&(t.value=e,Dom.fireEvent(t,"change")),this.$_initSelectOptions(t),i.value&&i.value!=PivotValueSetupView.SUM_OPTION_VALUE){for(var s=[],n=[];i;)s.splice(0,0,i.$$field),n.splice(0,0,i.value),i=i.$$parent;this.$_buildSelectOptions(t,t.$$field,s,n)}}},$_applyButtonClick:function(e){try{this.$_applyValueConfig()}finally{this.close(),e.preventDefault()}},$_cancelButtonClick:function(e){this.close(),e.preventDefault()}},{SUM_OPTION_VALUE:"$$$SUM"}),ValueSetupModel=defineClass("ValueSetupModel",null,{init:function(e,t,i){this._super(!1),this._owner=e,this._dataField=t,this._fieldManager=i,this.$_assignFrom(i)},destroy:function(){return this._super()},dataField:null,columnSort:!1,rowSort:!1,columnSortDir:SortDirection.NONE,rowSortDir:SortDirection.NONE,columnSortConditions:null,rowSortConditions:null,numberFormat:null,valueAlignment:null,getColumns:function(){return this._fieldManager.getColumns()},getRows:function(){return this._fieldManager.getRows()},$_assignFrom:function(e){var t=this._dataField,i=t.name(),s=e.getValueSort(FieldType.COLUMN);this._columnSort=s&&s.fieldName===i,this._numberFormat=t.numberFormat(),this._valueAlignment=t.valueAlignment(),this._columnSort&&(this._columnSortDir=s.direction,this._columnSortConditions=deepCopy(s.conditions)),s=e.getValueSort(FieldType.ROW),this._rowSort=s&&s.fieldName===i,this._rowSort&&(this._rowSortDir=s.direction,this._rowSortConditions=deepCopy(s.conditions))}}),ExportCellItem=function(e){this.colIndex=0,this.rowIndex=0,this.colSpan=0,this.rowSpan=0,this.valueType="s",this.cell=e},ExportCellArray=defineClass("ExportCellArray",null,{init:function(e,t){this._super(),this._grid=e,this._columnCells=[],this._rowCells=[],this._dataCells=[],this.$_parse(e,t)},destroy:function(){this._grid=null,this._rows=null,this._super()},grid:function(){return this._grid},colCount:function(){return this._columnCells.length&&this._columnCells[0].length},rowHeaderCount:function(){return this._rowCells.length&&this._rowCells[0].length},columnHeaderCount:function(){return this._columnCells.length},dataRowCount:function(){return this._dataCells.length},getColumnHeader:function(e,t){return this._columnCells[e],this._columnCells[e][t]},getRowHeader:function(e,t){return this._rowCells[e],this._rowCells[e][t]},getCell:function(e,t){return this._dataCells[e],this._dataCells[e][t]},getCellIndex:function(e,t,i){e=this._rowCells[e],e=e[e.length-1],t=this._columnCells[this._columnCells.length-1][t],t=t&&t.cell&&t.cell._cellIndex._columns,e=e&&e.cell&&e.cell._cellIndex._rows;return CellIndex.temp(this._grid,t,e,i)},setColumnHeader:function(e,t,i){this._columnCells[e],this._columnCells[e][t]=i},setRowHeader:function(e,t,i){this._rowCells[e],this._rowCells[e][t]=i},setCell:function(e,t,i){this._dataCells[e],this._dataCells[e][t]=i},$_parse:function(e,t){var i,s=e.getColumnDepth(),n=e.getRowDepth(),o=t?e.getLeafRowCount():e.getVisibleRowCount(),r=t?e.getLeafColumnCount():e.getVisibleColumnCount();for(this._columnCells=[],i=s;i--;)this._columnCells.push([]);for(this._rowCells=[],this._dataCells=[],i=o;i--;)this._rowCells.push([]),this._dataCells.push([]);this.$_parseColumnCells(e,this._columnCells,e.valueLabelVisible()?s-1:s,t),this.$_parseRowCells(e,this._rowCells,n,t),this.$_parseDataCells(e,this._dataCells,o,r,t)},$_parseColumnCells:function(e,t,i,s){for(var n=e.columnView().rootElement().getLowers(),o=0,r=0,l=n.length;r<l;r++){var a=n[r];o+=this.$_addColumnGroup(t,a,o,0,i,s)}},$_parseRowCells:function(e,t,i,s){for(var n=e.rowView().rootElement().getLowers(),o=0,r=0,l=n.length;r<l;r++){var a=n[r];o+=this.$_addRowGroup(t,a,0,o,i,s)}},$_parseDataCells:function(e,t,i,s,n){for(var o,r,l,a,h,u,c,d,_=0,f=0,p=this._columnCells,m=this._rowCells,g=e.modelManager();f<i;){if(o=r=0,h=(l=m[_][m[_].length-1].cell).treePath(),c=g.getRow(h),n||l.isVisible()){for(;r<s;)d=(a=p[p.length-1][o].cell).treePath(),u=a.valueField().name(),d=c.getCell(d,u),(n||a.isVisible())&&(this.$_addCell(t,r,f,1,1,d),r++),o++;f++}_++}},$_addCell:function(e,t,i,s,n,o){for(var r,l,a=0;a<n;a++)for(r=0;r<s;r++)(l=new ExportCellItem(o)).colIndex=r,l.colSpan=s,l.rowIndex=a,l.rowSpan=n,e[i+a][t+r]=l},$_addColumnGroup:function(e,t,i,s,n,o){var r=0,l=t instanceof LabelSummaryCellElement?n-t.level():1,a=t instanceof GroupCellElement;if(o||!a||t.expanded)for(var h=a&&t.expanded(),u=a&&t.isSummaryVisible(),c=o?t.getLowers():t.getVisibleLowers(!0,!0),d=i,_=s+l,f=0,p=c.length;f<p;f++){var m=c[f],g=m instanceof LabelSummaryCellElement,g=a?o||h?!u&&g:!g:!1;g||(m.hasLower()?(d+=g=this.$_addColumnGroup(e,m,d,_,n,o),r+=g):(g=m instanceof LabelSummaryCellElement&&!m.isValueLabel()?n-_:1,this.$_addCell(e,d,_,1,g,m),r++,d++))}return this.$_addCell(e,i,s,r=0==r?1:r,l,t),r},$_addRowGroup:function(e,t,i,s,n,o){var r=0,l=t instanceof LabelSummaryCellElement?n-t.level():1,a=t instanceof GroupCellElement;if(o||!a||t.expanded)for(var h=a&&t.expanded(),u=a&&t.isSummaryVisible(),c=o?t.getLowers():t.getVisibleLowers(!0,!0),d=s,_=i+l,f=0,p=c.length;f<p;f++){var m=c[f],g=m instanceof LabelSummaryCellElement,g=a?o||h?!u&&g:!g:!1;g||(m.hasLower()?(d+=g=this.$_addRowGroup(e,m,_,d,n,o),r+=g):(g=m instanceof LabelSummaryCellElement&&!m.isValueLabel()?n-_:1,this.$_addCell(e,_,d,g,1,c[f]),r++,d++))}return this.$_addCell(e,i,s,l,r=0==r?1:r,t),r}}),PIXELS_PER_CHAR=7,DocumentTitle=defineClass("DocumentTitle",null,{init:function(e){"string"==typeof e?(this._message=e,this._visible=!0,this._spaceTop=0,this._spaceBottom=0,this._height=-1):"object"==typeof e&&(this._message=e.message,this._visible=!e.hasOwnProperty("visible")||e.visible,this._spaceTop=!e.spaceTop||isNaN(parseInt(e.spaceTop))?0:parseInt(e.spaceTop),this._spaceBottom=!e.spaceBottom||isNaN(parseInt(e.spaceBottom))?0:parseInt(e.spaceBottom),this._height=!e.height||isNaN(parseInt(e.height))?-1:parseInt(e.height),this._styles=e.styles,this._styleName=e.styleName)},message:null,visible:!0,spaceTop:0,spaceBottom:0,height:-1,styles:null,styleName:null}),UserCells=defineClass("UserCells",null,{init:function(e){this.assign(e)},assignFrom:function(e){this._row=e.row,this._col=e.col,this._value=e.value,this._mergeRow=e.mergeRow||1,this._mergeCol=e.mergeCol||1,this._styles=e.styles,this._styleName=e.styleName,this._format=e.format,this._height=e.height||-1,this._heights=e.heights,this._formula=e.formula},row:null,col:null,value:null,styleName:null,styles:null,mergeRow:1,mergeCol:1,height:-1,format:null,heights:null,formula:null}),GridExportOptions=defineClass("GridExportOptions",null,{init:function(e){this._super(),this._datetimeWriter=null,e&&this.assign(e)},target:"local",url:void 0,fileName:null,expandAll:!0,documentTitle:null,documentSubtitle:null,documentTail:null,numberFormat:void 0,showProgress:!1,progressMessage:null,applyCssStyle:!0,applyStyleCallback:!1,includeTitle:!1,done:null,start:0,count:-1,exportEmptyValue:!1,xOffset:0,yOffset:0,xOffsetWidth:100,userCells:null,userCellsCallback:null,setFileName:function(e){(e=_trim(e))&&e.indexOf(".")<0&&(e+=".xlsx"),this._fileName=e},setNumberFormat:function(e){e!=this._numberFormat&&(this._numberFormat=e)},setDocumentTitle:function(e){this._documentTitle=e?new DocumentTitle(e):null},setDocumentSubtitle:function(e){this._documentSubtitle=e?new DocumentTitle(e):null},setDocumentTail:function(e){this._documentTail=e?new DocumentTitle(e):null}}),GridExcelExporter=defineClass("GridExcelExporter",null,{init:function(){this._super()},destroy:function(){this._super()},export:function(t,o,e){var r,l,a;t&&(o=o instanceof GridExportOptions?o:new GridExportOptions(o),(r={grid:t,levelCells:e,book:new ExcelWorkbook,options:o,colArr:new ExportCellArray(t,o.isExpandAll()),numberFormatId:0,textFormatId:49,showProgress:o.isShowProgress(),progressMessage:o.progressMessage()||"Exporting...",progressMax:0,prepareProgress:10,setProgress:function(e){t.setCurrentProgress(e+this.prepareProgress)}}).colCount=r.colArr.colCount()+r.colArr.rowHeaderCount(),this._cssStyles={},l=(new Date).getTime(),(a=this).$_buildBook(r,function(){var e,t=a,i=(new Date).getTime(),s=(_trace("E X C E L: buildBook "+(l=i-l)),l=i,r.book.createParts()),i=(new Date).getTime(),n=(_trace("E X C E L: createParts "+(l=i-l)),l=i,[]);for(e in s)n.push({key:e,body:s[e]});t.$_export(n,o),i=(new Date).getTime(),_trace("E X C E L: zip "+(l=i-l)),l=i,o._done&&"function"==typeof o._done&&o._done(),r.options&&(r.options.destroy(),r.options=null),r.book&&(r.book.destroy(),r.book=null),r.colArr&&(r.colArr.destroy(),r.colArr=null),r=null}))},$_buildBook:function(e,t){var i,s=e.grid,n=(e.start=0<e.options.start()?e.options.start():0,e.options.count()),o=e.colArr.dataRowCount(),r=((!(0<e.count)||e.start+n>o)&&e.start,e.last=e.start+o,this.$_prepareFormats(e),this.$_prepareStyles(e),this.$_buildColumns(e),Math.max(0,e.options.yOffset())),l=Math.max(0,e.options.xOffset()),r=(r+=this.$_buildDocumentTitle(e,r,l))+this.$_buildHeader(e,r,l);e.showProgress?(e.progressStep=Math.max(_int(o/10),1),s.showProgress(o+e.prepareProgress,e.progressMessage),r+=(i=this).$_buildItemsAsync(e,r,l,function(){r=e.row,r+=i.$_buildDocumentTail(e,r,l),i.$_buildUserCells(e,r),s.completeProgress(),setTimeout(function(){s.closeProgress()}),t()})):(r=(r+=this.$_buildItems(e,r,l))+this.$_buildDocumentTail(e,r,l),this.$_buildUserCells(e,r),t())},$_prepareFormats:function(e){var t=e.options,i=e.book,t=t.numberFormat();"number"==typeof t||0<_int(t)?e.numberFormatId=_int(t):t&&(e.numberFormatId=i.addNumberFormat(ExcelFormatConverter.convertNumberFormat(t)))},$_prepareStyles:function(e){var t=e.book,i=e.grid.dataSource().fieldManager().getValues();if(this._bodyStyles={},e.options.isApplyCssStyle()&&e.levelCells)for(var s=e.levelCells,n=0;n<i.length;n++)for(var o=i[n],r=o.name(),l=this._bodyStyles[r]=[],a=0;a<s[r].length;a++){var h=s[r][a];l[a]=[];for(var u=0;u<h.length;u++)l[a][u]=this.$_addStyle(t,h[u],!0,o.exportFormat()||o.numberFormat(),o.prefix(),o.suffix())}},$_cssToExcelStyle:function(e,t,i,s){var n,o,r=new ExcelFill,l=i.backgroundImage,a="linear-gradient(",h=l.indexOf(a),l=(s&&"table-cell"==s.display&&["transparent","rgba(0, 0, 0, 0)","unset"].indexOf(s.backgroundColor)<0?(r.patternType="solid",n=new Color(s.backgroundColor),r.color=n.toColorHex(),r.tint=1-n._a):-1<h?(r.gradient="linear",a=2<(h=PivotHelper.splitEscape(l.slice(h+a.length,l.length-1))).length?(o=new Color(h[1]),u=new Color(h[2]),parseInt(h[0])):(o=new Color(h[0]),u=new Color(h[1]),180),r.color=o.toColorHex(),r.color2=u.toColorHex(),r.tint=1-o._a,r.degree=a+270+""):(r.patternType="solid",n=new Color(i.backgroundColor),r.color=n.toColorHex(),r.tint=1-n._a),r=e.addFill(r),new ExcelBorder),h=(l.right=new Pen(i.borderRightColor,i.borderRightWidth),l.bottom=new Pen(i.borderBottomColor,i.borderBottomWidth),l.left=new Pen(i.borderLeftColor,i.borderLeftWidth),l.top=new Pen(i.borderTopColor,i.borderTopWidth),l=e.addBorder(l),i=s||i,new ExcelFont),u=(h.name=i.fontFamily,parseInt(i.fontSize));if(0<i.fontSize.indexOf("pt")?u=_round(u/.75):0<i.fontSize.indexOf("em")?u=_round(12*u/.75):0<i.fontSize.indexOf("%")&&(u=_round(u/100*12/.75)),h.size=72*u/96,h.color=new Color(i.color).toColorHex(),h.bold="bold"==i.fontWeight||600<parseInt(i.fontWeight),h.italic="italic"==i.fontStyle,h=e.addFont(h),t.fill=r,t.border=l,t.font=h,"flex"==i.display){switch(i.justifyContent){case"center":t.horzAlign=ExcelStyle.ALIGN_CENTER;break;case"flex-end":t.horzAlign=ExcelStyle.ALIGN_FAR;break;default:t.horzAlign=ExcelStyle.ALIGN_NEAR}switch(i.alignItems){case"center":t.vertAlign=ExcelStyle.VALIGN_CENTER;break;case"flex-end":t.vertAlign=ExcelStyle.VALIGN_FAR;break;default:t.vertAlign=ExcelStyle.VALIGN_NEAR}}else{switch(i.textAlign){case"center":t.horzAlign=ExcelStyle.ALIGN_CENTER;break;case"right":t.horzAlign=ExcelStyle.ALIGN_FAR;break;default:t.horzAlign=ExcelStyle.ALIGN_NEAR}switch(i.verticalAlign){case"middle":t.vertAlign=ExcelStyle.VALIGN_CENTER;break;case"bottom":t.vertAlign=ExcelStyle.VALIGN_FAR;break;default:t.vertAlign=ExcelStyle.VALIGN_NEAR}}},$_createStyles:function(e,t,i,s,n,o){(l=s&&0<s.length?ExcelFormatConverter.convertNumberFormat(s):l)&&(n&&(l='"'+n+'"'+l),l=PivotHelper.removeTags(l=o?l+'"'+o+'"':l),r=e.addNumberFormat(l));var r,l,s=r||i?new ExcelStyle:null;return r&&(s.formatId=r),i&&(n=getComputedStyle(t._element),o=t._span&&getComputedStyle(t._span),this.$_cssToExcelStyle(e,s,n,o)),s},$_addStyle:function(e,t,i,s,n,o){var r,l=this._cssStyles,a="";return i&&(a+=t.cssClass()),l[a+="="+s+"="+n+"="+o]?r=l[a]:(r=this.$_createStyles(e,t,i,s,n,o),l[a]=r,e.addStyle(r)),r},$_addCustomStyle:function(e,t,i,s,n){if(!t&&!i&&!s)return null;var o=e.book,e=e.grid._element,r=document.createElement("span"),l=(r.className=i+"",r.style);if(l.position="absolute",l.top="-1000px",e.appendChild(r),t)for(var a=t?Object.keys(t):{},h=0;h<a.length;h++)l[a[h]]=t[a[h]];i=new ExcelStyle;return s&&(s=ExcelFormatConverter.convertNumberFormat(s))&&(i.formatId=o.addNumberFormat(s)),this.$_cssToExcelStyle(o,i,getComputedStyle(r),null),i.wrapText=n,e.removeChild(r),i},$_buildColumns:function(e){for(var t=e.grid,i=e.colArr,s=1,n=[],o=Math.max(0,e.options.xOffset()),r=Math.max(0,e.options.xOffsetWidth()),l=0;l<o;l++)(c=new ExcelColumn).index=s++,c.width=_round(r/PIXELS_PER_CHAR),n.push(c);var a=i.rowHeaderCount();for(l=0;l<a;l++)(c=new ExcelColumn).index=s++,c.width=_round(t.rowLevelWidth(l)/PIXELS_PER_CHAR),n.push(c);var h=i.colCount(),u=i.columnHeaderCount()-1;for(l=0;l<h;l++){var c,d=i.getColumnHeader(u,l);(c=new ExcelColumn).index=s++,c.width=_round(d.cell.width()/PIXELS_PER_CHAR),n.push(c)}e.book.sheet().setColumns(n)},$_buildTitle:function(e,t,i,s,n){if(t&&t._visible){var o=e.book,r=o.sheet(),l=(i+=t.spaceTop(),t.message()),a=t.styles()&&this.$_addCustomStyle(e,t.styles(),t.styleName(),null,!0);a&&o.addStyle(a),r.addText(i,s,l,a,t.height()),r.addMerge(i,s,1,n);for(var h=1;h<n;h++)r.addBlank(i,s+h,a);i++,i+=t.spaceBottom()}return i},$_buildDocumentTitle:function(e,t,i){var s=e.options,n=e.colCount,o=t,o=this.$_buildTitle(e,s.documentTitle(),o,i,n);return this.$_buildTitle(e,s.documentSubtitle(),o,i,n)-t},$_buildDocumentTail:function(e,t,i){var s=e.options,n=e.colCount,o=t;return this.$_buildTitle(e,s.documentTail(),o,i,n)-t},$_buildHeader:function(e,t,i){var s,n,o,r,l,a=e.grid,h=e.book,u=h.sheet(),c=e.colArr,d=c.colCount(),_=c.columnHeaderCount(),f=c.rowHeaderCount(),p=e.options.isApplyCssStyle(),m=e.options.isIncludeTitle(),e=a.headerView(),g=e.getTitleCell()||e.getGridRowHeaderCell(0),v=this.$_addStyle(h,g,p),C="";if(v.vertAlign=ExcelStyle.VALIGN_CENTER,m){var g=a.dataSource().fieldManager(),a=g.getValues(),w=g.getRows(),y=g.getColumns(),b=w.length,a=g.getFieldsText(a,!0),y=g.getFieldsText(y),C=g.getFieldsText(w);if(u.addText(t,i,a,v),1<b){for(x=1;x<b;x++)u.addBlank(t,i+x,v);u.addMerge(t,i,1,i+b)}var E=i+b;if(u.addText(t,E,y,v),1<d){for(x=1;x<d;x++)u.addBlank(t,E+x,v);u.addMerge(t,E,1,d)}t++}if(e.formType()==HeaderFormType.GRID)for(var S=e.getGridRowHeaderCells(),T=this.$_addStyle(h,S[0],p),x=0;x<_;x++)for(s=0;s<f;s++)0==x?(u.addText(t,i+s,S[s].text(),T),1<_&&u.addMerge(t,i+s,_,1)):u.addBlank(t+x,i+s,T);else{for(x=0;x<_;x++)for(s=0;s<f;s++)m&&0==x&&0==s?u.addText(t,i,C,v):u.addBlank(t+x,i+s,v);(1<_||1<f)&&u.addMerge(t,i,_,f)}for(i+=f,x=0;x<_;x++)for(n=t+x,s=0;s<d;s++)l=(r=c.getColumnHeader(x,s)).cell,T=this.$_addStyle(h,l,p),o=s+i,0<r.colIndex||0<r.rowIndex?u.addBlank(n,o,T):((l=PivotHelper.removeTags(l.text()))&&l.match($_linereg)&&(T.wrapText=!0),u.addText(n,o,l,T),(1<r.rowSpan||1<r.colSpan)&&u.addMerge(n,o,r.rowSpan,r.colSpan));return _+(m?1:0)},$_buildRow:function(e,t,i,s){for(var n=e.grid,o=e.book,r=o.sheet(),l=e.colArr,a=l.colCount(),h=l.rowHeaderCount(),u=e.options,c=u.isApplyCssStyle(),d=u.isApplyStyleCallback(),_=0;_<h;_++){var f,p=(f=l.getRowHeader(s,_)).cell,m=_+i,g=this.$_addStyle(o,p,c);0<f.colIndex||0<f.rowIndex?r.addBlank(t,m,g):((v=PivotHelper.removeTags(p.text()))&&v.match($_linereg)&&(g.wrapText=!0),r.addText(t,m,v,g),(1<f.rowSpan||1<f.colSpan)&&r.addMerge(t,m,f.rowSpan,f.colSpan))}for(i+=h,_=0;_<a;_++){var v,C,w=(p=(f=l.getCell(s,_)).cell).field(),y=l.getCellIndex(s,_,w.name()),b=e.levelCells[w.name()][p.rowLevel()][p.level()];b._cellIndex=y,b.setValue(p.getValue()),b.draw(),g=d&&BodyCellElement.getStyleName(n,y,p.getValue())?this.$_addStyle(o,b,c,w.exportFormat()||w.numberFormat(),w.prefix(),w.suffix()):this._bodyStyles[w.name()][p.rowLevel()][p.level()],m=_+i,0<f.colIndex||0<f.rowIndex?r.addBlank(t,m,g):(y=w.emptyValue(),C=0===p.getCount()?null!=(C=u.isExportEmptyValue()&&y?y:n.displayOptions().blankFillValue())?C:"":p.getValue(),"number"==w.getDataType()?0===p.getCount()&&"string"==typeof C?r.addText(t,m,PivotHelper.removeTags(C),g):r.addNumber(t,m,C,g):r.addText(t,m,PivotHelper.removeTags(v=C+""),g))}return 1},$_buildItems:function(e,t,i){for(var s=t,n=e.start;n<e.last;n++)s+=this.$_buildRow(e,s,i,n);return s-t},$_buildUserCells:function(p,e){var m,t=p.grid,g=p.book,v=g.sheet(),i=p.options,s=i.userCellsCallback(),s=i.userCells()||s&&s.call(t,t,e,p.colCount+i.xOffset());Array.isArray(s)&&(s.sort(function(e,t){return e.row===t.row?e.col-t.col:e.row-t.row}),m=new UserCells(null),(i=(e=document.createElement("span")).style).position="absolute",i.top="-1000px",t._element.appendChild(e),s.forEach(function(e,t,i){m.assignFrom(e);var s,n,o=this.$_addCustomStyle(p,m.styles(),m.styleName(),m.format(),!0),r=(o&&g.addStyle(o),m.row()),l=m.col(),a=m.mergeRow(),h=m.mergeCol(),u=0<m.height()?.75*m.height():-1;if(null!=m.value()?"string"==typeof(e=m.value())?s=v.addText(r,l,e,o,u):"number"==typeof e?s=v.addNumber(r,l,e,o,u):"boolean"==typeof e?s=v.addBool(r,l,e,o,u):e instanceof Date&&(s=v.addDate(r,l,e,o,u)):v.addBlank(r,l,o,u),s&&m.formula()&&((e=v._doc.createElement("f")).appendChild(v._doc.createTextNode(m.formula())),n=s.childNodes[0],s.insertBefore(e,n)),1<a||1<h){for(var c=m.heights()||[],d=0;d<a;d++)for(var _,f=0;f<h;f++)0==d&&0==f||(_=0<c[d]?.75*c[d]:u,v.addBlank(r+d,l+f,o,_));v.addMerge(r,l,a,h)}}.bind(this)),t._element.removeChild(e))},$_buildItemsAsync:function(t,e,i,s){try{this.$_buildItemAsync(t,e,i,t.start,s)}catch(e){throw t.grid.completeProgress(),e}},$_buildItemAsync:function(e,t,i,s,n){for(var o,r=s+Math.min(e.progressStep,e.last-s),l=s;l<r;l++)t+=this.$_buildRow(e,t,i,l);e.row=t,e.setProgress(r-e.start),(s=r)>=e.last?n():(o=this,setTimeout(function(){o.$_buildItemAsync(e,t,i,s,n)},0))},$_export:function(e,i){function t(e){var t;window.navigator.msSaveOrOpenBlob?window.navigator.msSaveOrOpenBlob(e,n):window.navigator.msSaveBlob?window.navigator.msSaveBlob(e,n):(t=document.createElement("a"),document.body.appendChild(t),e=URL.createObjectURL(e),t.href=e,t.download=n,t.click(),document.body.removeChild(t))}function s(e){var t='<form name="tempForm" action="'+i.url()+'" method="post">',e=(t=(t=t+('<input type="hidden" name="fileName" value = "'+n+'"/>')+('<input type="hidden" name="data" value = "'+e+'"/>'))+'<input id="submitBtn" type="submit"/>'+"</form>",document.createElement("div"));e.innerHTML=t,document.body.appendChild(e),document.getElementById("submitBtn").click(),document.body.removeChild(e)}var n=i.fileName()||"realpivot.xlsx",o="local"==i.target();if(JSZip.support.blob||!o){for(var r=new JSZip,l=0;l<e.length;l++){var a=(a=e[l].body).replace(/ xmlns=""/g,"").replace(/xmlns=""/g,"");r.file(e[l].key,a)}o?r.generateAsync?r.generateAsync({type:"blob",compression:"DEFLATE"}).then(function(e){t(e)}):t(r.generate({type:"blob",compression:"DEFLATE"})):r.generateAsync?r.generateAsync({type:"base64",compression:"DEFLATE"}).then(function(e){s(e)}):s(r.generate({type:"base64",compression:"DEFLATE"}))}else alert("not supported on this browser")}}),_gk="dkdl",_wm_="iVBORw0KG"+_vm__+"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";return __lck()?{PivotDataProvider:PivotDataProvider,PivotView:PivotView,PivotSetupView:PivotSetupView,getVersion:_getVersion,setLogging:_setLogging}:null}(this),RealPivot=function(e){if(!(e="string"==typeof e?document.getElementById(e):e))throw new Error("container not found.");this.provider=new RealPivotClass.PivotDataProvider,this.view=new RealPivotClass.PivotView(e),this.provider.addListener(this.view),this.view.setDataSource(this.provider),this.view.addListener(this),this._setupView=new RealPivotClass.PivotSetupView(e,this.view),this._setupView.addListener(this.view),this.view.setSetupView(this._setupView),this.destroy=function(){this._setupView.destroy(),this._setupView=null,this.view.destroy(),this.view=null,this.provider.destroy(),this.provider=null},this.getVersion=function(){return RealPivotClass.getVersion()},this.setDataProvider=function(e){this.provider.setDataSource(e)},this.setFieldMapping=function(e){this.provider.setFieldMapping(e)},this.setPivotFields=function(e){this.provider.setPivotFields(e)},this.getPivotFields=function(e){return e=0<arguments.length&&arguments[0],this.provider.getPivotFields(e)},this.getDataOptions=function(){return this.provider.getOptions()},this.setDataOptions=function(e){this.provider.setOptions(e)},this.setSetupOptions=function(e){this._setupView.setOptions(e)},this.getSetupOptions=function(){return this._setupView.getOptions()},this.getOptions=function(){return this.view.getOptions()},this.setOptions=function(e){this.view.setOptions(e)},this.getDisplayOptions=function(){return this.view.getDisplayOptions()},this.setDisplayOptions=function(e){this.view.setDisplayOptions(e)},this.getSummaryOptions=function(){return this.view.getSummaryOptions()},this.setSummaryOptions=function(e){this.view.setSummaryOptions(e)},this.getHeaderOptions=function(){return this.view.getHeaderOptions()},this.setHeaderOptions=function(e){this.view.setHeaderOptions(e)},this.getCopyOptions=function(){return this.view.getCopyOptions()},this.setCopyOptions=function(e){this.view.setCopyOptions(e)},this.getGroupOptions=function(){return this.view.getGroupOptions()},this.setGroupOptions=function(e){this.view.setGroupOptions(e)},this.buildPivot=function(){this.provider.buildPivotData(!0)},this.drawView=function(e){this.view.draw(e)},this.showSetupView=function(e,t){this._setupView.show(e,t)},this.resetSize=function(){this.view.resetSize()},this.sort=function(e){this.view.sort(e)},this.resetFilter=function(){this.provider.resetFilter(),this.provider.buildPivotData()},this.filter=function(e){this.provider.filter(e),this.provider.buildPivotData()},this.getFilter=function(){return this.provider.getFilters()},this.exportGrid=function(e){this.view.export(e)},this.expandColumnLevel=function(e){this.view.expandColumnLevel(e)},this.expandRowLevel=function(e){this.view.expandRowLevel(e)},this.expandColumn=function(e){this.view.expandColumn(e,!0)},this.expandRow=function(e){this.view.expandRow(e,!0)},this.collapseColumn=function(e){this.view.expandColumn(e,!1)},this.collapseRow=function(e){this.view.expandRow(e,!1)},this.getColumnExpanded=function(e){return this.view.columnExpanded(e)},this.getRowExpanded=function(e){return this.view.rowExpanded(e)},this.setGlobalContextMenu=function(e){this.view.setGlobalContextMenu(e)},this.getGlobalContextMenu=function(e){return this.view.getGlobalContextMenu()},this.setContextMenu=function(e){this.view.setContextMenu(e)},this.getContextMenu=function(){return this.view.getContextMenu()},this.getColumnLabels=function(){return this.provider.getColumnLabelData()},this.getRowLabels=function(){return this.provider.getRowLabelData()},this.getAllValues=function(){return this.provider.getValueData()},this.getRowValues=function(e,t){return this.provider.getRowValueData(e,t)},this.getColumnValues=function(e,t){return this.provider.getColumnValueData(e,t)},this.getCellValues=function(e,t,i){var s=this.view;return isNaN(t)||"number"!=typeof t||(t=(t=s._rowView.getLeafCells(!0)[t])&&t.treePath()),isNaN(i)||"number"!=typeof i||(i=(i=s._columnView.getLeafCells(!0)[i])&&i.treePath()),this.provider.getCellValueData(e,t,i)},this.getCellValuesAt=function(e){return(e=arguments.length<1?this.getCurrent():e)?this.getCellValues(e.valueField,e.rows,e.columns):void 0},this.getColumnFieldNames=function(e){return this.provider.fieldManager().getColumnNames(e)},this.getRowFieldNames=function(e){return this.provider.fieldManager().getRowNames(e)},this.getValueNames=function(e){return this.provider.fieldManager().getValueNames(e)},this.getCurrent=function(){return this.view.getCurrent()},this.onPivotViewClick=function(e,t,i){this.onClick&&this.onClick(e,t,i)},this.onPivotViewDblClick=function(e,t,i){this.onDblClick&&this.onDblClick(e,t,i)},this.onPivotViewTooltip=function(e,t,i){return this.onTooltip?this.onTooltip(e,t,i):i},this.onPivotViewLabelTooltip=function(e,t,i){return this.onLabelTooltip?this.onLabelTooltip(e,t,i):i},this.onPivotViewCurrentChanged=function(e,t){this.onCurrentChanged&&this.onCurrentChanged(e,t)},this.onPivotViewSetupChanging=function(e,t,i){return!this.onSetupChanging||this.onSetupChanging(e,t,i)},this.onPivotViewSorting=function(e,t,i,s){return!this.onSorting||this.onSorting(e,t,i,s)}};